diff -Naur -r --no-dereference ./mednafen/configure ./emu4crt/configure
--- ./mednafen/configure	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/configure	2019-10-04 14:21:10.049110256 -0700
@@ -18087,7 +18087,8 @@
 fi
 
 
-	LIBS="-mconsole -lws2_32 -ldxguid -lwinmm -ldinput $LIBS -lwinmm"
+/* SLK - switch -mconsole */
+	LIBS="-mwindows -lws2_32 -ldxguid -lwinmm -ldinput $LIBS -lwinmm"
 	CPPFLAGS="-D_LFS64_LARGEFILE=1 $CPPFLAGS"
 elif expr x"$host" : 'x.*djgpp' > /dev/null; then
 
diff -Naur -r --no-dereference ./mednafen/configure.orig ./emu4crt/configure.orig
--- ./mednafen/configure.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/configure.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,21590 @@
+#! /bin/sh
+# Guess values for system-dependent variables and create Makefiles.
+# Generated by GNU Autoconf 2.69.
+#
+#
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
+#
+#
+# This configure script is free software; the Free Software Foundation
+# gives unlimited permission to copy, distribute and modify it.
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
+
+# Be more Bourne compatible
+DUALCASE=1; export DUALCASE # for MKS sh
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+"$@"}'='"$@"'
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
+fi
+
+
+as_nl='
+'
+export as_nl
+# Printing a long string crashes Solaris 7 /usr/bin/printf.
+as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='printf %s\n'
+  as_echo_n='printf %s'
+else
+  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
+    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
+    as_echo_n='/usr/ucb/echo -n'
+  else
+    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
+    as_echo_n_body='eval
+      arg=$1;
+      case $arg in #(
+      *"$as_nl"*)
+	expr "X$arg" : "X\\(.*\\)$as_nl";
+	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
+      esac;
+      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
+    '
+    export as_echo_n_body
+    as_echo_n='sh -c $as_echo_n_body as_echo'
+  fi
+  export as_echo_body
+  as_echo='sh -c $as_echo_body as_echo'
+fi
+
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  PATH_SEPARATOR=:
+  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
+    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
+      PATH_SEPARATOR=';'
+  }
+fi
+
+
+# IFS
+# We need space, tab and new line, in precisely that order.  Quoting is
+# there to prevent editors from complaining about space-tab.
+# (If _AS_PATH_WALK were called with IFS unset, it would disable word
+# splitting by setting IFS to empty value.)
+IFS=" ""	$as_nl"
+
+# Find who we are.  Look in the path if we contain no directory separator.
+as_myself=
+case $0 in #((
+  *[\\/]* ) as_myself=$0 ;;
+  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
+IFS=$as_save_IFS
+
+     ;;
+esac
+# We did not find ourselves, most probably we were run as `sh COMMAND'
+# in which case we are not to be found in the path.
+if test "x$as_myself" = x; then
+  as_myself=$0
+fi
+if test ! -f "$as_myself"; then
+  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
+  exit 1
+fi
+
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
+done
+PS1='$ '
+PS2='> '
+PS4='+ '
+
+# NLS nuisances.
+LC_ALL=C
+export LC_ALL
+LANGUAGE=C
+export LANGUAGE
+
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
+if test "x$CONFIG_SHELL" = x; then
+  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '\${1+\"\$@\"}'='\"\$@\"'
+  setopt NO_GLOB_SUBST
+else
+  case \`(set -o) 2>/dev/null\` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
+fi
+"
+  as_required="as_fn_return () { (exit \$1); }
+as_fn_success () { as_fn_return 0; }
+as_fn_failure () { as_fn_return 1; }
+as_fn_ret_success () { return 0; }
+as_fn_ret_failure () { return 1; }
+
+exitcode=0
+as_fn_success || { exitcode=1; echo as_fn_success failed.; }
+as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
+as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
+as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
+if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
+
+else
+  exitcode=1; echo positional parameters were not saved.
+fi
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
+  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
+  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
+  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
+  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
+test \$(( 1 + 1 )) = 2 || exit 1"
+  if (eval "$as_required") 2>/dev/null; then :
+  as_have_required=yes
+else
+  as_have_required=no
+fi
+  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :
+
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+as_found=false
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  as_found=:
+  case $as_dir in #(
+	 /*)
+	   for as_base in sh bash ksh sh5; do
+	     # Try only shells that exist, to save several forks.
+	     as_shell=$as_dir/$as_base
+	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
+		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  CONFIG_SHELL=$as_shell as_have_required=yes
+		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
+  break 2
+fi
+fi
+	   done;;
+       esac
+  as_found=false
+done
+$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
+	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
+  CONFIG_SHELL=$SHELL as_have_required=yes
+fi; }
+IFS=$as_save_IFS
+
+
+      if test "x$CONFIG_SHELL" != x; then :
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
+fi
+
+    if test x$as_have_required = xno; then :
+  $as_echo "$0: This script requires a shell more modern than all"
+  $as_echo "$0: the shells that I found on your system."
+  if test x${ZSH_VERSION+set} = xset ; then
+    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
+    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
+  else
+    $as_echo "$0: Please tell bug-autoconf@gnu.org about your system,
+$0: including any error possibly output before this
+$0: message. Then install a modern shell, or manually run
+$0: the script under such a shell if you do have one."
+  fi
+  exit 1
+fi
+fi
+fi
+SHELL=${CONFIG_SHELL-/bin/sh}
+export SHELL
+# Unset more variables known to interfere with behavior of common tools.
+CLICOLOR_FORCE= GREP_OPTIONS=
+unset CLICOLOR_FORCE GREP_OPTIONS
+
+## --------------------- ##
+## M4sh Shell Functions. ##
+## --------------------- ##
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+if expr a : '\(a\)' >/dev/null 2>&1 &&
+   test "X`expr 00001 : '.*\(...\)'`" = X001; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
+fi
+
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
+
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+
+  as_lineno_1=$LINENO as_lineno_1a=$LINENO
+  as_lineno_2=$LINENO as_lineno_2a=$LINENO
+  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
+  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
+  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
+  sed -n '
+    p
+    /[$]LINENO/=
+  ' <$as_myself |
+    sed '
+      s/[$]LINENO.*/&-/
+      t lineno
+      b
+      :lineno
+      N
+      :loop
+      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
+      t loop
+      s/-\n.*//
+    ' >$as_me.lineno &&
+  chmod +x "$as_me.lineno" ||
+    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
+
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
+  # Don't try to exec as it changes $[0], causing all sort of problems
+  # (the dirname of $[0] is not the place where we might find the
+  # original and so on.  Autoconf is especially sensitive to this).
+  . "./$as_me.lineno"
+  # Exit status is that of the last command.
+  exit
+}
+
+ECHO_C= ECHO_N= ECHO_T=
+case `echo -n x` in #(((((
+-n*)
+  case `echo 'xy\c'` in
+  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
+  esac;;
+*)
+  ECHO_N='-n';;
+esac
+
+rm -f conf$$ conf$$.exe conf$$.file
+if test -d conf$$.dir; then
+  rm -f conf$$.dir/conf$$.file
+else
+  rm -f conf$$.dir
+  mkdir conf$$.dir 2>/dev/null
+fi
+if (echo >conf$$.file) 2>/dev/null; then
+  if ln -s conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s='ln -s'
+    # ... but there are two gotchas:
+    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+    # In both cases, we have to default to `cp -pR'.
+    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+      as_ln_s='cp -pR'
+  elif ln conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s=ln
+  else
+    as_ln_s='cp -pR'
+  fi
+else
+  as_ln_s='cp -pR'
+fi
+rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
+rmdir conf$$.dir 2>/dev/null
+
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p='mkdir -p "$as_dir"'
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
+fi
+
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
+
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+
+
+test -n "$DJDIR" || exec 7<&0 </dev/null
+exec 6>&1
+
+# Name of the host.
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
+# so uname gets run too.
+ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
+
+#
+# Initializations.
+#
+ac_default_prefix=/usr/local
+ac_clean_files=
+ac_config_libobj_dir=.
+LIBOBJS=
+cross_compiling=no
+subdirs=
+MFLAGS=
+MAKEFLAGS=
+
+# Identity of this package.
+PACKAGE_NAME=
+PACKAGE_TARNAME=
+PACKAGE_VERSION=
+PACKAGE_STRING=
+PACKAGE_BUGREPORT=
+PACKAGE_URL=
+
+ac_unique_file="src/mednafen.cpp"
+# Factoring default headers for most tests.
+ac_includes_default="\
+#include <stdio.h>
+#ifdef HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#ifdef HAVE_SYS_STAT_H
+# include <sys/stat.h>
+#endif
+#ifdef STDC_HEADERS
+# include <stdlib.h>
+# include <stddef.h>
+#else
+# ifdef HAVE_STDLIB_H
+#  include <stdlib.h>
+# endif
+#endif
+#ifdef HAVE_STRING_H
+# if !defined STDC_HEADERS && defined HAVE_MEMORY_H
+#  include <memory.h>
+# endif
+# include <string.h>
+#endif
+#ifdef HAVE_STRINGS_H
+# include <strings.h>
+#endif
+#ifdef HAVE_INTTYPES_H
+# include <inttypes.h>
+#endif
+#ifdef HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#ifdef HAVE_UNISTD_H
+# include <unistd.h>
+#endif"
+
+gt_needs=
+ac_header_list=
+gl_use_threads_default=
+ac_subst_vars='am__EXEEXT_FALSE
+am__EXEEXT_TRUE
+LTLIBOBJS
+LIBOBJS
+AM_CXXFLAGS
+AM_CFLAGS
+TRIO_CFLAGS
+ARCH_POWERPC_ALTIVEC_FALSE
+ARCH_POWERPC_ALTIVEC_TRUE
+ARCH_POWERPC_FALSE
+ARCH_POWERPC_TRUE
+ARCH_X86_64_FALSE
+ARCH_X86_64_TRUE
+ARCH_X86_32_FALSE
+ARCH_X86_32_TRUE
+ARCH_X86_FALSE
+ARCH_X86_TRUE
+HAVE_POSIX_SOCKETS_FALSE
+HAVE_POSIX_SOCKETS_TRUE
+SDL2_CONFIG
+SDL_LIBS
+SDL_CFLAGS
+SDL2_FRAMEWORK
+ENABLE_LIBXXX_MODE_FALSE
+ENABLE_LIBXXX_MODE_TRUE
+HAVE_LINUX_JOYSTICK_FALSE
+HAVE_LINUX_JOYSTICK_TRUE
+UNIX_FALSE
+UNIX_TRUE
+WIN32_FALSE
+WIN32_TRUE
+DOS_FALSE
+DOS_TRUE
+HAVE_SDL_FALSE
+HAVE_SDL_TRUE
+HAVE_WASAPI_FALSE
+HAVE_WASAPI_TRUE
+HAVE_DIRECTSOUND_FALSE
+HAVE_DIRECTSOUND_TRUE
+HAVE_OSSDSP_FALSE
+HAVE_OSSDSP_TRUE
+SNDFILE_LIBS
+SNDFILE_CFLAGS
+HAVE_LIBSNDFILE_FALSE
+HAVE_LIBSNDFILE_TRUE
+LZO2_LIBS
+LZO2_CFLAGS
+HAVE_EXTERNAL_LZO2_FALSE
+HAVE_EXTERNAL_LZO2_TRUE
+TRIO_LIBS
+HAVE_EXTERNAL_TRIO_FALSE
+HAVE_EXTERNAL_TRIO_TRUE
+TREMOR_LIBS
+HAVE_EXTERNAL_TREMOR_FALSE
+HAVE_EXTERNAL_TREMOR_TRUE
+MPCDEC_LIBS
+HAVE_EXTERNAL_MPCDEC_FALSE
+HAVE_EXTERNAL_MPCDEC_TRUE
+HAVE_OPENBSD_AUDIO_FALSE
+HAVE_OPENBSD_AUDIO_TRUE
+JACK_LIBS
+JACK_CFLAGS
+HAVE_JACK_FALSE
+HAVE_JACK_TRUE
+ALSA_LIBS
+ALSA_CFLAGS
+HAVE_ALSA_FALSE
+HAVE_ALSA_TRUE
+NEED_ARCADE_CARD_EMU_FALSE
+NEED_ARCADE_CARD_EMU_TRUE
+NEED_HUC6270_EMU_FALSE
+NEED_HUC6270_EMU_TRUE
+NEED_V810_EMU_FALSE
+NEED_V810_EMU_TRUE
+NEED_Z80_EMU_FALSE
+NEED_Z80_EMU_TRUE
+NEED_68K_EMU_FALSE
+NEED_68K_EMU_TRUE
+NEED_SMS_APU_EMU_FALSE
+NEED_SMS_APU_EMU_TRUE
+NEED_PCE_PSG_EMU_FALSE
+NEED_PCE_PSG_EMU_TRUE
+NEED_YM2612_EMU_FALSE
+NEED_YM2612_EMU_TRUE
+NEED_YM2413_EMU_FALSE
+NEED_YM2413_EMU_TRUE
+NEED_GB_APU_EMU_FALSE
+NEED_GB_APU_EMU_TRUE
+NEED_BLIP_BUFFER_FALSE
+NEED_BLIP_BUFFER_TRUE
+WANT_WSWAN_EMU_FALSE
+WANT_WSWAN_EMU_TRUE
+WANT_VB_EMU_FALSE
+WANT_VB_EMU_TRUE
+WANT_SSFPLAY_EMU_FALSE
+WANT_SSFPLAY_EMU_TRUE
+WANT_SS_EMU_FALSE
+WANT_SS_EMU_TRUE
+WANT_SNES_FAUST_EMU_FALSE
+WANT_SNES_FAUST_EMU_TRUE
+WANT_SNES_EMU_FALSE
+WANT_SNES_EMU_TRUE
+WANT_PSX_EMU_FALSE
+WANT_PSX_EMU_TRUE
+WANT_PCFX_EMU_FALSE
+WANT_PCFX_EMU_TRUE
+WANT_PCE_FAST_EMU_FALSE
+WANT_PCE_FAST_EMU_TRUE
+WANT_PCE_EMU_FALSE
+WANT_PCE_EMU_TRUE
+WANT_NGP_EMU_FALSE
+WANT_NGP_EMU_TRUE
+WANT_NES_NEW_EMU_FALSE
+WANT_NES_NEW_EMU_TRUE
+WANT_NES_EMU_FALSE
+WANT_NES_EMU_TRUE
+WANT_SMS_EMU_FALSE
+WANT_SMS_EMU_TRUE
+WANT_MD_EMU_FALSE
+WANT_MD_EMU_TRUE
+WANT_LYNX_EMU_FALSE
+WANT_LYNX_EMU_TRUE
+WANT_GBA_EMU_FALSE
+WANT_GBA_EMU_TRUE
+WANT_GB_EMU_FALSE
+WANT_GB_EMU_TRUE
+WANT_APPLE2_EMU_FALSE
+WANT_APPLE2_EMU_TRUE
+WANT_FANCY_SCALERS_FALSE
+WANT_FANCY_SCALERS_TRUE
+WANT_DEBUGGER_FALSE
+WANT_DEBUGGER_TRUE
+SS_EXTRA_FLAGS
+SNES_EXTRA_CXXFLAGS
+SNES_EXTRA_FLAGS
+NO_STRICT_ALIASING_FLAGS
+NO_STACK_PROTECTOR_FLAGS
+WARNING_FLAGS
+ZLIB_LIBS
+POSUB
+LTLIBINTL
+LIBINTL
+INTLLIBS
+INTL_LIBTOOL_SUFFIX_PREFIX
+INTLOBJS
+GENCAT
+INSTOBJEXT
+DATADIRNAME
+CATOBJEXT
+USE_INCLUDED_LIBINTL
+BUILD_INCLUDED_LIBINTL
+LTLIBC
+WINDRES
+WOE32
+WOE32DLL
+HAVE_WPRINTF
+HAVE_NEWLOCALE
+HAVE_SNPRINTF
+HAVE_ASPRINTF
+HAVE_POSIX_PRINTF
+INTL_DEFAULT_VERBOSITY
+INTL_MACOSX_LIBS
+GLIBC21
+INTLBISON
+LTLIBMULTITHREAD
+LIBMULTITHREAD
+LTLIBTHREAD
+LIBTHREAD
+LIBPTH_PREFIX
+LTLIBPTH
+LIBPTH
+PRI_MACROS_BROKEN
+ALLOCA
+RANLIB
+GLIBC2
+XGETTEXT_EXTRA_OPTIONS
+MSGMERGE
+XGETTEXT_015
+XGETTEXT
+GMSGFMT_015
+MSGFMT_015
+GMSGFMT
+MSGFMT
+GETTEXT_MACRO_VERSION
+USE_NLS
+LTLIBICONV
+LIBICONV
+PKG_CONFIG_LIBDIR
+PKG_CONFIG_PATH
+PKG_CONFIG
+HAVE_VISIBILITY
+CFLAG_VISIBILITY
+CXXCPP
+am__fastdepCXX_FALSE
+am__fastdepCXX_TRUE
+CXXDEPMODE
+ac_ct_CXX
+CXXFLAGS
+CXX
+am__fastdepCCAS_FALSE
+am__fastdepCCAS_TRUE
+CCASDEPMODE
+CCASFLAGS
+CCAS
+AM_BACKSLASH
+AM_DEFAULT_VERBOSITY
+AM_DEFAULT_V
+AM_V
+am__fastdepCC_FALSE
+am__fastdepCC_TRUE
+CCDEPMODE
+am__nodep
+AMDEPBACKSLASH
+AMDEP_FALSE
+AMDEP_TRUE
+am__quote
+am__include
+DEPDIR
+am__untar
+am__tar
+AMTAR
+am__leading_dot
+SET_MAKE
+AWK
+mkdir_p
+MKDIR_P
+INSTALL_STRIP_PROGRAM
+STRIP
+install_sh
+MAKEINFO
+AUTOHEADER
+AUTOMAKE
+AUTOCONF
+ACLOCAL
+VERSION
+PACKAGE
+CYGPATH_W
+am__isrc
+INSTALL_DATA
+INSTALL_SCRIPT
+INSTALL_PROGRAM
+host_os
+host_vendor
+host_cpu
+host
+build_os
+build_vendor
+build_cpu
+build
+EGREP
+GREP
+CPP
+OBJEXT
+EXEEXT
+ac_ct_CC
+CPPFLAGS
+LDFLAGS
+CFLAGS
+CC
+target_alias
+host_alias
+build_alias
+LIBS
+ECHO_T
+ECHO_N
+ECHO_C
+DEFS
+mandir
+localedir
+libdir
+psdir
+pdfdir
+dvidir
+htmldir
+infodir
+docdir
+oldincludedir
+includedir
+localstatedir
+sharedstatedir
+sysconfdir
+datadir
+datarootdir
+libexecdir
+sbindir
+bindir
+program_transform_name
+prefix
+exec_prefix
+PACKAGE_URL
+PACKAGE_BUGREPORT
+PACKAGE_STRING
+PACKAGE_VERSION
+PACKAGE_TARNAME
+PACKAGE_NAME
+PATH_SEPARATOR
+SHELL'
+ac_subst_files=''
+ac_user_opts='
+enable_option_checking
+enable_dependency_tracking
+enable_silent_rules
+enable_largefile
+with_gnu_ld
+enable_rpath
+with_libiconv_prefix
+enable_nls
+enable_threads
+with_libpth_prefix
+with_included_gettext
+with_libintl_prefix
+enable_libxxx_mode
+enable_dev_build
+enable_debugger
+enable_cjk_fonts
+enable_fancy_scalers
+enable_altivec
+enable_apple2
+enable_gb
+enable_gba
+enable_lynx
+enable_md
+enable_nes
+enable_ngp
+enable_pce
+enable_pce_fast
+enable_pcfx
+enable_psx
+enable_sms
+enable_snes
+enable_snes_faust
+enable_ss
+enable_ssfplay
+enable_vb
+enable_wswan
+enable_alsa
+with_alsa_prefix
+with_alsa_inc_prefix
+enable_alsatest
+enable_jack
+with_external_mpcdec
+with_external_tremor
+with_external_trio
+with_external_lzo
+with_libsndfile
+with_sdl_prefix
+with_sdl_exec_prefix
+enable_sdltest
+enable_sdlframework
+'
+      ac_precious_vars='build_alias
+host_alias
+target_alias
+CC
+CFLAGS
+LDFLAGS
+LIBS
+CPPFLAGS
+CPP
+CCAS
+CCASFLAGS
+CXX
+CXXFLAGS
+CCC
+CXXCPP
+PKG_CONFIG
+PKG_CONFIG_PATH
+PKG_CONFIG_LIBDIR
+JACK_CFLAGS
+JACK_LIBS
+LZO2_CFLAGS
+LZO2_LIBS
+SNDFILE_CFLAGS
+SNDFILE_LIBS
+SDL2_FRAMEWORK
+SDL_CFLAGS
+SDL_LIBS'
+
+
+# Initialize some variables set by options.
+ac_init_help=
+ac_init_version=false
+ac_unrecognized_opts=
+ac_unrecognized_sep=
+# The variables have the same names as the options, with
+# dashes changed to underlines.
+cache_file=/dev/null
+exec_prefix=NONE
+no_create=
+no_recursion=
+prefix=NONE
+program_prefix=NONE
+program_suffix=NONE
+program_transform_name=s,x,x,
+silent=
+site=
+srcdir=
+verbose=
+x_includes=NONE
+x_libraries=NONE
+
+# Installation directory options.
+# These are left unexpanded so users can "make install exec_prefix=/foo"
+# and all the variables that are supposed to be based on exec_prefix
+# by default will actually change.
+# Use braces instead of parens because sh, perl, etc. also accept them.
+# (The list follows the same order as the GNU Coding Standards.)
+bindir='${exec_prefix}/bin'
+sbindir='${exec_prefix}/sbin'
+libexecdir='${exec_prefix}/libexec'
+datarootdir='${prefix}/share'
+datadir='${datarootdir}'
+sysconfdir='${prefix}/etc'
+sharedstatedir='${prefix}/com'
+localstatedir='${prefix}/var'
+includedir='${prefix}/include'
+oldincludedir='/usr/include'
+docdir='${datarootdir}/doc/${PACKAGE}'
+infodir='${datarootdir}/info'
+htmldir='${docdir}'
+dvidir='${docdir}'
+pdfdir='${docdir}'
+psdir='${docdir}'
+libdir='${exec_prefix}/lib'
+localedir='${datarootdir}/locale'
+mandir='${datarootdir}/man'
+
+ac_prev=
+ac_dashdash=
+for ac_option
+do
+  # If the previous option needs an argument, assign it.
+  if test -n "$ac_prev"; then
+    eval $ac_prev=\$ac_option
+    ac_prev=
+    continue
+  fi
+
+  case $ac_option in
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
+  esac
+
+  # Accept the important Cygnus configure options, so we can diagnose typos.
+
+  case $ac_dashdash$ac_option in
+  --)
+    ac_dashdash=yes ;;
+
+  -bindir | --bindir | --bindi | --bind | --bin | --bi)
+    ac_prev=bindir ;;
+  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
+    bindir=$ac_optarg ;;
+
+  -build | --build | --buil | --bui | --bu)
+    ac_prev=build_alias ;;
+  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
+    build_alias=$ac_optarg ;;
+
+  -cache-file | --cache-file | --cache-fil | --cache-fi \
+  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
+    ac_prev=cache_file ;;
+  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
+  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
+    cache_file=$ac_optarg ;;
+
+  --config-cache | -C)
+    cache_file=config.cache ;;
+
+  -datadir | --datadir | --datadi | --datad)
+    ac_prev=datadir ;;
+  -datadir=* | --datadir=* | --datadi=* | --datad=*)
+    datadir=$ac_optarg ;;
+
+  -datarootdir | --datarootdir | --datarootdi | --datarootd | --dataroot \
+  | --dataroo | --dataro | --datar)
+    ac_prev=datarootdir ;;
+  -datarootdir=* | --datarootdir=* | --datarootdi=* | --datarootd=* \
+  | --dataroot=* | --dataroo=* | --dataro=* | --datar=*)
+    datarootdir=$ac_optarg ;;
+
+  -disable-* | --disable-*)
+    ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid feature name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"enable_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--disable-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval enable_$ac_useropt=no ;;
+
+  -docdir | --docdir | --docdi | --doc | --do)
+    ac_prev=docdir ;;
+  -docdir=* | --docdir=* | --docdi=* | --doc=* | --do=*)
+    docdir=$ac_optarg ;;
+
+  -dvidir | --dvidir | --dvidi | --dvid | --dvi | --dv)
+    ac_prev=dvidir ;;
+  -dvidir=* | --dvidir=* | --dvidi=* | --dvid=* | --dvi=* | --dv=*)
+    dvidir=$ac_optarg ;;
+
+  -enable-* | --enable-*)
+    ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid feature name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"enable_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--enable-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval enable_$ac_useropt=\$ac_optarg ;;
+
+  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
+  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
+  | --exec | --exe | --ex)
+    ac_prev=exec_prefix ;;
+  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
+  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
+  | --exec=* | --exe=* | --ex=*)
+    exec_prefix=$ac_optarg ;;
+
+  -gas | --gas | --ga | --g)
+    # Obsolete; use --with-gas.
+    with_gas=yes ;;
+
+  -help | --help | --hel | --he | -h)
+    ac_init_help=long ;;
+  -help=r* | --help=r* | --hel=r* | --he=r* | -hr*)
+    ac_init_help=recursive ;;
+  -help=s* | --help=s* | --hel=s* | --he=s* | -hs*)
+    ac_init_help=short ;;
+
+  -host | --host | --hos | --ho)
+    ac_prev=host_alias ;;
+  -host=* | --host=* | --hos=* | --ho=*)
+    host_alias=$ac_optarg ;;
+
+  -htmldir | --htmldir | --htmldi | --htmld | --html | --htm | --ht)
+    ac_prev=htmldir ;;
+  -htmldir=* | --htmldir=* | --htmldi=* | --htmld=* | --html=* | --htm=* \
+  | --ht=*)
+    htmldir=$ac_optarg ;;
+
+  -includedir | --includedir | --includedi | --included | --include \
+  | --includ | --inclu | --incl | --inc)
+    ac_prev=includedir ;;
+  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
+  | --includ=* | --inclu=* | --incl=* | --inc=*)
+    includedir=$ac_optarg ;;
+
+  -infodir | --infodir | --infodi | --infod | --info | --inf)
+    ac_prev=infodir ;;
+  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
+    infodir=$ac_optarg ;;
+
+  -libdir | --libdir | --libdi | --libd)
+    ac_prev=libdir ;;
+  -libdir=* | --libdir=* | --libdi=* | --libd=*)
+    libdir=$ac_optarg ;;
+
+  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
+  | --libexe | --libex | --libe)
+    ac_prev=libexecdir ;;
+  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
+  | --libexe=* | --libex=* | --libe=*)
+    libexecdir=$ac_optarg ;;
+
+  -localedir | --localedir | --localedi | --localed | --locale)
+    ac_prev=localedir ;;
+  -localedir=* | --localedir=* | --localedi=* | --localed=* | --locale=*)
+    localedir=$ac_optarg ;;
+
+  -localstatedir | --localstatedir | --localstatedi | --localstated \
+  | --localstate | --localstat | --localsta | --localst | --locals)
+    ac_prev=localstatedir ;;
+  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
+  | --localstate=* | --localstat=* | --localsta=* | --localst=* | --locals=*)
+    localstatedir=$ac_optarg ;;
+
+  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
+    ac_prev=mandir ;;
+  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
+    mandir=$ac_optarg ;;
+
+  -nfp | --nfp | --nf)
+    # Obsolete; use --without-fp.
+    with_fp=no ;;
+
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c | -n)
+    no_create=yes ;;
+
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
+    no_recursion=yes ;;
+
+  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
+  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
+  | --oldin | --oldi | --old | --ol | --o)
+    ac_prev=oldincludedir ;;
+  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
+  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
+  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
+    oldincludedir=$ac_optarg ;;
+
+  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
+    ac_prev=prefix ;;
+  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
+    prefix=$ac_optarg ;;
+
+  -program-prefix | --program-prefix | --program-prefi | --program-pref \
+  | --program-pre | --program-pr | --program-p)
+    ac_prev=program_prefix ;;
+  -program-prefix=* | --program-prefix=* | --program-prefi=* \
+  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
+    program_prefix=$ac_optarg ;;
+
+  -program-suffix | --program-suffix | --program-suffi | --program-suff \
+  | --program-suf | --program-su | --program-s)
+    ac_prev=program_suffix ;;
+  -program-suffix=* | --program-suffix=* | --program-suffi=* \
+  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
+    program_suffix=$ac_optarg ;;
+
+  -program-transform-name | --program-transform-name \
+  | --program-transform-nam | --program-transform-na \
+  | --program-transform-n | --program-transform- \
+  | --program-transform | --program-transfor \
+  | --program-transfo | --program-transf \
+  | --program-trans | --program-tran \
+  | --progr-tra | --program-tr | --program-t)
+    ac_prev=program_transform_name ;;
+  -program-transform-name=* | --program-transform-name=* \
+  | --program-transform-nam=* | --program-transform-na=* \
+  | --program-transform-n=* | --program-transform-=* \
+  | --program-transform=* | --program-transfor=* \
+  | --program-transfo=* | --program-transf=* \
+  | --program-trans=* | --program-tran=* \
+  | --progr-tra=* | --program-tr=* | --program-t=*)
+    program_transform_name=$ac_optarg ;;
+
+  -pdfdir | --pdfdir | --pdfdi | --pdfd | --pdf | --pd)
+    ac_prev=pdfdir ;;
+  -pdfdir=* | --pdfdir=* | --pdfdi=* | --pdfd=* | --pdf=* | --pd=*)
+    pdfdir=$ac_optarg ;;
+
+  -psdir | --psdir | --psdi | --psd | --ps)
+    ac_prev=psdir ;;
+  -psdir=* | --psdir=* | --psdi=* | --psd=* | --ps=*)
+    psdir=$ac_optarg ;;
+
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil)
+    silent=yes ;;
+
+  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
+    ac_prev=sbindir ;;
+  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
+  | --sbi=* | --sb=*)
+    sbindir=$ac_optarg ;;
+
+  -sharedstatedir | --sharedstatedir | --sharedstatedi \
+  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
+  | --sharedst | --shareds | --shared | --share | --shar \
+  | --sha | --sh)
+    ac_prev=sharedstatedir ;;
+  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
+  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
+  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
+  | --sha=* | --sh=*)
+    sharedstatedir=$ac_optarg ;;
+
+  -site | --site | --sit)
+    ac_prev=site ;;
+  -site=* | --site=* | --sit=*)
+    site=$ac_optarg ;;
+
+  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
+    ac_prev=srcdir ;;
+  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
+    srcdir=$ac_optarg ;;
+
+  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
+  | --syscon | --sysco | --sysc | --sys | --sy)
+    ac_prev=sysconfdir ;;
+  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
+  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
+    sysconfdir=$ac_optarg ;;
+
+  -target | --target | --targe | --targ | --tar | --ta | --t)
+    ac_prev=target_alias ;;
+  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
+    target_alias=$ac_optarg ;;
+
+  -v | -verbose | --verbose | --verbos | --verbo | --verb)
+    verbose=yes ;;
+
+  -version | --version | --versio | --versi | --vers | -V)
+    ac_init_version=: ;;
+
+  -with-* | --with-*)
+    ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid package name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"with_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--with-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval with_$ac_useropt=\$ac_optarg ;;
+
+  -without-* | --without-*)
+    ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
+      as_fn_error $? "invalid package name: $ac_useropt"
+    ac_useropt_orig=$ac_useropt
+    ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
+    case $ac_user_opts in
+      *"
+"with_$ac_useropt"
+"*) ;;
+      *) ac_unrecognized_opts="$ac_unrecognized_opts$ac_unrecognized_sep--without-$ac_useropt_orig"
+	 ac_unrecognized_sep=', ';;
+    esac
+    eval with_$ac_useropt=no ;;
+
+  --x)
+    # Obsolete; use --with-x.
+    with_x=yes ;;
+
+  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
+  | --x-incl | --x-inc | --x-in | --x-i)
+    ac_prev=x_includes ;;
+  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
+  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
+    x_includes=$ac_optarg ;;
+
+  -x-libraries | --x-libraries | --x-librarie | --x-librari \
+  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
+    ac_prev=x_libraries ;;
+  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
+  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
+    x_libraries=$ac_optarg ;;
+
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
+    ;;
+
+  *=*)
+    ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
+    # Reject names that are not valid shell variable names.
+    case $ac_envvar in #(
+      '' | [0-9]* | *[!_$as_cr_alnum]* )
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
+    esac
+    eval $ac_envvar=\$ac_optarg
+    export $ac_envvar ;;
+
+  *)
+    # FIXME: should be removed in autoconf 3.0.
+    $as_echo "$as_me: WARNING: you should use --build, --host, --target" >&2
+    expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
+      $as_echo "$as_me: WARNING: invalid host type: $ac_option" >&2
+    : "${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}"
+    ;;
+
+  esac
+done
+
+if test -n "$ac_prev"; then
+  ac_option=--`echo $ac_prev | sed 's/_/-/g'`
+  as_fn_error $? "missing argument to $ac_option"
+fi
+
+if test -n "$ac_unrecognized_opts"; then
+  case $enable_option_checking in
+    no) ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
+    *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
+  esac
+fi
+
+# Check all directory arguments for consistency.
+for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
+		datadir sysconfdir sharedstatedir localstatedir includedir \
+		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
+		libdir localedir mandir
+do
+  eval ac_val=\$$ac_var
+  # Remove trailing slashes.
+  case $ac_val in
+    */ )
+      ac_val=`expr "X$ac_val" : 'X\(.*[^/]\)' \| "X$ac_val" : 'X\(.*\)'`
+      eval $ac_var=\$ac_val;;
+  esac
+  # Be sure to have absolute directory names.
+  case $ac_val in
+    [\\/$]* | ?:[\\/]* )  continue;;
+    NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
+  esac
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
+done
+
+# There might be people who depend on the old broken behavior: `$host'
+# used to hold the argument of --host etc.
+# FIXME: To remove some day.
+build=$build_alias
+host=$host_alias
+target=$target_alias
+
+# FIXME: To remove some day.
+if test "x$host_alias" != x; then
+  if test "x$build_alias" = x; then
+    cross_compiling=maybe
+  elif test "x$build_alias" != "x$host_alias"; then
+    cross_compiling=yes
+  fi
+fi
+
+ac_tool_prefix=
+test -n "$host_alias" && ac_tool_prefix=$host_alias-
+
+test "$silent" = yes && exec 6>/dev/null
+
+
+ac_pwd=`pwd` && test -n "$ac_pwd" &&
+ac_ls_di=`ls -di .` &&
+ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
+  as_fn_error $? "working directory cannot be determined"
+test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
+  as_fn_error $? "pwd does not report name of working directory"
+
+
+# Find the source files, if location was not specified.
+if test -z "$srcdir"; then
+  ac_srcdir_defaulted=yes
+  # Try the directory containing this script, then the parent directory.
+  ac_confdir=`$as_dirname -- "$as_myself" ||
+$as_expr X"$as_myself" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_myself" : 'X\(//\)[^/]' \| \
+	 X"$as_myself" : 'X\(//\)$' \| \
+	 X"$as_myself" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_myself" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+  srcdir=$ac_confdir
+  if test ! -r "$srcdir/$ac_unique_file"; then
+    srcdir=..
+  fi
+else
+  ac_srcdir_defaulted=no
+fi
+if test ! -r "$srcdir/$ac_unique_file"; then
+  test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
+fi
+ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
+ac_abs_confdir=`(
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
+	pwd)`
+# When building in place, set srcdir=.
+if test "$ac_abs_confdir" = "$ac_pwd"; then
+  srcdir=.
+fi
+# Remove unnecessary trailing slashes from srcdir.
+# Double slashes in file names in object file debugging info
+# mess up M-x gdb in Emacs.
+case $srcdir in
+*/) srcdir=`expr "X$srcdir" : 'X\(.*[^/]\)' \| "X$srcdir" : 'X\(.*\)'`;;
+esac
+for ac_var in $ac_precious_vars; do
+  eval ac_env_${ac_var}_set=\${${ac_var}+set}
+  eval ac_env_${ac_var}_value=\$${ac_var}
+  eval ac_cv_env_${ac_var}_set=\${${ac_var}+set}
+  eval ac_cv_env_${ac_var}_value=\$${ac_var}
+done
+
+#
+# Report the --help message.
+#
+if test "$ac_init_help" = "long"; then
+  # Omit some internal or obsolete options to make the list less imposing.
+  # This message is too long to be a string in the A/UX 3.1 sh.
+  cat <<_ACEOF
+\`configure' configures this package to adapt to many kinds of systems.
+
+Usage: $0 [OPTION]... [VAR=VALUE]...
+
+To assign environment variables (e.g., CC, CFLAGS...), specify them as
+VAR=VALUE.  See below for descriptions of some of the useful variables.
+
+Defaults for the options are specified in brackets.
+
+Configuration:
+  -h, --help              display this help and exit
+      --help=short        display options specific to this package
+      --help=recursive    display the short help of all the included packages
+  -V, --version           display version information and exit
+  -q, --quiet, --silent   do not print \`checking ...' messages
+      --cache-file=FILE   cache test results in FILE [disabled]
+  -C, --config-cache      alias for \`--cache-file=config.cache'
+  -n, --no-create         do not create output files
+      --srcdir=DIR        find the sources in DIR [configure dir or \`..']
+
+Installation directories:
+  --prefix=PREFIX         install architecture-independent files in PREFIX
+                          [$ac_default_prefix]
+  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
+                          [PREFIX]
+
+By default, \`make install' will install all the files in
+\`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
+an installation prefix other than \`$ac_default_prefix' using \`--prefix',
+for instance \`--prefix=\$HOME'.
+
+For better control, use the options below.
+
+Fine tuning of the installation directories:
+  --bindir=DIR            user executables [EPREFIX/bin]
+  --sbindir=DIR           system admin executables [EPREFIX/sbin]
+  --libexecdir=DIR        program executables [EPREFIX/libexec]
+  --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
+  --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
+  --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
+  --libdir=DIR            object code libraries [EPREFIX/lib]
+  --includedir=DIR        C header files [PREFIX/include]
+  --oldincludedir=DIR     C header files for non-gcc [/usr/include]
+  --datarootdir=DIR       read-only arch.-independent data root [PREFIX/share]
+  --datadir=DIR           read-only architecture-independent data [DATAROOTDIR]
+  --infodir=DIR           info documentation [DATAROOTDIR/info]
+  --localedir=DIR         locale-dependent data [DATAROOTDIR/locale]
+  --mandir=DIR            man documentation [DATAROOTDIR/man]
+  --docdir=DIR            documentation root [DATAROOTDIR/doc/PACKAGE]
+  --htmldir=DIR           html documentation [DOCDIR]
+  --dvidir=DIR            dvi documentation [DOCDIR]
+  --pdfdir=DIR            pdf documentation [DOCDIR]
+  --psdir=DIR             ps documentation [DOCDIR]
+_ACEOF
+
+  cat <<\_ACEOF
+
+Program names:
+  --program-prefix=PREFIX            prepend PREFIX to installed program names
+  --program-suffix=SUFFIX            append SUFFIX to installed program names
+  --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
+
+System types:
+  --build=BUILD     configure for building on BUILD [guessed]
+  --host=HOST       cross-compile to build programs to run on HOST [BUILD]
+_ACEOF
+fi
+
+if test -n "$ac_init_help"; then
+
+  cat <<\_ACEOF
+
+Optional Features:
+  --disable-option-checking  ignore unrecognized --enable/--with options
+  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
+  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --enable-dependency-tracking
+                          do not reject slow dependency extractors
+  --disable-dependency-tracking
+                          speeds up one-time build
+  --enable-silent-rules   less verbose build output (undo: "make V=1")
+  --disable-silent-rules  verbose build output (undo: "make V=0")
+  --disable-largefile     omit support for large files
+  --disable-rpath         do not hardcode runtime library paths
+  --disable-nls           do not use Native Language Support
+  --enable-threads={posix|solaris|pth|win32}
+                          specify multithreading API
+  --disable-threads       build without multithread safety
+  --enable-libxxx-mode    dev use only
+  --enable-dev-build      enable expensive Mednafen developer features
+                          [[default=no]]
+  --enable-debugger       build with internal debugger [[default=yes]]
+  --enable-cjk-fonts      build with internal CJK(Chinese, Japanese, Korean)
+                          fonts [[default=yes]]
+  --enable-fancy-scalers  build with fancy(2xsai, hq2x, etc.) CPU-intensive
+                          software video scalers [[default=yes]]
+  --enable-altivec        use AltiVec extensions on PowerPC/POWER ISA
+                          processors [[default=yes]]
+  --enable-apple2         build with Apple II+ emulation [[default=yes]]
+  --enable-gb             build with GameBoy emulation [[default=yes]]
+  --enable-gba            build with GameBoy Advance emulation [[default=yes]]
+  --enable-lynx           build with Atari Lynx emulation [[default=yes]]
+  --enable-md             build with Sega Genesis/MegaDrive emulation
+                          [[default=yes]]
+  --enable-nes            build with Nintendo Entertainment System emulation
+                          [[default=yes]]
+  --enable-ngp            build with Neo Geo Pocket emulation [[default=yes]]
+  --enable-pce            build with PC Engine(TurboGrafx 16) emulation
+                          [[default=yes]]
+  --enable-pce-fast       build the separate, fast PC Engine(TurboGrafx 16)
+                          emulation [[default=yes]]
+  --enable-pcfx           build with PC-FX emulation [[default=yes]]
+  --enable-psx            build with PlayStation emulation [[default=yes]]
+  --enable-sms            build with SMS+GG emulation [[default=yes]]
+  --enable-snes           build with SNES emulation [[default=yes]]
+  --enable-snes-faust     build with experimental fast SNES emulation
+                          [[default=yes]]
+  --enable-ss             build with Sega Saturn emulation [[default=x86_64
+                          amd64 aarch64* arm64* ppc64* powerpc64*]]
+  --enable-ssfplay        build with SSF playback support [[default=yes]]
+  --enable-vb             build with Virtual Boy emulation [[default=yes]]
+  --enable-wswan          build with WonderSwan emulation [[default=yes]]
+  --enable-alsa           support the ALSA audio API [[default=yes]]
+  --disable-alsatest      Do not try to compile and run a test Alsa program
+  --enable-jack           support the JACK audio API [[default=yes]]
+  --disable-sdltest       Do not try to compile and run a test SDL program
+  --disable-sdlframework Do not search for SDL2.framework
+
+Optional Packages:
+  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
+  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --with-gnu-ld           assume the C compiler uses GNU ld default=no
+  --with-libiconv-prefix[=DIR]  search for libiconv in DIR/include and DIR/lib
+  --without-libiconv-prefix     don't search for libiconv in includedir and libdir
+  --with-libpth-prefix[=DIR]  search for libpth in DIR/include and DIR/lib
+  --without-libpth-prefix     don't search for libpth in includedir and libdir
+  --with-included-gettext use the GNU gettext library included here
+  --with-libintl-prefix[=DIR]  search for libintl in DIR/include and DIR/lib
+  --without-libintl-prefix     don't search for libintl in includedir and libdir
+  --with-alsa-prefix=PFX  Prefix where Alsa library is installed(optional)
+  --with-alsa-inc-prefix=PFX  Prefix where include libraries are (optional)
+  --with-external-mpcdec  compile and link with external mpcdec [default=no]
+  --with-external-tremor  compile and link with external tremor [default=no]
+  --with-external-trio    compile and link with external trio [default=no]
+  --with-external-lzo     compile and link with external LZO [default=no]
+  --with-libsndfile       support various sound file formats in ripped CD
+                          images [default=yes]
+  --with-sdl-prefix=PFX   Prefix where SDL is installed (optional)
+  --with-sdl-exec-prefix=PFX Exec prefix where SDL is installed (optional)
+
+Some influential environment variables:
+  CC          C compiler command
+  CFLAGS      C compiler flags
+  LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
+              nonstandard directory <lib dir>
+  LIBS        libraries to pass to the linker, e.g. -l<library>
+  CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
+              you have headers in a nonstandard directory <include dir>
+  CPP         C preprocessor
+  CCAS        assembler compiler command (defaults to CC)
+  CCASFLAGS   assembler compiler flags (defaults to CFLAGS)
+  CXX         C++ compiler command
+  CXXFLAGS    C++ compiler flags
+  CXXCPP      C++ preprocessor
+  PKG_CONFIG  path to pkg-config utility
+  PKG_CONFIG_PATH
+              directories to add to pkg-config's search path
+  PKG_CONFIG_LIBDIR
+              path overriding pkg-config's built-in search path
+  JACK_CFLAGS C compiler flags for JACK, overriding pkg-config
+  JACK_LIBS   linker flags for JACK, overriding pkg-config
+  LZO2_CFLAGS C compiler flags for LZO2, overriding pkg-config
+  LZO2_LIBS   linker flags for LZO2, overriding pkg-config
+  SNDFILE_CFLAGS
+              C compiler flags for SNDFILE, overriding pkg-config
+  SNDFILE_LIBS
+              linker flags for SNDFILE, overriding pkg-config
+  SDL2_FRAMEWORK
+              Path to SDL2.framework
+  SDL_CFLAGS  C compiler flags for SDL, overriding pkg-config
+  SDL_LIBS    linker flags for SDL, overriding pkg-config
+
+Use these variables to override the choices made by `configure' or to help
+it to find libraries and programs with nonstandard names/locations.
+
+Report bugs to the package provider.
+_ACEOF
+ac_status=$?
+fi
+
+if test "$ac_init_help" = "recursive"; then
+  # If there are subdirs, report their specific --help.
+  for ac_dir in : $ac_subdirs_all; do test "x$ac_dir" = x: && continue
+    test -d "$ac_dir" ||
+      { cd "$srcdir" && ac_pwd=`pwd` && srcdir=. && test -d "$ac_dir"; } ||
+      continue
+    ac_builddir=.
+
+case "$ac_dir" in
+.) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
+*)
+  ac_dir_suffix=/`$as_echo "$ac_dir" | sed 's|^\.[\\/]||'`
+  # A ".." for each directory in $ac_dir_suffix.
+  ac_top_builddir_sub=`$as_echo "$ac_dir_suffix" | sed 's|/[^\\/]*|/..|g;s|/||'`
+  case $ac_top_builddir_sub in
+  "") ac_top_builddir_sub=. ac_top_build_prefix= ;;
+  *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
+  esac ;;
+esac
+ac_abs_top_builddir=$ac_pwd
+ac_abs_builddir=$ac_pwd$ac_dir_suffix
+# for backward compatibility:
+ac_top_builddir=$ac_top_build_prefix
+
+case $srcdir in
+  .)  # We are building in place.
+    ac_srcdir=.
+    ac_top_srcdir=$ac_top_builddir_sub
+    ac_abs_top_srcdir=$ac_pwd ;;
+  [\\/]* | ?:[\\/]* )  # Absolute name.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir
+    ac_abs_top_srcdir=$srcdir ;;
+  *) # Relative name.
+    ac_srcdir=$ac_top_build_prefix$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_build_prefix$srcdir
+    ac_abs_top_srcdir=$ac_pwd/$srcdir ;;
+esac
+ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_suffix
+
+    cd "$ac_dir" || { ac_status=$?; continue; }
+    # Check for guested configure.
+    if test -f "$ac_srcdir/configure.gnu"; then
+      echo &&
+      $SHELL "$ac_srcdir/configure.gnu" --help=recursive
+    elif test -f "$ac_srcdir/configure"; then
+      echo &&
+      $SHELL "$ac_srcdir/configure" --help=recursive
+    else
+      $as_echo "$as_me: WARNING: no configuration information is in $ac_dir" >&2
+    fi || ac_status=$?
+    cd "$ac_pwd" || { ac_status=$?; break; }
+  done
+fi
+
+test -n "$ac_init_help" && exit $ac_status
+if $ac_init_version; then
+  cat <<\_ACEOF
+configure
+generated by GNU Autoconf 2.69
+
+Copyright (C) 2012 Free Software Foundation, Inc.
+This configure script is free software; the Free Software Foundation
+gives unlimited permission to copy, distribute and modify it.
+_ACEOF
+  exit
+fi
+
+## ------------------------ ##
+## Autoconf initialization. ##
+## ------------------------ ##
+
+# ac_fn_c_try_compile LINENO
+# --------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_compile
+
+# ac_fn_c_try_cpp LINENO
+# ----------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_cpp
+
+# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_c_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if eval \${$3+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
+
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_mongrel
+
+# ac_fn_c_try_run LINENO
+# ----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_c_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_run
+
+# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES
+# -------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_c_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_c_check_header_compile
+
+# ac_fn_cxx_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_compile
+
+# ac_fn_cxx_try_cpp LINENO
+# ------------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_cpp
+
+# ac_fn_cxx_try_link LINENO
+# -------------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 test -x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_link
+
+# ac_fn_cxx_check_type LINENO TYPE VAR INCLUDES
+# ---------------------------------------------
+# Tests whether TYPE exists after having included INCLUDES, setting cache
+# variable VAR accordingly.
+ac_fn_cxx_check_type ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=no"
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof ($2))
+	 return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+if (sizeof (($2)))
+	    return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+
+else
+  eval "$3=yes"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_cxx_check_type
+
+# ac_fn_cxx_try_run LINENO
+# ------------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes
+# that executables *can* be run.
+ac_fn_cxx_try_run ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: program exited with status $ac_status" >&5
+       $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+       ac_retval=$ac_status
+fi
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_run
+
+# ac_fn_cxx_compute_int LINENO EXPR VAR INCLUDES
+# ----------------------------------------------
+# Tries to find the compile-time value of EXPR in a program that includes
+# INCLUDES, setting VAR accordingly. Returns whether the value could be
+# computed
+ac_fn_cxx_compute_int ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if test "$cross_compiling" = yes; then
+    # Depending upon the size, compute the lo and hi bounds.
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= 0)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_lo=0 ac_mid=0
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid; break
+else
+  as_fn_arith $ac_mid + 1 && ac_lo=$as_val
+			if test $ac_lo -le $ac_mid; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid + 1 && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) < 0)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_hi=-1 ac_mid=-1
+  while :; do
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) >= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_lo=$ac_mid; break
+else
+  as_fn_arith '(' $ac_mid ')' - 1 && ac_hi=$as_val
+			if test $ac_mid -le $ac_hi; then
+			  ac_lo= ac_hi=
+			  break
+			fi
+			as_fn_arith 2 '*' $ac_mid && ac_mid=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  done
+else
+  ac_lo= ac_hi=
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+# Binary search between lo and hi bounds.
+while test "x$ac_lo" != "x$ac_hi"; do
+  as_fn_arith '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo && ac_mid=$as_val
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+int
+main ()
+{
+static int test_array [1 - 2 * !(($2) <= $ac_mid)];
+test_array [0] = 0;
+return test_array [0];
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_hi=$ac_mid
+else
+  as_fn_arith '(' $ac_mid ')' + 1 && ac_lo=$as_val
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+case $ac_lo in #((
+?*) eval "$3=\$ac_lo"; ac_retval=0 ;;
+'') ac_retval=1 ;;
+esac
+  else
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+static long int longval () { return $2; }
+static unsigned long int ulongval () { return $2; }
+#include <stdio.h>
+#include <stdlib.h>
+int
+main ()
+{
+
+  FILE *f = fopen ("conftest.val", "w");
+  if (! f)
+    return 1;
+  if (($2) < 0)
+    {
+      long int i = longval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%ld", i);
+    }
+  else
+    {
+      unsigned long int i = ulongval ();
+      if (i != ($2))
+	return 1;
+      fprintf (f, "%lu", i);
+    }
+  /* Do not output a trailing newline, as this causes \r\n confusion
+     on some platforms.  */
+  return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  echo >>conftest.val; read $3 <conftest.val; ac_retval=0
+else
+  ac_retval=1
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+rm -f conftest.val
+
+  fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_compute_int
+
+# ac_fn_cxx_check_func LINENO FUNC VAR
+# ------------------------------------
+# Tests whether FUNC exists, setting the cache variable VAR accordingly
+ac_fn_cxx_check_func ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+/* Define $2 to an innocuous variant, in case <limits.h> declares $2.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $2 innocuous_$2
+
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $2 (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
+
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+
+#undef $2
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char $2 ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined __stub_$2 || defined __stub___$2
+choke me
+#endif
+
+int
+main ()
+{
+return $2 ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_cxx_check_func
+
+# ac_fn_cxx_check_header_mongrel LINENO HEADER VAR INCLUDES
+# ---------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_cxx_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if eval \${$3+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
+
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_cxx_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_cxx_check_header_mongrel
+
+# ac_fn_c_try_link LINENO
+# -----------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_c_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_c_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 test -x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_c_try_link
+
+# ac_fn_cxx_check_header_compile LINENO HEADER VAR INCLUDES
+# ---------------------------------------------------------
+# Tests whether HEADER exists and can be compiled using the include files in
+# INCLUDES, setting the cache variable VAR accordingly.
+ac_fn_cxx_check_header_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  eval "$3=yes"
+else
+  eval "$3=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_cxx_check_header_compile
+cat >config.log <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+
+It was created by $as_me, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
+
+  $ $0 $@
+
+_ACEOF
+exec 5>>config.log
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
+
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+
+_ASUNAME
+
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    $as_echo "PATH: $as_dir"
+  done
+IFS=$as_save_IFS
+
+} >&5
+
+cat >&5 <<_ACEOF
+
+
+## ----------- ##
+## Core tests. ##
+## ----------- ##
+
+_ACEOF
+
+
+# Keep a trace of the command line.
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Strip out --silent because we don't want to record it for future runs.
+# Also quote any args containing shell meta-characters.
+# Make two passes to allow for proper duplicate-argument suppression.
+ac_configure_args=
+ac_configure_args0=
+ac_configure_args1=
+ac_must_keep_next=false
+for ac_pass in 1 2
+do
+  for ac_arg
+  do
+    case $ac_arg in
+    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
+    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+    | -silent | --silent | --silen | --sile | --sil)
+      continue ;;
+    *\'*)
+      ac_arg=`$as_echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    case $ac_pass in
+    1) as_fn_append ac_configure_args0 " '$ac_arg'" ;;
+    2)
+      as_fn_append ac_configure_args1 " '$ac_arg'"
+      if test $ac_must_keep_next = true; then
+	ac_must_keep_next=false # Got value, back to normal.
+      else
+	case $ac_arg in
+	  *=* | --config-cache | -C | -disable-* | --disable-* \
+	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+	  | -with-* | --with-* | -without-* | --without-* | --x)
+	    case "$ac_configure_args0 " in
+	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+	    esac
+	    ;;
+	  -* ) ac_must_keep_next=true ;;
+	esac
+      fi
+      as_fn_append ac_configure_args " '$ac_arg'"
+      ;;
+    esac
+  done
+done
+{ ac_configure_args0=; unset ac_configure_args0;}
+{ ac_configure_args1=; unset ac_configure_args1;}
+
+# When interrupted or exit'd, cleanup temporary files, and complete
+# config.log.  We remove comments because anyway the quotes in there
+# would cause problems or look ugly.
+# WARNING: Use '\'' to represent an apostrophe within the trap.
+# WARNING: Do not start the trap code with a newline, due to a FreeBSD 4.0 bug.
+trap 'exit_status=$?
+  # Save into config.log some information that might help in debugging.
+  {
+    echo
+
+    $as_echo "## ---------------- ##
+## Cache variables. ##
+## ---------------- ##"
+    echo
+    # The following way of writing the cache mishandles newlines in values,
+(
+  for ac_var in `(set) 2>&1 | sed -n '\''s/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'\''`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+  (set) 2>&1 |
+    case $as_nl`(ac_space='\'' '\''; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      sed -n \
+	"s/'\''/'\''\\\\'\'''\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\''\\2'\''/p"
+      ;; #(
+    *)
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+)
+    echo
+
+    $as_echo "## ----------------- ##
+## Output variables. ##
+## ----------------- ##"
+    echo
+    for ac_var in $ac_subst_vars
+    do
+      eval ac_val=\$$ac_var
+      case $ac_val in
+      *\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+      esac
+      $as_echo "$ac_var='\''$ac_val'\''"
+    done | sort
+    echo
+
+    if test -n "$ac_subst_files"; then
+      $as_echo "## ------------------- ##
+## File substitutions. ##
+## ------------------- ##"
+      echo
+      for ac_var in $ac_subst_files
+      do
+	eval ac_val=\$$ac_var
+	case $ac_val in
+	*\'\''*) ac_val=`$as_echo "$ac_val" | sed "s/'\''/'\''\\\\\\\\'\'''\''/g"`;;
+	esac
+	$as_echo "$ac_var='\''$ac_val'\''"
+      done | sort
+      echo
+    fi
+
+    if test -s confdefs.h; then
+      $as_echo "## ----------- ##
+## confdefs.h. ##
+## ----------- ##"
+      echo
+      cat confdefs.h
+      echo
+    fi
+    test "$ac_signal" != 0 &&
+      $as_echo "$as_me: caught signal $ac_signal"
+    $as_echo "$as_me: exit $exit_status"
+  } >&5
+  rm -f core *.core core.conftest.* &&
+    rm -f -r conftest* confdefs* conf$$* $ac_clean_files &&
+    exit $exit_status
+' 0
+for ac_signal in 1 2 13 15; do
+  trap 'ac_signal='$ac_signal'; as_fn_exit 1' $ac_signal
+done
+ac_signal=0
+
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -f -r conftest* confdefs.h
+
+$as_echo "/* confdefs.h */" > confdefs.h
+
+# Predefined preprocessor variables.
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_NAME "$PACKAGE_NAME"
+_ACEOF
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
+_ACEOF
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_VERSION "$PACKAGE_VERSION"
+_ACEOF
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_STRING "$PACKAGE_STRING"
+_ACEOF
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+_ACEOF
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_URL "$PACKAGE_URL"
+_ACEOF
+
+
+# Let the site file select an alternate cache file if it wants to.
+# Prefer an explicitly selected file to automatically selected ones.
+ac_site_file1=NONE
+ac_site_file2=NONE
+if test -n "$CONFIG_SITE"; then
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
+elif test "x$prefix" != xNONE; then
+  ac_site_file1=$prefix/share/config.site
+  ac_site_file2=$prefix/etc/config.site
+else
+  ac_site_file1=$ac_default_prefix/share/config.site
+  ac_site_file2=$ac_default_prefix/etc/config.site
+fi
+for ac_site_file in "$ac_site_file1" "$ac_site_file2"
+do
+  test "x$ac_site_file" = xNONE && continue
+  if test /dev/null != "$ac_site_file" && test -r "$ac_site_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
+$as_echo "$as_me: loading site script $ac_site_file" >&6;}
+    sed 's/^/| /' "$ac_site_file" >&5
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5; }
+  fi
+done
+
+if test -r "$cache_file"; then
+  # Some versions of bash will fail to source /dev/null (special files
+  # actually), so we avoid doing that.  DJGPP emulates it as a regular file.
+  if test /dev/null != "$cache_file" && test -f "$cache_file"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: loading cache $cache_file" >&5
+$as_echo "$as_me: loading cache $cache_file" >&6;}
+    case $cache_file in
+      [\\/]* | ?:[\\/]* ) . "$cache_file";;
+      *)                      . "./$cache_file";;
+    esac
+  fi
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: creating cache $cache_file" >&5
+$as_echo "$as_me: creating cache $cache_file" >&6;}
+  >$cache_file
+fi
+
+gt_needs="$gt_needs "
+as_fn_append ac_header_list " stdlib.h"
+as_fn_append ac_header_list " unistd.h"
+as_fn_append ac_header_list " sys/param.h"
+# Check that the precious variables saved in the cache have kept the same
+# value.
+ac_cache_corrupted=false
+for ac_var in $ac_precious_vars; do
+  eval ac_old_set=\$ac_cv_env_${ac_var}_set
+  eval ac_new_set=\$ac_env_${ac_var}_set
+  eval ac_old_val=\$ac_cv_env_${ac_var}_value
+  eval ac_new_val=\$ac_env_${ac_var}_value
+  case $ac_old_set,$ac_new_set in
+    set,)
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,set)
+      { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' was not set in the previous run" >&5
+$as_echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,);;
+    *)
+      if test "x$ac_old_val" != "x$ac_new_val"; then
+	# differences in whitespace do not lead to failure.
+	ac_old_val_w=`echo x $ac_old_val`
+	ac_new_val_w=`echo x $ac_new_val`
+	if test "$ac_old_val_w" != "$ac_new_val_w"; then
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: error: \`$ac_var' has changed since the previous run:" >&5
+$as_echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
+	  ac_cache_corrupted=:
+	else
+	  { $as_echo "$as_me:${as_lineno-$LINENO}: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&5
+$as_echo "$as_me: warning: ignoring whitespace changes in \`$ac_var' since the previous run:" >&2;}
+	  eval $ac_var=\$ac_old_val
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   former value:  \`$ac_old_val'" >&5
+$as_echo "$as_me:   former value:  \`$ac_old_val'" >&2;}
+	{ $as_echo "$as_me:${as_lineno-$LINENO}:   current value: \`$ac_new_val'" >&5
+$as_echo "$as_me:   current value: \`$ac_new_val'" >&2;}
+      fi;;
+  esac
+  # Pass precious variables to config.status.
+  if test "$ac_new_set" = set; then
+    case $ac_new_val in
+    *\'*) ac_arg=$ac_var=`$as_echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
+    *) ac_arg=$ac_var=$ac_new_val ;;
+    esac
+    case " $ac_configure_args " in
+      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
+      *) as_fn_append ac_configure_args " '$ac_arg'" ;;
+    esac
+  fi
+done
+if $ac_cache_corrupted; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
+$as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
+fi
+## -------------------- ##
+## Main body of script. ##
+## -------------------- ##
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+ac_aux_dir=
+for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
+  if test -f "$ac_dir/install-sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install-sh -c"
+    break
+  elif test -f "$ac_dir/install.sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install.sh -c"
+    break
+  elif test -f "$ac_dir/shtool"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/shtool install -c"
+    break
+  fi
+done
+if test -z "$ac_aux_dir"; then
+  as_fn_error $? "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
+fi
+
+# These three variables are undocumented and unsupported,
+# and are intended to be withdrawn in a future Autoconf release.
+# They can cause serious problems if a builder's source tree is in a directory
+# whose full name contains unusual characters.
+ac_config_guess="$SHELL $ac_aux_dir/config.guess"  # Please don't use this var.
+ac_config_sub="$SHELL $ac_aux_dir/config.sub"  # Please don't use this var.
+ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
+
+
+# Expand $ac_aux_dir to an absolute path.
+am_aux_dir=`cd "$ac_aux_dir" && pwd`
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+else
+  CC="$ac_cv_prog_CC"
+fi
+
+if test -z "$CC"; then
+          if test -n "$ac_tool_prefix"; then
+    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  fi
+fi
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
+fi
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl.exe
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+    test -n "$CC" && break
+  done
+fi
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl.exe
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$ac_ct_CC" && break
+done
+
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+fi
+
+fi
+
+
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
+
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
+
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files a.out a.out.dSYM a.exe b.out"
+# Try to create an executable without -o first, disregard a.out.
+# It will help us diagnose broken compilers, and finding out an intuition
+# of exeext.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler works" >&5
+$as_echo_n "checking whether the C compiler works... " >&6; }
+ac_link_default=`$as_echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
+
+# The possible output files:
+ac_files="a.out conftest.exe conftest a.exe a_out.exe b.out conftest.*"
+
+ac_rmfiles=
+for ac_file in $ac_files
+do
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
+    * ) ac_rmfiles="$ac_rmfiles $ac_file";;
+  esac
+done
+rm -f $ac_rmfiles
+
+if { { ac_try="$ac_link_default"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link_default") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  # Autoconf-2.13 could set the ac_cv_exeext variable to `no'.
+# So ignore a value of `no', otherwise this would lead to `EXEEXT = no'
+# in a Makefile.  We should not override ac_cv_exeext if it was cached,
+# so that the user can short-circuit this test for compilers unknown to
+# Autoconf.
+for ac_file in $ac_files ''
+do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj )
+	;;
+    [ab].out )
+	# We found the default executable, but exeext='' is most
+	# certainly right.
+	break;;
+    *.* )
+	if test "${ac_cv_exeext+set}" = set && test "$ac_cv_exeext" != no;
+	then :; else
+	   ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	fi
+	# We set ac_cv_exeext here because the later test for it is not
+	# safe: cross compilers may not add the suffix if given an `-o'
+	# argument, so we may need to know it at that point already.
+	# Even if this section looks crufty: it has the advantage of
+	# actually working.
+	break;;
+    * )
+	break;;
+  esac
+done
+test "$ac_cv_exeext" = no && ac_cv_exeext=
+
+else
+  ac_file=''
+fi
+if test -z "$ac_file"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+$as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler default output file name" >&5
+$as_echo_n "checking for C compiler default output file name... " >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_file" >&5
+$as_echo "$ac_file" >&6; }
+ac_exeext=$ac_cv_exeext
+
+rm -f -r a.out a.out.dSYM a.exe conftest$ac_cv_exeext b.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of executables" >&5
+$as_echo_n "checking for suffix of executables... " >&6; }
+if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  # If both `conftest.exe' and `conftest' are `present' (well, observable)
+# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
+# work properly (i.e., refer to `conftest.exe'), while it won't with
+# `rm'.
+for ac_file in conftest.exe conftest conftest.*; do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM | *.o | *.obj ) ;;
+    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	  break;;
+    * ) break;;
+  esac
+done
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+rm -f conftest conftest$ac_cv_exeext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
+$as_echo "$ac_cv_exeext" >&6; }
+
+rm -f conftest.$ac_ext
+EXEEXT=$ac_cv_exeext
+ac_exeext=$EXEEXT
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+FILE *f = fopen ("conftest.out", "w");
+ return ferror (f) || fclose (f) != 0;
+
+  ;
+  return 0;
+}
+_ACEOF
+ac_clean_files="$ac_clean_files conftest.out"
+# Check that the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are cross compiling" >&5
+$as_echo_n "checking whether we are cross compiling... " >&6; }
+if test "$cross_compiling" != yes; then
+  { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+  if { ac_try='./conftest$ac_cv_exeext'
+  { { case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_try") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; }; then
+    cross_compiling=no
+  else
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details" "$LINENO" 5; }
+    fi
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $cross_compiling" >&5
+$as_echo "$cross_compiling" >&6; }
+
+rm -f conftest.$ac_ext conftest$ac_cv_exeext conftest.out
+ac_clean_files=$ac_clean_files_save
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for suffix of object files" >&5
+$as_echo_n "checking for suffix of object files... " >&6; }
+if ${ac_cv_objext+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.o conftest.obj
+if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then :
+  for ac_file in conftest.o conftest.obj conftest.*; do
+  test -f "$ac_file" || continue;
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.map | *.inf | *.dSYM ) ;;
+    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
+       break;;
+  esac
+done
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+rm -f conftest.$ac_cv_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objext" >&5
+$as_echo "$ac_cv_objext" >&6; }
+OBJEXT=$ac_cv_objext
+ac_objext=$OBJEXT
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
+else
+  GCC=
+fi
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if ${ac_cv_prog_cc_g+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+else
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
+	 CFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
+else
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if ${ac_cv_prog_cc_c89+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+struct stat;
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
+   inside strings and character constants.  */
+#define FOO(x) 'x'
+int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
+int
+main ()
+{
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+  ;
+  return 0;
+}
+_ACEOF
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
+do
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c89=$ac_arg
+fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c89" != "xno" && break
+done
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
+
+fi
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c89" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c89"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
+esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
+
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC understands -c and -o together" >&5
+$as_echo_n "checking whether $CC understands -c and -o together... " >&6; }
+if ${am_cv_prog_cc_c_o+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+  # Make sure it works both with $CC and with simple cc.
+  # Following AC_PROG_CC_C_O, we do the test twice because some
+  # compilers refuse to overwrite an existing .o file with -o,
+  # though they will create one.
+  am_cv_prog_cc_c_o=yes
+  for am_i in 1 2; do
+    if { echo "$as_me:$LINENO: $CC -c conftest.$ac_ext -o conftest2.$ac_objext" >&5
+   ($CC -c conftest.$ac_ext -o conftest2.$ac_objext) >&5 2>&5
+   ac_status=$?
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   (exit $ac_status); } \
+         && test -f conftest2.$ac_objext; then
+      : OK
+    else
+      am_cv_prog_cc_c_o=no
+      break
+    fi
+  done
+  rm -f core conftest*
+  unset am_i
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_prog_cc_c_o" >&5
+$as_echo "$am_cv_prog_cc_c_o" >&6; }
+if test "$am_cv_prog_cc_c_o" != yes; then
+   # Losing compiler, so override with the script.
+   # FIXME: It is wrong to rewrite CC.
+   # But if we don't then we get into trouble of one sort or another.
+   # A longer-term fix would be to have automake use am__CC in this case,
+   # and then we could set am__CC="\$(top_srcdir)/compile \$(CC)"
+   CC="$am_aux_dir/compile $CC"
+fi
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
+$as_echo_n "checking how to run the C preprocessor... " >&6; }
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+  if ${ac_cv_prog_CPP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+      # Double quotes because CPP needs to be expanded
+    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
+    do
+      ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+  break
+fi
+
+    done
+    ac_cv_prog_CPP=$CPP
+
+fi
+  CPP=$ac_cv_prog_CPP
+else
+  ac_cv_prog_CPP=$CPP
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
+$as_echo "$CPP" >&6; }
+ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e" >&5
+$as_echo_n "checking for grep that handles long lines and -e... " >&6; }
+if ${ac_cv_path_GREP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$GREP"; then
+  ac_path_GREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in grep ggrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_GREP" || continue
+# Check for GNU ac_path_GREP and select it if it is found.
+  # Check for GNU $ac_path_GREP
+case `"$ac_path_GREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_GREP="$ac_path_GREP" ac_path_GREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'GREP' >> "conftest.nl"
+    "$ac_path_GREP" -e 'GREP$' -e '-(cannot match)-' < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_GREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_GREP="$ac_path_GREP"
+      ac_path_GREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
+esac
+
+      $ac_path_GREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_GREP"; then
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_GREP=$GREP
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP" >&5
+$as_echo "$ac_cv_path_GREP" >&6; }
+ GREP="$ac_cv_path_GREP"
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+$as_echo_n "checking for egrep... " >&6; }
+if ${ac_cv_path_EGREP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
+   then ac_cv_path_EGREP="$GREP -E"
+   else
+     if test -z "$EGREP"; then
+  ac_path_EGREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in egrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_EGREP" || continue
+# Check for GNU ac_path_EGREP and select it if it is found.
+  # Check for GNU $ac_path_EGREP
+case `"$ac_path_EGREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'EGREP' >> "conftest.nl"
+    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_EGREP="$ac_path_EGREP"
+      ac_path_EGREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
+esac
+
+      $ac_path_EGREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_EGREP"; then
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_EGREP=$EGREP
+fi
+
+   fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
+$as_echo "$ac_cv_path_EGREP" >&6; }
+ EGREP="$ac_cv_path_EGREP"
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
+$as_echo_n "checking for ANSI C header files... " >&6; }
+if ${ac_cv_header_stdc+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_stdc=yes
+else
+  ac_cv_header_stdc=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <string.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "free" >/dev/null 2>&1; then :
+
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+  if test "$cross_compiling" = yes; then :
+  :
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ctype.h>
+#include <stdlib.h>
+#if ((' ' & 0x0FF) == 0x020)
+# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#else
+# define ISLOWER(c) \
+		   (('a' <= (c) && (c) <= 'i') \
+		     || ('j' <= (c) && (c) <= 'r') \
+		     || ('s' <= (c) && (c) <= 'z'))
+# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
+#endif
+
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int
+main ()
+{
+  int i;
+  for (i = 0; i < 256; i++)
+    if (XOR (islower (i), ISLOWER (i))
+	|| toupper (i) != TOUPPER (i))
+      return 2;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+
+else
+  ac_cv_header_stdc=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
+$as_echo "$ac_cv_header_stdc" >&6; }
+if test $ac_cv_header_stdc = yes; then
+
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
+
+fi
+
+# On IRIX 5.3, sys/types and inttypes.h are conflicting.
+for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
+		  inttypes.h stdint.h unistd.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+
+  ac_fn_c_check_header_mongrel "$LINENO" "minix/config.h" "ac_cv_header_minix_config_h" "$ac_includes_default"
+if test "x$ac_cv_header_minix_config_h" = xyes; then :
+  MINIX=yes
+else
+  MINIX=
+fi
+
+
+  if test "$MINIX" = yes; then
+
+$as_echo "#define _POSIX_SOURCE 1" >>confdefs.h
+
+
+$as_echo "#define _POSIX_1_SOURCE 2" >>confdefs.h
+
+
+$as_echo "#define _MINIX 1" >>confdefs.h
+
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether it is safe to define __EXTENSIONS__" >&5
+$as_echo_n "checking whether it is safe to define __EXTENSIONS__... " >&6; }
+if ${ac_cv_safe_to_define___extensions__+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#         define __EXTENSIONS__ 1
+          $ac_includes_default
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_safe_to_define___extensions__=yes
+else
+  ac_cv_safe_to_define___extensions__=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_safe_to_define___extensions__" >&5
+$as_echo "$ac_cv_safe_to_define___extensions__" >&6; }
+  test $ac_cv_safe_to_define___extensions__ = yes &&
+    $as_echo "#define __EXTENSIONS__ 1" >>confdefs.h
+
+  $as_echo "#define _ALL_SOURCE 1" >>confdefs.h
+
+  $as_echo "#define _GNU_SOURCE 1" >>confdefs.h
+
+  $as_echo "#define _POSIX_PTHREAD_SEMANTICS 1" >>confdefs.h
+
+  $as_echo "#define _TANDEM_SOURCE 1" >>confdefs.h
+
+
+
+
+
+
+#
+# Avoid trailing and leading zeroes in the decimal version components to avoid confusing not-so-learned people.
+#
+MEDNAFEN_VERSION='1.23.0-UNSTABLE'
+MEDNAFEN_VERSION_NUMERIC=0x00102300
+#                        0xJJJnnnRR
+
+# Make sure we can run config.sub.
+$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
+$as_echo_n "checking build system type... " >&6; }
+if ${ac_cv_build+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_build_alias=$build_alias
+test "x$ac_build_alias" = x &&
+  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
+test "x$ac_build_alias" = x &&
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
+ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
+$as_echo "$ac_cv_build" >&6; }
+case $ac_cv_build in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
+esac
+build=$ac_cv_build
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_build
+shift
+build_cpu=$1
+build_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+build_os=$*
+IFS=$ac_save_IFS
+case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
+$as_echo_n "checking host system type... " >&6; }
+if ${ac_cv_host+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "x$host_alias" = x; then
+  ac_cv_host=$ac_cv_build
+else
+  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
+$as_echo "$ac_cv_host" >&6; }
+case $ac_cv_host in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
+esac
+host=$ac_cv_host
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_host
+shift
+host_cpu=$1
+host_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+host_os=$*
+IFS=$ac_save_IFS
+case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
+
+
+am__api_version='1.14'
+
+# Find a good install program.  We prefer a C program (faster),
+# so one script is as good as another.  But avoid the broken or
+# incompatible versions:
+# SysV /etc/install, /usr/sbin/install
+# SunOS /usr/etc/install
+# IRIX /sbin/install
+# AIX /bin/install
+# AmigaOS /C/install, which installs bootblocks on floppy discs
+# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
+# AFS /usr/afsws/bin/install, which mishandles nonexistent args
+# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
+# OS/2's system install, which has a completely different semantic
+# ./install, which can be erroneously created by make from ./install.sh.
+# Reject install programs that cannot install multiple files.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a BSD-compatible install" >&5
+$as_echo_n "checking for a BSD-compatible install... " >&6; }
+if test -z "$INSTALL"; then
+if ${ac_cv_path_install+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in #((
+  ./ | .// | /[cC]/* | \
+  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
+  ?:[\\/]os2[\\/]install[\\/]* | ?:[\\/]OS2[\\/]INSTALL[\\/]* | \
+  /usr/ucb/* ) ;;
+  *)
+    # OSF1 and SCO ODT 3.0 have their own names for install.
+    # Don't use installbsd from OSF since it installs stuff as root
+    # by default.
+    for ac_prog in ginstall scoinst install; do
+      for ac_exec_ext in '' $ac_executable_extensions; do
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
+	  if test $ac_prog = install &&
+	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # AIX install.  It has an incompatible calling convention.
+	    :
+	  elif test $ac_prog = install &&
+	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # program-specific install script used by HP pwplus--don't use.
+	    :
+	  else
+	    rm -rf conftest.one conftest.two conftest.dir
+	    echo one > conftest.one
+	    echo two > conftest.two
+	    mkdir conftest.dir
+	    if "$as_dir/$ac_prog$ac_exec_ext" -c conftest.one conftest.two "`pwd`/conftest.dir" &&
+	      test -s conftest.one && test -s conftest.two &&
+	      test -s conftest.dir/conftest.one &&
+	      test -s conftest.dir/conftest.two
+	    then
+	      ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+	      break 3
+	    fi
+	  fi
+	fi
+      done
+    done
+    ;;
+esac
+
+  done
+IFS=$as_save_IFS
+
+rm -rf conftest.one conftest.two conftest.dir
+
+fi
+  if test "${ac_cv_path_install+set}" = set; then
+    INSTALL=$ac_cv_path_install
+  else
+    # As a last resort, use the slow shell script.  Don't cache a
+    # value for INSTALL within a source directory, because that will
+    # break other packages using the cache if that directory is
+    # removed, or if the value is a relative name.
+    INSTALL=$ac_install_sh
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $INSTALL" >&5
+$as_echo "$INSTALL" >&6; }
+
+# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
+# It thinks the first close brace ends the variable substitution.
+test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
+
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
+
+test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether build environment is sane" >&5
+$as_echo_n "checking whether build environment is sane... " >&6; }
+# Reject unsafe characters in $srcdir or the absolute working directory
+# name.  Accept space and tab only in the latter.
+am_lf='
+'
+case `pwd` in
+  *[\\\"\#\$\&\'\`$am_lf]*)
+    as_fn_error $? "unsafe absolute working directory name" "$LINENO" 5;;
+esac
+case $srcdir in
+  *[\\\"\#\$\&\'\`$am_lf\ \	]*)
+    as_fn_error $? "unsafe srcdir value: '$srcdir'" "$LINENO" 5;;
+esac
+
+# Do 'set' in a subshell so we don't clobber the current shell's
+# arguments.  Must try -L first in case configure is actually a
+# symlink; some systems play weird games with the mod time of symlinks
+# (eg FreeBSD returns the mod time of the symlink's containing
+# directory).
+if (
+   am_has_slept=no
+   for am_try in 1 2; do
+     echo "timestamp, slept: $am_has_slept" > conftest.file
+     set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
+     if test "$*" = "X"; then
+	# -L didn't work.
+	set X `ls -t "$srcdir/configure" conftest.file`
+     fi
+     if test "$*" != "X $srcdir/configure conftest.file" \
+	&& test "$*" != "X conftest.file $srcdir/configure"; then
+
+	# If neither matched, then we have a broken ls.  This can happen
+	# if, for instance, CONFIG_SHELL is bash and it inherits a
+	# broken ls alias from the environment.  This has actually
+	# happened.  Such a system could not be considered "sane".
+	as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
+  alias in your environment" "$LINENO" 5
+     fi
+     if test "$2" = conftest.file || test $am_try -eq 2; then
+       break
+     fi
+     # Just in case.
+     sleep 1
+     am_has_slept=yes
+   done
+   test "$2" = conftest.file
+   )
+then
+   # Ok.
+   :
+else
+   as_fn_error $? "newly created file is older than distributed files!
+Check your system clock" "$LINENO" 5
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+# If we didn't sleep, we still need to ensure time stamps of config.status and
+# generated files are strictly newer.
+am_sleep_pid=
+if grep 'slept: no' conftest.file >/dev/null 2>&1; then
+  ( sleep 1 ) &
+  am_sleep_pid=$!
+fi
+
+rm -f conftest.file
+
+test "$program_prefix" != NONE &&
+  program_transform_name="s&^&$program_prefix&;$program_transform_name"
+# Use a double $ so make ignores it.
+test "$program_suffix" != NONE &&
+  program_transform_name="s&\$&$program_suffix&;$program_transform_name"
+# Double any \ or $.
+# By default was `s,x,x', remove it if useless.
+ac_script='s/[\\$]/&&/g;s/;s,x,x,$//'
+program_transform_name=`$as_echo "$program_transform_name" | sed "$ac_script"`
+
+if test x"${MISSING+set}" != xset; then
+  case $am_aux_dir in
+  *\ * | *\	*)
+    MISSING="\${SHELL} \"$am_aux_dir/missing\"" ;;
+  *)
+    MISSING="\${SHELL} $am_aux_dir/missing" ;;
+  esac
+fi
+# Use eval to expand $SHELL
+if eval "$MISSING --is-lightweight"; then
+  am_missing_run="$MISSING "
+else
+  am_missing_run=
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: 'missing' script is too old or missing" >&5
+$as_echo "$as_me: WARNING: 'missing' script is too old or missing" >&2;}
+fi
+
+if test x"${install_sh}" != xset; then
+  case $am_aux_dir in
+  *\ * | *\	*)
+    install_sh="\${SHELL} '$am_aux_dir/install-sh'" ;;
+  *)
+    install_sh="\${SHELL} $am_aux_dir/install-sh"
+  esac
+fi
+
+# Installed binaries are usually stripped using 'strip' when the user
+# run "make install-strip".  However 'strip' might not be the right
+# tool to use in cross-compilation environments, therefore Automake
+# will honor the 'STRIP' environment variable to overrule this program.
+if test "$cross_compiling" != no; then
+  if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
+set dummy ${ac_tool_prefix}strip; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$STRIP"; then
+  ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_STRIP="${ac_tool_prefix}strip"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+STRIP=$ac_cv_prog_STRIP
+if test -n "$STRIP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $STRIP" >&5
+$as_echo "$STRIP" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_STRIP"; then
+  ac_ct_STRIP=$STRIP
+  # Extract the first word of "strip", so it can be a program name with args.
+set dummy strip; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_STRIP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_STRIP"; then
+  ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_STRIP="strip"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
+if test -n "$ac_ct_STRIP"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_STRIP" >&5
+$as_echo "$ac_ct_STRIP" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_STRIP" = x; then
+    STRIP=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    STRIP=$ac_ct_STRIP
+  fi
+else
+  STRIP="$ac_cv_prog_STRIP"
+fi
+
+fi
+INSTALL_STRIP_PROGRAM="\$(install_sh) -c -s"
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a thread-safe mkdir -p" >&5
+$as_echo_n "checking for a thread-safe mkdir -p... " >&6; }
+if test -z "$MKDIR_P"; then
+  if ${ac_cv_path_mkdir+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/opt/sfw/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in mkdir gmkdir; do
+	 for ac_exec_ext in '' $ac_executable_extensions; do
+	   as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext" || continue
+	   case `"$as_dir/$ac_prog$ac_exec_ext" --version 2>&1` in #(
+	     'mkdir (GNU coreutils) '* | \
+	     'mkdir (coreutils) '* | \
+	     'mkdir (fileutils) '4.1*)
+	       ac_cv_path_mkdir=$as_dir/$ac_prog$ac_exec_ext
+	       break 3;;
+	   esac
+	 done
+       done
+  done
+IFS=$as_save_IFS
+
+fi
+
+  test -d ./--version && rmdir ./--version
+  if test "${ac_cv_path_mkdir+set}" = set; then
+    MKDIR_P="$ac_cv_path_mkdir -p"
+  else
+    # As a last resort, use the slow shell script.  Don't cache a
+    # value for MKDIR_P within a source directory, because that will
+    # break other packages using the cache if that directory is
+    # removed, or if the value is a relative name.
+    MKDIR_P="$ac_install_sh -d"
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $MKDIR_P" >&5
+$as_echo "$MKDIR_P" >&6; }
+
+for ac_prog in gawk mawk nawk awk
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_AWK+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$AWK"; then
+  ac_cv_prog_AWK="$AWK" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AWK="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+AWK=$ac_cv_prog_AWK
+if test -n "$AWK"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $AWK" >&5
+$as_echo "$AWK" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$AWK" && break
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+$as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
+set x ${MAKE-make}
+ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
+if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat >conftest.make <<\_ACEOF
+SHELL = /bin/sh
+all:
+	@echo '@@@%%%=$(MAKE)=@@@%%%'
+_ACEOF
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
+case `${MAKE-make} -f conftest.make 2>/dev/null` in
+  *@@@%%%=?*=@@@%%%*)
+    eval ac_cv_prog_make_${ac_make}_set=yes;;
+  *)
+    eval ac_cv_prog_make_${ac_make}_set=no;;
+esac
+rm -f conftest.make
+fi
+if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+  SET_MAKE=
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+  SET_MAKE="MAKE=${MAKE-make}"
+fi
+
+rm -rf .tst 2>/dev/null
+mkdir .tst 2>/dev/null
+if test -d .tst; then
+  am__leading_dot=.
+else
+  am__leading_dot=_
+fi
+rmdir .tst 2>/dev/null
+
+DEPDIR="${am__leading_dot}deps"
+
+ac_config_commands="$ac_config_commands depfiles"
+
+
+am_make=${MAKE-make}
+cat > confinc << 'END'
+am__doit:
+	@echo this is the am__doit target
+.PHONY: am__doit
+END
+# If we don't find an include directive, just comment out the code.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for style of include used by $am_make" >&5
+$as_echo_n "checking for style of include used by $am_make... " >&6; }
+am__include="#"
+am__quote=
+_am_result=none
+# First try GNU make style include.
+echo "include confinc" > confmf
+# Ignore all kinds of additional output from 'make'.
+case `$am_make -s -f confmf 2> /dev/null` in #(
+*the\ am__doit\ target*)
+  am__include=include
+  am__quote=
+  _am_result=GNU
+  ;;
+esac
+# Now try BSD make style include.
+if test "$am__include" = "#"; then
+   echo '.include "confinc"' > confmf
+   case `$am_make -s -f confmf 2> /dev/null` in #(
+   *the\ am__doit\ target*)
+     am__include=.include
+     am__quote="\""
+     _am_result=BSD
+     ;;
+   esac
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $_am_result" >&5
+$as_echo "$_am_result" >&6; }
+rm -f confinc confmf
+
+# Check whether --enable-dependency-tracking was given.
+if test "${enable_dependency_tracking+set}" = set; then :
+  enableval=$enable_dependency_tracking;
+fi
+
+if test "x$enable_dependency_tracking" != xno; then
+  am_depcomp="$ac_aux_dir/depcomp"
+  AMDEPBACKSLASH='\'
+  am__nodep='_no'
+fi
+ if test "x$enable_dependency_tracking" != xno; then
+  AMDEP_TRUE=
+  AMDEP_FALSE='#'
+else
+  AMDEP_TRUE='#'
+  AMDEP_FALSE=
+fi
+
+
+# Check whether --enable-silent-rules was given.
+if test "${enable_silent_rules+set}" = set; then :
+  enableval=$enable_silent_rules;
+fi
+
+case $enable_silent_rules in # (((
+  yes) AM_DEFAULT_VERBOSITY=0;;
+   no) AM_DEFAULT_VERBOSITY=1;;
+    *) AM_DEFAULT_VERBOSITY=1;;
+esac
+am_make=${MAKE-make}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $am_make supports nested variables" >&5
+$as_echo_n "checking whether $am_make supports nested variables... " >&6; }
+if ${am_cv_make_support_nested_variables+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if $as_echo 'TRUE=$(BAR$(V))
+BAR0=false
+BAR1=true
+V=1
+am__doit:
+	@$(TRUE)
+.PHONY: am__doit' | $am_make -f - >/dev/null 2>&1; then
+  am_cv_make_support_nested_variables=yes
+else
+  am_cv_make_support_nested_variables=no
+fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_make_support_nested_variables" >&5
+$as_echo "$am_cv_make_support_nested_variables" >&6; }
+if test $am_cv_make_support_nested_variables = yes; then
+    AM_V='$(V)'
+  AM_DEFAULT_V='$(AM_DEFAULT_VERBOSITY)'
+else
+  AM_V=$AM_DEFAULT_VERBOSITY
+  AM_DEFAULT_V=$AM_DEFAULT_VERBOSITY
+fi
+AM_BACKSLASH='\'
+
+if test "`cd $srcdir && pwd`" != "`pwd`"; then
+  # Use -I$(srcdir) only when $(srcdir) != ., so that make's output
+  # is not polluted with repeated "-I."
+  am__isrc=' -I$(srcdir)'
+  # test to see if srcdir already configured
+  if test -f $srcdir/config.status; then
+    as_fn_error $? "source directory already configured; run \"make distclean\" there first" "$LINENO" 5
+  fi
+fi
+
+# test whether we have cygpath
+if test -z "$CYGPATH_W"; then
+  if (cygpath --version) >/dev/null 2>/dev/null; then
+    CYGPATH_W='cygpath -w'
+  else
+    CYGPATH_W=echo
+  fi
+fi
+
+
+# Define the identity of the package.
+
+ PACKAGE=mednafen
+ VERSION=$MEDNAFEN_VERSION
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE "$PACKAGE"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define VERSION "$VERSION"
+_ACEOF
+
+# Some tools Automake needs.
+
+ACLOCAL=${ACLOCAL-"${am_missing_run}aclocal-${am__api_version}"}
+
+
+AUTOCONF=${AUTOCONF-"${am_missing_run}autoconf"}
+
+
+AUTOMAKE=${AUTOMAKE-"${am_missing_run}automake-${am__api_version}"}
+
+
+AUTOHEADER=${AUTOHEADER-"${am_missing_run}autoheader"}
+
+
+MAKEINFO=${MAKEINFO-"${am_missing_run}makeinfo"}
+
+# For better backward compatibility.  To be removed once Automake 1.9.x
+# dies out for good.  For more background, see:
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00001.html>
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00014.html>
+mkdir_p='$(MKDIR_P)'
+
+# We need awk for the "check" target.  The system "awk" is bad on
+# some platforms.
+# Always define AMTAR for backward compatibility.  Yes, it's still used
+# in the wild :-(  We should find a proper way to deprecate it ...
+AMTAR='$${TAR-tar}'
+
+
+# We'll loop over all known methods to create a tar archive until one works.
+_am_tools='gnutar  pax cpio none'
+
+am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'
+
+
+
+
+
+depcc="$CC"   am_compiler_list=
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
+$as_echo_n "checking dependency style of $depcc... " >&6; }
+if ${am_cv_CC_dependencies_compiler_type+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
+  rm -rf conftest.dir
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_CC_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
+  fi
+  am__universal=false
+  case " $depcc " in #(
+     *\ -arch\ *\ -arch\ *) am__universal=true ;;
+     esac
+
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
+    am__obj=sub/conftest.${OBJEXT-o}
+    am__minus_obj="-o $am__obj"
+    case $depmode in
+    gcc)
+      # This depmode causes a compiler race in universal mode.
+      test "$am__universal" = false || continue
+      ;;
+    nosideeffect)
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
+      # This compiler won't grok '-c -o', but also, the minuso test has
+      # not run yet.  These depmodes are late enough in the game, and
+      # so weak that their functioning should not be impacted.
+      am__obj=conftest.${OBJEXT-o}
+      am__minus_obj=
+      ;;
+    none) break ;;
+    esac
+    if depmode=$depmode \
+       source=sub/conftest.c object=$am__obj \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # or remarks (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored or not supported.
+      # When given -MP, icc 7.0 and 7.1 complain thusly:
+      #   icc: Command line warning: ignoring option '-M'; no argument required
+      # The diagnosis changed in icc 8.0:
+      #   icc: Command line remark: option '-MP' not supported
+      if (grep 'ignoring option' conftest.err ||
+          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
+        am_cv_CC_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_CC_dependencies_compiler_type=none
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CC_dependencies_compiler_type" >&5
+$as_echo "$am_cv_CC_dependencies_compiler_type" >&6; }
+CCDEPMODE=depmode=$am_cv_CC_dependencies_compiler_type
+
+ if
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_CC_dependencies_compiler_type" = gcc3; then
+  am__fastdepCC_TRUE=
+  am__fastdepCC_FALSE='#'
+else
+  am__fastdepCC_TRUE='#'
+  am__fastdepCC_FALSE=
+fi
+
+
+
+# POSIX will say in a future version that running "rm -f" with no argument
+# is OK; and we want to be able to make that assumption in our Makefile
+# recipes.  So use an aggressive probe to check that the usage we want is
+# actually supported "in the wild" to an acceptable degree.
+# See automake bug#10828.
+# To make any issue more visible, cause the running configure to be aborted
+# by default if the 'rm' program in use doesn't match our expectations; the
+# user can still override this though.
+if rm -f && rm -fr && rm -rf; then : OK; else
+  cat >&2 <<'END'
+Oops!
+
+Your 'rm' program seems unable to run without file operands specified
+on the command line, even when the '-f' option is present.  This is contrary
+to the behaviour of most rm programs out there, and not conforming with
+the upcoming POSIX standard: <http://austingroupbugs.net/view.php?id=542>
+
+Please tell bug-automake@gnu.org about your system, including the value
+of your $PATH and any error possibly output before this message.  This
+can help us improve future automake versions.
+
+END
+  if test x"$ACCEPT_INFERIOR_RM_PROGRAM" = x"yes"; then
+    echo 'Configuration will proceed anyway, since you have set the' >&2
+    echo 'ACCEPT_INFERIOR_RM_PROGRAM variable to "yes"' >&2
+    echo >&2
+  else
+    cat >&2 <<'END'
+Aborting the configuration process, to ensure you take notice of the issue.
+
+You can download and install GNU coreutils to get an 'rm' implementation
+that behaves properly: <http://www.gnu.org/software/coreutils/>.
+
+If you want to complete the configuration process using your problematic
+'rm' anyway, export the environment variable ACCEPT_INFERIOR_RM_PROGRAM
+to "yes", and re-run configure.
+
+END
+    as_fn_error $? "Your 'rm' program is bad, sorry." "$LINENO" 5
+  fi
+fi
+
+# Check whether --enable-silent-rules was given.
+if test "${enable_silent_rules+set}" = set; then :
+  enableval=$enable_silent_rules;
+fi
+
+case $enable_silent_rules in # (((
+  yes) AM_DEFAULT_VERBOSITY=0;;
+   no) AM_DEFAULT_VERBOSITY=1;;
+    *) AM_DEFAULT_VERBOSITY=1;;
+esac
+am_make=${MAKE-make}
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $am_make supports nested variables" >&5
+$as_echo_n "checking whether $am_make supports nested variables... " >&6; }
+if ${am_cv_make_support_nested_variables+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if $as_echo 'TRUE=$(BAR$(V))
+BAR0=false
+BAR1=true
+V=1
+am__doit:
+	@$(TRUE)
+.PHONY: am__doit' | $am_make -f - >/dev/null 2>&1; then
+  am_cv_make_support_nested_variables=yes
+else
+  am_cv_make_support_nested_variables=no
+fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_make_support_nested_variables" >&5
+$as_echo "$am_cv_make_support_nested_variables" >&6; }
+if test $am_cv_make_support_nested_variables = yes; then
+    AM_V='$(V)'
+  AM_DEFAULT_V='$(AM_DEFAULT_VERBOSITY)'
+else
+  AM_V=$AM_DEFAULT_VERBOSITY
+  AM_DEFAULT_V=$AM_DEFAULT_VERBOSITY
+fi
+AM_BACKSLASH='\'
+
+ac_config_headers="$ac_config_headers include/config.h:include/config.h.in"
+
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+else
+  CC="$ac_cv_prog_CC"
+fi
+
+if test -z "$CC"; then
+          if test -n "$ac_tool_prefix"; then
+    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  fi
+fi
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
+fi
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl.exe
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
+$as_echo "$CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+    test -n "$CC" && break
+  done
+fi
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl.exe
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
+$as_echo "$ac_ct_CC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$ac_ct_CC" && break
+done
+
+  if test "x$ac_ct_CC" = x; then
+    CC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CC=$ac_ct_CC
+  fi
+fi
+
+fi
+
+
+test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5; }
+
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
+$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
+if ${ac_cv_c_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
+$as_echo "$ac_cv_c_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GCC=yes
+else
+  GCC=
+fi
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
+$as_echo_n "checking whether $CC accepts -g... " >&6; }
+if ${ac_cv_prog_cc_g+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_save_c_werror_flag=$ac_c_werror_flag
+   ac_c_werror_flag=yes
+   ac_cv_prog_cc_g=no
+   CFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+else
+  CFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+
+else
+  ac_c_werror_flag=$ac_save_c_werror_flag
+	 CFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_c_werror_flag=$ac_save_c_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
+$as_echo "$ac_cv_prog_cc_g" >&6; }
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
+else
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
+$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
+if ${ac_cv_prog_cc_c89+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_prog_cc_c89=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+struct stat;
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
+   inside strings and character constants.  */
+#define FOO(x) 'x'
+int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
+int
+main ()
+{
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+  ;
+  return 0;
+}
+_ACEOF
+for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
+	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
+do
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c89=$ac_arg
+fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c89" != "xno" && break
+done
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
+
+fi
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c89" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c89"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
+$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
+esac
+if test "x$ac_cv_prog_cc_c89" != xno; then :
+
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC understands -c and -o together" >&5
+$as_echo_n "checking whether $CC understands -c and -o together... " >&6; }
+if ${am_cv_prog_cc_c_o+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+  # Make sure it works both with $CC and with simple cc.
+  # Following AC_PROG_CC_C_O, we do the test twice because some
+  # compilers refuse to overwrite an existing .o file with -o,
+  # though they will create one.
+  am_cv_prog_cc_c_o=yes
+  for am_i in 1 2; do
+    if { echo "$as_me:$LINENO: $CC -c conftest.$ac_ext -o conftest2.$ac_objext" >&5
+   ($CC -c conftest.$ac_ext -o conftest2.$ac_objext) >&5 2>&5
+   ac_status=$?
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   (exit $ac_status); } \
+         && test -f conftest2.$ac_objext; then
+      : OK
+    else
+      am_cv_prog_cc_c_o=no
+      break
+    fi
+  done
+  rm -f core conftest*
+  unset am_i
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_prog_cc_c_o" >&5
+$as_echo "$am_cv_prog_cc_c_o" >&6; }
+if test "$am_cv_prog_cc_c_o" != yes; then
+   # Losing compiler, so override with the script.
+   # FIXME: It is wrong to rewrite CC.
+   # But if we don't then we get into trouble of one sort or another.
+   # A longer-term fix would be to have automake use am__CC in this case,
+   # and then we could set am__CC="\$(top_srcdir)/compile \$(CC)"
+   CC="$am_aux_dir/compile $CC"
+fi
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
+$as_echo_n "checking how to run the C preprocessor... " >&6; }
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+  if ${ac_cv_prog_CPP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+      # Double quotes because CPP needs to be expanded
+    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
+    do
+      ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+  break
+fi
+
+    done
+    ac_cv_prog_CPP=$CPP
+
+fi
+  CPP=$ac_cv_prog_CPP
+else
+  ac_cv_prog_CPP=$CPP
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
+$as_echo "$CPP" >&6; }
+ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+# By default we simply use the C compiler to build assembly code.
+
+test "${CCAS+set}" = set || CCAS=$CC
+test "${CCASFLAGS+set}" = set || CCASFLAGS=$CFLAGS
+
+
+
+depcc="$CCAS"   am_compiler_list=
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
+$as_echo_n "checking dependency style of $depcc... " >&6; }
+if ${am_cv_CCAS_dependencies_compiler_type+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
+  rm -rf conftest.dir
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_CCAS_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
+  fi
+  am__universal=false
+
+
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
+    am__obj=sub/conftest.${OBJEXT-o}
+    am__minus_obj="-o $am__obj"
+    case $depmode in
+    gcc)
+      # This depmode causes a compiler race in universal mode.
+      test "$am__universal" = false || continue
+      ;;
+    nosideeffect)
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
+      # This compiler won't grok '-c -o', but also, the minuso test has
+      # not run yet.  These depmodes are late enough in the game, and
+      # so weak that their functioning should not be impacted.
+      am__obj=conftest.${OBJEXT-o}
+      am__minus_obj=
+      ;;
+    none) break ;;
+    esac
+    if depmode=$depmode \
+       source=sub/conftest.c object=$am__obj \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # or remarks (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored or not supported.
+      # When given -MP, icc 7.0 and 7.1 complain thusly:
+      #   icc: Command line warning: ignoring option '-M'; no argument required
+      # The diagnosis changed in icc 8.0:
+      #   icc: Command line remark: option '-MP' not supported
+      if (grep 'ignoring option' conftest.err ||
+          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
+        am_cv_CCAS_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_CCAS_dependencies_compiler_type=none
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CCAS_dependencies_compiler_type" >&5
+$as_echo "$am_cv_CCAS_dependencies_compiler_type" >&6; }
+CCASDEPMODE=depmode=$am_cv_CCAS_dependencies_compiler_type
+
+ if
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_CCAS_dependencies_compiler_type" = gcc3; then
+  am__fastdepCCAS_TRUE=
+  am__fastdepCCAS_FALSE='#'
+else
+  am__fastdepCCAS_TRUE='#'
+  am__fastdepCCAS_FALSE=
+fi
+
+
+
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+if test -z "$CXX"; then
+  if test -n "$CCC"; then
+    CXX=$CCC
+  else
+    if test -n "$ac_tool_prefix"; then
+  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$CXX"; then
+  ac_cv_prog_CXX="$CXX" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+CXX=$ac_cv_prog_CXX
+if test -n "$CXX"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXX" >&5
+$as_echo "$CXX" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+    test -n "$CXX" && break
+  done
+fi
+if test -z "$CXX"; then
+  ac_ct_CXX=$CXX
+  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_CXX"; then
+  ac_cv_prog_ac_ct_CXX="$ac_ct_CXX" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CXX="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
+if test -n "$ac_ct_CXX"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CXX" >&5
+$as_echo "$ac_ct_CXX" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$ac_ct_CXX" && break
+done
+
+  if test "x$ac_ct_CXX" = x; then
+    CXX="g++"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    CXX=$ac_ct_CXX
+  fi
+fi
+
+  fi
+fi
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C++ compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
+$as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
+if ${ac_cv_cxx_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cxx_compiler_gnu" >&5
+$as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GXX=yes
+else
+  GXX=
+fi
+ac_test_CXXFLAGS=${CXXFLAGS+set}
+ac_save_CXXFLAGS=$CXXFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
+$as_echo_n "checking whether $CXX accepts -g... " >&6; }
+if ${ac_cv_prog_cxx_g+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_save_cxx_werror_flag=$ac_cxx_werror_flag
+   ac_cxx_werror_flag=yes
+   ac_cv_prog_cxx_g=no
+   CXXFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_prog_cxx_g=yes
+else
+  CXXFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+
+else
+  ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+	 CXXFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_prog_cxx_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cxx_g" >&5
+$as_echo "$ac_cv_prog_cxx_g" >&6; }
+if test "$ac_test_CXXFLAGS" = set; then
+  CXXFLAGS=$ac_save_CXXFLAGS
+elif test $ac_cv_prog_cxx_g = yes; then
+  if test "$GXX" = yes; then
+    CXXFLAGS="-g -O2"
+  else
+    CXXFLAGS="-g"
+  fi
+else
+  if test "$GXX" = yes; then
+    CXXFLAGS="-O2"
+  else
+    CXXFLAGS=
+  fi
+fi
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+depcc="$CXX"  am_compiler_list=
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
+$as_echo_n "checking dependency style of $depcc... " >&6; }
+if ${am_cv_CXX_dependencies_compiler_type+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
+  rm -rf conftest.dir
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_CXX_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
+  fi
+  am__universal=false
+  case " $depcc " in #(
+     *\ -arch\ *\ -arch\ *) am__universal=true ;;
+     esac
+
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
+    am__obj=sub/conftest.${OBJEXT-o}
+    am__minus_obj="-o $am__obj"
+    case $depmode in
+    gcc)
+      # This depmode causes a compiler race in universal mode.
+      test "$am__universal" = false || continue
+      ;;
+    nosideeffect)
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
+      # This compiler won't grok '-c -o', but also, the minuso test has
+      # not run yet.  These depmodes are late enough in the game, and
+      # so weak that their functioning should not be impacted.
+      am__obj=conftest.${OBJEXT-o}
+      am__minus_obj=
+      ;;
+    none) break ;;
+    esac
+    if depmode=$depmode \
+       source=sub/conftest.c object=$am__obj \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # or remarks (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored or not supported.
+      # When given -MP, icc 7.0 and 7.1 complain thusly:
+      #   icc: Command line warning: ignoring option '-M'; no argument required
+      # The diagnosis changed in icc 8.0:
+      #   icc: Command line remark: option '-MP' not supported
+      if (grep 'ignoring option' conftest.err ||
+          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
+        am_cv_CXX_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_CXX_dependencies_compiler_type=none
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CXX_dependencies_compiler_type" >&5
+$as_echo "$am_cv_CXX_dependencies_compiler_type" >&6; }
+CXXDEPMODE=depmode=$am_cv_CXX_dependencies_compiler_type
+
+ if
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_CXX_dependencies_compiler_type" = gcc3; then
+  am__fastdepCXX_TRUE=
+  am__fastdepCXX_FALSE='#'
+else
+  am__fastdepCXX_TRUE='#'
+  am__fastdepCXX_FALSE=
+fi
+
+
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
+$as_echo_n "checking how to run the C++ preprocessor... " >&6; }
+if test -z "$CXXCPP"; then
+  if ${ac_cv_prog_CXXCPP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+      # Double quotes because CXXCPP needs to be expanded
+    for CXXCPP in "$CXX -E" "/lib/cpp"
+    do
+      ac_preproc_ok=false
+for ac_cxx_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+  break
+fi
+
+    done
+    ac_cv_prog_CXXCPP=$CXXCPP
+
+fi
+  CXXCPP=$ac_cv_prog_CXXCPP
+else
+  ac_cv_prog_CXXCPP=$CXXCPP
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXXCPP" >&5
+$as_echo "$CXXCPP" >&6; }
+ac_preproc_ok=false
+for ac_cxx_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C++ preprocessor \"$CXXCPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+CXX="$CXX -std=gnu++11"
+CXXCPP="$CXXCPP -std=gnu++11"
+CC="$CC -std=gnu99"
+CPP="$CPP -std=gnu99"
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CC for gcc -fsigned-char" >&5
+$as_echo_n "checking CC for gcc -fsigned-char... " >&6; }
+if ${ax_cv_cflags_gcc_option__fsigned_char+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fsigned_char="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fsigned-char"     "-pedantic % -fsigned-char %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fsigned_char=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fsigned_char" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fsigned_char" >&6; }
+var=$ax_cv_cflags_gcc_option__fsigned_char
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CC " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CC does contain \$var"; } >&5
+  (: CC does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CC=\"\$CC \$var\""; } >&5
+  (: CC="$CC $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CC="$CC $var"
+   fi
+ ;;
+esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CXX for gcc -fsigned-char" >&5
+$as_echo_n "checking CXX for gcc -fsigned-char... " >&6; }
+if ${ax_cv_cxxflags_gcc_option__fsigned_char+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cxxflags_gcc_option__fsigned_char="no, unknown"
+
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+ ac_save_CXXFLAGS="$CXXFLAGS"
+for ac_arg in "-pedantic -Werror % -fsigned-char"     "-pedantic % -fsigned-char %% no, obsolete"     #
+do CXXFLAGS="$ac_save_CXXFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ax_cv_cxxflags_gcc_option__fsigned_char=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CXXFLAGS="$ac_save_CXXFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cxxflags_gcc_option__fsigned_char" >&5
+$as_echo "$ax_cv_cxxflags_gcc_option__fsigned_char" >&6; }
+var=$ax_cv_cxxflags_gcc_option__fsigned_char
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CXX " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CXX does contain \$var"; } >&5
+  (: CXX does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CXX=\"\$CXX \$var\""; } >&5
+  (: CXX="$CXX $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CXX="$CXX $var"
+   fi
+ ;;
+esac
+
+
+
+
+
+
+  CFLAG_VISIBILITY=
+  HAVE_VISIBILITY=0
+  if test -n "$GCC"; then
+                { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the -Werror option is usable" >&5
+$as_echo_n "checking whether the -Werror option is usable... " >&6; }
+    if ${gl_cv_cc_vis_werror+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      gl_save_CFLAGS="$CFLAGS"
+      CFLAGS="$CFLAGS -Werror"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gl_cv_cc_vis_werror=yes
+else
+  gl_cv_cc_vis_werror=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+      CFLAGS="$gl_save_CFLAGS"
+fi
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_cc_vis_werror" >&5
+$as_echo "$gl_cv_cc_vis_werror" >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for simple visibility declarations" >&5
+$as_echo_n "checking for simple visibility declarations... " >&6; }
+    if ${gl_cv_cc_visibility+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      gl_save_CFLAGS="$CFLAGS"
+      CFLAGS="$CFLAGS -fvisibility=hidden"
+                                    if test $gl_cv_cc_vis_werror = yes; then
+        CFLAGS="$CFLAGS -Werror"
+      fi
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+extern __attribute__((__visibility__("hidden"))) int hiddenvar;
+         extern __attribute__((__visibility__("default"))) int exportedvar;
+         extern __attribute__((__visibility__("hidden"))) int hiddenfunc (void);
+         extern __attribute__((__visibility__("default"))) int exportedfunc (void);
+         void dummyfunc (void) {}
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gl_cv_cc_visibility=yes
+else
+  gl_cv_cc_visibility=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+      CFLAGS="$gl_save_CFLAGS"
+fi
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_cc_visibility" >&5
+$as_echo "$gl_cv_cc_visibility" >&6; }
+    if test $gl_cv_cc_visibility = yes; then
+      CFLAG_VISIBILITY="-fvisibility=hidden"
+      HAVE_VISIBILITY=1
+    fi
+  fi
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_VISIBILITY $HAVE_VISIBILITY
+_ACEOF
+
+
+
+# Check whether --enable-largefile was given.
+if test "${enable_largefile+set}" = set; then :
+  enableval=$enable_largefile;
+fi
+
+if test "$enable_largefile" != no; then
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for special C compiler options needed for large files" >&5
+$as_echo_n "checking for special C compiler options needed for large files... " >&6; }
+if ${ac_cv_sys_largefile_CC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_sys_largefile_CC=no
+     if test "$GCC" != yes; then
+       ac_save_CC=$CC
+       while :; do
+	 # IRIX 6.2 and later do not support large files by default,
+	 # so use the C compiler's -n32 option if that helps.
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+ /* Check that off_t can represent 2**63 - 1 correctly.
+    We can't simply define LARGE_OFF_T to be 9223372036854775807,
+    since some C++ compilers masquerading as C compilers
+    incorrectly reject 9223372036854775807.  */
+#define LARGE_OFF_T ((((off_t) 1 << 31) << 31) - 1 + (((off_t) 1 << 31) << 31))
+  int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
+		       && LARGE_OFF_T % 2147483647 == 1)
+		      ? 1 : -1];
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+	 if ac_fn_cxx_try_compile "$LINENO"; then :
+  break
+fi
+rm -f core conftest.err conftest.$ac_objext
+	 CC="$CC -n32"
+	 if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_sys_largefile_CC=' -n32'; break
+fi
+rm -f core conftest.err conftest.$ac_objext
+	 break
+       done
+       CC=$ac_save_CC
+       rm -f conftest.$ac_ext
+    fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sys_largefile_CC" >&5
+$as_echo "$ac_cv_sys_largefile_CC" >&6; }
+  if test "$ac_cv_sys_largefile_CC" != no; then
+    CC=$CC$ac_cv_sys_largefile_CC
+  fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for _FILE_OFFSET_BITS value needed for large files" >&5
+$as_echo_n "checking for _FILE_OFFSET_BITS value needed for large files... " >&6; }
+if ${ac_cv_sys_file_offset_bits+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  while :; do
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+ /* Check that off_t can represent 2**63 - 1 correctly.
+    We can't simply define LARGE_OFF_T to be 9223372036854775807,
+    since some C++ compilers masquerading as C compilers
+    incorrectly reject 9223372036854775807.  */
+#define LARGE_OFF_T ((((off_t) 1 << 31) << 31) - 1 + (((off_t) 1 << 31) << 31))
+  int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
+		       && LARGE_OFF_T % 2147483647 == 1)
+		      ? 1 : -1];
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_sys_file_offset_bits=no; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#define _FILE_OFFSET_BITS 64
+#include <sys/types.h>
+ /* Check that off_t can represent 2**63 - 1 correctly.
+    We can't simply define LARGE_OFF_T to be 9223372036854775807,
+    since some C++ compilers masquerading as C compilers
+    incorrectly reject 9223372036854775807.  */
+#define LARGE_OFF_T ((((off_t) 1 << 31) << 31) - 1 + (((off_t) 1 << 31) << 31))
+  int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
+		       && LARGE_OFF_T % 2147483647 == 1)
+		      ? 1 : -1];
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_sys_file_offset_bits=64; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  ac_cv_sys_file_offset_bits=unknown
+  break
+done
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sys_file_offset_bits" >&5
+$as_echo "$ac_cv_sys_file_offset_bits" >&6; }
+case $ac_cv_sys_file_offset_bits in #(
+  no | unknown) ;;
+  *)
+cat >>confdefs.h <<_ACEOF
+#define _FILE_OFFSET_BITS $ac_cv_sys_file_offset_bits
+_ACEOF
+;;
+esac
+rm -rf conftest*
+  if test $ac_cv_sys_file_offset_bits = unknown; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for _LARGE_FILES value needed for large files" >&5
+$as_echo_n "checking for _LARGE_FILES value needed for large files... " >&6; }
+if ${ac_cv_sys_large_files+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  while :; do
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+ /* Check that off_t can represent 2**63 - 1 correctly.
+    We can't simply define LARGE_OFF_T to be 9223372036854775807,
+    since some C++ compilers masquerading as C compilers
+    incorrectly reject 9223372036854775807.  */
+#define LARGE_OFF_T ((((off_t) 1 << 31) << 31) - 1 + (((off_t) 1 << 31) << 31))
+  int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
+		       && LARGE_OFF_T % 2147483647 == 1)
+		      ? 1 : -1];
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_sys_large_files=no; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#define _LARGE_FILES 1
+#include <sys/types.h>
+ /* Check that off_t can represent 2**63 - 1 correctly.
+    We can't simply define LARGE_OFF_T to be 9223372036854775807,
+    since some C++ compilers masquerading as C compilers
+    incorrectly reject 9223372036854775807.  */
+#define LARGE_OFF_T ((((off_t) 1 << 31) << 31) - 1 + (((off_t) 1 << 31) << 31))
+  int off_t_is_large[(LARGE_OFF_T % 2147483629 == 721
+		       && LARGE_OFF_T % 2147483647 == 1)
+		      ? 1 : -1];
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_sys_large_files=1; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  ac_cv_sys_large_files=unknown
+  break
+done
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sys_large_files" >&5
+$as_echo "$ac_cv_sys_large_files" >&6; }
+case $ac_cv_sys_large_files in #(
+  no | unknown) ;;
+  *)
+cat >>confdefs.h <<_ACEOF
+#define _LARGE_FILES $ac_cv_sys_large_files
+_ACEOF
+;;
+esac
+rm -rf conftest*
+  fi
+
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _LARGEFILE_SOURCE value needed for large files" >&5
+$as_echo_n "checking for _LARGEFILE_SOURCE value needed for large files... " >&6; }
+if ${ac_cv_sys_largefile_source+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  while :; do
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h> /* for off_t */
+     #include <stdio.h>
+int
+main ()
+{
+int (*fp) (FILE *, off_t, int) = fseeko;
+     return fseeko (stdin, 0, 0) && fp (stdin, 0, 0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_sys_largefile_source=no; break
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#define _LARGEFILE_SOURCE 1
+#include <sys/types.h> /* for off_t */
+     #include <stdio.h>
+int
+main ()
+{
+int (*fp) (FILE *, off_t, int) = fseeko;
+     return fseeko (stdin, 0, 0) && fp (stdin, 0, 0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_sys_largefile_source=1; break
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  ac_cv_sys_largefile_source=unknown
+  break
+done
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sys_largefile_source" >&5
+$as_echo "$ac_cv_sys_largefile_source" >&6; }
+case $ac_cv_sys_largefile_source in #(
+  no | unknown) ;;
+  *)
+cat >>confdefs.h <<_ACEOF
+#define _LARGEFILE_SOURCE $ac_cv_sys_largefile_source
+_ACEOF
+;;
+esac
+rm -rf conftest*
+
+# We used to try defining _XOPEN_SOURCE=500 too, to work around a bug
+# in glibc 2.1.3, but that breaks too many other things.
+# If you want fseeko and ftello with glibc, upgrade to a fixed glibc.
+if test $ac_cv_sys_largefile_source != unknown; then
+
+$as_echo "#define HAVE_FSEEKO 1" >>confdefs.h
+
+fi
+
+
+$as_echo "#define _LARGEFILE64_SOURCE 1" >>confdefs.h
+
+
+$as_echo "#define _LARGEFILE_SOURCE 1" >>confdefs.h
+
+
+# sizeof tests need to come after largefile support macros
+
+ac_fn_cxx_check_type "$LINENO" "ptrdiff_t" "ac_cv_type_ptrdiff_t" "$ac_includes_default"
+if test "x$ac_cv_type_ptrdiff_t" = xyes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define ptrdiff_t long
+_ACEOF
+
+fi
+
+ac_fn_cxx_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
+if test "x$ac_cv_type_size_t" = xyes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define size_t unsigned int
+_ACEOF
+
+fi
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of char" >&5
+$as_echo_n "checking size of char... " >&6; }
+if ${ac_cv_sizeof_char+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (char))" "ac_cv_sizeof_char"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_char" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (char)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_char=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_char" >&5
+$as_echo "$ac_cv_sizeof_char" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_CHAR $ac_cv_sizeof_char
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of short" >&5
+$as_echo_n "checking size of short... " >&6; }
+if ${ac_cv_sizeof_short+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (short))" "ac_cv_sizeof_short"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_short" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (short)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_short=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_short" >&5
+$as_echo "$ac_cv_sizeof_short" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_SHORT $ac_cv_sizeof_short
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of int" >&5
+$as_echo_n "checking size of int... " >&6; }
+if ${ac_cv_sizeof_int+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (int))" "ac_cv_sizeof_int"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_int" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (int)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_int=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_int" >&5
+$as_echo "$ac_cv_sizeof_int" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_INT $ac_cv_sizeof_int
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long" >&5
+$as_echo_n "checking size of long... " >&6; }
+if ${ac_cv_sizeof_long+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (long))" "ac_cv_sizeof_long"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_long" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (long)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_long=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_long" >&5
+$as_echo "$ac_cv_sizeof_long" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_LONG $ac_cv_sizeof_long
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of long long" >&5
+$as_echo_n "checking size of long long... " >&6; }
+if ${ac_cv_sizeof_long_long+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (long long))" "ac_cv_sizeof_long_long"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_long_long" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (long long)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_long_long=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_long_long" >&5
+$as_echo "$ac_cv_sizeof_long_long" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_LONG_LONG $ac_cv_sizeof_long_long
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of __int64" >&5
+$as_echo_n "checking size of __int64... " >&6; }
+if ${ac_cv_sizeof___int64+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (__int64))" "ac_cv_sizeof___int64"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type___int64" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (__int64)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof___int64=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof___int64" >&5
+$as_echo "$ac_cv_sizeof___int64" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF___INT64 $ac_cv_sizeof___int64
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of void *" >&5
+$as_echo_n "checking size of void *... " >&6; }
+if ${ac_cv_sizeof_void_p+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (void *))" "ac_cv_sizeof_void_p"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_void_p" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (void *)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_void_p=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_void_p" >&5
+$as_echo "$ac_cv_sizeof_void_p" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_VOID_P $ac_cv_sizeof_void_p
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of size_t" >&5
+$as_echo_n "checking size of size_t... " >&6; }
+if ${ac_cv_sizeof_size_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (size_t))" "ac_cv_sizeof_size_t"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_size_t" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (size_t)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_size_t=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_size_t" >&5
+$as_echo "$ac_cv_sizeof_size_t" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_SIZE_T $ac_cv_sizeof_size_t
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of ptrdiff_t" >&5
+$as_echo_n "checking size of ptrdiff_t... " >&6; }
+if ${ac_cv_sizeof_ptrdiff_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (ptrdiff_t))" "ac_cv_sizeof_ptrdiff_t"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_ptrdiff_t" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (ptrdiff_t)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_ptrdiff_t=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_ptrdiff_t" >&5
+$as_echo "$ac_cv_sizeof_ptrdiff_t" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_PTRDIFF_T $ac_cv_sizeof_ptrdiff_t
+_ACEOF
+
+
+# The cast to long int works around a bug in the HP C Compiler
+# version HP92453-01 B.11.11.23709.GP, which incorrectly rejects
+# declarations like `int a3[[(sizeof (unsigned char)) >= 0]];'.
+# This bug is HP SR number 8606223364.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking size of off_t" >&5
+$as_echo_n "checking size of off_t... " >&6; }
+if ${ac_cv_sizeof_off_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if ac_fn_cxx_compute_int "$LINENO" "(long int) (sizeof (off_t))" "ac_cv_sizeof_off_t"        "$ac_includes_default"; then :
+
+else
+  if test "$ac_cv_type_off_t" = yes; then
+     { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error 77 "cannot compute sizeof (off_t)
+See \`config.log' for more details" "$LINENO" 5; }
+   else
+     ac_cv_sizeof_off_t=0
+   fi
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_sizeof_off_t" >&5
+$as_echo "$ac_cv_sizeof_off_t" >&6; }
+
+
+
+cat >>confdefs.h <<_ACEOF
+#define SIZEOF_OFF_T $ac_cv_sizeof_off_t
+_ACEOF
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for an ANSI C-conforming const" >&5
+$as_echo_n "checking for an ANSI C-conforming const... " >&6; }
+if ${ac_cv_c_const+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+#ifndef __cplusplus
+  /* Ultrix mips cc rejects this sort of thing.  */
+  typedef int charset[2];
+  const charset cs = { 0, 0 };
+  /* SunOS 4.1.1 cc rejects this.  */
+  char const *const *pcpcc;
+  char **ppc;
+  /* NEC SVR4.0.2 mips cc rejects this.  */
+  struct point {int x, y;};
+  static struct point const zero = {0,0};
+  /* AIX XL C 1.02.0.0 rejects this.
+     It does not let you subtract one const X* pointer from another in
+     an arm of an if-expression whose if-part is not a constant
+     expression */
+  const char *g = "string";
+  pcpcc = &g + (g ? g-g : 0);
+  /* HPUX 7.0 cc rejects these. */
+  ++pcpcc;
+  ppc = (char**) pcpcc;
+  pcpcc = (char const *const *) ppc;
+  { /* SCO 3.2v4 cc rejects this sort of thing.  */
+    char tx;
+    char *t = &tx;
+    char const *s = 0 ? (char *) 0 : (char const *) 0;
+
+    *t++ = 0;
+    if (s) return 0;
+  }
+  { /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
+    int x[] = {25, 17};
+    const int *foo = &x[0];
+    ++foo;
+  }
+  { /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
+    typedef const int *iptr;
+    iptr p = 0;
+    ++p;
+  }
+  { /* AIX XL C 1.02.0.0 rejects this sort of thing, saying
+       "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
+    struct s { int j; const int *ap[3]; } bx;
+    struct s *b = &bx; b->j = 5;
+  }
+  { /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
+    const int foo = 10;
+    if (!foo) return 0;
+  }
+  return !cs[0] && !zero.x;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_c_const=yes
+else
+  ac_cv_c_const=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_const" >&5
+$as_echo "$ac_cv_c_const" >&6; }
+if test $ac_cv_c_const = no; then
+
+$as_echo "#define const /**/" >>confdefs.h
+
+fi
+
+for ac_func in memcmp memcpy memmove memset mmap munmap madvise signal sigaction fork pipe dup2 fcntl getenv putenv setenv gettimeofday getpwuid getuid strerror strerror_r ftello fopen64 fseeko64 ftello64 fstat64 ftruncate64 __mingw_get_crt_info
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing fmodl" >&5
+$as_echo_n "checking for library containing fmodl... " >&6; }
+if ${ac_cv_search_fmodl+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char fmodl ();
+int
+main ()
+{
+return fmodl ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' m; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_search_fmodl=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_fmodl+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_fmodl+:} false; then :
+
+else
+  ac_cv_search_fmodl=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_fmodl" >&5
+$as_echo "$ac_cv_search_fmodl" >&6; }
+ac_res=$ac_cv_search_fmodl
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+
+#
+# Check for any libraries that need to be linked against for clock_gettime().
+#
+# (posix4 is apparently used by much older versions of Solaris according to tar, pre-7, so maybe it's not necessary
+#  for Mednafen?)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing clock_gettime" >&5
+$as_echo_n "checking for library containing clock_gettime... " >&6; }
+if ${ac_cv_search_clock_gettime+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char clock_gettime ();
+int
+main ()
+{
+return clock_gettime ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' rt posix4; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_search_clock_gettime=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_clock_gettime+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_clock_gettime+:} false; then :
+
+else
+  ac_cv_search_clock_gettime=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_clock_gettime" >&5
+$as_echo "$ac_cv_search_clock_gettime" >&6; }
+ac_res=$ac_cv_search_clock_gettime
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+for ac_func in clock_gettime nanosleep usleep localtime_r gmtime_r
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+
+for ac_header in fcntl.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "fcntl.h" "ac_cv_header_fcntl_h" "$ac_includes_default"
+if test "x$ac_cv_header_fcntl_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_FCNTL_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in stdint.h inttypes.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_cxx_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+for ac_func in mkdir _mkdir
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether mkdir takes one argument" >&5
+$as_echo_n "checking whether mkdir takes one argument... " >&6; }
+if ${ac_cv_mkdir_takes_one_arg+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <sys/stat.h>
+#if HAVE_UNISTD_H
+#  include <unistd.h>
+#endif
+
+int
+main ()
+{
+mkdir (".");
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_mkdir_takes_one_arg=yes
+else
+  ac_cv_mkdir_takes_one_arg=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_mkdir_takes_one_arg" >&5
+$as_echo "$ac_cv_mkdir_takes_one_arg" >&6; }
+if test x"$ac_cv_mkdir_takes_one_arg" = xyes; then
+
+$as_echo "#define MKDIR_TAKES_ONE_ARG 1" >>confdefs.h
+
+fi
+
+
+
+
+
+
+
+
+if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
+	if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
+set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+PKG_CONFIG=$ac_cv_path_PKG_CONFIG
+if test -n "$PKG_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
+$as_echo "$PKG_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_path_PKG_CONFIG"; then
+  ac_pt_PKG_CONFIG=$PKG_CONFIG
+  # Extract the first word of "pkg-config", so it can be a program name with args.
+set dummy pkg-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $ac_pt_PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
+if test -n "$ac_pt_PKG_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG" >&5
+$as_echo "$ac_pt_PKG_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_pt_PKG_CONFIG" = x; then
+    PKG_CONFIG=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    PKG_CONFIG=$ac_pt_PKG_CONFIG
+  fi
+else
+  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
+fi
+
+fi
+if test -n "$PKG_CONFIG"; then
+	_pkg_min_version=0.9.0
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
+$as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
+	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+		PKG_CONFIG=""
+	fi
+fi
+
+for ac_func in round nearbyint nearbyintf rint rintf
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+for ac_header in fenv.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "fenv.h" "ac_cv_header_fenv_h" "$ac_includes_default"
+if test "x$ac_cv_header_fenv_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_FENV_H 1
+_ACEOF
+
+fi
+
+done
+
+
+
+
+$as_echo "#define MINILZO_HAVE_CONFIG_H 1" >>confdefs.h
+
+
+
+      if test "X$prefix" = "XNONE"; then
+    acl_final_prefix="$ac_default_prefix"
+  else
+    acl_final_prefix="$prefix"
+  fi
+  if test "X$exec_prefix" = "XNONE"; then
+    acl_final_exec_prefix='${prefix}'
+  else
+    acl_final_exec_prefix="$exec_prefix"
+  fi
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  eval acl_final_exec_prefix=\"$acl_final_exec_prefix\"
+  prefix="$acl_save_prefix"
+
+
+# Check whether --with-gnu-ld was given.
+if test "${with_gnu_ld+set}" = set; then :
+  withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
+else
+  with_gnu_ld=no
+fi
+
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+ac_prog=ld
+if test "$GCC" = yes; then
+  # Check if gcc -print-prog-name=ld gives a path.
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by GCC" >&5
+$as_echo_n "checking for ld used by GCC... " >&6; }
+  case $host in
+  *-*-mingw*)
+    # gcc leaves a trailing carriage return which upsets mingw
+    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
+  *)
+    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
+  esac
+  case $ac_prog in
+    # Accept absolute paths.
+    [\\/]* | [A-Za-z]:[\\/]*)
+      re_direlt='/[^/][^/]*/\.\./'
+      # Canonicalize the path of ld
+      ac_prog=`echo $ac_prog| sed 's%\\\\%/%g'`
+      while echo $ac_prog | grep "$re_direlt" > /dev/null 2>&1; do
+        ac_prog=`echo $ac_prog| sed "s%$re_direlt%/%"`
+      done
+      test -z "$LD" && LD="$ac_prog"
+      ;;
+  "")
+    # If it fails, then pretend we aren't using GCC.
+    ac_prog=ld
+    ;;
+  *)
+    # If it is relative, then search for the first ld in PATH.
+    with_gnu_ld=unknown
+    ;;
+  esac
+elif test "$with_gnu_ld" = yes; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
+$as_echo_n "checking for GNU ld... " >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
+$as_echo_n "checking for non-GNU ld... " >&6; }
+fi
+if ${acl_cv_path_LD+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$LD"; then
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}${PATH_SEPARATOR-:}"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
+      acl_cv_path_LD="$ac_dir/$ac_prog"
+      # Check to see if the program is GNU ld.  I'd rather use --version,
+      # but apparently some GNU ld's only accept -v.
+      # Break only if it was the GNU/non-GNU ld that we prefer.
+      case `"$acl_cv_path_LD" -v 2>&1 < /dev/null` in
+      *GNU* | *'with BFD'*)
+        test "$with_gnu_ld" != no && break ;;
+      *)
+        test "$with_gnu_ld" != yes && break ;;
+      esac
+    fi
+  done
+  IFS="$ac_save_ifs"
+else
+  acl_cv_path_LD="$LD" # Let the user override the test with a path.
+fi
+fi
+
+LD="$acl_cv_path_LD"
+if test -n "$LD"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
+$as_echo "$LD" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
+$as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
+if ${acl_cv_prog_gnu_ld+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  # I'd rather use --version here, but apparently some GNU ld's only accept -v.
+case `$LD -v 2>&1 </dev/null` in
+*GNU* | *'with BFD'*)
+  acl_cv_prog_gnu_ld=yes ;;
+*)
+  acl_cv_prog_gnu_ld=no ;;
+esac
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $acl_cv_prog_gnu_ld" >&5
+$as_echo "$acl_cv_prog_gnu_ld" >&6; }
+with_gnu_ld=$acl_cv_prog_gnu_ld
+
+
+
+
+                                                { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shared library run path origin" >&5
+$as_echo_n "checking for shared library run path origin... " >&6; }
+if ${acl_cv_rpath+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    CC="$CC" GCC="$GCC" LDFLAGS="$LDFLAGS" LD="$LD" with_gnu_ld="$with_gnu_ld" \
+    ${CONFIG_SHELL-/bin/sh} "$ac_aux_dir/config.rpath" "$host" > conftest.sh
+    . ./conftest.sh
+    rm -f ./conftest.sh
+    acl_cv_rpath=done
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $acl_cv_rpath" >&5
+$as_echo "$acl_cv_rpath" >&6; }
+  wl="$acl_cv_wl"
+  acl_libext="$acl_cv_libext"
+  acl_shlibext="$acl_cv_shlibext"
+  acl_libname_spec="$acl_cv_libname_spec"
+  acl_library_names_spec="$acl_cv_library_names_spec"
+  acl_hardcode_libdir_flag_spec="$acl_cv_hardcode_libdir_flag_spec"
+  acl_hardcode_libdir_separator="$acl_cv_hardcode_libdir_separator"
+  acl_hardcode_direct="$acl_cv_hardcode_direct"
+  acl_hardcode_minus_L="$acl_cv_hardcode_minus_L"
+    # Check whether --enable-rpath was given.
+if test "${enable_rpath+set}" = set; then :
+  enableval=$enable_rpath; :
+else
+  enable_rpath=yes
+fi
+
+
+
+
+  acl_libdirstem=lib
+  acl_libdirstem2=
+  case "$host_os" in
+    solaris*)
+                                    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for 64-bit host" >&5
+$as_echo_n "checking for 64-bit host... " >&6; }
+if ${gl_cv_solaris_64bit+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#ifdef _LP64
+sixtyfour bits
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "sixtyfour bits" >/dev/null 2>&1; then :
+  gl_cv_solaris_64bit=yes
+else
+  gl_cv_solaris_64bit=no
+fi
+rm -f conftest*
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_solaris_64bit" >&5
+$as_echo "$gl_cv_solaris_64bit" >&6; }
+      if test $gl_cv_solaris_64bit = yes; then
+        acl_libdirstem=lib/64
+        case "$host_cpu" in
+          sparc*)        acl_libdirstem2=lib/sparcv9 ;;
+          i*86 | x86_64) acl_libdirstem2=lib/amd64 ;;
+        esac
+      fi
+      ;;
+    *)
+      searchpath=`(LC_ALL=C $CC -print-search-dirs) 2>/dev/null | sed -n -e 's,^libraries: ,,p' | sed -e 's,^=,,'`
+      if test -n "$searchpath"; then
+        acl_save_IFS="${IFS= 	}"; IFS=":"
+        for searchdir in $searchpath; do
+          if test -d "$searchdir"; then
+            case "$searchdir" in
+              */lib64/ | */lib64 ) acl_libdirstem=lib64 ;;
+              */../ | */.. )
+                # Better ignore directories of this form. They are misleading.
+                ;;
+              *) searchdir=`cd "$searchdir" && pwd`
+                 case "$searchdir" in
+                   */lib64 ) acl_libdirstem=lib64 ;;
+                 esac ;;
+            esac
+          fi
+        done
+        IFS="$acl_save_IFS"
+      fi
+      ;;
+  esac
+  test -n "$acl_libdirstem2" || acl_libdirstem2="$acl_libdirstem"
+
+
+
+
+
+
+
+
+
+
+
+
+    use_additional=yes
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+
+    eval additional_includedir=\"$includedir\"
+    eval additional_libdir=\"$libdir\"
+
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+
+# Check whether --with-libiconv-prefix was given.
+if test "${with_libiconv_prefix+set}" = set; then :
+  withval=$with_libiconv_prefix;
+    if test "X$withval" = "Xno"; then
+      use_additional=no
+    else
+      if test "X$withval" = "X"; then
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+
+          eval additional_includedir=\"$includedir\"
+          eval additional_libdir=\"$libdir\"
+
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+      else
+        additional_includedir="$withval/include"
+        additional_libdir="$withval/$acl_libdirstem"
+        if test "$acl_libdirstem2" != "$acl_libdirstem" \
+           && ! test -d "$withval/$acl_libdirstem"; then
+          additional_libdir="$withval/$acl_libdirstem2"
+        fi
+      fi
+    fi
+
+fi
+
+      LIBICONV=
+  LTLIBICONV=
+  INCICONV=
+  LIBICONV_PREFIX=
+      HAVE_LIBICONV=
+  rpathdirs=
+  ltrpathdirs=
+  names_already_handled=
+  names_next_round='iconv '
+  while test -n "$names_next_round"; do
+    names_this_round="$names_next_round"
+    names_next_round=
+    for name in $names_this_round; do
+      already_handled=
+      for n in $names_already_handled; do
+        if test "$n" = "$name"; then
+          already_handled=yes
+          break
+        fi
+      done
+      if test -z "$already_handled"; then
+        names_already_handled="$names_already_handled $name"
+                        uppername=`echo "$name" | sed -e 'y|abcdefghijklmnopqrstuvwxyz./-|ABCDEFGHIJKLMNOPQRSTUVWXYZ___|'`
+        eval value=\"\$HAVE_LIB$uppername\"
+        if test -n "$value"; then
+          if test "$value" = yes; then
+            eval value=\"\$LIB$uppername\"
+            test -z "$value" || LIBICONV="${LIBICONV}${LIBICONV:+ }$value"
+            eval value=\"\$LTLIB$uppername\"
+            test -z "$value" || LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }$value"
+          else
+                                    :
+          fi
+        else
+                              found_dir=
+          found_la=
+          found_so=
+          found_a=
+          eval libname=\"$acl_libname_spec\"    # typically: libname=lib$name
+          if test -n "$acl_shlibext"; then
+            shrext=".$acl_shlibext"             # typically: shrext=.so
+          else
+            shrext=
+          fi
+          if test $use_additional = yes; then
+            dir="$additional_libdir"
+                                    if test -n "$acl_shlibext"; then
+              if test -f "$dir/$libname$shrext"; then
+                found_dir="$dir"
+                found_so="$dir/$libname$shrext"
+              else
+                if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                  ver=`(cd "$dir" && \
+                        for f in "$libname$shrext".*; do echo "$f"; done \
+                        | sed -e "s,^$libname$shrext\\\\.,," \
+                        | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                        | sed 1q ) 2>/dev/null`
+                  if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                    found_dir="$dir"
+                    found_so="$dir/$libname$shrext.$ver"
+                  fi
+                else
+                  eval library_names=\"$acl_library_names_spec\"
+                  for f in $library_names; do
+                    if test -f "$dir/$f"; then
+                      found_dir="$dir"
+                      found_so="$dir/$f"
+                      break
+                    fi
+                  done
+                fi
+              fi
+            fi
+                        if test "X$found_dir" = "X"; then
+              if test -f "$dir/$libname.$acl_libext"; then
+                found_dir="$dir"
+                found_a="$dir/$libname.$acl_libext"
+              fi
+            fi
+            if test "X$found_dir" != "X"; then
+              if test -f "$dir/$libname.la"; then
+                found_la="$dir/$libname.la"
+              fi
+            fi
+          fi
+          if test "X$found_dir" = "X"; then
+            for x in $LDFLAGS $LTLIBICONV; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+              case "$x" in
+                -L*)
+                  dir=`echo "X$x" | sed -e 's/^X-L//'`
+                                    if test -n "$acl_shlibext"; then
+                    if test -f "$dir/$libname$shrext"; then
+                      found_dir="$dir"
+                      found_so="$dir/$libname$shrext"
+                    else
+                      if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                        ver=`(cd "$dir" && \
+                              for f in "$libname$shrext".*; do echo "$f"; done \
+                              | sed -e "s,^$libname$shrext\\\\.,," \
+                              | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                              | sed 1q ) 2>/dev/null`
+                        if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                          found_dir="$dir"
+                          found_so="$dir/$libname$shrext.$ver"
+                        fi
+                      else
+                        eval library_names=\"$acl_library_names_spec\"
+                        for f in $library_names; do
+                          if test -f "$dir/$f"; then
+                            found_dir="$dir"
+                            found_so="$dir/$f"
+                            break
+                          fi
+                        done
+                      fi
+                    fi
+                  fi
+                                    if test "X$found_dir" = "X"; then
+                    if test -f "$dir/$libname.$acl_libext"; then
+                      found_dir="$dir"
+                      found_a="$dir/$libname.$acl_libext"
+                    fi
+                  fi
+                  if test "X$found_dir" != "X"; then
+                    if test -f "$dir/$libname.la"; then
+                      found_la="$dir/$libname.la"
+                    fi
+                  fi
+                  ;;
+              esac
+              if test "X$found_dir" != "X"; then
+                break
+              fi
+            done
+          fi
+          if test "X$found_dir" != "X"; then
+                        LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }-L$found_dir -l$name"
+            if test "X$found_so" != "X"; then
+                                                        if test "$enable_rpath" = no \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem" \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem2"; then
+                                LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
+              else
+                                                                                haveit=
+                for x in $ltrpathdirs; do
+                  if test "X$x" = "X$found_dir"; then
+                    haveit=yes
+                    break
+                  fi
+                done
+                if test -z "$haveit"; then
+                  ltrpathdirs="$ltrpathdirs $found_dir"
+                fi
+                                if test "$acl_hardcode_direct" = yes; then
+                                                      LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
+                else
+                  if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
+                                                            LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
+                                                            haveit=
+                    for x in $rpathdirs; do
+                      if test "X$x" = "X$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      rpathdirs="$rpathdirs $found_dir"
+                    fi
+                  else
+                                                                                haveit=
+                    for x in $LDFLAGS $LIBICONV; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                      if test "X$x" = "X-L$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      LIBICONV="${LIBICONV}${LIBICONV:+ }-L$found_dir"
+                    fi
+                    if test "$acl_hardcode_minus_L" != no; then
+                                                                                        LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
+                    else
+                                                                                                                                                                                LIBICONV="${LIBICONV}${LIBICONV:+ }-l$name"
+                    fi
+                  fi
+                fi
+              fi
+            else
+              if test "X$found_a" != "X"; then
+                                LIBICONV="${LIBICONV}${LIBICONV:+ }$found_a"
+              else
+                                                LIBICONV="${LIBICONV}${LIBICONV:+ }-L$found_dir -l$name"
+              fi
+            fi
+                        additional_includedir=
+            case "$found_dir" in
+              */$acl_libdirstem | */$acl_libdirstem/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem/"'*$,,'`
+                if test "$name" = 'iconv'; then
+                  LIBICONV_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+              */$acl_libdirstem2 | */$acl_libdirstem2/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem2/"'*$,,'`
+                if test "$name" = 'iconv'; then
+                  LIBICONV_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+            esac
+            if test "X$additional_includedir" != "X"; then
+                                                                                                                if test "X$additional_includedir" != "X/usr/include"; then
+                haveit=
+                if test "X$additional_includedir" = "X/usr/local/include"; then
+                  if test -n "$GCC"; then
+                    case $host_os in
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                    esac
+                  fi
+                fi
+                if test -z "$haveit"; then
+                  for x in $CPPFLAGS $INCICONV; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                    if test "X$x" = "X-I$additional_includedir"; then
+                      haveit=yes
+                      break
+                    fi
+                  done
+                  if test -z "$haveit"; then
+                    if test -d "$additional_includedir"; then
+                                            INCICONV="${INCICONV}${INCICONV:+ }-I$additional_includedir"
+                    fi
+                  fi
+                fi
+              fi
+            fi
+                        if test -n "$found_la"; then
+                                                        save_libdir="$libdir"
+              case "$found_la" in
+                */* | *\\*) . "$found_la" ;;
+                *) . "./$found_la" ;;
+              esac
+              libdir="$save_libdir"
+                            for dep in $dependency_libs; do
+                case "$dep" in
+                  -L*)
+                    additional_libdir=`echo "X$dep" | sed -e 's/^X-L//'`
+                                                                                                                                                                if test "X$additional_libdir" != "X/usr/$acl_libdirstem" \
+                       && test "X$additional_libdir" != "X/usr/$acl_libdirstem2"; then
+                      haveit=
+                      if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem" \
+                         || test "X$additional_libdir" = "X/usr/local/$acl_libdirstem2"; then
+                        if test -n "$GCC"; then
+                          case $host_os in
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                          esac
+                        fi
+                      fi
+                      if test -z "$haveit"; then
+                        haveit=
+                        for x in $LDFLAGS $LIBICONV; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                                                        LIBICONV="${LIBICONV}${LIBICONV:+ }-L$additional_libdir"
+                          fi
+                        fi
+                        haveit=
+                        for x in $LDFLAGS $LTLIBICONV; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                                                        LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }-L$additional_libdir"
+                          fi
+                        fi
+                      fi
+                    fi
+                    ;;
+                  -R*)
+                    dir=`echo "X$dep" | sed -e 's/^X-R//'`
+                    if test "$enable_rpath" != no; then
+                                                                  haveit=
+                      for x in $rpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        rpathdirs="$rpathdirs $dir"
+                      fi
+                                                                  haveit=
+                      for x in $ltrpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        ltrpathdirs="$ltrpathdirs $dir"
+                      fi
+                    fi
+                    ;;
+                  -l*)
+                                        names_next_round="$names_next_round "`echo "X$dep" | sed -e 's/^X-l//'`
+                    ;;
+                  *.la)
+                                                                                names_next_round="$names_next_round "`echo "X$dep" | sed -e 's,^X.*/,,' -e 's,^lib,,' -e 's,\.la$,,'`
+                    ;;
+                  *)
+                                        LIBICONV="${LIBICONV}${LIBICONV:+ }$dep"
+                    LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }$dep"
+                    ;;
+                esac
+              done
+            fi
+          else
+                                                            LIBICONV="${LIBICONV}${LIBICONV:+ }-l$name"
+            LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }-l$name"
+          fi
+        fi
+      fi
+    done
+  done
+  if test "X$rpathdirs" != "X"; then
+    if test -n "$acl_hardcode_libdir_separator"; then
+                        alldirs=
+      for found_dir in $rpathdirs; do
+        alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$found_dir"
+      done
+            acl_save_libdir="$libdir"
+      libdir="$alldirs"
+      eval flag=\"$acl_hardcode_libdir_flag_spec\"
+      libdir="$acl_save_libdir"
+      LIBICONV="${LIBICONV}${LIBICONV:+ }$flag"
+    else
+            for found_dir in $rpathdirs; do
+        acl_save_libdir="$libdir"
+        libdir="$found_dir"
+        eval flag=\"$acl_hardcode_libdir_flag_spec\"
+        libdir="$acl_save_libdir"
+        LIBICONV="${LIBICONV}${LIBICONV:+ }$flag"
+      done
+    fi
+  fi
+  if test "X$ltrpathdirs" != "X"; then
+            for found_dir in $ltrpathdirs; do
+      LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }-R$found_dir"
+    done
+  fi
+
+
+
+
+
+
+
+
+
+    ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+
+
+
+          am_save_CPPFLAGS="$CPPFLAGS"
+
+  for element in $INCICONV; do
+    haveit=
+    for x in $CPPFLAGS; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+      if test "X$x" = "X$element"; then
+        haveit=yes
+        break
+      fi
+    done
+    if test -z "$haveit"; then
+      CPPFLAGS="${CPPFLAGS}${CPPFLAGS:+ }$element"
+    fi
+  done
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for iconv" >&5
+$as_echo_n "checking for iconv... " >&6; }
+if ${am_cv_func_iconv+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    am_cv_func_iconv="no, consider installing GNU libiconv"
+    am_cv_lib_iconv=no
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <iconv.h>
+
+int
+main ()
+{
+iconv_t cd = iconv_open("","");
+           iconv(cd,NULL,NULL,NULL,NULL);
+           iconv_close(cd);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  am_cv_func_iconv=yes
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    if test "$am_cv_func_iconv" != yes; then
+      am_save_LIBS="$LIBS"
+      LIBS="$LIBS $LIBICONV"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <iconv.h>
+
+int
+main ()
+{
+iconv_t cd = iconv_open("","");
+             iconv(cd,NULL,NULL,NULL,NULL);
+             iconv_close(cd);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  am_cv_lib_iconv=yes
+        am_cv_func_iconv=yes
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+      LIBS="$am_save_LIBS"
+    fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_func_iconv" >&5
+$as_echo "$am_cv_func_iconv" >&6; }
+  if test "$am_cv_func_iconv" = yes; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working iconv" >&5
+$as_echo_n "checking for working iconv... " >&6; }
+if ${am_cv_func_iconv_works+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+                  am_save_LIBS="$LIBS"
+      if test $am_cv_lib_iconv = yes; then
+        LIBS="$LIBS $LIBICONV"
+      fi
+      if test "$cross_compiling" = yes; then :
+
+         case "$host_os" in
+           aix* | hpux*) am_cv_func_iconv_works="guessing no" ;;
+           *)            am_cv_func_iconv_works="guessing yes" ;;
+         esac
+
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <iconv.h>
+#include <string.h>
+int main ()
+{
+  int result = 0;
+  /* Test against AIX 5.1 bug: Failures are not distinguishable from successful
+     returns.  */
+  {
+    iconv_t cd_utf8_to_88591 = iconv_open ("ISO8859-1", "UTF-8");
+    if (cd_utf8_to_88591 != (iconv_t)(-1))
+      {
+        static const char input[] = "\342\202\254"; /* EURO SIGN */
+        char buf[10];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_utf8_to_88591,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if (res == 0)
+          result |= 1;
+        iconv_close (cd_utf8_to_88591);
+      }
+  }
+  /* Test against Solaris 10 bug: Failures are not distinguishable from
+     successful returns.  */
+  {
+    iconv_t cd_ascii_to_88591 = iconv_open ("ISO8859-1", "646");
+    if (cd_ascii_to_88591 != (iconv_t)(-1))
+      {
+        static const char input[] = "\263";
+        char buf[10];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_ascii_to_88591,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if (res == 0)
+          result |= 2;
+        iconv_close (cd_ascii_to_88591);
+      }
+  }
+  /* Test against AIX 6.1..7.1 bug: Buffer overrun.  */
+  {
+    iconv_t cd_88591_to_utf8 = iconv_open ("UTF-8", "ISO-8859-1");
+    if (cd_88591_to_utf8 != (iconv_t)(-1))
+      {
+        static const char input[] = "\304";
+        static char buf[2] = { (char)0xDE, (char)0xAD };
+        const char *inptr = input;
+        size_t inbytesleft = 1;
+        char *outptr = buf;
+        size_t outbytesleft = 1;
+        size_t res = iconv (cd_88591_to_utf8,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if (res != (size_t)(-1) || outptr - buf > 1 || buf[1] != (char)0xAD)
+          result |= 4;
+        iconv_close (cd_88591_to_utf8);
+      }
+  }
+#if 0 /* This bug could be worked around by the caller.  */
+  /* Test against HP-UX 11.11 bug: Positive return value instead of 0.  */
+  {
+    iconv_t cd_88591_to_utf8 = iconv_open ("utf8", "iso88591");
+    if (cd_88591_to_utf8 != (iconv_t)(-1))
+      {
+        static const char input[] = "\304rger mit b\366sen B\374bchen ohne Augenma\337";
+        char buf[50];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_88591_to_utf8,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if ((int)res > 0)
+          result |= 8;
+        iconv_close (cd_88591_to_utf8);
+      }
+  }
+#endif
+  /* Test against HP-UX 11.11 bug: No converter from EUC-JP to UTF-8 is
+     provided.  */
+  if (/* Try standardized names.  */
+      iconv_open ("UTF-8", "EUC-JP") == (iconv_t)(-1)
+      /* Try IRIX, OSF/1 names.  */
+      && iconv_open ("UTF-8", "eucJP") == (iconv_t)(-1)
+      /* Try AIX names.  */
+      && iconv_open ("UTF-8", "IBM-eucJP") == (iconv_t)(-1)
+      /* Try HP-UX names.  */
+      && iconv_open ("utf8", "eucJP") == (iconv_t)(-1))
+    result |= 16;
+  return result;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  am_cv_func_iconv_works=yes
+else
+  am_cv_func_iconv_works=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+      LIBS="$am_save_LIBS"
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_func_iconv_works" >&5
+$as_echo "$am_cv_func_iconv_works" >&6; }
+    case "$am_cv_func_iconv_works" in
+      *no) am_func_iconv=no am_cv_lib_iconv=no ;;
+      *)   am_func_iconv=yes ;;
+    esac
+  else
+    am_func_iconv=no am_cv_lib_iconv=no
+  fi
+  if test "$am_func_iconv" = yes; then
+
+$as_echo "#define HAVE_ICONV 1" >>confdefs.h
+
+  fi
+  if test "$am_cv_lib_iconv" = yes; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to link with libiconv" >&5
+$as_echo_n "checking how to link with libiconv... " >&6; }
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIBICONV" >&5
+$as_echo "$LIBICONV" >&6; }
+  else
+            CPPFLAGS="$am_save_CPPFLAGS"
+    LIBICONV=
+    LTLIBICONV=
+  fi
+
+
+
+    ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+  if test "$am_cv_func_iconv" = yes; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for iconv declaration" >&5
+$as_echo_n "checking for iconv declaration... " >&6; }
+    if ${am_cv_proto_iconv+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <iconv.h>
+extern
+#ifdef __cplusplus
+"C"
+#endif
+#if defined(__STDC__) || defined(_MSC_VER) || defined(__cplusplus)
+size_t iconv (iconv_t cd, char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);
+#else
+size_t iconv();
+#endif
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  am_cv_proto_iconv_arg1=""
+else
+  am_cv_proto_iconv_arg1="const"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+      am_cv_proto_iconv="extern size_t iconv (iconv_t cd, $am_cv_proto_iconv_arg1 char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);"
+fi
+
+    am_cv_proto_iconv=`echo "$am_cv_proto_iconv" | tr -s ' ' | sed -e 's/( /(/'`
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result:
+         $am_cv_proto_iconv" >&5
+$as_echo "
+         $am_cv_proto_iconv" >&6; }
+
+cat >>confdefs.h <<_ACEOF
+#define ICONV_CONST $am_cv_proto_iconv_arg1
+_ACEOF
+
+
+  fi
+
+
+mkdir_p="$MKDIR_P"
+case $mkdir_p in
+  [\\/$]* | ?:[\\/]*) ;;
+  */*) mkdir_p="\$(top_builddir)/$mkdir_p" ;;
+esac
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NLS is requested" >&5
+$as_echo_n "checking whether NLS is requested... " >&6; }
+    # Check whether --enable-nls was given.
+if test "${enable_nls+set}" = set; then :
+  enableval=$enable_nls; USE_NLS=$enableval
+else
+  USE_NLS=yes
+fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $USE_NLS" >&5
+$as_echo "$USE_NLS" >&6; }
+
+
+
+
+      GETTEXT_MACRO_VERSION=0.18
+
+
+
+
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+# Find out how to test for executable files. Don't use a zero-byte file,
+# as systems may use methods other than mode bits to determine executability.
+cat >conf$$.file <<_ASEOF
+#! /bin/sh
+exit 0
+_ASEOF
+chmod +x conf$$.file
+if test -x conf$$.file >/dev/null 2>&1; then
+  ac_executable_p="test -x"
+else
+  ac_executable_p="test -f"
+fi
+rm -f conf$$.file
+
+# Extract the first word of "msgfmt", so it can be a program name with args.
+set dummy msgfmt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_MSGFMT+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case "$MSGFMT" in
+  [\\/]* | ?:[\\/]*)
+    ac_cv_path_MSGFMT="$MSGFMT" # Let the user override the test with a path.
+    ;;
+  *)
+    ac_save_IFS="$IFS"; IFS=$PATH_SEPARATOR
+    for ac_dir in $PATH; do
+      IFS="$ac_save_IFS"
+      test -z "$ac_dir" && ac_dir=.
+      for ac_exec_ext in '' $ac_executable_extensions; do
+        if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
+          echo "$as_me: trying $ac_dir/$ac_word..." >&5
+          if $ac_dir/$ac_word --statistics /dev/null >&5 2>&1 &&
+     (if $ac_dir/$ac_word --statistics /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then
+            ac_cv_path_MSGFMT="$ac_dir/$ac_word$ac_exec_ext"
+            break 2
+          fi
+        fi
+      done
+    done
+    IFS="$ac_save_IFS"
+  test -z "$ac_cv_path_MSGFMT" && ac_cv_path_MSGFMT=":"
+    ;;
+esac
+fi
+MSGFMT="$ac_cv_path_MSGFMT"
+if test "$MSGFMT" != ":"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MSGFMT" >&5
+$as_echo "$MSGFMT" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  # Extract the first word of "gmsgfmt", so it can be a program name with args.
+set dummy gmsgfmt; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_GMSGFMT+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $GMSGFMT in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_GMSGFMT="$GMSGFMT" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_GMSGFMT="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  test -z "$ac_cv_path_GMSGFMT" && ac_cv_path_GMSGFMT="$MSGFMT"
+  ;;
+esac
+fi
+GMSGFMT=$ac_cv_path_GMSGFMT
+if test -n "$GMSGFMT"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $GMSGFMT" >&5
+$as_echo "$GMSGFMT" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+
+    case `$MSGFMT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) MSGFMT_015=: ;;
+    *) MSGFMT_015=$MSGFMT ;;
+  esac
+
+  case `$GMSGFMT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) GMSGFMT_015=: ;;
+    *) GMSGFMT_015=$GMSGFMT ;;
+  esac
+
+
+
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+# Find out how to test for executable files. Don't use a zero-byte file,
+# as systems may use methods other than mode bits to determine executability.
+cat >conf$$.file <<_ASEOF
+#! /bin/sh
+exit 0
+_ASEOF
+chmod +x conf$$.file
+if test -x conf$$.file >/dev/null 2>&1; then
+  ac_executable_p="test -x"
+else
+  ac_executable_p="test -f"
+fi
+rm -f conf$$.file
+
+# Extract the first word of "xgettext", so it can be a program name with args.
+set dummy xgettext; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_XGETTEXT+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case "$XGETTEXT" in
+  [\\/]* | ?:[\\/]*)
+    ac_cv_path_XGETTEXT="$XGETTEXT" # Let the user override the test with a path.
+    ;;
+  *)
+    ac_save_IFS="$IFS"; IFS=$PATH_SEPARATOR
+    for ac_dir in $PATH; do
+      IFS="$ac_save_IFS"
+      test -z "$ac_dir" && ac_dir=.
+      for ac_exec_ext in '' $ac_executable_extensions; do
+        if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
+          echo "$as_me: trying $ac_dir/$ac_word..." >&5
+          if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >&5 2>&1 &&
+     (if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then
+            ac_cv_path_XGETTEXT="$ac_dir/$ac_word$ac_exec_ext"
+            break 2
+          fi
+        fi
+      done
+    done
+    IFS="$ac_save_IFS"
+  test -z "$ac_cv_path_XGETTEXT" && ac_cv_path_XGETTEXT=":"
+    ;;
+esac
+fi
+XGETTEXT="$ac_cv_path_XGETTEXT"
+if test "$XGETTEXT" != ":"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $XGETTEXT" >&5
+$as_echo "$XGETTEXT" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+    rm -f messages.po
+
+    case `$XGETTEXT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) XGETTEXT_015=: ;;
+    *) XGETTEXT_015=$XGETTEXT ;;
+  esac
+
+
+
+# Prepare PATH_SEPARATOR.
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+# Find out how to test for executable files. Don't use a zero-byte file,
+# as systems may use methods other than mode bits to determine executability.
+cat >conf$$.file <<_ASEOF
+#! /bin/sh
+exit 0
+_ASEOF
+chmod +x conf$$.file
+if test -x conf$$.file >/dev/null 2>&1; then
+  ac_executable_p="test -x"
+else
+  ac_executable_p="test -f"
+fi
+rm -f conf$$.file
+
+# Extract the first word of "msgmerge", so it can be a program name with args.
+set dummy msgmerge; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_MSGMERGE+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case "$MSGMERGE" in
+  [\\/]* | ?:[\\/]*)
+    ac_cv_path_MSGMERGE="$MSGMERGE" # Let the user override the test with a path.
+    ;;
+  *)
+    ac_save_IFS="$IFS"; IFS=$PATH_SEPARATOR
+    for ac_dir in $PATH; do
+      IFS="$ac_save_IFS"
+      test -z "$ac_dir" && ac_dir=.
+      for ac_exec_ext in '' $ac_executable_extensions; do
+        if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
+          echo "$as_me: trying $ac_dir/$ac_word..." >&5
+          if $ac_dir/$ac_word --update -q /dev/null /dev/null >&5 2>&1; then
+            ac_cv_path_MSGMERGE="$ac_dir/$ac_word$ac_exec_ext"
+            break 2
+          fi
+        fi
+      done
+    done
+    IFS="$ac_save_IFS"
+  test -z "$ac_cv_path_MSGMERGE" && ac_cv_path_MSGMERGE=":"
+    ;;
+esac
+fi
+MSGMERGE="$ac_cv_path_MSGMERGE"
+if test "$MSGMERGE" != ":"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MSGMERGE" >&5
+$as_echo "$MSGMERGE" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+        test -n "$localedir" || localedir='${datadir}/locale'
+
+
+    test -n "${XGETTEXT_EXTRA_OPTIONS+set}" || XGETTEXT_EXTRA_OPTIONS=
+
+
+  ac_config_commands="$ac_config_commands po-directories"
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C Library 2 or newer" >&5
+$as_echo_n "checking whether we are using the GNU C Library 2 or newer... " >&6; }
+if ${ac_cv_gnu_library_2+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <features.h>
+#ifdef __GNU_LIBRARY__
+ #if (__GLIBC__ >= 2)
+  Lucky GNU user
+ #endif
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "Lucky GNU user" >/dev/null 2>&1; then :
+  ac_cv_gnu_library_2=yes
+else
+  ac_cv_gnu_library_2=no
+fi
+rm -f conftest*
+
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_gnu_library_2" >&5
+$as_echo "$ac_cv_gnu_library_2" >&6; }
+
+    GLIBC2="$ac_cv_gnu_library_2"
+
+
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
+set dummy ${ac_tool_prefix}ranlib; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_RANLIB+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+RANLIB=$ac_cv_prog_RANLIB
+if test -n "$RANLIB"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RANLIB" >&5
+$as_echo "$RANLIB" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_RANLIB"; then
+  ac_ct_RANLIB=$RANLIB
+  # Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_RANLIB+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_RANLIB"; then
+  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_RANLIB="ranlib"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
+if test -n "$ac_ct_RANLIB"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RANLIB" >&5
+$as_echo "$ac_ct_RANLIB" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_RANLIB" = x; then
+    RANLIB=":"
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    RANLIB=$ac_ct_RANLIB
+  fi
+else
+  RANLIB="$ac_cv_prog_RANLIB"
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for inline" >&5
+$as_echo_n "checking for inline... " >&6; }
+if ${ac_cv_c_inline+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_c_inline=no
+for ac_kw in inline __inline__ __inline; do
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifndef __cplusplus
+typedef int foo_t;
+static $ac_kw foo_t static_foo () {return 0; }
+$ac_kw foo_t foo () {return 0; }
+#endif
+
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_c_inline=$ac_kw
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  test "$ac_cv_c_inline" != no && break
+done
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_inline" >&5
+$as_echo "$ac_cv_c_inline" >&6; }
+
+case $ac_cv_c_inline in
+  inline | yes) ;;
+  *)
+    case $ac_cv_c_inline in
+      no) ac_val=;;
+      *) ac_val=$ac_cv_c_inline;;
+    esac
+    cat >>confdefs.h <<_ACEOF
+#ifndef __cplusplus
+#define inline $ac_val
+#endif
+_ACEOF
+    ;;
+esac
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for stdint.h" >&5
+$as_echo_n "checking for stdint.h... " >&6; }
+if ${gl_cv_header_stdint_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+#include <stdint.h>
+int
+main ()
+{
+uintmax_t i = (uintmax_t) -1; return !i;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gl_cv_header_stdint_h=yes
+else
+  gl_cv_header_stdint_h=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_header_stdint_h" >&5
+$as_echo "$gl_cv_header_stdint_h" >&6; }
+  if test $gl_cv_header_stdint_h = yes; then
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STDINT_H_WITH_UINTMAX 1
+_ACEOF
+
+  fi
+
+# The Ultrix 4.2 mips builtin alloca declared by alloca.h only works
+# for constant arguments.  Useless!
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working alloca.h" >&5
+$as_echo_n "checking for working alloca.h... " >&6; }
+if ${ac_cv_working_alloca_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <alloca.h>
+int
+main ()
+{
+char *p = (char *) alloca (2 * sizeof (int));
+			  if (p) return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_working_alloca_h=yes
+else
+  ac_cv_working_alloca_h=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_working_alloca_h" >&5
+$as_echo "$ac_cv_working_alloca_h" >&6; }
+if test $ac_cv_working_alloca_h = yes; then
+
+$as_echo "#define HAVE_ALLOCA_H 1" >>confdefs.h
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for alloca" >&5
+$as_echo_n "checking for alloca... " >&6; }
+if ${ac_cv_func_alloca_works+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __GNUC__
+# define alloca __builtin_alloca
+#else
+# ifdef _MSC_VER
+#  include <malloc.h>
+#  define alloca _alloca
+# else
+#  ifdef HAVE_ALLOCA_H
+#   include <alloca.h>
+#  else
+#   ifdef _AIX
+ #pragma alloca
+#   else
+#    ifndef alloca /* predefined by HP cc +Olibcalls */
+void *alloca (size_t);
+#    endif
+#   endif
+#  endif
+# endif
+#endif
+
+int
+main ()
+{
+char *p = (char *) alloca (1);
+				    if (p) return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_func_alloca_works=yes
+else
+  ac_cv_func_alloca_works=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_func_alloca_works" >&5
+$as_echo "$ac_cv_func_alloca_works" >&6; }
+
+if test $ac_cv_func_alloca_works = yes; then
+
+$as_echo "#define HAVE_ALLOCA 1" >>confdefs.h
+
+else
+  # The SVR3 libPW and SVR4 libucb both contain incompatible functions
+# that cause trouble.  Some versions do not even contain alloca or
+# contain a buggy version.  If you still want to use their alloca,
+# use ar to extract alloca.o from them instead of compiling alloca.c.
+
+ALLOCA=\${LIBOBJDIR}alloca.$ac_objext
+
+$as_echo "#define C_ALLOCA 1" >>confdefs.h
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether \`alloca.c' needs Cray hooks" >&5
+$as_echo_n "checking whether \`alloca.c' needs Cray hooks... " >&6; }
+if ${ac_cv_os_cray+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#if defined CRAY && ! defined CRAY2
+webecray
+#else
+wenotbecray
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "webecray" >/dev/null 2>&1; then :
+  ac_cv_os_cray=yes
+else
+  ac_cv_os_cray=no
+fi
+rm -f conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_os_cray" >&5
+$as_echo "$ac_cv_os_cray" >&6; }
+if test $ac_cv_os_cray = yes; then
+  for ac_func in _getb67 GETB67 getb67; do
+    as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+
+cat >>confdefs.h <<_ACEOF
+#define CRAY_STACKSEG_END $ac_func
+_ACEOF
+
+    break
+fi
+
+  done
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking stack direction for C alloca" >&5
+$as_echo_n "checking stack direction for C alloca... " >&6; }
+if ${ac_cv_c_stack_direction+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  ac_cv_c_stack_direction=0
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$ac_includes_default
+int
+find_stack_direction (int *addr, int depth)
+{
+  int dir, dummy = 0;
+  if (! addr)
+    addr = &dummy;
+  *addr = addr < &dummy ? 1 : addr == &dummy ? 0 : -1;
+  dir = depth ? find_stack_direction (addr, depth - 1) : 0;
+  return dir + dummy;
+}
+
+int
+main (int argc, char **argv)
+{
+  return find_stack_direction (0, argc + !argv + 20) < 0;
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  ac_cv_c_stack_direction=1
+else
+  ac_cv_c_stack_direction=-1
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_stack_direction" >&5
+$as_echo "$ac_cv_c_stack_direction" >&6; }
+cat >>confdefs.h <<_ACEOF
+#define STACK_DIRECTION $ac_cv_c_stack_direction
+_ACEOF
+
+
+fi
+
+
+
+
+  for ac_header in $ac_header_list
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_cxx_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+
+
+
+
+
+
+for ac_func in getpagesize
+do :
+  ac_fn_cxx_check_func "$LINENO" "getpagesize" "ac_cv_func_getpagesize"
+if test "x$ac_cv_func_getpagesize" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETPAGESIZE 1
+_ACEOF
+
+fi
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for working mmap" >&5
+$as_echo_n "checking for working mmap... " >&6; }
+if ${ac_cv_func_mmap_fixed_mapped+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  ac_cv_func_mmap_fixed_mapped=no
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$ac_includes_default
+/* malloc might have been renamed as rpl_malloc. */
+#undef malloc
+
+/* Thanks to Mike Haertel and Jim Avera for this test.
+   Here is a matrix of mmap possibilities:
+	mmap private not fixed
+	mmap private fixed at somewhere currently unmapped
+	mmap private fixed at somewhere already mapped
+	mmap shared not fixed
+	mmap shared fixed at somewhere currently unmapped
+	mmap shared fixed at somewhere already mapped
+   For private mappings, we should verify that changes cannot be read()
+   back from the file, nor mmap's back from the file at a different
+   address.  (There have been systems where private was not correctly
+   implemented like the infamous i386 svr4.0, and systems where the
+   VM page cache was not coherent with the file system buffer cache
+   like early versions of FreeBSD and possibly contemporary NetBSD.)
+   For shared mappings, we should conversely verify that changes get
+   propagated back to all the places they're supposed to be.
+
+   Grep wants private fixed already mapped.
+   The main things grep needs to know about mmap are:
+   * does it exist and is it safe to write into the mmap'd area
+   * how to use it (BSD variants)  */
+
+#include <fcntl.h>
+#include <sys/mman.h>
+
+#if !defined STDC_HEADERS && !defined HAVE_STDLIB_H
+char *malloc ();
+#endif
+
+/* This mess was copied from the GNU getpagesize.h.  */
+#ifndef HAVE_GETPAGESIZE
+# ifdef _SC_PAGESIZE
+#  define getpagesize() sysconf(_SC_PAGESIZE)
+# else /* no _SC_PAGESIZE */
+#  ifdef HAVE_SYS_PARAM_H
+#   include <sys/param.h>
+#   ifdef EXEC_PAGESIZE
+#    define getpagesize() EXEC_PAGESIZE
+#   else /* no EXEC_PAGESIZE */
+#    ifdef NBPG
+#     define getpagesize() NBPG * CLSIZE
+#     ifndef CLSIZE
+#      define CLSIZE 1
+#     endif /* no CLSIZE */
+#    else /* no NBPG */
+#     ifdef NBPC
+#      define getpagesize() NBPC
+#     else /* no NBPC */
+#      ifdef PAGESIZE
+#       define getpagesize() PAGESIZE
+#      endif /* PAGESIZE */
+#     endif /* no NBPC */
+#    endif /* no NBPG */
+#   endif /* no EXEC_PAGESIZE */
+#  else /* no HAVE_SYS_PARAM_H */
+#   define getpagesize() 8192	/* punt totally */
+#  endif /* no HAVE_SYS_PARAM_H */
+# endif /* no _SC_PAGESIZE */
+
+#endif /* no HAVE_GETPAGESIZE */
+
+int
+main ()
+{
+  char *data, *data2, *data3;
+  const char *cdata2;
+  int i, pagesize;
+  int fd, fd2;
+
+  pagesize = getpagesize ();
+
+  /* First, make a file with some known garbage in it. */
+  data = (char *) malloc (pagesize);
+  if (!data)
+    return 1;
+  for (i = 0; i < pagesize; ++i)
+    *(data + i) = rand ();
+  umask (0);
+  fd = creat ("conftest.mmap", 0600);
+  if (fd < 0)
+    return 2;
+  if (write (fd, data, pagesize) != pagesize)
+    return 3;
+  close (fd);
+
+  /* Next, check that the tail of a page is zero-filled.  File must have
+     non-zero length, otherwise we risk SIGBUS for entire page.  */
+  fd2 = open ("conftest.txt", O_RDWR | O_CREAT | O_TRUNC, 0600);
+  if (fd2 < 0)
+    return 4;
+  cdata2 = "";
+  if (write (fd2, cdata2, 1) != 1)
+    return 5;
+  data2 = (char *) mmap (0, pagesize, PROT_READ | PROT_WRITE, MAP_SHARED, fd2, 0L);
+  if (data2 == MAP_FAILED)
+    return 6;
+  for (i = 0; i < pagesize; ++i)
+    if (*(data2 + i))
+      return 7;
+  close (fd2);
+  if (munmap (data2, pagesize))
+    return 8;
+
+  /* Next, try to mmap the file at a fixed address which already has
+     something else allocated at it.  If we can, also make sure that
+     we see the same garbage.  */
+  fd = open ("conftest.mmap", O_RDWR);
+  if (fd < 0)
+    return 9;
+  if (data2 != mmap (data2, pagesize, PROT_READ | PROT_WRITE,
+		     MAP_PRIVATE | MAP_FIXED, fd, 0L))
+    return 10;
+  for (i = 0; i < pagesize; ++i)
+    if (*(data + i) != *(data2 + i))
+      return 11;
+
+  /* Finally, make sure that changes to the mapped area do not
+     percolate back to the file as seen by read().  (This is a bug on
+     some variants of i386 svr4.0.)  */
+  for (i = 0; i < pagesize; ++i)
+    *(data2 + i) = *(data2 + i) + 1;
+  data3 = (char *) malloc (pagesize);
+  if (!data3)
+    return 12;
+  if (read (fd, data3, pagesize) != pagesize)
+    return 13;
+  for (i = 0; i < pagesize; ++i)
+    if (*(data + i) != *(data3 + i))
+      return 14;
+  close (fd);
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  ac_cv_func_mmap_fixed_mapped=yes
+else
+  ac_cv_func_mmap_fixed_mapped=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_func_mmap_fixed_mapped" >&5
+$as_echo "$ac_cv_func_mmap_fixed_mapped" >&6; }
+if test $ac_cv_func_mmap_fixed_mapped = yes; then
+
+$as_echo "#define HAVE_MMAP 1" >>confdefs.h
+
+fi
+rm -f conftest.mmap conftest.txt
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether integer division by zero raises SIGFPE" >&5
+$as_echo_n "checking whether integer division by zero raises SIGFPE... " >&6; }
+if ${gt_cv_int_divbyzero_sigfpe+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      gt_cv_int_divbyzero_sigfpe=
+      case "$host_os" in
+        macos* | darwin[6-9]* | darwin[1-9][0-9]*)
+          # On MacOS X 10.2 or newer, just assume the same as when cross-
+          # compiling. If we were to perform the real test, 1 Crash Report
+          # dialog window would pop up.
+          case "$host_cpu" in
+            i[34567]86 | x86_64)
+              gt_cv_int_divbyzero_sigfpe="guessing yes" ;;
+          esac
+          ;;
+      esac
+      if test -z "$gt_cv_int_divbyzero_sigfpe"; then
+        if test "$cross_compiling" = yes; then :
+
+            # Guess based on the CPU.
+            case "$host_cpu" in
+              alpha* | i[34567]86 | x86_64 | m68k | s390*)
+                gt_cv_int_divbyzero_sigfpe="guessing yes";;
+              *)
+                gt_cv_int_divbyzero_sigfpe="guessing no";;
+            esac
+
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <signal.h>
+
+static void
+sigfpe_handler (int sig)
+{
+  /* Exit with code 0 if SIGFPE, with code 1 if any other signal.  */
+  exit (sig != SIGFPE);
+}
+
+int x = 1;
+int y = 0;
+int z;
+int nan;
+
+int main ()
+{
+  signal (SIGFPE, sigfpe_handler);
+/* IRIX and AIX (when "xlc -qcheck" is used) yield signal SIGTRAP.  */
+#if (defined (__sgi) || defined (_AIX)) && defined (SIGTRAP)
+  signal (SIGTRAP, sigfpe_handler);
+#endif
+/* Linux/SPARC yields signal SIGILL.  */
+#if defined (__sparc__) && defined (__linux__)
+  signal (SIGILL, sigfpe_handler);
+#endif
+
+  z = x / y;
+  nan = y / y;
+  exit (1);
+}
+
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  gt_cv_int_divbyzero_sigfpe=yes
+else
+  gt_cv_int_divbyzero_sigfpe=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+      fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_int_divbyzero_sigfpe" >&5
+$as_echo "$gt_cv_int_divbyzero_sigfpe" >&6; }
+  case "$gt_cv_int_divbyzero_sigfpe" in
+    *yes) value=1;;
+    *) value=0;;
+  esac
+
+cat >>confdefs.h <<_ACEOF
+#define INTDIV0_RAISES_SIGFPE $value
+_ACEOF
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for inttypes.h" >&5
+$as_echo_n "checking for inttypes.h... " >&6; }
+if ${gl_cv_header_inttypes_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+#include <inttypes.h>
+int
+main ()
+{
+uintmax_t i = (uintmax_t) -1; return !i;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gl_cv_header_inttypes_h=yes
+else
+  gl_cv_header_inttypes_h=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_header_inttypes_h" >&5
+$as_echo "$gl_cv_header_inttypes_h" >&6; }
+  if test $gl_cv_header_inttypes_h = yes; then
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_INTTYPES_H_WITH_UINTMAX 1
+_ACEOF
+
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for unsigned long long int" >&5
+$as_echo_n "checking for unsigned long long int... " >&6; }
+if ${ac_cv_type_unsigned_long_long_int+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+  /* For now, do not test the preprocessor; as of 2007 there are too many
+         implementations with broken preprocessors.  Perhaps this can
+         be revisited in 2012.  In the meantime, code should not expect
+         #if to work with literals wider than 32 bits.  */
+      /* Test literals.  */
+      long long int ll = 9223372036854775807ll;
+      long long int nll = -9223372036854775807LL;
+      unsigned long long int ull = 18446744073709551615ULL;
+      /* Test constant expressions.   */
+      typedef int a[((-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
+                     ? 1 : -1)];
+      typedef int b[(18446744073709551615ULL <= (unsigned long long int) -1
+                     ? 1 : -1)];
+      int i = 63;
+int
+main ()
+{
+/* Test availability of runtime routines for shift and division.  */
+      long long int llmax = 9223372036854775807ll;
+      unsigned long long int ullmax = 18446744073709551615ull;
+      return ((ll << 63) | (ll >> 63) | (ll < i) | (ll > i)
+              | (llmax / ll) | (llmax % ll)
+              | (ull << 63) | (ull >> 63) | (ull << i) | (ull >> i)
+              | (ullmax / ull) | (ullmax % ull));
+  ;
+  return 0;
+}
+
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_type_unsigned_long_long_int=yes
+else
+  ac_cv_type_unsigned_long_long_int=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_unsigned_long_long_int" >&5
+$as_echo "$ac_cv_type_unsigned_long_long_int" >&6; }
+  if test $ac_cv_type_unsigned_long_long_int = yes; then
+
+$as_echo "#define HAVE_UNSIGNED_LONG_LONG_INT 1" >>confdefs.h
+
+  fi
+
+
+
+
+  if test $gl_cv_header_inttypes_h = no && test $gl_cv_header_stdint_h = no; then
+
+    test $ac_cv_type_unsigned_long_long_int = yes \
+      && ac_type='unsigned long long' \
+      || ac_type='unsigned long'
+
+cat >>confdefs.h <<_ACEOF
+#define uintmax_t $ac_type
+_ACEOF
+
+  else
+
+$as_echo "#define HAVE_UINTMAX_T 1" >>confdefs.h
+
+  fi
+
+
+  for ac_header in inttypes.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "inttypes.h" "ac_cv_header_inttypes_h" "$ac_includes_default"
+if test "x$ac_cv_header_inttypes_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_INTTYPES_H 1
+_ACEOF
+
+fi
+
+done
+
+  if test $ac_cv_header_inttypes_h = yes; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the inttypes.h PRIxNN macros are broken" >&5
+$as_echo_n "checking whether the inttypes.h PRIxNN macros are broken... " >&6; }
+if ${gt_cv_inttypes_pri_broken+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <inttypes.h>
+#ifdef PRId32
+char *p = PRId32;
+#endif
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gt_cv_inttypes_pri_broken=no
+else
+  gt_cv_inttypes_pri_broken=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_inttypes_pri_broken" >&5
+$as_echo "$gt_cv_inttypes_pri_broken" >&6; }
+  fi
+  if test "$gt_cv_inttypes_pri_broken" = yes; then
+
+cat >>confdefs.h <<_ACEOF
+#define PRI_MACROS_BROKEN 1
+_ACEOF
+
+    PRI_MACROS_BROKEN=1
+  else
+    PRI_MACROS_BROKEN=0
+  fi
+
+
+
+
+
+
+
+  # Check whether --enable-threads was given.
+if test "${enable_threads+set}" = set; then :
+  enableval=$enable_threads; gl_use_threads=$enableval
+else
+  if test -n "$gl_use_threads_default"; then
+       gl_use_threads="$gl_use_threads_default"
+     else
+       case "$host_os" in
+                                                               osf*) gl_use_threads=no ;;
+         cygwin*)
+               case `uname -r` in
+                 1.[0-5].*) gl_use_threads=no ;;
+                 *)         gl_use_threads=yes ;;
+               esac
+               ;;
+         *)    gl_use_threads=yes ;;
+       esac
+     fi
+
+fi
+
+  if test "$gl_use_threads" = yes || test "$gl_use_threads" = posix; then
+    # For using <pthread.h>:
+    case "$host_os" in
+      osf*)
+        # On OSF/1, the compiler needs the flag -D_REENTRANT so that it
+        # groks <pthread.h>. cc also understands the flag -pthread, but
+        # we don't use it because 1. gcc-2.95 doesn't understand -pthread,
+        # 2. putting a flag into CPPFLAGS that has an effect on the linker
+        # causes the AC_TRY_LINK test below to succeed unexpectedly,
+        # leading to wrong values of LIBTHREAD and LTLIBTHREAD.
+        CPPFLAGS="$CPPFLAGS -D_REENTRANT"
+        ;;
+    esac
+    # Some systems optimize for single-threaded programs by default, and
+    # need special flags to disable these optimizations. For example, the
+    # definition of 'errno' in <errno.h>.
+    case "$host_os" in
+      aix* | freebsd*) CPPFLAGS="$CPPFLAGS -D_THREAD_SAFE" ;;
+      solaris*) CPPFLAGS="$CPPFLAGS -D_REENTRANT" ;;
+    esac
+  fi
+
+
+
+
+
+
+  gl_threads_api=none
+  LIBTHREAD=
+  LTLIBTHREAD=
+  LIBMULTITHREAD=
+  LTLIBMULTITHREAD=
+  if test "$gl_use_threads" != no; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether imported symbols can be declared weak" >&5
+$as_echo_n "checking whether imported symbols can be declared weak... " >&6; }
+if ${gl_cv_have_weak+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  gl_cv_have_weak=no
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+extern void xyzzy ();
+#pragma weak xyzzy
+int
+main ()
+{
+xyzzy();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gl_cv_have_weak=maybe
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+       if test $gl_cv_have_weak = maybe; then
+                           if test "$cross_compiling" = yes; then :
+                          cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __ELF__
+               Extensible Linking Format
+               #endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "Extensible Linking Format" >/dev/null 2>&1; then :
+  gl_cv_have_weak="guessing yes"
+else
+  gl_cv_have_weak="guessing no"
+fi
+rm -f conftest*
+
+
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#pragma weak fputs
+int main ()
+{
+  return (fputs == NULL);
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  gl_cv_have_weak=yes
+else
+  gl_cv_have_weak=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+       fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_have_weak" >&5
+$as_echo "$gl_cv_have_weak" >&6; }
+    if test "$gl_use_threads" = yes || test "$gl_use_threads" = posix; then
+      # On OSF/1, the compiler needs the flag -pthread or -D_REENTRANT so that
+      # it groks <pthread.h>. It's added above, in gl_THREADLIB_EARLY_BODY.
+      ac_fn_cxx_check_header_mongrel "$LINENO" "pthread.h" "ac_cv_header_pthread_h" "$ac_includes_default"
+if test "x$ac_cv_header_pthread_h" = xyes; then :
+  gl_have_pthread_h=yes
+else
+  gl_have_pthread_h=no
+fi
+
+
+      if test "$gl_have_pthread_h" = yes; then
+        # Other possible tests:
+        #   -lpthreads (FSU threads, PCthreads)
+        #   -lgthreads
+        gl_have_pthread=
+        # Test whether both pthread_mutex_lock and pthread_mutexattr_init exist
+        # in libc. IRIX 6.5 has the first one in both libc and libpthread, but
+        # the second one only in libpthread, and lock.c needs it.
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <pthread.h>
+int
+main ()
+{
+pthread_mutex_lock((pthread_mutex_t*)0);
+           pthread_mutexattr_init((pthread_mutexattr_t*)0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gl_have_pthread=yes
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+        # Test for libpthread by looking for pthread_kill. (Not pthread_self,
+        # since it is defined as a macro on OSF/1.)
+        if test -n "$gl_have_pthread"; then
+          # The program links fine without libpthread. But it may actually
+          # need to link with libpthread in order to create multiple threads.
+          { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_kill in -lpthread" >&5
+$as_echo_n "checking for pthread_kill in -lpthread... " >&6; }
+if ${ac_cv_lib_pthread_pthread_kill+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lpthread  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pthread_kill ();
+int
+main ()
+{
+return pthread_kill ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_pthread_pthread_kill=yes
+else
+  ac_cv_lib_pthread_pthread_kill=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_kill" >&5
+$as_echo "$ac_cv_lib_pthread_pthread_kill" >&6; }
+if test "x$ac_cv_lib_pthread_pthread_kill" = xyes; then :
+  LIBMULTITHREAD=-lpthread LTLIBMULTITHREAD=-lpthread
+             # On Solaris and HP-UX, most pthread functions exist also in libc.
+             # Therefore pthread_in_use() needs to actually try to create a
+             # thread: pthread_create from libc will fail, whereas
+             # pthread_create will actually create a thread.
+             case "$host_os" in
+               solaris* | hpux*)
+
+$as_echo "#define PTHREAD_IN_USE_DETECTION_HARD 1" >>confdefs.h
+
+             esac
+
+fi
+
+        else
+          # Some library is needed. Try libpthread and libc_r.
+          { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_kill in -lpthread" >&5
+$as_echo_n "checking for pthread_kill in -lpthread... " >&6; }
+if ${ac_cv_lib_pthread_pthread_kill+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lpthread  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pthread_kill ();
+int
+main ()
+{
+return pthread_kill ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_pthread_pthread_kill=yes
+else
+  ac_cv_lib_pthread_pthread_kill=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_kill" >&5
+$as_echo "$ac_cv_lib_pthread_pthread_kill" >&6; }
+if test "x$ac_cv_lib_pthread_pthread_kill" = xyes; then :
+  gl_have_pthread=yes
+             LIBTHREAD=-lpthread LTLIBTHREAD=-lpthread
+             LIBMULTITHREAD=-lpthread LTLIBMULTITHREAD=-lpthread
+fi
+
+          if test -z "$gl_have_pthread"; then
+            # For FreeBSD 4.
+            { $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_kill in -lc_r" >&5
+$as_echo_n "checking for pthread_kill in -lc_r... " >&6; }
+if ${ac_cv_lib_c_r_pthread_kill+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lc_r  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pthread_kill ();
+int
+main ()
+{
+return pthread_kill ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_c_r_pthread_kill=yes
+else
+  ac_cv_lib_c_r_pthread_kill=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_c_r_pthread_kill" >&5
+$as_echo "$ac_cv_lib_c_r_pthread_kill" >&6; }
+if test "x$ac_cv_lib_c_r_pthread_kill" = xyes; then :
+  gl_have_pthread=yes
+               LIBTHREAD=-lc_r LTLIBTHREAD=-lc_r
+               LIBMULTITHREAD=-lc_r LTLIBMULTITHREAD=-lc_r
+fi
+
+          fi
+        fi
+        if test -n "$gl_have_pthread"; then
+          gl_threads_api=posix
+
+$as_echo "#define USE_POSIX_THREADS 1" >>confdefs.h
+
+          if test -n "$LIBMULTITHREAD" || test -n "$LTLIBMULTITHREAD"; then
+            if case "$gl_cv_have_weak" in *yes) true;; *) false;; esac; then
+
+$as_echo "#define USE_POSIX_THREADS_WEAK 1" >>confdefs.h
+
+              LIBTHREAD=
+              LTLIBTHREAD=
+            fi
+          fi
+        fi
+      fi
+    fi
+    if test -z "$gl_have_pthread"; then
+      if test "$gl_use_threads" = yes || test "$gl_use_threads" = solaris; then
+        gl_have_solaristhread=
+        gl_save_LIBS="$LIBS"
+        LIBS="$LIBS -lthread"
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <thread.h>
+#include <synch.h>
+int
+main ()
+{
+thr_self();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gl_have_solaristhread=yes
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+        LIBS="$gl_save_LIBS"
+        if test -n "$gl_have_solaristhread"; then
+          gl_threads_api=solaris
+          LIBTHREAD=-lthread
+          LTLIBTHREAD=-lthread
+          LIBMULTITHREAD="$LIBTHREAD"
+          LTLIBMULTITHREAD="$LTLIBTHREAD"
+
+$as_echo "#define USE_SOLARIS_THREADS 1" >>confdefs.h
+
+          if case "$gl_cv_have_weak" in *yes) true;; *) false;; esac; then
+
+$as_echo "#define USE_SOLARIS_THREADS_WEAK 1" >>confdefs.h
+
+            LIBTHREAD=
+            LTLIBTHREAD=
+          fi
+        fi
+      fi
+    fi
+    if test "$gl_use_threads" = pth; then
+      gl_save_CPPFLAGS="$CPPFLAGS"
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to link with libpth" >&5
+$as_echo_n "checking how to link with libpth... " >&6; }
+if ${ac_cv_libpth_libs+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+
+
+
+
+
+
+
+    use_additional=yes
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+
+    eval additional_includedir=\"$includedir\"
+    eval additional_libdir=\"$libdir\"
+
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+
+# Check whether --with-libpth-prefix was given.
+if test "${with_libpth_prefix+set}" = set; then :
+  withval=$with_libpth_prefix;
+    if test "X$withval" = "Xno"; then
+      use_additional=no
+    else
+      if test "X$withval" = "X"; then
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+
+          eval additional_includedir=\"$includedir\"
+          eval additional_libdir=\"$libdir\"
+
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+      else
+        additional_includedir="$withval/include"
+        additional_libdir="$withval/$acl_libdirstem"
+        if test "$acl_libdirstem2" != "$acl_libdirstem" \
+           && ! test -d "$withval/$acl_libdirstem"; then
+          additional_libdir="$withval/$acl_libdirstem2"
+        fi
+      fi
+    fi
+
+fi
+
+      LIBPTH=
+  LTLIBPTH=
+  INCPTH=
+  LIBPTH_PREFIX=
+      HAVE_LIBPTH=
+  rpathdirs=
+  ltrpathdirs=
+  names_already_handled=
+  names_next_round='pth '
+  while test -n "$names_next_round"; do
+    names_this_round="$names_next_round"
+    names_next_round=
+    for name in $names_this_round; do
+      already_handled=
+      for n in $names_already_handled; do
+        if test "$n" = "$name"; then
+          already_handled=yes
+          break
+        fi
+      done
+      if test -z "$already_handled"; then
+        names_already_handled="$names_already_handled $name"
+                        uppername=`echo "$name" | sed -e 'y|abcdefghijklmnopqrstuvwxyz./-|ABCDEFGHIJKLMNOPQRSTUVWXYZ___|'`
+        eval value=\"\$HAVE_LIB$uppername\"
+        if test -n "$value"; then
+          if test "$value" = yes; then
+            eval value=\"\$LIB$uppername\"
+            test -z "$value" || LIBPTH="${LIBPTH}${LIBPTH:+ }$value"
+            eval value=\"\$LTLIB$uppername\"
+            test -z "$value" || LTLIBPTH="${LTLIBPTH}${LTLIBPTH:+ }$value"
+          else
+                                    :
+          fi
+        else
+                              found_dir=
+          found_la=
+          found_so=
+          found_a=
+          eval libname=\"$acl_libname_spec\"    # typically: libname=lib$name
+          if test -n "$acl_shlibext"; then
+            shrext=".$acl_shlibext"             # typically: shrext=.so
+          else
+            shrext=
+          fi
+          if test $use_additional = yes; then
+            dir="$additional_libdir"
+                                    if test -n "$acl_shlibext"; then
+              if test -f "$dir/$libname$shrext"; then
+                found_dir="$dir"
+                found_so="$dir/$libname$shrext"
+              else
+                if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                  ver=`(cd "$dir" && \
+                        for f in "$libname$shrext".*; do echo "$f"; done \
+                        | sed -e "s,^$libname$shrext\\\\.,," \
+                        | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                        | sed 1q ) 2>/dev/null`
+                  if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                    found_dir="$dir"
+                    found_so="$dir/$libname$shrext.$ver"
+                  fi
+                else
+                  eval library_names=\"$acl_library_names_spec\"
+                  for f in $library_names; do
+                    if test -f "$dir/$f"; then
+                      found_dir="$dir"
+                      found_so="$dir/$f"
+                      break
+                    fi
+                  done
+                fi
+              fi
+            fi
+                        if test "X$found_dir" = "X"; then
+              if test -f "$dir/$libname.$acl_libext"; then
+                found_dir="$dir"
+                found_a="$dir/$libname.$acl_libext"
+              fi
+            fi
+            if test "X$found_dir" != "X"; then
+              if test -f "$dir/$libname.la"; then
+                found_la="$dir/$libname.la"
+              fi
+            fi
+          fi
+          if test "X$found_dir" = "X"; then
+            for x in $LDFLAGS $LTLIBPTH; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+              case "$x" in
+                -L*)
+                  dir=`echo "X$x" | sed -e 's/^X-L//'`
+                                    if test -n "$acl_shlibext"; then
+                    if test -f "$dir/$libname$shrext"; then
+                      found_dir="$dir"
+                      found_so="$dir/$libname$shrext"
+                    else
+                      if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                        ver=`(cd "$dir" && \
+                              for f in "$libname$shrext".*; do echo "$f"; done \
+                              | sed -e "s,^$libname$shrext\\\\.,," \
+                              | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                              | sed 1q ) 2>/dev/null`
+                        if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                          found_dir="$dir"
+                          found_so="$dir/$libname$shrext.$ver"
+                        fi
+                      else
+                        eval library_names=\"$acl_library_names_spec\"
+                        for f in $library_names; do
+                          if test -f "$dir/$f"; then
+                            found_dir="$dir"
+                            found_so="$dir/$f"
+                            break
+                          fi
+                        done
+                      fi
+                    fi
+                  fi
+                                    if test "X$found_dir" = "X"; then
+                    if test -f "$dir/$libname.$acl_libext"; then
+                      found_dir="$dir"
+                      found_a="$dir/$libname.$acl_libext"
+                    fi
+                  fi
+                  if test "X$found_dir" != "X"; then
+                    if test -f "$dir/$libname.la"; then
+                      found_la="$dir/$libname.la"
+                    fi
+                  fi
+                  ;;
+              esac
+              if test "X$found_dir" != "X"; then
+                break
+              fi
+            done
+          fi
+          if test "X$found_dir" != "X"; then
+                        LTLIBPTH="${LTLIBPTH}${LTLIBPTH:+ }-L$found_dir -l$name"
+            if test "X$found_so" != "X"; then
+                                                        if test "$enable_rpath" = no \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem" \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem2"; then
+                                LIBPTH="${LIBPTH}${LIBPTH:+ }$found_so"
+              else
+                                                                                haveit=
+                for x in $ltrpathdirs; do
+                  if test "X$x" = "X$found_dir"; then
+                    haveit=yes
+                    break
+                  fi
+                done
+                if test -z "$haveit"; then
+                  ltrpathdirs="$ltrpathdirs $found_dir"
+                fi
+                                if test "$acl_hardcode_direct" = yes; then
+                                                      LIBPTH="${LIBPTH}${LIBPTH:+ }$found_so"
+                else
+                  if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
+                                                            LIBPTH="${LIBPTH}${LIBPTH:+ }$found_so"
+                                                            haveit=
+                    for x in $rpathdirs; do
+                      if test "X$x" = "X$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      rpathdirs="$rpathdirs $found_dir"
+                    fi
+                  else
+                                                                                haveit=
+                    for x in $LDFLAGS $LIBPTH; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                      if test "X$x" = "X-L$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      LIBPTH="${LIBPTH}${LIBPTH:+ }-L$found_dir"
+                    fi
+                    if test "$acl_hardcode_minus_L" != no; then
+                                                                                        LIBPTH="${LIBPTH}${LIBPTH:+ }$found_so"
+                    else
+                                                                                                                                                                                LIBPTH="${LIBPTH}${LIBPTH:+ }-l$name"
+                    fi
+                  fi
+                fi
+              fi
+            else
+              if test "X$found_a" != "X"; then
+                                LIBPTH="${LIBPTH}${LIBPTH:+ }$found_a"
+              else
+                                                LIBPTH="${LIBPTH}${LIBPTH:+ }-L$found_dir -l$name"
+              fi
+            fi
+                        additional_includedir=
+            case "$found_dir" in
+              */$acl_libdirstem | */$acl_libdirstem/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem/"'*$,,'`
+                if test "$name" = 'pth'; then
+                  LIBPTH_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+              */$acl_libdirstem2 | */$acl_libdirstem2/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem2/"'*$,,'`
+                if test "$name" = 'pth'; then
+                  LIBPTH_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+            esac
+            if test "X$additional_includedir" != "X"; then
+                                                                                                                if test "X$additional_includedir" != "X/usr/include"; then
+                haveit=
+                if test "X$additional_includedir" = "X/usr/local/include"; then
+                  if test -n "$GCC"; then
+                    case $host_os in
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                    esac
+                  fi
+                fi
+                if test -z "$haveit"; then
+                  for x in $CPPFLAGS $INCPTH; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                    if test "X$x" = "X-I$additional_includedir"; then
+                      haveit=yes
+                      break
+                    fi
+                  done
+                  if test -z "$haveit"; then
+                    if test -d "$additional_includedir"; then
+                                            INCPTH="${INCPTH}${INCPTH:+ }-I$additional_includedir"
+                    fi
+                  fi
+                fi
+              fi
+            fi
+                        if test -n "$found_la"; then
+                                                        save_libdir="$libdir"
+              case "$found_la" in
+                */* | *\\*) . "$found_la" ;;
+                *) . "./$found_la" ;;
+              esac
+              libdir="$save_libdir"
+                            for dep in $dependency_libs; do
+                case "$dep" in
+                  -L*)
+                    additional_libdir=`echo "X$dep" | sed -e 's/^X-L//'`
+                                                                                                                                                                if test "X$additional_libdir" != "X/usr/$acl_libdirstem" \
+                       && test "X$additional_libdir" != "X/usr/$acl_libdirstem2"; then
+                      haveit=
+                      if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem" \
+                         || test "X$additional_libdir" = "X/usr/local/$acl_libdirstem2"; then
+                        if test -n "$GCC"; then
+                          case $host_os in
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                          esac
+                        fi
+                      fi
+                      if test -z "$haveit"; then
+                        haveit=
+                        for x in $LDFLAGS $LIBPTH; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                                                        LIBPTH="${LIBPTH}${LIBPTH:+ }-L$additional_libdir"
+                          fi
+                        fi
+                        haveit=
+                        for x in $LDFLAGS $LTLIBPTH; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                                                        LTLIBPTH="${LTLIBPTH}${LTLIBPTH:+ }-L$additional_libdir"
+                          fi
+                        fi
+                      fi
+                    fi
+                    ;;
+                  -R*)
+                    dir=`echo "X$dep" | sed -e 's/^X-R//'`
+                    if test "$enable_rpath" != no; then
+                                                                  haveit=
+                      for x in $rpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        rpathdirs="$rpathdirs $dir"
+                      fi
+                                                                  haveit=
+                      for x in $ltrpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        ltrpathdirs="$ltrpathdirs $dir"
+                      fi
+                    fi
+                    ;;
+                  -l*)
+                                        names_next_round="$names_next_round "`echo "X$dep" | sed -e 's/^X-l//'`
+                    ;;
+                  *.la)
+                                                                                names_next_round="$names_next_round "`echo "X$dep" | sed -e 's,^X.*/,,' -e 's,^lib,,' -e 's,\.la$,,'`
+                    ;;
+                  *)
+                                        LIBPTH="${LIBPTH}${LIBPTH:+ }$dep"
+                    LTLIBPTH="${LTLIBPTH}${LTLIBPTH:+ }$dep"
+                    ;;
+                esac
+              done
+            fi
+          else
+                                                            LIBPTH="${LIBPTH}${LIBPTH:+ }-l$name"
+            LTLIBPTH="${LTLIBPTH}${LTLIBPTH:+ }-l$name"
+          fi
+        fi
+      fi
+    done
+  done
+  if test "X$rpathdirs" != "X"; then
+    if test -n "$acl_hardcode_libdir_separator"; then
+                        alldirs=
+      for found_dir in $rpathdirs; do
+        alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$found_dir"
+      done
+            acl_save_libdir="$libdir"
+      libdir="$alldirs"
+      eval flag=\"$acl_hardcode_libdir_flag_spec\"
+      libdir="$acl_save_libdir"
+      LIBPTH="${LIBPTH}${LIBPTH:+ }$flag"
+    else
+            for found_dir in $rpathdirs; do
+        acl_save_libdir="$libdir"
+        libdir="$found_dir"
+        eval flag=\"$acl_hardcode_libdir_flag_spec\"
+        libdir="$acl_save_libdir"
+        LIBPTH="${LIBPTH}${LIBPTH:+ }$flag"
+      done
+    fi
+  fi
+  if test "X$ltrpathdirs" != "X"; then
+            for found_dir in $ltrpathdirs; do
+      LTLIBPTH="${LTLIBPTH}${LTLIBPTH:+ }-R$found_dir"
+    done
+  fi
+
+
+
+
+
+
+    ac_cv_libpth_libs="$LIBPTH"
+    ac_cv_libpth_ltlibs="$LTLIBPTH"
+    ac_cv_libpth_cppflags="$INCPTH"
+    ac_cv_libpth_prefix="$LIBPTH_PREFIX"
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_libpth_libs" >&5
+$as_echo "$ac_cv_libpth_libs" >&6; }
+  LIBPTH="$ac_cv_libpth_libs"
+  LTLIBPTH="$ac_cv_libpth_ltlibs"
+  INCPTH="$ac_cv_libpth_cppflags"
+  LIBPTH_PREFIX="$ac_cv_libpth_prefix"
+
+  for element in $INCPTH; do
+    haveit=
+    for x in $CPPFLAGS; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+      if test "X$x" = "X$element"; then
+        haveit=yes
+        break
+      fi
+    done
+    if test -z "$haveit"; then
+      CPPFLAGS="${CPPFLAGS}${CPPFLAGS:+ }$element"
+    fi
+  done
+
+
+
+
+      HAVE_LIBPTH=yes
+
+
+
+      gl_have_pth=
+      gl_save_LIBS="$LIBS"
+      LIBS="$LIBS -lpth"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <pth.h>
+int
+main ()
+{
+pth_self();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gl_have_pth=yes
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+      LIBS="$gl_save_LIBS"
+      if test -n "$gl_have_pth"; then
+        gl_threads_api=pth
+        LIBTHREAD="$LIBPTH"
+        LTLIBTHREAD="$LTLIBPTH"
+        LIBMULTITHREAD="$LIBTHREAD"
+        LTLIBMULTITHREAD="$LTLIBTHREAD"
+
+$as_echo "#define USE_PTH_THREADS 1" >>confdefs.h
+
+        if test -n "$LIBMULTITHREAD" || test -n "$LTLIBMULTITHREAD"; then
+          if case "$gl_cv_have_weak" in *yes) true;; *) false;; esac; then
+
+$as_echo "#define USE_PTH_THREADS_WEAK 1" >>confdefs.h
+
+            LIBTHREAD=
+            LTLIBTHREAD=
+          fi
+        fi
+      else
+        CPPFLAGS="$gl_save_CPPFLAGS"
+      fi
+    fi
+    if test -z "$gl_have_pthread"; then
+      if test "$gl_use_threads" = yes || test "$gl_use_threads" = win32; then
+        if { case "$host_os" in
+               mingw*) true;;
+               *) false;;
+             esac
+           }; then
+          gl_threads_api=win32
+
+$as_echo "#define USE_WIN32_THREADS 1" >>confdefs.h
+
+        fi
+      fi
+    fi
+  fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for multithread API to use" >&5
+$as_echo_n "checking for multithread API to use... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_threads_api" >&5
+$as_echo "$gl_threads_api" >&6; }
+
+
+
+
+
+
+
+
+
+
+
+  if test "$gl_threads_api" = posix; then
+    # OSF/1 4.0 and MacOS X 10.1 lack the pthread_rwlock_t type and the
+    # pthread_rwlock_* functions.
+    ac_fn_cxx_check_type "$LINENO" "pthread_rwlock_t" "ac_cv_type_pthread_rwlock_t" "#include <pthread.h>
+"
+if test "x$ac_cv_type_pthread_rwlock_t" = xyes; then :
+
+$as_echo "#define HAVE_PTHREAD_RWLOCK 1" >>confdefs.h
+
+fi
+
+    # glibc defines PTHREAD_MUTEX_RECURSIVE as enum, not as a macro.
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <pthread.h>
+int
+main ()
+{
+#if __FreeBSD__ == 4
+error "No, in FreeBSD 4.0 recursive mutexes actually don't work."
+#else
+int x = (int)PTHREAD_MUTEX_RECURSIVE;
+return !x;
+#endif
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+
+$as_echo "#define HAVE_PTHREAD_MUTEX_RECURSIVE 1" >>confdefs.h
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  fi
+
+
+
+
+
+
+
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+int foo (int a) { a = __builtin_expect (a, 10); return a == 10 ? 0 : 1; }
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+
+$as_echo "#define HAVE_BUILTIN_EXPECT 1" >>confdefs.h
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+  for ac_header in argz.h inttypes.h limits.h unistd.h sys/param.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_cxx_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+  for ac_func in getcwd getegid geteuid getgid getuid mempcpy munmap \
+    stpcpy strcasecmp strdup strtoul tsearch uselocale argz_count \
+    argz_stringify argz_next __fsetlocking
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether feof_unlocked is declared" >&5
+$as_echo_n "checking whether feof_unlocked is declared... " >&6; }
+if ${ac_cv_have_decl_feof_unlocked+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+
+#ifndef feof_unlocked
+  char *p = (char *) feof_unlocked;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_have_decl_feof_unlocked=yes
+else
+  ac_cv_have_decl_feof_unlocked=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_have_decl_feof_unlocked" >&5
+$as_echo "$ac_cv_have_decl_feof_unlocked" >&6; }
+  if test $ac_cv_have_decl_feof_unlocked = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL_FEOF_UNLOCKED $gt_value
+_ACEOF
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether fgets_unlocked is declared" >&5
+$as_echo_n "checking whether fgets_unlocked is declared... " >&6; }
+if ${ac_cv_have_decl_fgets_unlocked+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+
+#ifndef fgets_unlocked
+  char *p = (char *) fgets_unlocked;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_have_decl_fgets_unlocked=yes
+else
+  ac_cv_have_decl_fgets_unlocked=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_have_decl_fgets_unlocked" >&5
+$as_echo "$ac_cv_have_decl_fgets_unlocked" >&6; }
+  if test $ac_cv_have_decl_fgets_unlocked = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL_FGETS_UNLOCKED $gt_value
+_ACEOF
+
+
+
+
+
+                      for ac_prog in bison
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_INTLBISON+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$INTLBISON"; then
+  ac_cv_prog_INTLBISON="$INTLBISON" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_INTLBISON="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+INTLBISON=$ac_cv_prog_INTLBISON
+if test -n "$INTLBISON"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $INTLBISON" >&5
+$as_echo "$INTLBISON" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$INTLBISON" && break
+done
+
+  if test -z "$INTLBISON"; then
+    ac_verc_fail=yes
+  else
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking version of bison" >&5
+$as_echo_n "checking version of bison... " >&6; }
+    ac_prog_version=`$INTLBISON --version 2>&1 | sed -n 's/^.*GNU Bison.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
+    case $ac_prog_version in
+      '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+      1.2[6-9]* | 1.[3-9][0-9]* | [2-9].*)
+         ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+      *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+    esac
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_prog_version" >&5
+$as_echo "$ac_prog_version" >&6; }
+  fi
+  if test $ac_verc_fail = yes; then
+    INTLBISON=:
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for long long int" >&5
+$as_echo_n "checking for long long int... " >&6; }
+if ${ac_cv_type_long_long_int+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+  /* For now, do not test the preprocessor; as of 2007 there are too many
+         implementations with broken preprocessors.  Perhaps this can
+         be revisited in 2012.  In the meantime, code should not expect
+         #if to work with literals wider than 32 bits.  */
+      /* Test literals.  */
+      long long int ll = 9223372036854775807ll;
+      long long int nll = -9223372036854775807LL;
+      unsigned long long int ull = 18446744073709551615ULL;
+      /* Test constant expressions.   */
+      typedef int a[((-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
+                     ? 1 : -1)];
+      typedef int b[(18446744073709551615ULL <= (unsigned long long int) -1
+                     ? 1 : -1)];
+      int i = 63;
+int
+main ()
+{
+/* Test availability of runtime routines for shift and division.  */
+      long long int llmax = 9223372036854775807ll;
+      unsigned long long int ullmax = 18446744073709551615ull;
+      return ((ll << 63) | (ll >> 63) | (ll < i) | (ll > i)
+              | (llmax / ll) | (llmax % ll)
+              | (ull << 63) | (ull >> 63) | (ull << i) | (ull >> i)
+              | (ullmax / ull) | (ullmax % ull));
+  ;
+  return 0;
+}
+
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+                          if test "$cross_compiling" = yes; then :
+  ac_cv_type_long_long_int=yes
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <limits.h>
+               #ifndef LLONG_MAX
+               # define HALF \
+                        (1LL << (sizeof (long long int) * CHAR_BIT - 2))
+               # define LLONG_MAX (HALF - 1 + HALF)
+               #endif
+int
+main ()
+{
+long long int n = 1;
+               int i;
+               for (i = 0; ; i++)
+                 {
+                   long long int m = n << i;
+                   if (m >> i != n)
+                     return 1;
+                   if (LLONG_MAX / 2 < m)
+                     break;
+                 }
+               return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  ac_cv_type_long_long_int=yes
+else
+  ac_cv_type_long_long_int=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+else
+  ac_cv_type_long_long_int=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_long_long_int" >&5
+$as_echo "$ac_cv_type_long_long_int" >&6; }
+  if test $ac_cv_type_long_long_int = yes; then
+
+$as_echo "#define HAVE_LONG_LONG_INT 1" >>confdefs.h
+
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for wchar_t" >&5
+$as_echo_n "checking for wchar_t... " >&6; }
+if ${gt_cv_c_wchar_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stddef.h>
+       wchar_t foo = (wchar_t)'\0';
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gt_cv_c_wchar_t=yes
+else
+  gt_cv_c_wchar_t=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_c_wchar_t" >&5
+$as_echo "$gt_cv_c_wchar_t" >&6; }
+  if test $gt_cv_c_wchar_t = yes; then
+
+$as_echo "#define HAVE_WCHAR_T 1" >>confdefs.h
+
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for wint_t" >&5
+$as_echo_n "checking for wint_t... " >&6; }
+if ${gt_cv_c_wint_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Tru64 with Desktop Toolkit C has a bug: <stdio.h> must be included before
+   <wchar.h>.
+   BSD/OS 4.0.1 has a bug: <stddef.h>, <stdio.h> and <time.h> must be included
+   before <wchar.h>.  */
+#include <stddef.h>
+#include <stdio.h>
+#include <time.h>
+#include <wchar.h>
+       wint_t foo = (wchar_t)'\0';
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gt_cv_c_wint_t=yes
+else
+  gt_cv_c_wint_t=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_c_wint_t" >&5
+$as_echo "$gt_cv_c_wint_t" >&6; }
+  if test $gt_cv_c_wint_t = yes; then
+
+$as_echo "#define HAVE_WINT_T 1" >>confdefs.h
+
+  fi
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for intmax_t" >&5
+$as_echo_n "checking for intmax_t... " >&6; }
+if ${gt_cv_c_intmax_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stddef.h>
+#include <stdlib.h>
+#if HAVE_STDINT_H_WITH_UINTMAX
+#include <stdint.h>
+#endif
+#if HAVE_INTTYPES_H_WITH_UINTMAX
+#include <inttypes.h>
+#endif
+
+int
+main ()
+{
+intmax_t x = -1;
+        return !x;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  gt_cv_c_intmax_t=yes
+else
+  gt_cv_c_intmax_t=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_c_intmax_t" >&5
+$as_echo "$gt_cv_c_intmax_t" >&6; }
+  if test $gt_cv_c_intmax_t = yes; then
+
+$as_echo "#define HAVE_INTMAX_T 1" >>confdefs.h
+
+  fi
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether printf() supports POSIX/XSI format strings" >&5
+$as_echo_n "checking whether printf() supports POSIX/XSI format strings... " >&6; }
+if ${gt_cv_func_printf_posix+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+      if test "$cross_compiling" = yes; then :
+
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#if defined __NetBSD__ || defined __BEOS__ || defined _MSC_VER || defined __MINGW32__ || defined __CYGWIN__
+  notposix
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "notposix" >/dev/null 2>&1; then :
+  gt_cv_func_printf_posix="guessing no"
+else
+  gt_cv_func_printf_posix="guessing yes"
+fi
+rm -f conftest*
+
+
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include <string.h>
+/* The string "%2$d %1$d", with dollar characters protected from the shell's
+   dollar expansion (possibly an autoconf bug).  */
+static char format[] = { '%', '2', '$', 'd', ' ', '%', '1', '$', 'd', '\0' };
+static char buf[100];
+int main ()
+{
+  sprintf (buf, format, 33, 55);
+  return (strcmp (buf, "55 33") != 0);
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  gt_cv_func_printf_posix=yes
+else
+  gt_cv_func_printf_posix=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_printf_posix" >&5
+$as_echo "$gt_cv_func_printf_posix" >&6; }
+  case $gt_cv_func_printf_posix in
+    *yes)
+
+$as_echo "#define HAVE_POSIX_PRINTF 1" >>confdefs.h
+
+      ;;
+  esac
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C Library 2.1 or newer" >&5
+$as_echo_n "checking whether we are using the GNU C Library 2.1 or newer... " >&6; }
+if ${ac_cv_gnu_library_2_1+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <features.h>
+#ifdef __GNU_LIBRARY__
+ #if (__GLIBC__ == 2 && __GLIBC_MINOR__ >= 1) || (__GLIBC__ > 2)
+  Lucky GNU user
+ #endif
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "Lucky GNU user" >/dev/null 2>&1; then :
+  ac_cv_gnu_library_2_1=yes
+else
+  ac_cv_gnu_library_2_1=no
+fi
+rm -f conftest*
+
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_gnu_library_2_1" >&5
+$as_echo "$ac_cv_gnu_library_2_1" >&6; }
+
+    GLIBC21="$ac_cv_gnu_library_2_1"
+
+
+
+  for ac_header in stdint.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "stdint.h" "ac_cv_header_stdint_h" "$ac_includes_default"
+if test "x$ac_cv_header_stdint_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_STDINT_H 1
+_ACEOF
+
+fi
+
+done
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SIZE_MAX" >&5
+$as_echo_n "checking for SIZE_MAX... " >&6; }
+if ${gl_cv_size_max+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    gl_cv_size_max=
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <limits.h>
+#if HAVE_STDINT_H
+#include <stdint.h>
+#endif
+#ifdef SIZE_MAX
+Found it
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "Found it" >/dev/null 2>&1; then :
+  gl_cv_size_max=yes
+fi
+rm -f conftest*
+
+    if test -z "$gl_cv_size_max"; then
+                        if ac_fn_cxx_compute_int "$LINENO" "sizeof (size_t) * CHAR_BIT - 1" "size_t_bits_minus_1"        "#include <stddef.h>
+#include <limits.h>"; then :
+
+else
+  size_t_bits_minus_1=
+fi
+
+      if ac_fn_cxx_compute_int "$LINENO" "sizeof (size_t) <= sizeof (unsigned int)" "fits_in_uint"        "#include <stddef.h>"; then :
+
+else
+  fits_in_uint=
+fi
+
+      if test -n "$size_t_bits_minus_1" && test -n "$fits_in_uint"; then
+        if test $fits_in_uint = 1; then
+                              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stddef.h>
+            extern size_t foo;
+            extern unsigned long foo;
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  fits_in_uint=0
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+        fi
+                                if test $fits_in_uint = 1; then
+          gl_cv_size_max="(((1U << $size_t_bits_minus_1) - 1) * 2 + 1)"
+        else
+          gl_cv_size_max="(((1UL << $size_t_bits_minus_1) - 1) * 2 + 1)"
+        fi
+      else
+                gl_cv_size_max='((size_t)~(size_t)0)'
+      fi
+    fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_size_max" >&5
+$as_echo "$gl_cv_size_max" >&6; }
+  if test "$gl_cv_size_max" != yes; then
+
+cat >>confdefs.h <<_ACEOF
+#define SIZE_MAX $gl_cv_size_max
+_ACEOF
+
+  fi
+
+
+
+
+
+  for ac_header in stdint.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "stdint.h" "ac_cv_header_stdint_h" "$ac_includes_default"
+if test "x$ac_cv_header_stdint_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_STDINT_H 1
+_ACEOF
+
+fi
+
+done
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working fcntl.h" >&5
+$as_echo_n "checking for working fcntl.h... " >&6; }
+if ${gl_cv_header_working_fcntl_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  gl_cv_header_working_fcntl_h=cross-compiling
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+           #include <sys/stat.h>
+           #include <unistd.h>
+           #include <fcntl.h>
+           #ifndef O_NOATIME
+            #define O_NOATIME 0
+           #endif
+           #ifndef O_NOFOLLOW
+            #define O_NOFOLLOW 0
+           #endif
+           static int const constants[] =
+            {
+              O_CREAT, O_EXCL, O_NOCTTY, O_TRUNC, O_APPEND,
+              O_NONBLOCK, O_SYNC, O_ACCMODE, O_RDONLY, O_RDWR, O_WRONLY
+            };
+
+int
+main ()
+{
+
+            int status = !constants;
+            {
+              static char const sym[] = "conftest.sym";
+              if (symlink (".", sym) != 0
+                  || close (open (sym, O_RDONLY | O_NOFOLLOW)) == 0)
+                status |= 32;
+              unlink (sym);
+            }
+            {
+              static char const file[] = "confdefs.h";
+              int fd = open (file, O_RDONLY | O_NOATIME);
+              char c;
+              struct stat st0, st1;
+              if (fd < 0
+                  || fstat (fd, &st0) != 0
+                  || sleep (1) != 0
+                  || read (fd, &c, 1) != 1
+                  || close (fd) != 0
+                  || stat (file, &st1) != 0
+                  || st0.st_atime != st1.st_atime)
+                status |= 64;
+            }
+            return status;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  gl_cv_header_working_fcntl_h=yes
+else
+  case $? in #(
+        32) gl_cv_header_working_fcntl_h='no (bad O_NOFOLLOW)';; #(
+        64) gl_cv_header_working_fcntl_h='no (bad O_NOATIME)';; #(
+        96) gl_cv_header_working_fcntl_h='no (bad O_NOATIME, O_NOFOLLOW)';; #(
+         *) gl_cv_header_working_fcntl_h='no';;
+        esac
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_header_working_fcntl_h" >&5
+$as_echo "$gl_cv_header_working_fcntl_h" >&6; }
+
+  case $gl_cv_header_working_fcntl_h in #(
+  *O_NOATIME* | no | cross-compiling) ac_val=0;; #(
+  *) ac_val=1;;
+  esac
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_WORKING_O_NOATIME $ac_val
+_ACEOF
+
+
+  case $gl_cv_header_working_fcntl_h in #(
+  *O_NOFOLLOW* | no | cross-compiling) ac_val=0;; #(
+  *) ac_val=1;;
+  esac
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_WORKING_O_NOFOLLOW $ac_val
+_ACEOF
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CFPreferencesCopyAppValue" >&5
+$as_echo_n "checking for CFPreferencesCopyAppValue... " >&6; }
+if ${gt_cv_func_CFPreferencesCopyAppValue+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <CoreFoundation/CFPreferences.h>
+int
+main ()
+{
+CFPreferencesCopyAppValue(NULL, NULL)
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gt_cv_func_CFPreferencesCopyAppValue=yes
+else
+  gt_cv_func_CFPreferencesCopyAppValue=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="$gt_save_LIBS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_CFPreferencesCopyAppValue" >&5
+$as_echo "$gt_cv_func_CFPreferencesCopyAppValue" >&6; }
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes; then
+
+$as_echo "#define HAVE_CFPREFERENCESCOPYAPPVALUE 1" >>confdefs.h
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CFLocaleCopyCurrent" >&5
+$as_echo_n "checking for CFLocaleCopyCurrent... " >&6; }
+if ${gt_cv_func_CFLocaleCopyCurrent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <CoreFoundation/CFLocale.h>
+int
+main ()
+{
+CFLocaleCopyCurrent();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gt_cv_func_CFLocaleCopyCurrent=yes
+else
+  gt_cv_func_CFLocaleCopyCurrent=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="$gt_save_LIBS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_CFLocaleCopyCurrent" >&5
+$as_echo "$gt_cv_func_CFLocaleCopyCurrent" >&6; }
+  if test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+
+$as_echo "#define HAVE_CFLOCALECOPYCURRENT 1" >>confdefs.h
+
+  fi
+  INTL_MACOSX_LIBS=
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes || test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+    INTL_MACOSX_LIBS="-Wl,-framework -Wl,CoreFoundation"
+  fi
+
+
+
+
+
+
+
+    case "$enable_silent_rules" in
+    yes) INTL_DEFAULT_VERBOSITY=0;;
+    no)  INTL_DEFAULT_VERBOSITY=1;;
+    *)   INTL_DEFAULT_VERBOSITY=1;;
+  esac
+
+
+  ac_fn_cxx_check_type "$LINENO" "ptrdiff_t" "ac_cv_type_ptrdiff_t" "$ac_includes_default"
+if test "x$ac_cv_type_ptrdiff_t" = xyes; then :
+
+else
+
+$as_echo "#define ptrdiff_t long" >>confdefs.h
+
+
+fi
+
+  for ac_header in stddef.h stdlib.h string.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_cxx_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+  for ac_func in asprintf fwprintf newlocale putenv setenv setlocale \
+    snprintf strnlen wcslen wcsnlen mbrtowc wcrtomb
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether _snprintf is declared" >&5
+$as_echo_n "checking whether _snprintf is declared... " >&6; }
+if ${ac_cv_have_decl__snprintf+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+
+#ifndef _snprintf
+  char *p = (char *) _snprintf;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_have_decl__snprintf=yes
+else
+  ac_cv_have_decl__snprintf=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_have_decl__snprintf" >&5
+$as_echo "$ac_cv_have_decl__snprintf" >&6; }
+  if test $ac_cv_have_decl__snprintf = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL__SNPRINTF $gt_value
+_ACEOF
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether _snwprintf is declared" >&5
+$as_echo_n "checking whether _snwprintf is declared... " >&6; }
+if ${ac_cv_have_decl__snwprintf+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+
+#ifndef _snwprintf
+  char *p = (char *) _snwprintf;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_have_decl__snwprintf=yes
+else
+  ac_cv_have_decl__snwprintf=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_have_decl__snwprintf" >&5
+$as_echo "$ac_cv_have_decl__snwprintf" >&6; }
+  if test $ac_cv_have_decl__snwprintf = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL__SNWPRINTF $gt_value
+_ACEOF
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether getc_unlocked is declared" >&5
+$as_echo_n "checking whether getc_unlocked is declared... " >&6; }
+if ${ac_cv_have_decl_getc_unlocked+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdio.h>
+int
+main ()
+{
+
+#ifndef getc_unlocked
+  char *p = (char *) getc_unlocked;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_have_decl_getc_unlocked=yes
+else
+  ac_cv_have_decl_getc_unlocked=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_have_decl_getc_unlocked" >&5
+$as_echo "$ac_cv_have_decl_getc_unlocked" >&6; }
+  if test $ac_cv_have_decl_getc_unlocked = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL_GETC_UNLOCKED $gt_value
+_ACEOF
+
+
+
+  case $gt_cv_func_printf_posix in
+    *yes) HAVE_POSIX_PRINTF=1 ;;
+    *) HAVE_POSIX_PRINTF=0 ;;
+  esac
+
+  if test "$ac_cv_func_asprintf" = yes; then
+    HAVE_ASPRINTF=1
+  else
+    HAVE_ASPRINTF=0
+  fi
+
+  if test "$ac_cv_func_snprintf" = yes; then
+    HAVE_SNPRINTF=1
+  else
+    HAVE_SNPRINTF=0
+  fi
+
+  if test "$ac_cv_func_newlocale" = yes; then
+    HAVE_NEWLOCALE=1
+  else
+    HAVE_NEWLOCALE=0
+  fi
+
+  if test "$ac_cv_func_wprintf" = yes; then
+    HAVE_WPRINTF=1
+  else
+    HAVE_WPRINTF=0
+  fi
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nl_langinfo and CODESET" >&5
+$as_echo_n "checking for nl_langinfo and CODESET... " >&6; }
+if ${am_cv_langinfo_codeset+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <langinfo.h>
+int
+main ()
+{
+char* cs = nl_langinfo(CODESET); return !cs;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  am_cv_langinfo_codeset=yes
+else
+  am_cv_langinfo_codeset=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_langinfo_codeset" >&5
+$as_echo "$am_cv_langinfo_codeset" >&6; }
+  if test $am_cv_langinfo_codeset = yes; then
+
+$as_echo "#define HAVE_LANGINFO_CODESET 1" >>confdefs.h
+
+  fi
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for LC_MESSAGES" >&5
+$as_echo_n "checking for LC_MESSAGES... " >&6; }
+if ${gt_cv_val_LC_MESSAGES+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <locale.h>
+int
+main ()
+{
+return LC_MESSAGES
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gt_cv_val_LC_MESSAGES=yes
+else
+  gt_cv_val_LC_MESSAGES=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_val_LC_MESSAGES" >&5
+$as_echo "$gt_cv_val_LC_MESSAGES" >&6; }
+  if test $gt_cv_val_LC_MESSAGES = yes; then
+
+$as_echo "#define HAVE_LC_MESSAGES 1" >>confdefs.h
+
+  fi
+
+
+                if test "$enable_shared" = yes; then
+    case "$host_os" in
+      mingw* | cygwin*) is_woe32dll=yes ;;
+      *) is_woe32dll=no ;;
+    esac
+  else
+    is_woe32dll=no
+  fi
+  WOE32DLL=$is_woe32dll
+
+
+      case "$host_os" in
+    mingw* | cygwin*) is_woe32=yes ;;
+    *) is_woe32=no ;;
+  esac
+  WOE32=$is_woe32
+
+  if test $WOE32 = yes; then
+        if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}windres", so it can be a program name with args.
+set dummy ${ac_tool_prefix}windres; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_WINDRES+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$WINDRES"; then
+  ac_cv_prog_WINDRES="$WINDRES" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_WINDRES="${ac_tool_prefix}windres"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+WINDRES=$ac_cv_prog_WINDRES
+if test -n "$WINDRES"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $WINDRES" >&5
+$as_echo "$WINDRES" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_WINDRES"; then
+  ac_ct_WINDRES=$WINDRES
+  # Extract the first word of "windres", so it can be a program name with args.
+set dummy windres; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_WINDRES+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_WINDRES"; then
+  ac_cv_prog_ac_ct_WINDRES="$ac_ct_WINDRES" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_WINDRES="windres"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_WINDRES=$ac_cv_prog_ac_ct_WINDRES
+if test -n "$ac_ct_WINDRES"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_WINDRES" >&5
+$as_echo "$ac_ct_WINDRES" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_WINDRES" = x; then
+    WINDRES=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    WINDRES=$ac_ct_WINDRES
+  fi
+else
+  WINDRES="$ac_cv_prog_WINDRES"
+fi
+
+  fi
+
+              case "$host_os" in
+    hpux*) LTLIBC="" ;;
+    *)     LTLIBC="-lc" ;;
+  esac
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CFPreferencesCopyAppValue" >&5
+$as_echo_n "checking for CFPreferencesCopyAppValue... " >&6; }
+if ${gt_cv_func_CFPreferencesCopyAppValue+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <CoreFoundation/CFPreferences.h>
+int
+main ()
+{
+CFPreferencesCopyAppValue(NULL, NULL)
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gt_cv_func_CFPreferencesCopyAppValue=yes
+else
+  gt_cv_func_CFPreferencesCopyAppValue=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="$gt_save_LIBS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_CFPreferencesCopyAppValue" >&5
+$as_echo "$gt_cv_func_CFPreferencesCopyAppValue" >&6; }
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes; then
+
+$as_echo "#define HAVE_CFPREFERENCESCOPYAPPVALUE 1" >>confdefs.h
+
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CFLocaleCopyCurrent" >&5
+$as_echo_n "checking for CFLocaleCopyCurrent... " >&6; }
+if ${gt_cv_func_CFLocaleCopyCurrent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <CoreFoundation/CFLocale.h>
+int
+main ()
+{
+CFLocaleCopyCurrent();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  gt_cv_func_CFLocaleCopyCurrent=yes
+else
+  gt_cv_func_CFLocaleCopyCurrent=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="$gt_save_LIBS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_CFLocaleCopyCurrent" >&5
+$as_echo "$gt_cv_func_CFLocaleCopyCurrent" >&6; }
+  if test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+
+$as_echo "#define HAVE_CFLOCALECOPYCURRENT 1" >>confdefs.h
+
+  fi
+  INTL_MACOSX_LIBS=
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes || test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+    INTL_MACOSX_LIBS="-Wl,-framework -Wl,CoreFoundation"
+  fi
+
+
+
+
+
+
+    BUILD_INCLUDED_LIBINTL=no
+    USE_INCLUDED_LIBINTL=no
+
+  LIBINTL=
+  LTLIBINTL=
+  POSUB=
+
+    case " $gt_needs " in
+    *" need-formatstring-macros "*) gt_api_version=3 ;;
+    *" need-ngettext "*) gt_api_version=2 ;;
+    *) gt_api_version=1 ;;
+  esac
+  gt_func_gnugettext_libc="gt_cv_func_gnugettext${gt_api_version}_libc"
+  gt_func_gnugettext_libintl="gt_cv_func_gnugettext${gt_api_version}_libintl"
+
+    if test "$USE_NLS" = "yes"; then
+    gt_use_preinstalled_gnugettext=no
+
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether included gettext is requested" >&5
+$as_echo_n "checking whether included gettext is requested... " >&6; }
+
+# Check whether --with-included-gettext was given.
+if test "${with_included_gettext+set}" = set; then :
+  withval=$with_included_gettext; nls_cv_force_use_gnu_gettext=$withval
+else
+  nls_cv_force_use_gnu_gettext=no
+fi
+
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: $nls_cv_force_use_gnu_gettext" >&5
+$as_echo "$nls_cv_force_use_gnu_gettext" >&6; }
+
+      nls_cv_use_gnu_gettext="$nls_cv_force_use_gnu_gettext"
+      if test "$nls_cv_force_use_gnu_gettext" != "yes"; then
+
+
+        if test $gt_api_version -ge 3; then
+          gt_revision_test_code='
+#ifndef __GNU_GETTEXT_SUPPORTED_REVISION
+#define __GNU_GETTEXT_SUPPORTED_REVISION(major) ((major) == 0 ? 0 : -1)
+#endif
+typedef int array [2 * (__GNU_GETTEXT_SUPPORTED_REVISION(0) >= 1) - 1];
+'
+        else
+          gt_revision_test_code=
+        fi
+        if test $gt_api_version -ge 2; then
+          gt_expression_test_code=' + * ngettext ("", "", 0)'
+        else
+          gt_expression_test_code=
+        fi
+
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU gettext in libc" >&5
+$as_echo_n "checking for GNU gettext in libc... " >&6; }
+if eval \${$gt_func_gnugettext_libc+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern int *_nl_domain_bindings;
+int
+main ()
+{
+bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_domain_bindings
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  eval "$gt_func_gnugettext_libc=yes"
+else
+  eval "$gt_func_gnugettext_libc=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$gt_func_gnugettext_libc
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+
+        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" != "yes"; }; then
+
+
+
+
+
+
+
+
+    use_additional=yes
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+
+    eval additional_includedir=\"$includedir\"
+    eval additional_libdir=\"$libdir\"
+
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+
+# Check whether --with-libintl-prefix was given.
+if test "${with_libintl_prefix+set}" = set; then :
+  withval=$with_libintl_prefix;
+    if test "X$withval" = "Xno"; then
+      use_additional=no
+    else
+      if test "X$withval" = "X"; then
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+
+          eval additional_includedir=\"$includedir\"
+          eval additional_libdir=\"$libdir\"
+
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+      else
+        additional_includedir="$withval/include"
+        additional_libdir="$withval/$acl_libdirstem"
+        if test "$acl_libdirstem2" != "$acl_libdirstem" \
+           && ! test -d "$withval/$acl_libdirstem"; then
+          additional_libdir="$withval/$acl_libdirstem2"
+        fi
+      fi
+    fi
+
+fi
+
+      LIBINTL=
+  LTLIBINTL=
+  INCINTL=
+  LIBINTL_PREFIX=
+      HAVE_LIBINTL=
+  rpathdirs=
+  ltrpathdirs=
+  names_already_handled=
+  names_next_round='intl '
+  while test -n "$names_next_round"; do
+    names_this_round="$names_next_round"
+    names_next_round=
+    for name in $names_this_round; do
+      already_handled=
+      for n in $names_already_handled; do
+        if test "$n" = "$name"; then
+          already_handled=yes
+          break
+        fi
+      done
+      if test -z "$already_handled"; then
+        names_already_handled="$names_already_handled $name"
+                        uppername=`echo "$name" | sed -e 'y|abcdefghijklmnopqrstuvwxyz./-|ABCDEFGHIJKLMNOPQRSTUVWXYZ___|'`
+        eval value=\"\$HAVE_LIB$uppername\"
+        if test -n "$value"; then
+          if test "$value" = yes; then
+            eval value=\"\$LIB$uppername\"
+            test -z "$value" || LIBINTL="${LIBINTL}${LIBINTL:+ }$value"
+            eval value=\"\$LTLIB$uppername\"
+            test -z "$value" || LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }$value"
+          else
+                                    :
+          fi
+        else
+                              found_dir=
+          found_la=
+          found_so=
+          found_a=
+          eval libname=\"$acl_libname_spec\"    # typically: libname=lib$name
+          if test -n "$acl_shlibext"; then
+            shrext=".$acl_shlibext"             # typically: shrext=.so
+          else
+            shrext=
+          fi
+          if test $use_additional = yes; then
+            dir="$additional_libdir"
+                                    if test -n "$acl_shlibext"; then
+              if test -f "$dir/$libname$shrext"; then
+                found_dir="$dir"
+                found_so="$dir/$libname$shrext"
+              else
+                if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                  ver=`(cd "$dir" && \
+                        for f in "$libname$shrext".*; do echo "$f"; done \
+                        | sed -e "s,^$libname$shrext\\\\.,," \
+                        | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                        | sed 1q ) 2>/dev/null`
+                  if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                    found_dir="$dir"
+                    found_so="$dir/$libname$shrext.$ver"
+                  fi
+                else
+                  eval library_names=\"$acl_library_names_spec\"
+                  for f in $library_names; do
+                    if test -f "$dir/$f"; then
+                      found_dir="$dir"
+                      found_so="$dir/$f"
+                      break
+                    fi
+                  done
+                fi
+              fi
+            fi
+                        if test "X$found_dir" = "X"; then
+              if test -f "$dir/$libname.$acl_libext"; then
+                found_dir="$dir"
+                found_a="$dir/$libname.$acl_libext"
+              fi
+            fi
+            if test "X$found_dir" != "X"; then
+              if test -f "$dir/$libname.la"; then
+                found_la="$dir/$libname.la"
+              fi
+            fi
+          fi
+          if test "X$found_dir" = "X"; then
+            for x in $LDFLAGS $LTLIBINTL; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+              case "$x" in
+                -L*)
+                  dir=`echo "X$x" | sed -e 's/^X-L//'`
+                                    if test -n "$acl_shlibext"; then
+                    if test -f "$dir/$libname$shrext"; then
+                      found_dir="$dir"
+                      found_so="$dir/$libname$shrext"
+                    else
+                      if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                        ver=`(cd "$dir" && \
+                              for f in "$libname$shrext".*; do echo "$f"; done \
+                              | sed -e "s,^$libname$shrext\\\\.,," \
+                              | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                              | sed 1q ) 2>/dev/null`
+                        if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                          found_dir="$dir"
+                          found_so="$dir/$libname$shrext.$ver"
+                        fi
+                      else
+                        eval library_names=\"$acl_library_names_spec\"
+                        for f in $library_names; do
+                          if test -f "$dir/$f"; then
+                            found_dir="$dir"
+                            found_so="$dir/$f"
+                            break
+                          fi
+                        done
+                      fi
+                    fi
+                  fi
+                                    if test "X$found_dir" = "X"; then
+                    if test -f "$dir/$libname.$acl_libext"; then
+                      found_dir="$dir"
+                      found_a="$dir/$libname.$acl_libext"
+                    fi
+                  fi
+                  if test "X$found_dir" != "X"; then
+                    if test -f "$dir/$libname.la"; then
+                      found_la="$dir/$libname.la"
+                    fi
+                  fi
+                  ;;
+              esac
+              if test "X$found_dir" != "X"; then
+                break
+              fi
+            done
+          fi
+          if test "X$found_dir" != "X"; then
+                        LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }-L$found_dir -l$name"
+            if test "X$found_so" != "X"; then
+                                                        if test "$enable_rpath" = no \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem" \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem2"; then
+                                LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
+              else
+                                                                                haveit=
+                for x in $ltrpathdirs; do
+                  if test "X$x" = "X$found_dir"; then
+                    haveit=yes
+                    break
+                  fi
+                done
+                if test -z "$haveit"; then
+                  ltrpathdirs="$ltrpathdirs $found_dir"
+                fi
+                                if test "$acl_hardcode_direct" = yes; then
+                                                      LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
+                else
+                  if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
+                                                            LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
+                                                            haveit=
+                    for x in $rpathdirs; do
+                      if test "X$x" = "X$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      rpathdirs="$rpathdirs $found_dir"
+                    fi
+                  else
+                                                                                haveit=
+                    for x in $LDFLAGS $LIBINTL; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                      if test "X$x" = "X-L$found_dir"; then
+                        haveit=yes
+                        break
+                      fi
+                    done
+                    if test -z "$haveit"; then
+                      LIBINTL="${LIBINTL}${LIBINTL:+ }-L$found_dir"
+                    fi
+                    if test "$acl_hardcode_minus_L" != no; then
+                                                                                        LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
+                    else
+                                                                                                                                                                                LIBINTL="${LIBINTL}${LIBINTL:+ }-l$name"
+                    fi
+                  fi
+                fi
+              fi
+            else
+              if test "X$found_a" != "X"; then
+                                LIBINTL="${LIBINTL}${LIBINTL:+ }$found_a"
+              else
+                                                LIBINTL="${LIBINTL}${LIBINTL:+ }-L$found_dir -l$name"
+              fi
+            fi
+                        additional_includedir=
+            case "$found_dir" in
+              */$acl_libdirstem | */$acl_libdirstem/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem/"'*$,,'`
+                if test "$name" = 'intl'; then
+                  LIBINTL_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+              */$acl_libdirstem2 | */$acl_libdirstem2/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem2/"'*$,,'`
+                if test "$name" = 'intl'; then
+                  LIBINTL_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+            esac
+            if test "X$additional_includedir" != "X"; then
+                                                                                                                if test "X$additional_includedir" != "X/usr/include"; then
+                haveit=
+                if test "X$additional_includedir" = "X/usr/local/include"; then
+                  if test -n "$GCC"; then
+                    case $host_os in
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                    esac
+                  fi
+                fi
+                if test -z "$haveit"; then
+                  for x in $CPPFLAGS $INCINTL; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                    if test "X$x" = "X-I$additional_includedir"; then
+                      haveit=yes
+                      break
+                    fi
+                  done
+                  if test -z "$haveit"; then
+                    if test -d "$additional_includedir"; then
+                                            INCINTL="${INCINTL}${INCINTL:+ }-I$additional_includedir"
+                    fi
+                  fi
+                fi
+              fi
+            fi
+                        if test -n "$found_la"; then
+                                                        save_libdir="$libdir"
+              case "$found_la" in
+                */* | *\\*) . "$found_la" ;;
+                *) . "./$found_la" ;;
+              esac
+              libdir="$save_libdir"
+                            for dep in $dependency_libs; do
+                case "$dep" in
+                  -L*)
+                    additional_libdir=`echo "X$dep" | sed -e 's/^X-L//'`
+                                                                                                                                                                if test "X$additional_libdir" != "X/usr/$acl_libdirstem" \
+                       && test "X$additional_libdir" != "X/usr/$acl_libdirstem2"; then
+                      haveit=
+                      if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem" \
+                         || test "X$additional_libdir" = "X/usr/local/$acl_libdirstem2"; then
+                        if test -n "$GCC"; then
+                          case $host_os in
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
+                          esac
+                        fi
+                      fi
+                      if test -z "$haveit"; then
+                        haveit=
+                        for x in $LDFLAGS $LIBINTL; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                                                        LIBINTL="${LIBINTL}${LIBINTL:+ }-L$additional_libdir"
+                          fi
+                        fi
+                        haveit=
+                        for x in $LDFLAGS $LTLIBINTL; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+                          if test "X$x" = "X-L$additional_libdir"; then
+                            haveit=yes
+                            break
+                          fi
+                        done
+                        if test -z "$haveit"; then
+                          if test -d "$additional_libdir"; then
+                                                        LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }-L$additional_libdir"
+                          fi
+                        fi
+                      fi
+                    fi
+                    ;;
+                  -R*)
+                    dir=`echo "X$dep" | sed -e 's/^X-R//'`
+                    if test "$enable_rpath" != no; then
+                                                                  haveit=
+                      for x in $rpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        rpathdirs="$rpathdirs $dir"
+                      fi
+                                                                  haveit=
+                      for x in $ltrpathdirs; do
+                        if test "X$x" = "X$dir"; then
+                          haveit=yes
+                          break
+                        fi
+                      done
+                      if test -z "$haveit"; then
+                        ltrpathdirs="$ltrpathdirs $dir"
+                      fi
+                    fi
+                    ;;
+                  -l*)
+                                        names_next_round="$names_next_round "`echo "X$dep" | sed -e 's/^X-l//'`
+                    ;;
+                  *.la)
+                                                                                names_next_round="$names_next_round "`echo "X$dep" | sed -e 's,^X.*/,,' -e 's,^lib,,' -e 's,\.la$,,'`
+                    ;;
+                  *)
+                                        LIBINTL="${LIBINTL}${LIBINTL:+ }$dep"
+                    LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }$dep"
+                    ;;
+                esac
+              done
+            fi
+          else
+                                                            LIBINTL="${LIBINTL}${LIBINTL:+ }-l$name"
+            LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }-l$name"
+          fi
+        fi
+      fi
+    done
+  done
+  if test "X$rpathdirs" != "X"; then
+    if test -n "$acl_hardcode_libdir_separator"; then
+                        alldirs=
+      for found_dir in $rpathdirs; do
+        alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$found_dir"
+      done
+            acl_save_libdir="$libdir"
+      libdir="$alldirs"
+      eval flag=\"$acl_hardcode_libdir_flag_spec\"
+      libdir="$acl_save_libdir"
+      LIBINTL="${LIBINTL}${LIBINTL:+ }$flag"
+    else
+            for found_dir in $rpathdirs; do
+        acl_save_libdir="$libdir"
+        libdir="$found_dir"
+        eval flag=\"$acl_hardcode_libdir_flag_spec\"
+        libdir="$acl_save_libdir"
+        LIBINTL="${LIBINTL}${LIBINTL:+ }$flag"
+      done
+    fi
+  fi
+  if test "X$ltrpathdirs" != "X"; then
+            for found_dir in $ltrpathdirs; do
+      LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }-R$found_dir"
+    done
+  fi
+
+
+
+
+
+
+          { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU gettext in libintl" >&5
+$as_echo_n "checking for GNU gettext in libintl... " >&6; }
+if eval \${$gt_func_gnugettext_libintl+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  gt_save_CPPFLAGS="$CPPFLAGS"
+            CPPFLAGS="$CPPFLAGS $INCINTL"
+            gt_save_LIBS="$LIBS"
+            LIBS="$LIBS $LIBINTL"
+                        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern
+#ifdef __cplusplus
+"C"
+#endif
+const char *_nl_expand_alias (const char *);
+int
+main ()
+{
+bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_expand_alias ("")
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  eval "$gt_func_gnugettext_libintl=yes"
+else
+  eval "$gt_func_gnugettext_libintl=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+                        if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" != yes; } && test -n "$LIBICONV"; then
+              LIBS="$LIBS $LIBICONV"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern
+#ifdef __cplusplus
+"C"
+#endif
+const char *_nl_expand_alias (const char *);
+int
+main ()
+{
+bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_expand_alias ("")
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  LIBINTL="$LIBINTL $LIBICONV"
+                LTLIBINTL="$LTLIBINTL $LTLIBICONV"
+                eval "$gt_func_gnugettext_libintl=yes"
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+            fi
+            CPPFLAGS="$gt_save_CPPFLAGS"
+            LIBS="$gt_save_LIBS"
+fi
+eval ac_res=\$$gt_func_gnugettext_libintl
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+        fi
+
+                                        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" = "yes"; } \
+           || { { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; } \
+                && test "$PACKAGE" != gettext-runtime \
+                && test "$PACKAGE" != gettext-tools; }; then
+          gt_use_preinstalled_gnugettext=yes
+        else
+                    LIBINTL=
+          LTLIBINTL=
+          INCINTL=
+        fi
+
+
+        if test "$gt_use_preinstalled_gnugettext" != "yes"; then
+                              nls_cv_use_gnu_gettext=yes
+        fi
+      fi
+
+      if test "$nls_cv_use_gnu_gettext" = "yes"; then
+                BUILD_INCLUDED_LIBINTL=yes
+        USE_INCLUDED_LIBINTL=yes
+        LIBINTL="\${top_builddir}/intl/libintl.a $LIBICONV $LIBTHREAD"
+        LTLIBINTL="\${top_builddir}/intl/libintl.a $LTLIBICONV $LTLIBTHREAD"
+        LIBS=`echo " $LIBS " | sed -e 's/ -lintl / /' -e 's/^ //' -e 's/ $//'`
+      fi
+
+      CATOBJEXT=
+      if test "$gt_use_preinstalled_gnugettext" = "yes" \
+         || test "$nls_cv_use_gnu_gettext" = "yes"; then
+                CATOBJEXT=.gmo
+      fi
+
+
+    if test -n "$INTL_MACOSX_LIBS"; then
+      if test "$gt_use_preinstalled_gnugettext" = "yes" \
+         || test "$nls_cv_use_gnu_gettext" = "yes"; then
+                LIBINTL="$LIBINTL $INTL_MACOSX_LIBS"
+        LTLIBINTL="$LTLIBINTL $INTL_MACOSX_LIBS"
+      fi
+    fi
+
+    if test "$gt_use_preinstalled_gnugettext" = "yes" \
+       || test "$nls_cv_use_gnu_gettext" = "yes"; then
+
+$as_echo "#define ENABLE_NLS 1" >>confdefs.h
+
+    else
+      USE_NLS=no
+    fi
+  fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to use NLS" >&5
+$as_echo_n "checking whether to use NLS... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $USE_NLS" >&5
+$as_echo "$USE_NLS" >&6; }
+  if test "$USE_NLS" = "yes"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking where the gettext function comes from" >&5
+$as_echo_n "checking where the gettext function comes from... " >&6; }
+    if test "$gt_use_preinstalled_gnugettext" = "yes"; then
+      if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; }; then
+        gt_source="external libintl"
+      else
+        gt_source="libc"
+      fi
+    else
+      gt_source="included intl directory"
+    fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_source" >&5
+$as_echo "$gt_source" >&6; }
+  fi
+
+  if test "$USE_NLS" = "yes"; then
+
+    if test "$gt_use_preinstalled_gnugettext" = "yes"; then
+      if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; }; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to link with libintl" >&5
+$as_echo_n "checking how to link with libintl... " >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIBINTL" >&5
+$as_echo "$LIBINTL" >&6; }
+
+  for element in $INCINTL; do
+    haveit=
+    for x in $CPPFLAGS; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
+  acl_save_exec_prefix="$exec_prefix"
+  exec_prefix="$acl_final_exec_prefix"
+  eval x=\"$x\"
+  exec_prefix="$acl_save_exec_prefix"
+  prefix="$acl_save_prefix"
+
+      if test "X$x" = "X$element"; then
+        haveit=yes
+        break
+      fi
+    done
+    if test -z "$haveit"; then
+      CPPFLAGS="${CPPFLAGS}${CPPFLAGS:+ }$element"
+    fi
+  done
+
+      fi
+
+
+$as_echo "#define HAVE_GETTEXT 1" >>confdefs.h
+
+
+$as_echo "#define HAVE_DCGETTEXT 1" >>confdefs.h
+
+    fi
+
+        POSUB=po
+  fi
+
+
+            if test "$PACKAGE" = gettext-runtime || test "$PACKAGE" = gettext-tools; then
+      BUILD_INCLUDED_LIBINTL=yes
+    fi
+
+
+
+
+
+        nls_cv_header_intl=
+    nls_cv_header_libgt=
+
+        DATADIRNAME=share
+
+
+        INSTOBJEXT=.mo
+
+
+        GENCAT=gencat
+
+
+        INTLOBJS=
+    if test "$USE_INCLUDED_LIBINTL" = yes; then
+      INTLOBJS="\$(GETTOBJS)"
+    fi
+
+
+        INTL_LIBTOOL_SUFFIX_PREFIX=
+
+
+
+    INTLLIBS="$LIBINTL"
+
+
+
+
+
+
+
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for zlibVersion in -lz" >&5
+$as_echo_n "checking for zlibVersion in -lz... " >&6; }
+if ${ac_cv_lib_z_zlibVersion+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lz  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char zlibVersion ();
+int
+main ()
+{
+return zlibVersion ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_z_zlibVersion=yes
+else
+  ac_cv_lib_z_zlibVersion=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_z_zlibVersion" >&5
+$as_echo "$ac_cv_lib_z_zlibVersion" >&6; }
+if test "x$ac_cv_lib_z_zlibVersion" = xyes; then :
+  ZLIB_LIBS="-lz"
+else
+  as_fn_error $? "*** zlib not found!" "$LINENO" 5
+fi
+
+
+
+
+ENABLE_LIBXXX_MODE=false
+# Check whether --enable-libxxx-mode was given.
+if test "${enable_libxxx_mode+set}" = set; then :
+  enableval=$enable_libxxx_mode;
+fi
+
+if test x$enable_libxxx_mode = xyes; then
+	ENABLE_LIBXXX_MODE=true
+fi
+
+# Check whether --enable-dev-build was given.
+if test "${enable_dev_build+set}" = set; then :
+  enableval=$enable_dev_build;
+else
+  enable_dev_build=no
+fi
+
+
+if test x$enable_dev_build = xyes; then
+
+$as_echo "#define MDFN_ENABLE_DEV_BUILD 1" >>confdefs.h
+
+fi
+
+OPTIMIZER_FLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fno-fast-math" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fno-fast-math... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_fast_math+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_fast_math="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-fast-math"     "-pedantic % -fno-fast-math %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_fast_math=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_fast_math" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_fast_math" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_fast_math
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fno-unsafe-math-optimizations" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fno-unsafe-math-optimizations... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_unsafe_math_optimizations+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_unsafe_math_optimizations="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-unsafe-math-optimizations"     "-pedantic % -fno-unsafe-math-optimizations %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_unsafe_math_optimizations=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_unsafe_math_optimizations" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_unsafe_math_optimizations" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_unsafe_math_optimizations
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fno-aggressive-loop-optimizations" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fno-aggressive-loop-optimizations... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_aggressive_loop_optimizations+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_aggressive_loop_optimizations="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-aggressive-loop-optimizations"     "-pedantic % -fno-aggressive-loop-optimizations %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_aggressive_loop_optimizations=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_aggressive_loop_optimizations" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_aggressive_loop_optimizations" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_aggressive_loop_optimizations
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fno-ipa-icf" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fno-ipa-icf... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_ipa_icf+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_ipa_icf="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-ipa-icf"     "-pedantic % -fno-ipa-icf %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_ipa_icf=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_ipa_icf" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_ipa_icf" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_ipa_icf
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fno-printf-return-value" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fno-printf-return-value... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_printf_return_value+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_printf_return_value="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-printf-return-value"     "-pedantic % -fno-printf-return-value %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_printf_return_value=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_printf_return_value" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_printf_return_value" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_printf_return_value
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fomit-frame-pointer" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fomit-frame-pointer... " >&6; }
+if ${ax_cv_cflags_gcc_option__fomit_frame_pointer+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fomit_frame_pointer="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fomit-frame-pointer"     "-pedantic % -fomit-frame-pointer %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fomit_frame_pointer=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fomit_frame_pointer" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fomit_frame_pointer" >&6; }
+var=$ax_cv_cflags_gcc_option__fomit_frame_pointer
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -fstrict-aliasing" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -fstrict-aliasing... " >&6; }
+if ${ax_cv_cflags_gcc_option__fstrict_aliasing+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fstrict_aliasing="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fstrict-aliasing"     "-pedantic % -fstrict-aliasing %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fstrict_aliasing=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fstrict_aliasing" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fstrict_aliasing" >&6; }
+var=$ax_cv_cflags_gcc_option__fstrict_aliasing
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+CODEGEN_FLAGS=""
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -fno-pic" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -fno-pic... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_pic+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_pic="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-pic"     "-pedantic % -fno-pic %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_pic=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_pic" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_pic" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_pic
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -fno-pie" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -fno-pie... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_pie+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_pie="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-pie"     "-pedantic % -fno-pie %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_pie=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_pie" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_pie" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_pie
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -fno-PIC" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -fno-PIC... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_PIC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_PIC="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-PIC"     "-pedantic % -fno-PIC %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_PIC=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_PIC" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_PIC" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_PIC
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -fno-PIE" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -fno-PIE... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_PIE+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_PIE="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-PIE"     "-pedantic % -fno-PIE %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_PIE=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_PIE" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_PIE" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_PIE
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -nopie" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -nopie... " >&6; }
+if ${ax_cv_cflags_gcc_option__nopie+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__nopie="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -nopie"     "-pedantic % -nopie %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__nopie=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__nopie" >&5
+$as_echo "$ax_cv_cflags_gcc_option__nopie" >&6; }
+var=$ax_cv_cflags_gcc_option__nopie
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -no-pie" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -no-pie... " >&6; }
+if ${ax_cv_cflags_gcc_option__no_pie+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__no_pie="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -no-pie"     "-pedantic % -no-pie %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__no_pie=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__no_pie" >&5
+$as_echo "$ax_cv_cflags_gcc_option__no_pie" >&6; }
+var=$ax_cv_cflags_gcc_option__no_pie
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -fwrapv" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -fwrapv... " >&6; }
+if ${ax_cv_cflags_gcc_option__fwrapv+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fwrapv="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fwrapv"     "-pedantic % -fwrapv %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fwrapv=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fwrapv" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fwrapv" >&6; }
+var=$ax_cv_cflags_gcc_option__fwrapv
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -fjump-tables" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -fjump-tables... " >&6; }
+if ${ax_cv_cflags_gcc_option__fjump_tables+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fjump_tables="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fjump-tables"     "-pedantic % -fjump-tables %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fjump_tables=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fjump_tables" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fjump_tables" >&6; }
+var=$ax_cv_cflags_gcc_option__fjump_tables
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -mfunction-return=keep" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -mfunction-return=keep... " >&6; }
+if ${ax_cv_cflags_gcc_option__mfunction_return_keep+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mfunction_return_keep="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mfunction-return=keep"     "-pedantic % -mfunction-return=keep %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mfunction_return_keep=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mfunction_return_keep" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mfunction_return_keep" >&6; }
+var=$ax_cv_cflags_gcc_option__mfunction_return_keep
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -mindirect-branch=keep" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -mindirect-branch=keep... " >&6; }
+if ${ax_cv_cflags_gcc_option__mindirect_branch_keep+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mindirect_branch_keep="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mindirect-branch=keep"     "-pedantic % -mindirect-branch=keep %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mindirect_branch_keep=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mindirect_branch_keep" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mindirect_branch_keep" >&6; }
+var=$ax_cv_cflags_gcc_option__mindirect_branch_keep
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -mno-indirect-branch-register" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -mno-indirect-branch-register... " >&6; }
+if ${ax_cv_cflags_gcc_option__mno_indirect_branch_register+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mno_indirect_branch_register="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mno-indirect-branch-register"     "-pedantic % -mno-indirect-branch-register %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mno_indirect_branch_register=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mno_indirect_branch_register" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mno_indirect_branch_register" >&6; }
+var=$ax_cv_cflags_gcc_option__mno_indirect_branch_register
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -mno-retpoline" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -mno-retpoline... " >&6; }
+if ${ax_cv_cflags_gcc_option__mno_retpoline+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mno_retpoline="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mno-retpoline"     "-pedantic % -mno-retpoline %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mno_retpoline=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mno_retpoline" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mno_retpoline" >&6; }
+var=$ax_cv_cflags_gcc_option__mno_retpoline
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+CODEGEN_CFLAGS=""
+
+CODEGEN_CXXFLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_CXXFLAGS for gcc -fexceptions" >&5
+$as_echo_n "checking CODEGEN_CXXFLAGS for gcc -fexceptions... " >&6; }
+if ${ax_cv_cxxflags_gcc_option__fexceptions+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cxxflags_gcc_option__fexceptions="no, unknown"
+
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+ ac_save_CXXFLAGS="$CXXFLAGS"
+for ac_arg in "-pedantic -Werror % -fexceptions"     "-pedantic % -fexceptions %% no, obsolete"     #
+do CXXFLAGS="$ac_save_CXXFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ax_cv_cxxflags_gcc_option__fexceptions=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CXXFLAGS="$ac_save_CXXFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cxxflags_gcc_option__fexceptions" >&5
+$as_echo "$ax_cv_cxxflags_gcc_option__fexceptions" >&6; }
+var=$ax_cv_cxxflags_gcc_option__fexceptions
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_CXXFLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_CXXFLAGS does contain \$var"; } >&5
+  (: CODEGEN_CXXFLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_CXXFLAGS=\"\$CODEGEN_CXXFLAGS \$var\""; } >&5
+  (: CODEGEN_CXXFLAGS="$CODEGEN_CXXFLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_CXXFLAGS="$CODEGEN_CXXFLAGS $var"
+   fi
+ ;;
+esac
+
+
+WARNING_FLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wall" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wall... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wall+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wall="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wall"     "-pedantic % -Wall %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wall=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wall" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wall" >&6; }
+var=$ax_cv_cflags_gcc_option__Wall
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wshadow" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wshadow... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wshadow+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wshadow="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wshadow"     "-pedantic % -Wshadow %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wshadow=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wshadow" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wshadow" >&6; }
+var=$ax_cv_cflags_gcc_option__Wshadow
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wempty-body" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wempty-body... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wempty_body+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wempty_body="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wempty-body"     "-pedantic % -Wempty-body %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wempty_body=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wempty_body" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wempty_body" >&6; }
+var=$ax_cv_cflags_gcc_option__Wempty_body
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wignored-qualifiers" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wignored-qualifiers... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wignored_qualifiers+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wignored_qualifiers="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wignored-qualifiers"     "-pedantic % -Wignored-qualifiers %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wignored_qualifiers=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wignored_qualifiers" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wignored_qualifiers" >&6; }
+var=$ax_cv_cflags_gcc_option__Wignored_qualifiers
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wvla" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wvla... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wvla+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wvla="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wvla"     "-pedantic % -Wvla %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wvla=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wvla" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wvla" >&6; }
+var=$ax_cv_cflags_gcc_option__Wvla
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wvariadic-macros" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wvariadic-macros... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wvariadic_macros+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wvariadic_macros="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wvariadic-macros"     "-pedantic % -Wvariadic-macros %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wvariadic_macros=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wvariadic_macros" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wvariadic_macros" >&6; }
+var=$ax_cv_cflags_gcc_option__Wvariadic_macros
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Wdisabled-optimization" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Wdisabled-optimization... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wdisabled_optimization+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wdisabled_optimization="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wdisabled-optimization"     "-pedantic % -Wdisabled-optimization %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wdisabled_optimization=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wdisabled_optimization" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wdisabled_optimization" >&6; }
+var=$ax_cv_cflags_gcc_option__Wdisabled_optimization
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking WARNING_FLAGS for gcc -Werror=write-strings" >&5
+$as_echo_n "checking WARNING_FLAGS for gcc -Werror=write-strings... " >&6; }
+if ${ax_cv_cflags_gcc_option__Werror_write_strings+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Werror_write_strings="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Werror=write-strings"     "-pedantic % -Werror=write-strings %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Werror_write_strings=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Werror_write_strings" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Werror_write_strings" >&6; }
+var=$ax_cv_cflags_gcc_option__Werror_write_strings
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $WARNING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS does contain \$var"; } >&5
+  (: WARNING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : WARNING_FLAGS=\"\$WARNING_FLAGS \$var\""; } >&5
+  (: WARNING_FLAGS="$WARNING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      WARNING_FLAGS="$WARNING_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+
+#################################
+#
+# Used as needed in Makefile.am:
+#
+NO_STACK_PROTECTOR_FLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking NO_STACK_PROTECTOR_FLAGS for gcc -fno-stack-protector" >&5
+$as_echo_n "checking NO_STACK_PROTECTOR_FLAGS for gcc -fno-stack-protector... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_stack_protector+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_stack_protector="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-stack-protector"     "-pedantic % -fno-stack-protector %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_stack_protector=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_stack_protector" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_stack_protector" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_stack_protector
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $NO_STACK_PROTECTOR_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STACK_PROTECTOR_FLAGS does contain \$var"; } >&5
+  (: NO_STACK_PROTECTOR_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STACK_PROTECTOR_FLAGS=\"\$NO_STACK_PROTECTOR_FLAGS \$var\""; } >&5
+  (: NO_STACK_PROTECTOR_FLAGS="$NO_STACK_PROTECTOR_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      NO_STACK_PROTECTOR_FLAGS="$NO_STACK_PROTECTOR_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking NO_STACK_PROTECTOR_FLAGS for gcc -fno-stack-protector-all" >&5
+$as_echo_n "checking NO_STACK_PROTECTOR_FLAGS for gcc -fno-stack-protector-all... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_stack_protector_all+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_stack_protector_all="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-stack-protector-all"     "-pedantic % -fno-stack-protector-all %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_stack_protector_all=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_stack_protector_all" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_stack_protector_all" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_stack_protector_all
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $NO_STACK_PROTECTOR_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STACK_PROTECTOR_FLAGS does contain \$var"; } >&5
+  (: NO_STACK_PROTECTOR_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STACK_PROTECTOR_FLAGS=\"\$NO_STACK_PROTECTOR_FLAGS \$var\""; } >&5
+  (: NO_STACK_PROTECTOR_FLAGS="$NO_STACK_PROTECTOR_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      NO_STACK_PROTECTOR_FLAGS="$NO_STACK_PROTECTOR_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking NO_STACK_PROTECTOR_FLAGS for gcc -fno-stack-protector-strong" >&5
+$as_echo_n "checking NO_STACK_PROTECTOR_FLAGS for gcc -fno-stack-protector-strong... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_stack_protector_strong+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_stack_protector_strong="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-stack-protector-strong"     "-pedantic % -fno-stack-protector-strong %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_stack_protector_strong=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_stack_protector_strong" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_stack_protector_strong" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_stack_protector_strong
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $NO_STACK_PROTECTOR_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STACK_PROTECTOR_FLAGS does contain \$var"; } >&5
+  (: NO_STACK_PROTECTOR_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STACK_PROTECTOR_FLAGS=\"\$NO_STACK_PROTECTOR_FLAGS \$var\""; } >&5
+  (: NO_STACK_PROTECTOR_FLAGS="$NO_STACK_PROTECTOR_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      NO_STACK_PROTECTOR_FLAGS="$NO_STACK_PROTECTOR_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+
+# Used for ngp and quicklz
+NO_STRICT_ALIASING_FLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking NO_STRICT_ALIASING_FLAGS for gcc -fno-strict-aliasing" >&5
+$as_echo_n "checking NO_STRICT_ALIASING_FLAGS for gcc -fno-strict-aliasing... " >&6; }
+if ${ax_cv_cflags_gcc_option__fno_strict_aliasing+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__fno_strict_aliasing="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -fno-strict-aliasing"     "-pedantic % -fno-strict-aliasing %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__fno_strict_aliasing=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__fno_strict_aliasing" >&5
+$as_echo "$ax_cv_cflags_gcc_option__fno_strict_aliasing" >&6; }
+var=$ax_cv_cflags_gcc_option__fno_strict_aliasing
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $NO_STRICT_ALIASING_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STRICT_ALIASING_FLAGS does contain \$var"; } >&5
+  (: NO_STRICT_ALIASING_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : NO_STRICT_ALIASING_FLAGS=\"\$NO_STRICT_ALIASING_FLAGS \$var\""; } >&5
+  (: NO_STRICT_ALIASING_FLAGS="$NO_STRICT_ALIASING_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      NO_STRICT_ALIASING_FLAGS="$NO_STRICT_ALIASING_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+
+# -----------------------------------
+# Begin snes flags
+#
+SNES_EXTRA_FLAGS=""
+SNES_EXTRA_CXXFLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SNES_EXTRA_FLAGS for gcc -Wno-unused" >&5
+$as_echo_n "checking SNES_EXTRA_FLAGS for gcc -Wno-unused... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wno_unused+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wno_unused="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wno-unused"     "-pedantic % -Wno-unused %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wno_unused=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wno_unused" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wno_unused" >&6; }
+var=$ax_cv_cflags_gcc_option__Wno_unused
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SNES_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SNES_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS=\"\$SNES_EXTRA_FLAGS \$var\""; } >&5
+  (: SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SNES_EXTRA_FLAGS for gcc -Wno-shadow" >&5
+$as_echo_n "checking SNES_EXTRA_FLAGS for gcc -Wno-shadow... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wno_shadow+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wno_shadow="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wno-shadow"     "-pedantic % -Wno-shadow %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wno_shadow=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wno_shadow" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wno_shadow" >&6; }
+var=$ax_cv_cflags_gcc_option__Wno_shadow
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SNES_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SNES_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS=\"\$SNES_EXTRA_FLAGS \$var\""; } >&5
+  (: SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SNES_EXTRA_FLAGS for gcc -Wno-sign-compare" >&5
+$as_echo_n "checking SNES_EXTRA_FLAGS for gcc -Wno-sign-compare... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wno_sign_compare+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wno_sign_compare="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wno-sign-compare"     "-pedantic % -Wno-sign-compare %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wno_sign_compare=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wno_sign_compare" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wno_sign_compare" >&6; }
+var=$ax_cv_cflags_gcc_option__Wno_sign_compare
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SNES_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SNES_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS=\"\$SNES_EXTRA_FLAGS \$var\""; } >&5
+  (: SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SNES_EXTRA_FLAGS for gcc -Wno-uninitialized" >&5
+$as_echo_n "checking SNES_EXTRA_FLAGS for gcc -Wno-uninitialized... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wno_uninitialized+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wno_uninitialized="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wno-uninitialized"     "-pedantic % -Wno-uninitialized %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wno_uninitialized=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wno_uninitialized" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wno_uninitialized" >&6; }
+var=$ax_cv_cflags_gcc_option__Wno_uninitialized
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SNES_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SNES_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS=\"\$SNES_EXTRA_FLAGS \$var\""; } >&5
+  (: SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SNES_EXTRA_FLAGS for gcc -Wno-parentheses" >&5
+$as_echo_n "checking SNES_EXTRA_FLAGS for gcc -Wno-parentheses... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wno_parentheses+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wno_parentheses="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wno-parentheses"     "-pedantic % -Wno-parentheses %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wno_parentheses=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wno_parentheses" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wno_parentheses" >&6; }
+var=$ax_cv_cflags_gcc_option__Wno_parentheses
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SNES_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SNES_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS=\"\$SNES_EXTRA_FLAGS \$var\""; } >&5
+  (: SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SNES_EXTRA_FLAGS for gcc -Wno-switch" >&5
+$as_echo_n "checking SNES_EXTRA_FLAGS for gcc -Wno-switch... " >&6; }
+if ${ax_cv_cflags_gcc_option__Wno_switch+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__Wno_switch="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -Wno-switch"     "-pedantic % -Wno-switch %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__Wno_switch=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__Wno_switch" >&5
+$as_echo "$ax_cv_cflags_gcc_option__Wno_switch" >&6; }
+var=$ax_cv_cflags_gcc_option__Wno_switch
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SNES_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SNES_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SNES_EXTRA_FLAGS=\"\$SNES_EXTRA_FLAGS \$var\""; } >&5
+  (: SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SNES_EXTRA_FLAGS="$SNES_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+
+#
+# End snes flags
+# -----------------------------------
+
+# -----------------------------------
+# Begin ss flags
+#
+SS_EXTRA_FLAGS=""
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking SS_EXTRA_FLAGS for gcc -mtune=haswell" >&5
+$as_echo_n "checking SS_EXTRA_FLAGS for gcc -mtune=haswell... " >&6; }
+if ${ax_cv_cflags_gcc_option__mtune_haswell+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mtune_haswell="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mtune=haswell"     "-pedantic % -mtune=haswell %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mtune_haswell=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mtune_haswell" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mtune_haswell" >&6; }
+var=$ax_cv_cflags_gcc_option__mtune_haswell
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $SS_EXTRA_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : SS_EXTRA_FLAGS does contain \$var"; } >&5
+  (: SS_EXTRA_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : SS_EXTRA_FLAGS=\"\$SS_EXTRA_FLAGS \$var\""; } >&5
+  (: SS_EXTRA_FLAGS="$SS_EXTRA_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      SS_EXTRA_FLAGS="$SS_EXTRA_FLAGS $var"
+   fi
+ ;;
+esac
+
+
+#
+# End ss flags
+# -----------------------------------
+#
+# End used-as-needed flags
+########################################
+
+ if false; then
+  WANT_DEBUGGER_TRUE=
+  WANT_DEBUGGER_FALSE='#'
+else
+  WANT_DEBUGGER_TRUE='#'
+  WANT_DEBUGGER_FALSE=
+fi
+
+ if false; then
+  WANT_FANCY_SCALERS_TRUE=
+  WANT_FANCY_SCALERS_FALSE='#'
+else
+  WANT_FANCY_SCALERS_TRUE='#'
+  WANT_FANCY_SCALERS_FALSE=
+fi
+
+
+# Check whether --enable-debugger was given.
+if test "${enable_debugger+set}" = set; then :
+  enableval=$enable_debugger;
+else
+  enable_debugger=yes
+fi
+
+
+if test x$enable_debugger = xyes; then
+
+$as_echo "#define WANT_DEBUGGER 1" >>confdefs.h
+
+		 if true; then
+  WANT_DEBUGGER_TRUE=
+  WANT_DEBUGGER_FALSE='#'
+else
+  WANT_DEBUGGER_TRUE='#'
+  WANT_DEBUGGER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-cjk-fonts was given.
+if test "${enable_cjk_fonts+set}" = set; then :
+  enableval=$enable_cjk_fonts;
+else
+  enable_cjk_fonts=yes
+fi
+
+
+if test x$enable_cjk_fonts = xyes; then
+
+$as_echo "#define WANT_INTERNAL_CJK 1" >>confdefs.h
+
+fi
+
+# Check whether --enable-fancy-scalers was given.
+if test "${enable_fancy_scalers+set}" = set; then :
+  enableval=$enable_fancy_scalers;
+else
+  enable_fancy_scalers=yes
+fi
+
+
+if test x$enable_fancy_scalers = xyes; then
+
+$as_echo "#define WANT_FANCY_SCALERS 1" >>confdefs.h
+
+		 if true; then
+  WANT_FANCY_SCALERS_TRUE=
+  WANT_FANCY_SCALERS_FALSE='#'
+else
+  WANT_FANCY_SCALERS_TRUE='#'
+  WANT_FANCY_SCALERS_FALSE=
+fi
+
+fi
+
+# Check whether --enable-altivec was given.
+if test "${enable_altivec+set}" = set; then :
+  enableval=$enable_altivec;
+else
+  enable_altivec=yes
+fi
+
+
+
+ if false; then
+  WANT_APPLE2_EMU_TRUE=
+  WANT_APPLE2_EMU_FALSE='#'
+else
+  WANT_APPLE2_EMU_TRUE='#'
+  WANT_APPLE2_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_GB_EMU_TRUE=
+  WANT_GB_EMU_FALSE='#'
+else
+  WANT_GB_EMU_TRUE='#'
+  WANT_GB_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_GBA_EMU_TRUE=
+  WANT_GBA_EMU_FALSE='#'
+else
+  WANT_GBA_EMU_TRUE='#'
+  WANT_GBA_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_LYNX_EMU_TRUE=
+  WANT_LYNX_EMU_FALSE='#'
+else
+  WANT_LYNX_EMU_TRUE='#'
+  WANT_LYNX_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_MD_EMU_TRUE=
+  WANT_MD_EMU_FALSE='#'
+else
+  WANT_MD_EMU_TRUE='#'
+  WANT_MD_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_SMS_EMU_TRUE=
+  WANT_SMS_EMU_FALSE='#'
+else
+  WANT_SMS_EMU_TRUE='#'
+  WANT_SMS_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_NES_EMU_TRUE=
+  WANT_NES_EMU_FALSE='#'
+else
+  WANT_NES_EMU_TRUE='#'
+  WANT_NES_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_NES_NEW_EMU_TRUE=
+  WANT_NES_NEW_EMU_FALSE='#'
+else
+  WANT_NES_NEW_EMU_TRUE='#'
+  WANT_NES_NEW_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_NGP_EMU_TRUE=
+  WANT_NGP_EMU_FALSE='#'
+else
+  WANT_NGP_EMU_TRUE='#'
+  WANT_NGP_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_PCE_EMU_TRUE=
+  WANT_PCE_EMU_FALSE='#'
+else
+  WANT_PCE_EMU_TRUE='#'
+  WANT_PCE_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_PCE_FAST_EMU_TRUE=
+  WANT_PCE_FAST_EMU_FALSE='#'
+else
+  WANT_PCE_FAST_EMU_TRUE='#'
+  WANT_PCE_FAST_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_PCFX_EMU_TRUE=
+  WANT_PCFX_EMU_FALSE='#'
+else
+  WANT_PCFX_EMU_TRUE='#'
+  WANT_PCFX_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_PSX_EMU_TRUE=
+  WANT_PSX_EMU_FALSE='#'
+else
+  WANT_PSX_EMU_TRUE='#'
+  WANT_PSX_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_SMS_EMU_TRUE=
+  WANT_SMS_EMU_FALSE='#'
+else
+  WANT_SMS_EMU_TRUE='#'
+  WANT_SMS_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_SNES_EMU_TRUE=
+  WANT_SNES_EMU_FALSE='#'
+else
+  WANT_SNES_EMU_TRUE='#'
+  WANT_SNES_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_SNES_FAUST_EMU_TRUE=
+  WANT_SNES_FAUST_EMU_FALSE='#'
+else
+  WANT_SNES_FAUST_EMU_TRUE='#'
+  WANT_SNES_FAUST_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_SS_EMU_TRUE=
+  WANT_SS_EMU_FALSE='#'
+else
+  WANT_SS_EMU_TRUE='#'
+  WANT_SS_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_SSFPLAY_EMU_TRUE=
+  WANT_SSFPLAY_EMU_FALSE='#'
+else
+  WANT_SSFPLAY_EMU_TRUE='#'
+  WANT_SSFPLAY_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_VB_EMU_TRUE=
+  WANT_VB_EMU_FALSE='#'
+else
+  WANT_VB_EMU_TRUE='#'
+  WANT_VB_EMU_FALSE=
+fi
+
+ if false; then
+  WANT_WSWAN_EMU_TRUE=
+  WANT_WSWAN_EMU_FALSE='#'
+else
+  WANT_WSWAN_EMU_TRUE='#'
+  WANT_WSWAN_EMU_FALSE=
+fi
+
+
+ if false; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+
+ if false; then
+  NEED_GB_APU_EMU_TRUE=
+  NEED_GB_APU_EMU_FALSE='#'
+else
+  NEED_GB_APU_EMU_TRUE='#'
+  NEED_GB_APU_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_YM2413_EMU_TRUE=
+  NEED_YM2413_EMU_FALSE='#'
+else
+  NEED_YM2413_EMU_TRUE='#'
+  NEED_YM2413_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_YM2612_EMU_TRUE=
+  NEED_YM2612_EMU_FALSE='#'
+else
+  NEED_YM2612_EMU_TRUE='#'
+  NEED_YM2612_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_PCE_PSG_EMU_TRUE=
+  NEED_PCE_PSG_EMU_FALSE='#'
+else
+  NEED_PCE_PSG_EMU_TRUE='#'
+  NEED_PCE_PSG_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_SMS_APU_EMU_TRUE=
+  NEED_SMS_APU_EMU_FALSE='#'
+else
+  NEED_SMS_APU_EMU_TRUE='#'
+  NEED_SMS_APU_EMU_FALSE=
+fi
+
+
+ if false; then
+  NEED_68K_EMU_TRUE=
+  NEED_68K_EMU_FALSE='#'
+else
+  NEED_68K_EMU_TRUE='#'
+  NEED_68K_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_Z80_EMU_TRUE=
+  NEED_Z80_EMU_FALSE='#'
+else
+  NEED_Z80_EMU_TRUE='#'
+  NEED_Z80_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_V810_EMU_TRUE=
+  NEED_V810_EMU_FALSE='#'
+else
+  NEED_V810_EMU_TRUE='#'
+  NEED_V810_EMU_FALSE=
+fi
+
+
+ if false; then
+  NEED_HUC6270_EMU_TRUE=
+  NEED_HUC6270_EMU_FALSE='#'
+else
+  NEED_HUC6270_EMU_TRUE='#'
+  NEED_HUC6270_EMU_FALSE=
+fi
+
+ if false; then
+  NEED_ARCADE_CARD_EMU_TRUE=
+  NEED_ARCADE_CARD_EMU_FALSE='#'
+else
+  NEED_ARCADE_CARD_EMU_TRUE='#'
+  NEED_ARCADE_CARD_EMU_FALSE=
+fi
+
+
+# Check whether --enable-apple2 was given.
+if test "${enable_apple2+set}" = set; then :
+  enableval=$enable_apple2;
+else
+  enable_apple2=yes
+fi
+
+
+if test x$enable_apple2 = xyes; then
+
+$as_echo "#define WANT_APPLE2_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_APPLE2_EMU_TRUE=
+  WANT_APPLE2_EMU_FALSE='#'
+else
+  WANT_APPLE2_EMU_TRUE='#'
+  WANT_APPLE2_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-gb was given.
+if test "${enable_gb+set}" = set; then :
+  enableval=$enable_gb;
+else
+  enable_gb=yes
+fi
+
+
+if test x$enable_gb = xyes; then
+
+$as_echo "#define WANT_GB_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_GB_EMU_TRUE=
+  WANT_GB_EMU_FALSE='#'
+else
+  WANT_GB_EMU_TRUE='#'
+  WANT_GB_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_GB_APU_EMU_TRUE=
+  NEED_GB_APU_EMU_FALSE='#'
+else
+  NEED_GB_APU_EMU_TRUE='#'
+  NEED_GB_APU_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-gba was given.
+if test "${enable_gba+set}" = set; then :
+  enableval=$enable_gba;
+else
+  enable_gba=yes
+fi
+
+
+if test x$enable_gba = xyes; then
+
+$as_echo "#define WANT_GBA_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_GBA_EMU_TRUE=
+  WANT_GBA_EMU_FALSE='#'
+else
+  WANT_GBA_EMU_TRUE='#'
+  WANT_GBA_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_GB_APU_EMU_TRUE=
+  NEED_GB_APU_EMU_FALSE='#'
+else
+  NEED_GB_APU_EMU_TRUE='#'
+  NEED_GB_APU_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-lynx was given.
+if test "${enable_lynx+set}" = set; then :
+  enableval=$enable_lynx;
+else
+  enable_lynx=yes
+fi
+
+
+if test x$enable_lynx = xyes; then
+
+$as_echo "#define WANT_LYNX_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_LYNX_EMU_TRUE=
+  WANT_LYNX_EMU_FALSE='#'
+else
+  WANT_LYNX_EMU_TRUE='#'
+  WANT_LYNX_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-md was given.
+if test "${enable_md+set}" = set; then :
+  enableval=$enable_md;
+else
+  enable_md=yes
+fi
+
+
+if test x$enable_md = xyes; then
+
+$as_echo "#define WANT_MD_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_MD_EMU_TRUE=
+  WANT_MD_EMU_FALSE='#'
+else
+  WANT_MD_EMU_TRUE='#'
+  WANT_MD_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_68K_EMU_TRUE=
+  NEED_68K_EMU_FALSE='#'
+else
+  NEED_68K_EMU_TRUE='#'
+  NEED_68K_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_Z80_EMU_TRUE=
+  NEED_Z80_EMU_FALSE='#'
+else
+  NEED_Z80_EMU_TRUE='#'
+  NEED_Z80_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_YM2612_EMU_TRUE=
+  NEED_YM2612_EMU_FALSE='#'
+else
+  NEED_YM2612_EMU_TRUE='#'
+  NEED_YM2612_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_SMS_APU_EMU_TRUE=
+  NEED_SMS_APU_EMU_FALSE='#'
+else
+  NEED_SMS_APU_EMU_TRUE='#'
+  NEED_SMS_APU_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-nes was given.
+if test "${enable_nes+set}" = set; then :
+  enableval=$enable_nes;
+else
+  enable_nes=yes
+fi
+
+
+if test x$enable_nes = xyes; then
+
+$as_echo "#define WANT_NES_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_NES_EMU_TRUE=
+  WANT_NES_EMU_FALSE='#'
+else
+  WANT_NES_EMU_TRUE='#'
+  WANT_NES_EMU_FALSE=
+fi
+
+fi
+
+#AC_ARG_ENABLE(nes_new,
+# AC_HELP_STRING([--enable-nes-new], [build with experimental, alternate new(ish) NES emulation [[default=yes]]]),
+#                  , enable_nes_new=yes)
+#
+#if test x$enable_nes_new = xyes; then
+#                AC_DEFINE([WANT_NES_NEW_EMU], [1], [Define if we are compiling with experimental, alternate new(ish) NES emulation.])
+#                AM_CONDITIONAL(WANT_NES_NEW_EMU, true)
+#fi
+
+# Check whether --enable-ngp was given.
+if test "${enable_ngp+set}" = set; then :
+  enableval=$enable_ngp;
+else
+  enable_ngp=yes
+fi
+
+
+if test x$enable_ngp = xyes; then
+
+$as_echo "#define WANT_NGP_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_NGP_EMU_TRUE=
+  WANT_NGP_EMU_FALSE='#'
+else
+  WANT_NGP_EMU_TRUE='#'
+  WANT_NGP_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_Z80_EMU_TRUE=
+  NEED_Z80_EMU_FALSE='#'
+else
+  NEED_Z80_EMU_TRUE='#'
+  NEED_Z80_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-pce was given.
+if test "${enable_pce+set}" = set; then :
+  enableval=$enable_pce;
+else
+  enable_pce=yes
+fi
+
+
+if test x$enable_pce = xyes; then
+
+$as_echo "#define WANT_PCE_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_PCE_EMU_TRUE=
+  WANT_PCE_EMU_FALSE='#'
+else
+  WANT_PCE_EMU_TRUE='#'
+  WANT_PCE_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_PCE_PSG_EMU_TRUE=
+  NEED_PCE_PSG_EMU_FALSE='#'
+else
+  NEED_PCE_PSG_EMU_TRUE='#'
+  NEED_PCE_PSG_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_HUC6270_EMU_TRUE=
+  NEED_HUC6270_EMU_FALSE='#'
+else
+  NEED_HUC6270_EMU_TRUE='#'
+  NEED_HUC6270_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_ARCADE_CARD_EMU_TRUE=
+  NEED_ARCADE_CARD_EMU_FALSE='#'
+else
+  NEED_ARCADE_CARD_EMU_TRUE='#'
+  NEED_ARCADE_CARD_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-pce-fast was given.
+if test "${enable_pce_fast+set}" = set; then :
+  enableval=$enable_pce_fast;
+else
+  enable_pce_fast=yes
+fi
+
+
+if test x$enable_pce_fast = xyes; then
+
+$as_echo "#define WANT_PCE_FAST_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_PCE_FAST_EMU_TRUE=
+  WANT_PCE_FAST_EMU_FALSE='#'
+else
+  WANT_PCE_FAST_EMU_TRUE='#'
+  WANT_PCE_FAST_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_ARCADE_CARD_EMU_TRUE=
+  NEED_ARCADE_CARD_EMU_FALSE='#'
+else
+  NEED_ARCADE_CARD_EMU_TRUE='#'
+  NEED_ARCADE_CARD_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-pcfx was given.
+if test "${enable_pcfx+set}" = set; then :
+  enableval=$enable_pcfx;
+else
+  enable_pcfx=yes
+fi
+
+
+if test x$enable_pcfx = xyes; then
+
+$as_echo "#define WANT_PCFX_EMU 1" >>confdefs.h
+
+		 if true; then
+  WANT_PCFX_EMU_TRUE=
+  WANT_PCFX_EMU_FALSE='#'
+else
+  WANT_PCFX_EMU_TRUE='#'
+  WANT_PCFX_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_V810_EMU_TRUE=
+  NEED_V810_EMU_FALSE='#'
+else
+  NEED_V810_EMU_TRUE='#'
+  NEED_V810_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_PCE_PSG_EMU_TRUE=
+  NEED_PCE_PSG_EMU_FALSE='#'
+else
+  NEED_PCE_PSG_EMU_TRUE='#'
+  NEED_PCE_PSG_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_HUC6270_EMU_TRUE=
+  NEED_HUC6270_EMU_FALSE='#'
+else
+  NEED_HUC6270_EMU_TRUE='#'
+  NEED_HUC6270_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-psx was given.
+if test "${enable_psx+set}" = set; then :
+  enableval=$enable_psx;
+else
+  enable_psx=yes
+fi
+
+
+if test x$enable_psx = xyes; then
+
+$as_echo "#define WANT_PSX_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_PSX_EMU_TRUE=
+  WANT_PSX_EMU_FALSE='#'
+else
+  WANT_PSX_EMU_TRUE='#'
+  WANT_PSX_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-sms was given.
+if test "${enable_sms+set}" = set; then :
+  enableval=$enable_sms;
+else
+  enable_sms=yes
+fi
+
+
+if test x$enable_sms = xyes; then
+
+$as_echo "#define WANT_SMS_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_SMS_EMU_TRUE=
+  WANT_SMS_EMU_FALSE='#'
+else
+  WANT_SMS_EMU_TRUE='#'
+  WANT_SMS_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_Z80_EMU_TRUE=
+  NEED_Z80_EMU_FALSE='#'
+else
+  NEED_Z80_EMU_TRUE='#'
+  NEED_Z80_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_SMS_APU_EMU_TRUE=
+  NEED_SMS_APU_EMU_FALSE='#'
+else
+  NEED_SMS_APU_EMU_TRUE='#'
+  NEED_SMS_APU_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_YM2413_EMU_TRUE=
+  NEED_YM2413_EMU_FALSE='#'
+else
+  NEED_YM2413_EMU_TRUE='#'
+  NEED_YM2413_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+# Check whether --enable-snes was given.
+if test "${enable_snes+set}" = set; then :
+  enableval=$enable_snes;
+else
+  enable_snes=yes
+fi
+
+
+if test x$enable_snes = xyes; then
+
+$as_echo "#define WANT_SNES_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_SNES_EMU_TRUE=
+  WANT_SNES_EMU_FALSE='#'
+else
+  WANT_SNES_EMU_TRUE='#'
+  WANT_SNES_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-snes-faust was given.
+if test "${enable_snes_faust+set}" = set; then :
+  enableval=$enable_snes_faust;
+else
+  enable_snes_faust=yes
+fi
+
+
+if test x$enable_snes_faust = xyes; then
+
+$as_echo "#define WANT_SNES_FAUST_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_SNES_FAUST_EMU_TRUE=
+  WANT_SNES_FAUST_EMU_FALSE='#'
+else
+  WANT_SNES_FAUST_EMU_TRUE='#'
+  WANT_SNES_FAUST_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-ss was given.
+if test "${enable_ss+set}" = set; then :
+  enableval=$enable_ss;
+else
+  enable_ss="x86_64 amd64 aarch64* arm64* ppc64* powerpc64*"
+fi
+
+for i in $enable_ss; do case $host_cpu in $i) enable_ss=yes ;; esac; done
+
+if test "x$enable_ss" = "xyes"; then
+
+$as_echo "#define WANT_SS_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_SS_EMU_TRUE=
+  WANT_SS_EMU_FALSE='#'
+else
+  WANT_SS_EMU_TRUE='#'
+  WANT_SS_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_68K_EMU_TRUE=
+  NEED_68K_EMU_FALSE='#'
+else
+  NEED_68K_EMU_TRUE='#'
+  NEED_68K_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-ssfplay was given.
+if test "${enable_ssfplay+set}" = set; then :
+  enableval=$enable_ssfplay;
+else
+  enable_ssfplay=yes
+fi
+
+
+if test x$enable_ssfplay = xyes; then
+
+$as_echo "#define WANT_SSFPLAY_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_SSFPLAY_EMU_TRUE=
+  WANT_SSFPLAY_EMU_FALSE='#'
+else
+  WANT_SSFPLAY_EMU_TRUE='#'
+  WANT_SSFPLAY_EMU_FALSE=
+fi
+
+                 if true; then
+  NEED_68K_EMU_TRUE=
+  NEED_68K_EMU_FALSE='#'
+else
+  NEED_68K_EMU_TRUE='#'
+  NEED_68K_EMU_FALSE=
+fi
+
+fi
+
+# Check whether --enable-vb was given.
+if test "${enable_vb+set}" = set; then :
+  enableval=$enable_vb;
+else
+  enable_vb=yes
+fi
+
+
+if test x$enable_vb = xyes; then
+
+$as_echo "#define WANT_VB_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_VB_EMU_TRUE=
+  WANT_VB_EMU_FALSE='#'
+else
+  WANT_VB_EMU_TRUE='#'
+  WANT_VB_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_V810_EMU_TRUE=
+  NEED_V810_EMU_FALSE='#'
+else
+  NEED_V810_EMU_TRUE='#'
+  NEED_V810_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+
+# Check whether --enable-wswan was given.
+if test "${enable_wswan+set}" = set; then :
+  enableval=$enable_wswan;
+else
+  enable_wswan=yes
+fi
+
+
+if test x$enable_wswan = xyes; then
+
+$as_echo "#define WANT_WSWAN_EMU 1" >>confdefs.h
+
+                 if true; then
+  WANT_WSWAN_EMU_TRUE=
+  WANT_WSWAN_EMU_FALSE='#'
+else
+  WANT_WSWAN_EMU_TRUE='#'
+  WANT_WSWAN_EMU_FALSE=
+fi
+
+		 if true; then
+  NEED_BLIP_BUFFER_TRUE=
+  NEED_BLIP_BUFFER_FALSE='#'
+else
+  NEED_BLIP_BUFFER_TRUE='#'
+  NEED_BLIP_BUFFER_FALSE=
+fi
+
+fi
+
+##
+## ALSA and JACK checking code ripped from SDL's autoconf file, with heavy modifications
+##
+#
+# ALSA
+#
+ if false; then
+  HAVE_ALSA_TRUE=
+  HAVE_ALSA_FALSE='#'
+else
+  HAVE_ALSA_TRUE='#'
+  HAVE_ALSA_FALSE=
+fi
+
+# Check whether --enable-alsa was given.
+if test "${enable_alsa+set}" = set; then :
+  enableval=$enable_alsa;
+else
+  enable_alsa=yes
+fi
+
+if test x$enable_alsa = xyes; then
+	alsa_save_CFLAGS="$CFLAGS"
+alsa_save_LDFLAGS="$LDFLAGS"
+alsa_save_LIBS="$LIBS"
+alsa_found=yes
+
+
+# Check whether --with-alsa-prefix was given.
+if test "${with_alsa_prefix+set}" = set; then :
+  withval=$with_alsa_prefix; alsa_prefix="$withval"
+else
+  alsa_prefix=""
+fi
+
+
+
+# Check whether --with-alsa-inc-prefix was given.
+if test "${with_alsa_inc_prefix+set}" = set; then :
+  withval=$with_alsa_inc_prefix; alsa_inc_prefix="$withval"
+else
+  alsa_inc_prefix=""
+fi
+
+
+# Check whether --enable-alsatest was given.
+if test "${enable_alsatest+set}" = set; then :
+  enableval=$enable_alsatest; enable_alsatest="$enableval"
+else
+  enable_alsatest=yes
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ALSA CFLAGS" >&5
+$as_echo_n "checking for ALSA CFLAGS... " >&6; }
+if test "$alsa_inc_prefix" != "" ; then
+	ALSA_CFLAGS="$ALSA_CFLAGS -I$alsa_inc_prefix"
+	CFLAGS="$CFLAGS -I$alsa_inc_prefix"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ALSA_CFLAGS" >&5
+$as_echo "$ALSA_CFLAGS" >&6; }
+CFLAGS="$alsa_save_CFLAGS"
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ALSA LDFLAGS" >&5
+$as_echo_n "checking for ALSA LDFLAGS... " >&6; }
+if test "$alsa_prefix" != "" ; then
+	ALSA_LIBS="$ALSA_LIBS -L$alsa_prefix"
+	LDFLAGS="$LDFLAGS $ALSA_LIBS"
+fi
+
+ALSA_LIBS="$ALSA_LIBS -lasound -lm -ldl -lpthread"
+LIBS="$ALSA_LIBS $LIBS"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ALSA_LIBS" >&5
+$as_echo "$ALSA_LIBS" >&6; }
+
+min_alsa_version=1.0.0
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libasound headers version >= $min_alsa_version" >&5
+$as_echo_n "checking for libasound headers version >= $min_alsa_version... " >&6; }
+no_alsa=""
+    alsa_min_major_version=`echo $min_alsa_version | \
+           sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
+    alsa_min_minor_version=`echo $min_alsa_version | \
+           sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\2/'`
+    alsa_min_micro_version=`echo $min_alsa_version | \
+           sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\3/'`
+
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <alsa/asoundlib.h>
+
+int
+main ()
+{
+
+/* ensure backward compatibility */
+#if !defined(SND_LIB_MAJOR) && defined(SOUNDLIB_VERSION_MAJOR)
+#define SND_LIB_MAJOR SOUNDLIB_VERSION_MAJOR
+#endif
+#if !defined(SND_LIB_MINOR) && defined(SOUNDLIB_VERSION_MINOR)
+#define SND_LIB_MINOR SOUNDLIB_VERSION_MINOR
+#endif
+#if !defined(SND_LIB_SUBMINOR) && defined(SOUNDLIB_VERSION_SUBMINOR)
+#define SND_LIB_SUBMINOR SOUNDLIB_VERSION_SUBMINOR
+#endif
+
+#  if(SND_LIB_MAJOR > $alsa_min_major_version)
+  exit(0);
+#  else
+#    if(SND_LIB_MAJOR < $alsa_min_major_version)
+#       error not present
+#    endif
+
+#   if(SND_LIB_MINOR > $alsa_min_minor_version)
+  exit(0);
+#   else
+#     if(SND_LIB_MINOR < $alsa_min_minor_version)
+#          error not present
+#      endif
+
+#      if(SND_LIB_SUBMINOR < $alsa_min_micro_version)
+#        error not present
+#      endif
+#    endif
+#  endif
+exit(0);
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: found." >&5
+$as_echo "found." >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: not present." >&5
+$as_echo "not present." >&6; }
+
+   alsa_found=no
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+if test "x$enable_alsatest" = "xyes"; then
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for snd_ctl_open in -lasound" >&5
+$as_echo_n "checking for snd_ctl_open in -lasound... " >&6; }
+if ${ac_cv_lib_asound_snd_ctl_open+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lasound  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char snd_ctl_open ();
+int
+main ()
+{
+return snd_ctl_open ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_asound_snd_ctl_open=yes
+else
+  ac_cv_lib_asound_snd_ctl_open=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_asound_snd_ctl_open" >&5
+$as_echo "$ac_cv_lib_asound_snd_ctl_open" >&6; }
+if test "x$ac_cv_lib_asound_snd_ctl_open" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBASOUND 1
+_ACEOF
+
+  LIBS="-lasound $LIBS"
+
+else
+
+	 alsa_found=no
+
+fi
+
+fi
+
+LDFLAGS="$alsa_save_LDFLAGS"
+LIBS="$alsa_save_LIBS"
+
+if test "x$alsa_found" = "xyes" ; then
+   have_alsa=yes
+else
+   ALSA_CFLAGS=""
+   ALSA_LIBS=""
+   have_alsa=no
+fi
+
+
+
+
+
+	# Restore all flags from before the ALSA detection runs
+	CFLAGS="$alsa_save_CFLAGS"
+	LDFLAGS="$alsa_save_LDFLAGS"
+	LIBS="$alsa_save_LIBS"
+
+	if test x$have_alsa = xyes; then
+		 if true; then
+  HAVE_ALSA_TRUE=
+  HAVE_ALSA_FALSE='#'
+else
+  HAVE_ALSA_TRUE='#'
+  HAVE_ALSA_FALSE=
+fi
+
+
+$as_echo "#define HAVE_ALSA 1" >>confdefs.h
+
+	fi
+fi
+
+
+
+
+#
+# JACK
+#
+ if false; then
+  HAVE_JACK_TRUE=
+  HAVE_JACK_FALSE='#'
+else
+  HAVE_JACK_TRUE='#'
+  HAVE_JACK_FALSE=
+fi
+
+# Check whether --enable-jack was given.
+if test "${enable_jack+set}" = set; then :
+  enableval=$enable_jack;
+else
+  enable_jack=yes
+fi
+
+if test x$enable_jack = xyes; then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for JACK" >&5
+$as_echo_n "checking for JACK... " >&6; }
+
+if test -n "$JACK_CFLAGS"; then
+    pkg_cv_JACK_CFLAGS="$JACK_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"jack\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "jack") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_JACK_CFLAGS=`$PKG_CONFIG --cflags "jack" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$JACK_LIBS"; then
+    pkg_cv_JACK_LIBS="$JACK_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"jack\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "jack") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_JACK_LIBS=`$PKG_CONFIG --libs "jack" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        JACK_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "jack" 2>&1`
+        else
+	        JACK_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "jack" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$JACK_PKG_ERRORS" >&5
+
+	have_jack=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	have_jack=no
+else
+	JACK_CFLAGS=$pkg_cv_JACK_CFLAGS
+	JACK_LIBS=$pkg_cv_JACK_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	have_jack=yes
+fi
+
+	if test x$have_jack = xyes; then
+		 if true; then
+  HAVE_JACK_TRUE=
+  HAVE_JACK_FALSE='#'
+else
+  HAVE_JACK_TRUE='#'
+  HAVE_JACK_FALSE=
+fi
+
+
+$as_echo "#define HAVE_JACK 1" >>confdefs.h
+
+	fi
+fi
+
+
+
+
+#
+# OpenBSD Audio
+#
+ if false; then
+  HAVE_OPENBSD_AUDIO_TRUE=
+  HAVE_OPENBSD_AUDIO_FALSE='#'
+else
+  HAVE_OPENBSD_AUDIO_TRUE='#'
+  HAVE_OPENBSD_AUDIO_FALSE=
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for OpenBSD audio" >&5
+$as_echo_n "checking for OpenBSD audio... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+	#include <sys/types.h>
+	#include <sys/ioctl.h>
+	#include <sys/audioio.h>
+	#include <string.h>
+
+int
+main ()
+{
+
+	struct audio_swpar par;
+	struct audio_pos pos;
+	struct audio_status status;
+	AUDIO_INITPAR(&par);
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	  if true; then
+  HAVE_OPENBSD_AUDIO_TRUE=
+  HAVE_OPENBSD_AUDIO_FALSE='#'
+else
+  HAVE_OPENBSD_AUDIO_TRUE='#'
+  HAVE_OPENBSD_AUDIO_FALSE=
+fi
+
+
+$as_echo "#define HAVE_OPENBSD_AUDIO 1" >>confdefs.h
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+#
+# mpcdec
+#
+ if false; then
+  HAVE_EXTERNAL_MPCDEC_TRUE=
+  HAVE_EXTERNAL_MPCDEC_FALSE='#'
+else
+  HAVE_EXTERNAL_MPCDEC_TRUE='#'
+  HAVE_EXTERNAL_MPCDEC_FALSE=
+fi
+
+
+# Check whether --with-external-mpcdec was given.
+if test "${with_external_mpcdec+set}" = set; then :
+  withval=$with_external_mpcdec;
+else
+  with_external_mpcdec=no
+fi
+
+if test x$with_external_mpcdec = xyes; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for mpc_demux_init in -lmpcdec" >&5
+$as_echo_n "checking for mpc_demux_init in -lmpcdec... " >&6; }
+if ${ac_cv_lib_mpcdec_mpc_demux_init+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lmpcdec  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char mpc_demux_init ();
+int
+main ()
+{
+return mpc_demux_init ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_mpcdec_mpc_demux_init=yes
+else
+  ac_cv_lib_mpcdec_mpc_demux_init=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_mpcdec_mpc_demux_init" >&5
+$as_echo "$ac_cv_lib_mpcdec_mpc_demux_init" >&6; }
+if test "x$ac_cv_lib_mpcdec_mpc_demux_init" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBMPCDEC 1
+_ACEOF
+
+  LIBS="-lmpcdec $LIBS"
+
+else
+  as_fn_error $? "*** mpcdec not found!" "$LINENO" 5
+fi
+
+	ac_fn_cxx_check_header_mongrel "$LINENO" "mpc/mpcdec.h" "ac_cv_header_mpc_mpcdec_h" "$ac_includes_default"
+if test "x$ac_cv_header_mpc_mpcdec_h" = xyes; then :
+
+else
+  as_fn_error $? "*** mpcdec not found!" "$LINENO" 5
+fi
+
+
+
+
+$as_echo "#define HAVE_EXTERNAL_MPCDEC 1" >>confdefs.h
+
+	 if true; then
+  HAVE_EXTERNAL_MPCDEC_TRUE=
+  HAVE_EXTERNAL_MPCDEC_FALSE='#'
+else
+  HAVE_EXTERNAL_MPCDEC_TRUE='#'
+  HAVE_EXTERNAL_MPCDEC_FALSE=
+fi
+
+	MPCDEC_LIBS="-lmpcdec"
+
+else
+
+$as_echo "#define MPC_FIXED_POINT 1" >>confdefs.h
+
+fi
+
+#
+# tremor
+#
+ if false; then
+  HAVE_EXTERNAL_TREMOR_TRUE=
+  HAVE_EXTERNAL_TREMOR_FALSE='#'
+else
+  HAVE_EXTERNAL_TREMOR_TRUE='#'
+  HAVE_EXTERNAL_TREMOR_FALSE=
+fi
+
+
+# Check whether --with-external-tremor was given.
+if test "${with_external_tremor+set}" = set; then :
+  withval=$with_external_tremor;
+else
+  with_external_tremor=no
+fi
+
+if test x$with_external_tremor = xyes; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ov_read in -lvorbisidec" >&5
+$as_echo_n "checking for ov_read in -lvorbisidec... " >&6; }
+if ${ac_cv_lib_vorbisidec_ov_read+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lvorbisidec  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char ov_read ();
+int
+main ()
+{
+return ov_read ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_vorbisidec_ov_read=yes
+else
+  ac_cv_lib_vorbisidec_ov_read=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_vorbisidec_ov_read" >&5
+$as_echo "$ac_cv_lib_vorbisidec_ov_read" >&6; }
+if test "x$ac_cv_lib_vorbisidec_ov_read" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBVORBISIDEC 1
+_ACEOF
+
+  LIBS="-lvorbisidec $LIBS"
+
+else
+  as_fn_error $? "*** libvorbisidec not found!" "$LINENO" 5
+fi
+
+	ac_fn_cxx_check_header_mongrel "$LINENO" "tremor/ivorbisfile.h" "ac_cv_header_tremor_ivorbisfile_h" "$ac_includes_default"
+if test "x$ac_cv_header_tremor_ivorbisfile_h" = xyes; then :
+
+else
+  as_fn_error $? "*** libvorbisidec not found!" "$LINENO" 5
+fi
+
+
+
+
+$as_echo "#define HAVE_EXTERNAL_TREMOR 1" >>confdefs.h
+
+	 if true; then
+  HAVE_EXTERNAL_TREMOR_TRUE=
+  HAVE_EXTERNAL_TREMOR_FALSE='#'
+else
+  HAVE_EXTERNAL_TREMOR_TRUE='#'
+  HAVE_EXTERNAL_TREMOR_FALSE=
+fi
+
+	TREMOR_LIBS="-lvorbisidec"
+
+fi
+
+#
+# trio
+#
+ if false; then
+  HAVE_EXTERNAL_TRIO_TRUE=
+  HAVE_EXTERNAL_TRIO_FALSE='#'
+else
+  HAVE_EXTERNAL_TRIO_TRUE='#'
+  HAVE_EXTERNAL_TRIO_FALSE=
+fi
+
+
+# Check whether --with-external-trio was given.
+if test "${with_external_trio+set}" = set; then :
+  withval=$with_external_trio;
+else
+  with_external_trio=no
+fi
+
+if test x$with_external_trio = xyes; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for trio_printf in -ltrio" >&5
+$as_echo_n "checking for trio_printf in -ltrio... " >&6; }
+if ${ac_cv_lib_trio_trio_printf+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ltrio  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char trio_printf ();
+int
+main ()
+{
+return trio_printf ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_trio_trio_printf=yes
+else
+  ac_cv_lib_trio_trio_printf=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_trio_trio_printf" >&5
+$as_echo "$ac_cv_lib_trio_trio_printf" >&6; }
+if test "x$ac_cv_lib_trio_trio_printf" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBTRIO 1
+_ACEOF
+
+  LIBS="-ltrio $LIBS"
+
+else
+  as_fn_error $? "*** libtrio not found!" "$LINENO" 5
+fi
+
+	ac_fn_cxx_check_header_mongrel "$LINENO" "trio.h" "ac_cv_header_trio_h" "$ac_includes_default"
+if test "x$ac_cv_header_trio_h" = xyes; then :
+
+else
+  as_fn_error $? "*** libtrio not found!" "$LINENO" 5
+fi
+
+
+
+
+$as_echo "#define HAVE_EXTERNAL_TRIO 1" >>confdefs.h
+
+	 if true; then
+  HAVE_EXTERNAL_TRIO_TRUE=
+  HAVE_EXTERNAL_TRIO_FALSE='#'
+else
+  HAVE_EXTERNAL_TRIO_TRUE='#'
+  HAVE_EXTERNAL_TRIO_FALSE=
+fi
+
+	TRIO_LIBS="-ltrio"
+
+	trio_include_symsrc="include/trio_external"
+else
+	trio_include_symsrc="src/trio"
+fi
+ac_config_links="$ac_config_links include/trio/triodef.h:$trio_include_symsrc/triodef.h"
+
+ac_config_links="$ac_config_links include/trio/trio.h:$trio_include_symsrc/trio.h"
+
+ac_config_links="$ac_config_links include/trio/trionan.h:$trio_include_symsrc/trionan.h"
+
+ac_config_links="$ac_config_links include/trio/triop.h:$trio_include_symsrc/triop.h"
+
+ac_config_links="$ac_config_links include/trio/triostr.h:$trio_include_symsrc/triostr.h"
+
+
+#
+# minilzo/lzo
+#
+ if false; then
+  HAVE_EXTERNAL_LZO2_TRUE=
+  HAVE_EXTERNAL_LZO2_FALSE='#'
+else
+  HAVE_EXTERNAL_LZO2_TRUE='#'
+  HAVE_EXTERNAL_LZO2_FALSE=
+fi
+
+
+# Check whether --with-external-lzo was given.
+if test "${with_external_lzo+set}" = set; then :
+  withval=$with_external_lzo;
+else
+  with_external_lzo=no
+fi
+
+if test x$with_external_lzo = xyes; then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LZO2" >&5
+$as_echo_n "checking for LZO2... " >&6; }
+
+if test -n "$LZO2_CFLAGS"; then
+    pkg_cv_LZO2_CFLAGS="$LZO2_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lzo2 >= 2.0.9\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lzo2 >= 2.0.9") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LZO2_CFLAGS=`$PKG_CONFIG --cflags "lzo2 >= 2.0.9" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LZO2_LIBS"; then
+    pkg_cv_LZO2_LIBS="$LZO2_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lzo2 >= 2.0.9\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lzo2 >= 2.0.9") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LZO2_LIBS=`$PKG_CONFIG --libs "lzo2 >= 2.0.9" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LZO2_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lzo2 >= 2.0.9" 2>&1`
+        else
+	        LZO2_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lzo2 >= 2.0.9" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LZO2_PKG_ERRORS" >&5
+
+	as_fn_error $? "*** lzo2 >= 2.0.9 not found!" "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "*** lzo2 >= 2.0.9 not found!" "$LINENO" 5
+else
+	LZO2_CFLAGS=$pkg_cv_LZO2_CFLAGS
+	LZO2_LIBS=$pkg_cv_LZO2_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+fi
+
+
+
+$as_echo "#define HAVE_EXTERNAL_LZO2 1" >>confdefs.h
+
+	 if true; then
+  HAVE_EXTERNAL_LZO2_TRUE=
+  HAVE_EXTERNAL_LZO2_FALSE='#'
+else
+  HAVE_EXTERNAL_LZO2_TRUE='#'
+  HAVE_EXTERNAL_LZO2_FALSE=
+fi
+
+	minilzo_include_symsrc="include/minilzo_external"
+else
+	minilzo_include_symsrc="include/minilzo_internal"
+fi
+ac_config_links="$ac_config_links include/minilzo/minilzo.h:$minilzo_include_symsrc/minilzo.h"
+
+
+#
+# libsndfile
+#
+ if false; then
+  HAVE_LIBSNDFILE_TRUE=
+  HAVE_LIBSNDFILE_FALSE='#'
+else
+  HAVE_LIBSNDFILE_TRUE='#'
+  HAVE_LIBSNDFILE_FALSE=
+fi
+
+
+# Check whether --with-libsndfile was given.
+if test "${with_libsndfile+set}" = set; then :
+  withval=$with_libsndfile;
+else
+  with_libsndfile=yes
+fi
+
+if test x$with_libsndfile = xyes; then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for SNDFILE" >&5
+$as_echo_n "checking for SNDFILE... " >&6; }
+
+if test -n "$SNDFILE_CFLAGS"; then
+    pkg_cv_SNDFILE_CFLAGS="$SNDFILE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sndfile >= 1.0.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "sndfile >= 1.0.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_SNDFILE_CFLAGS=`$PKG_CONFIG --cflags "sndfile >= 1.0.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$SNDFILE_LIBS"; then
+    pkg_cv_SNDFILE_LIBS="$SNDFILE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sndfile >= 1.0.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "sndfile >= 1.0.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_SNDFILE_LIBS=`$PKG_CONFIG --libs "sndfile >= 1.0.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        SNDFILE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "sndfile >= 1.0.2" 2>&1`
+        else
+	        SNDFILE_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "sndfile >= 1.0.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$SNDFILE_PKG_ERRORS" >&5
+
+	as_fn_error $? "*** libsndfile >= 1.0.2 not found!" "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "*** libsndfile >= 1.0.2 not found!" "$LINENO" 5
+else
+	SNDFILE_CFLAGS=$pkg_cv_SNDFILE_CFLAGS
+	SNDFILE_LIBS=$pkg_cv_SNDFILE_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+fi
+
+$as_echo "#define HAVE_LIBSNDFILE 1" >>confdefs.h
+
+	 if true; then
+  HAVE_LIBSNDFILE_TRUE=
+  HAVE_LIBSNDFILE_FALSE='#'
+else
+  HAVE_LIBSNDFILE_TRUE='#'
+  HAVE_LIBSNDFILE_FALSE=
+fi
+
+fi
+
+
+
+ if false; then
+  HAVE_OSSDSP_TRUE=
+  HAVE_OSSDSP_FALSE='#'
+else
+  HAVE_OSSDSP_TRUE='#'
+  HAVE_OSSDSP_FALSE=
+fi
+
+ if false; then
+  HAVE_DIRECTSOUND_TRUE=
+  HAVE_DIRECTSOUND_FALSE='#'
+else
+  HAVE_DIRECTSOUND_TRUE='#'
+  HAVE_DIRECTSOUND_FALSE=
+fi
+
+ if false; then
+  HAVE_WASAPI_TRUE=
+  HAVE_WASAPI_FALSE='#'
+else
+  HAVE_WASAPI_TRUE='#'
+  HAVE_WASAPI_FALSE=
+fi
+
+ if false; then
+  HAVE_SDL_TRUE=
+  HAVE_SDL_FALSE='#'
+else
+  HAVE_SDL_TRUE='#'
+  HAVE_SDL_FALSE=
+fi
+
+ if false; then
+  DOS_TRUE=
+  DOS_FALSE='#'
+else
+  DOS_TRUE='#'
+  DOS_FALSE=
+fi
+
+ if false; then
+  WIN32_TRUE=
+  WIN32_FALSE='#'
+else
+  WIN32_TRUE='#'
+  WIN32_FALSE=
+fi
+
+ if false; then
+  UNIX_TRUE=
+  UNIX_FALSE='#'
+else
+  UNIX_TRUE='#'
+  UNIX_FALSE=
+fi
+
+ if false; then
+  HAVE_LINUX_JOYSTICK_TRUE=
+  HAVE_LINUX_JOYSTICK_FALSE='#'
+else
+  HAVE_LINUX_JOYSTICK_TRUE='#'
+  HAVE_LINUX_JOYSTICK_FALSE=
+fi
+
+ if false; then
+  ENABLE_LIBXXX_MODE_TRUE=
+  ENABLE_LIBXXX_MODE_FALSE='#'
+else
+  ENABLE_LIBXXX_MODE_TRUE='#'
+  ENABLE_LIBXXX_MODE_FALSE=
+fi
+
+NEED_SDL=true
+
+if $ENABLE_LIBXXX_MODE; then
+	NEED_SDL=false
+
+$as_echo "#define ENABLE_LIBXXX_MODE 1" >>confdefs.h
+
+	 if true; then
+  ENABLE_LIBXXX_MODE_TRUE=
+  ENABLE_LIBXXX_MODE_FALSE='#'
+else
+  ENABLE_LIBXXX_MODE_TRUE='#'
+  ENABLE_LIBXXX_MODE_FALSE=
+fi
+
+fi
+
+if expr x"$host" : 'x.*-mingw*' > /dev/null; then
+	if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}windres", so it can be a program name with args.
+set dummy ${ac_tool_prefix}windres; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_WINDRES+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$WINDRES"; then
+  ac_cv_prog_WINDRES="$WINDRES" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_WINDRES="${ac_tool_prefix}windres"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+WINDRES=$ac_cv_prog_WINDRES
+if test -n "$WINDRES"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $WINDRES" >&5
+$as_echo "$WINDRES" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_WINDRES"; then
+  ac_ct_WINDRES=$WINDRES
+  # Extract the first word of "windres", so it can be a program name with args.
+set dummy windres; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_WINDRES+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_WINDRES"; then
+  ac_cv_prog_ac_ct_WINDRES="$ac_ct_WINDRES" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_WINDRES="windres"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_WINDRES=$ac_cv_prog_ac_ct_WINDRES
+if test -n "$ac_ct_WINDRES"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_WINDRES" >&5
+$as_echo "$ac_ct_WINDRES" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_WINDRES" = x; then
+    WINDRES=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    WINDRES=$ac_ct_WINDRES
+  fi
+else
+  WINDRES="$ac_cv_prog_WINDRES"
+fi
+
+
+	if test x$host_cpu != xx86_64; then
+		# Enable larger address space support(for the 32-bit build).
+		LDFLAGS="$LDFLAGS -Wl,--large-address-aware"
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -march=i686" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -march=i686... " >&6; }
+if ${ax_cv_cflags_gcc_option__march_i686+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__march_i686="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -march=i686"     "-pedantic % -march=i686 %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__march_i686=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__march_i686" >&5
+$as_echo "$ax_cv_cflags_gcc_option__march_i686" >&6; }
+var=$ax_cv_cflags_gcc_option__march_i686
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -mtune=pentium3" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -mtune=pentium3... " >&6; }
+if ${ax_cv_cflags_gcc_option__mtune_pentium3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mtune_pentium3="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mtune=pentium3"     "-pedantic % -mtune=pentium3 %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mtune_pentium3=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mtune_pentium3" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mtune_pentium3" >&6; }
+var=$ax_cv_cflags_gcc_option__mtune_pentium3
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking OPTIMIZER_FLAGS for gcc -mtune=amdfam10" >&5
+$as_echo_n "checking OPTIMIZER_FLAGS for gcc -mtune=amdfam10... " >&6; }
+if ${ax_cv_cflags_gcc_option__mtune_amdfam10+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mtune_amdfam10="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mtune=amdfam10"     "-pedantic % -mtune=amdfam10 %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mtune_amdfam10=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mtune_amdfam10" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mtune_amdfam10" >&6; }
+var=$ax_cv_cflags_gcc_option__mtune_amdfam10
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $OPTIMIZER_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS does contain \$var"; } >&5
+  (: OPTIMIZER_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : OPTIMIZER_FLAGS=\"\$OPTIMIZER_FLAGS \$var\""; } >&5
+  (: OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      OPTIMIZER_FLAGS="$OPTIMIZER_FLAGS $var"
+   fi
+ ;;
+esac
+
+	fi
+
+	# Always build with DirectSound support.
+	 if true; then
+  HAVE_DIRECTSOUND_TRUE=
+  HAVE_DIRECTSOUND_FALSE='#'
+else
+  HAVE_DIRECTSOUND_TRUE='#'
+  HAVE_DIRECTSOUND_FALSE=
+fi
+
+
+$as_echo "#define HAVE_DIRECTSOUND 1" >>confdefs.h
+
+	LIBS="-ldxguid -lwinmm -ldsound $LIBS"
+
+	# Always build with WASAPI support.
+	 if true; then
+  HAVE_WASAPI_TRUE=
+  HAVE_WASAPI_FALSE='#'
+else
+  HAVE_WASAPI_TRUE='#'
+  HAVE_WASAPI_FALSE=
+fi
+
+
+$as_echo "#define HAVE_WASAPI 1" >>confdefs.h
+
+	LIBS="-lole32 $LIBS"
+
+
+$as_echo "#define PSS_STYLE 2" >>confdefs.h
+
+
+$as_echo "#define WIN32 1" >>confdefs.h
+
+	 if true; then
+  WIN32_TRUE=
+  WIN32_FALSE='#'
+else
+  WIN32_TRUE='#'
+  WIN32_FALSE=
+fi
+
+
+	LIBS="-mconsole -lws2_32 -ldxguid -lwinmm -ldinput $LIBS -lwinmm"
+	CPPFLAGS="-D_LFS64_LARGEFILE=1 $CPPFLAGS"
+elif expr x"$host" : 'x.*djgpp' > /dev/null; then
+
+$as_echo "#define PSS_STYLE 2" >>confdefs.h
+
+
+$as_echo "#define DOS 1" >>confdefs.h
+
+       	 if true; then
+  DOS_TRUE=
+  DOS_FALSE='#'
+else
+  DOS_TRUE='#'
+  DOS_FALSE=
+fi
+
+	NEED_SDL=false
+else
+
+$as_echo "#define PSS_STYLE 1" >>confdefs.h
+
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing pthread_create" >&5
+$as_echo_n "checking for library containing pthread_create... " >&6; }
+if ${ac_cv_search_pthread_create+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pthread_create ();
+int
+main ()
+{
+return pthread_create ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' pthread; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_search_pthread_create=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_pthread_create+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_pthread_create+:} false; then :
+
+else
+  ac_cv_search_pthread_create=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_pthread_create" >&5
+$as_echo "$ac_cv_search_pthread_create" >&6; }
+ac_res=$ac_cv_search_pthread_create
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+	for ac_func in pthread_create sem_init
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+else
+  as_fn_error $? "*** pthreads not found!" "$LINENO" 5
+fi
+done
+
+	for ac_func in sem_timedwait sem_timedwait_monotonic pthread_condattr_setclock pthread_setname_np pthread_setaffinity_np pthread_cond_timedwait_relative_np
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+	ac_fn_cxx_check_header_mongrel "$LINENO" "sys/soundcard.h" "ac_cv_header_sys_soundcard_h" "$ac_includes_default"
+if test "x$ac_cv_header_sys_soundcard_h" = xyes; then :
+   if true; then
+  HAVE_OSSDSP_TRUE=
+  HAVE_OSSDSP_FALSE='#'
+else
+  HAVE_OSSDSP_TRUE='#'
+  HAVE_OSSDSP_FALSE=
+fi
+
+$as_echo "#define HAVE_OSSDSP 1" >>confdefs.h
+
+fi
+
+
+	ac_fn_cxx_check_header_mongrel "$LINENO" "linux/joystick.h" "ac_cv_header_linux_joystick_h" "$ac_includes_default"
+if test "x$ac_cv_header_linux_joystick_h" = xyes; then :
+   if true; then
+  HAVE_LINUX_JOYSTICK_TRUE=
+  HAVE_LINUX_JOYSTICK_FALSE='#'
+else
+  HAVE_LINUX_JOYSTICK_TRUE='#'
+  HAVE_LINUX_JOYSTICK_FALSE=
+fi
+
+$as_echo "#define HAVE_LINUX_JOYSTICK 1" >>confdefs.h
+
+fi
+
+
+fi
+
+if $NEED_SDL
+then
+	SDL_VERSION=2.0.5
+
+# Check whether --with-sdl-prefix was given.
+if test "${with_sdl_prefix+set}" = set; then :
+  withval=$with_sdl_prefix; sdl_prefix="$withval"
+else
+  sdl_prefix=""
+fi
+
+
+# Check whether --with-sdl-exec-prefix was given.
+if test "${with_sdl_exec_prefix+set}" = set; then :
+  withval=$with_sdl_exec_prefix; sdl_exec_prefix="$withval"
+else
+  sdl_exec_prefix=""
+fi
+
+# Check whether --enable-sdltest was given.
+if test "${enable_sdltest+set}" = set; then :
+  enableval=$enable_sdltest;
+else
+  enable_sdltest=yes
+fi
+
+# Check whether --enable-sdlframework was given.
+if test "${enable_sdlframework+set}" = set; then :
+  enableval=$enable_sdlframework;
+else
+  search_sdl_framework=yes
+fi
+
+
+
+
+  min_sdl_version=$SDL_VERSION
+
+  if test "x$sdl_prefix$sdl_exec_prefix" = x ; then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for SDL" >&5
+$as_echo_n "checking for SDL... " >&6; }
+
+if test -n "$SDL_CFLAGS"; then
+    pkg_cv_SDL_CFLAGS="$SDL_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sdl2 >= \$min_sdl_version\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "sdl2 >= $min_sdl_version") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_SDL_CFLAGS=`$PKG_CONFIG --cflags "sdl2 >= $min_sdl_version" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$SDL_LIBS"; then
+    pkg_cv_SDL_LIBS="$SDL_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sdl2 >= \$min_sdl_version\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "sdl2 >= $min_sdl_version") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_SDL_LIBS=`$PKG_CONFIG --libs "sdl2 >= $min_sdl_version" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        SDL_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "sdl2 >= $min_sdl_version" 2>&1`
+        else
+	        SDL_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "sdl2 >= $min_sdl_version" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$SDL_PKG_ERRORS" >&5
+
+	sdl_pc=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	sdl_pc=no
+else
+	SDL_CFLAGS=$pkg_cv_SDL_CFLAGS
+	SDL_LIBS=$pkg_cv_SDL_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	sdl_pc=yes
+fi
+  else
+    sdl_pc=no
+    if test x$sdl_exec_prefix != x ; then
+      sdl_config_args="$sdl_config_args --exec-prefix=$sdl_exec_prefix"
+      if test x${SDL2_CONFIG+set} != xset ; then
+        SDL2_CONFIG=$sdl_exec_prefix/bin/sdl2-config
+      fi
+    fi
+    if test x$sdl_prefix != x ; then
+      sdl_config_args="$sdl_config_args --prefix=$sdl_prefix"
+      if test x${SDL2_CONFIG+set} != xset ; then
+        SDL2_CONFIG=$sdl_prefix/bin/sdl2-config
+      fi
+    fi
+  fi
+
+  if test "x$sdl_pc" = xyes ; then
+    no_sdl=""
+    SDL2_CONFIG="pkg-config sdl2"
+  else
+    as_save_PATH="$PATH"
+    if test "x$prefix" != xNONE && test "$cross_compiling" != yes; then
+      PATH="$prefix/bin:$prefix/usr/bin:$PATH"
+    fi
+    # Extract the first word of "sdl2-config", so it can be a program name with args.
+set dummy sdl2-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_SDL2_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $SDL2_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_SDL2_CONFIG="$SDL2_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_SDL2_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  test -z "$ac_cv_path_SDL2_CONFIG" && ac_cv_path_SDL2_CONFIG="no"
+  ;;
+esac
+fi
+SDL2_CONFIG=$ac_cv_path_SDL2_CONFIG
+if test -n "$SDL2_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $SDL2_CONFIG" >&5
+$as_echo "$SDL2_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+    PATH="$as_save_PATH"
+    no_sdl=""
+
+    if test "$SDL2_CONFIG" = "no" -a "x$search_sdl_framework" = "xyes"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SDL2.framework" >&5
+$as_echo_n "checking for SDL2.framework... " >&6; }
+      if test "x$SDL2_FRAMEWORK" != x; then
+        sdl_framework=$SDL2_FRAMEWORK
+      else
+        for d in / ~/ /System/; do
+          if test -d "$dLibrary/Frameworks/SDL2.framework"; then
+            sdl_framework="$dLibrary/Frameworks/SDL2.framework"
+          fi
+        done
+      fi
+
+      if test -d "$sdl_framework"; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $sdl_framework" >&5
+$as_echo "$sdl_framework" >&6; }
+        sdl_framework_dir=`dirname $sdl_framework`
+        SDL_CFLAGS="-F$sdl_framework_dir -Wl,-framework,SDL2 -I$sdl_framework/include"
+        SDL_LIBS="-F$sdl_framework_dir -Wl,-framework,SDL2"
+      else
+        no_sdl=yes
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+      fi
+    fi
+
+    if test "$SDL2_CONFIG" != "no"; then
+      if test "x$sdl_pc" = "xno"; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SDL - version >= $min_sdl_version" >&5
+$as_echo_n "checking for SDL - version >= $min_sdl_version... " >&6; }
+        SDL_CFLAGS=`$SDL2_CONFIG $sdl_config_args --cflags`
+        SDL_LIBS=`$SDL2_CONFIG $sdl_config_args --libs`
+      fi
+
+      sdl_major_version=`$SDL2_CONFIG $sdl_config_args --version | \
+             sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
+      sdl_minor_version=`$SDL2_CONFIG $sdl_config_args --version | \
+             sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\2/'`
+      sdl_micro_version=`$SDL2_CONFIG $sdl_config_args --version | \
+             sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\3/'`
+      if test "x$enable_sdltest" = "xyes" ; then
+        ac_save_CFLAGS="$CFLAGS"
+        ac_save_CXXFLAGS="$CXXFLAGS"
+        ac_save_LIBS="$LIBS"
+        CFLAGS="$CFLAGS $SDL_CFLAGS"
+        CXXFLAGS="$CXXFLAGS $SDL_CFLAGS"
+        LIBS="$LIBS $SDL_LIBS"
+      rm -f conf.sdltest
+      if test "$cross_compiling" = yes; then :
+  echo $ac_n "cross compiling; assumed OK... $ac_c"
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include "SDL.h"
+
+char*
+my_strdup (char *str)
+{
+  char *new_str;
+
+  if (str)
+    {
+      new_str = (char *)malloc ((strlen (str) + 1) * sizeof(char));
+      strcpy (new_str, str);
+    }
+  else
+    new_str = NULL;
+
+  return new_str;
+}
+
+int main (int argc, char *argv[])
+{
+  int major, minor, micro;
+  char *tmp_version;
+
+  /* This hangs on some systems (?)
+  system ("touch conf.sdltest");
+  */
+  { FILE *fp = fopen("conf.sdltest", "a"); if ( fp ) fclose(fp); }
+
+  /* HP/UX 9 (%@#!) writes to sscanf strings */
+  tmp_version = my_strdup("$min_sdl_version");
+  if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
+     printf("%s, bad version string\n", "$min_sdl_version");
+     exit(1);
+   }
+
+   if (($sdl_major_version > major) ||
+      (($sdl_major_version == major) && ($sdl_minor_version > minor)) ||
+      (($sdl_major_version == major) && ($sdl_minor_version == minor) && ($sdl_micro_version >= micro)))
+    {
+      return 0;
+    }
+  else
+    {
+      printf("\n*** 'sdl2-config --version' returned %d.%d.%d, but the minimum version\n", $sdl_major_version, $sdl_minor_version, $sdl_micro_version);
+      printf("*** of SDL required is %d.%d.%d. If sdl2-config is correct, then it is\n", major, minor, micro);
+      printf("*** best to upgrade to the required version.\n");
+      printf("*** If sdl2-config was wrong, set the environment variable SDL2_CONFIG\n");
+      printf("*** to point to the correct copy of sdl2-config, and remove the file\n");
+      printf("*** config.cache before re-running configure\n");
+      return 1;
+    }
+}
+
+
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+
+else
+  no_sdl=yes
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+        CFLAGS="$ac_save_CFLAGS"
+        CXXFLAGS="$ac_save_CXXFLAGS"
+        LIBS="$ac_save_LIBS"
+
+      fi
+      if test "x$sdl_pc" = "xno"; then
+        if test "x$no_sdl" = "xyes"; then
+          { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+        else
+          { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+        fi
+      fi
+    fi
+  fi
+  if test "x$no_sdl" = x ; then
+     HAVE_SDL=true
+  else
+     if test "$SDL2_CONFIG" = "no" ; then
+       echo "*** The sdl2-config script installed by SDL could not be found"
+       echo "*** If SDL was installed in PREFIX, make sure PREFIX/bin is in"
+       echo "*** your path, or set the SDL2_CONFIG environment variable to the"
+       echo "*** full path to sdl2-config."
+     else
+       if test -f conf.sdltest ; then
+        :
+       else
+          echo "*** Could not run SDL test program, checking why..."
+          CFLAGS="$CFLAGS $SDL_CFLAGS"
+          CXXFLAGS="$CXXFLAGS $SDL_CFLAGS"
+          LIBS="$LIBS $SDL_LIBS"
+          cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include "SDL.h"
+
+int main(int argc, char *argv[])
+{ return 0; }
+#undef  main
+#define main K_and_R_C_main
+
+int
+main ()
+{
+ return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+   echo "*** The test program compiled, but did not run. This usually means"
+          echo "*** that the run-time linker is not finding SDL or finding the wrong"
+          echo "*** version of SDL. If it is not finding SDL, you'll need to set your"
+          echo "*** LD_LIBRARY_PATH environment variable, or edit /etc/ld.so.conf to point"
+          echo "*** to the installed location  Also, make sure you have run ldconfig if that"
+          echo "*** is required on your system"
+	  echo "***"
+          echo "*** If you have an old version installed, it is best to remove it, although"
+          echo "*** you may also be able to get things to work by modifying LD_LIBRARY_PATH"
+else
+   echo "*** The test program failed to compile or link. See the file config.log for the"
+          echo "*** exact error that occured. This usually means SDL was incorrectly installed"
+          echo "*** or that you have moved SDL since it was installed. In the latter case, you"
+          echo "*** may want to edit the sdl2-config script: $SDL2_CONFIG"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+          CFLAGS="$ac_save_CFLAGS"
+          CXXFLAGS="$ac_save_CXXFLAGS"
+          LIBS="$ac_save_LIBS"
+       fi
+     fi
+     SDL_CFLAGS=""
+     SDL_LIBS=""
+     HAVE_SDL=false
+  fi
+
+
+  rm -f conf.sdltest
+
+	if $HAVE_SDL
+	then
+		 if true; then
+  HAVE_SDL_TRUE=
+  HAVE_SDL_FALSE='#'
+else
+  HAVE_SDL_TRUE='#'
+  HAVE_SDL_FALSE=
+fi
+
+
+$as_echo "#define HAVE_SDL 1" >>confdefs.h
+
+
+
+	else
+		as_fn_error $? "*** SDL >= 2.0.5 not found!" "$LINENO" 5
+	fi
+fi
+
+
+ if false; then
+  HAVE_POSIX_SOCKETS_TRUE=
+  HAVE_POSIX_SOCKETS_FALSE='#'
+else
+  HAVE_POSIX_SOCKETS_TRUE='#'
+  HAVE_POSIX_SOCKETS_FALSE=
+fi
+
+HAVE_POSIX_SOCKETS=yes
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing gethostbyname" >&5
+$as_echo_n "checking for library containing gethostbyname... " >&6; }
+if ${ac_cv_search_gethostbyname+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char gethostbyname ();
+int
+main ()
+{
+return gethostbyname ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' nsl; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_search_gethostbyname=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_gethostbyname+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_gethostbyname+:} false; then :
+
+else
+  ac_cv_search_gethostbyname=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_gethostbyname" >&5
+$as_echo "$ac_cv_search_gethostbyname" >&6; }
+ac_res=$ac_cv_search_gethostbyname
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing socket" >&5
+$as_echo_n "checking for library containing socket... " >&6; }
+if ${ac_cv_search_socket+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char socket ();
+int
+main ()
+{
+return socket ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' socket network; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_search_socket=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_socket+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_socket+:} false; then :
+
+else
+  ac_cv_search_socket=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_socket" >&5
+$as_echo "$ac_cv_search_socket" >&6; }
+ac_res=$ac_cv_search_socket
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+
+for ac_func in socket bind listen connect accept send recv close gethostbyname gethostbyaddr getaddrinfo freeaddrinfo gai_strerror select poll getsockopt setsockopt
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_cxx_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+else
+  HAVE_POSIX_SOCKETS=no
+fi
+done
+
+
+if test x$HAVE_POSIX_SOCKETS = xyes; then
+	 if true; then
+  HAVE_POSIX_SOCKETS_TRUE=
+  HAVE_POSIX_SOCKETS_FALSE='#'
+else
+  HAVE_POSIX_SOCKETS_TRUE='#'
+  HAVE_POSIX_SOCKETS_FALSE=
+fi
+
+
+$as_echo "#define HAVE_POSIX_SOCKETS 1" >>confdefs.h
+
+fi
+
+ if false; then
+  ARCH_X86_TRUE=
+  ARCH_X86_FALSE='#'
+else
+  ARCH_X86_TRUE='#'
+  ARCH_X86_FALSE=
+fi
+
+ if false; then
+  ARCH_X86_32_TRUE=
+  ARCH_X86_32_FALSE='#'
+else
+  ARCH_X86_32_TRUE='#'
+  ARCH_X86_32_FALSE=
+fi
+
+ if false; then
+  ARCH_X86_64_TRUE=
+  ARCH_X86_64_FALSE='#'
+else
+  ARCH_X86_64_TRUE='#'
+  ARCH_X86_64_FALSE=
+fi
+
+ if false; then
+  ARCH_POWERPC_TRUE=
+  ARCH_POWERPC_FALSE='#'
+else
+  ARCH_POWERPC_TRUE='#'
+  ARCH_POWERPC_FALSE=
+fi
+
+ if false; then
+  ARCH_POWERPC_ALTIVEC_TRUE=
+  ARCH_POWERPC_ALTIVEC_FALSE='#'
+else
+  ARCH_POWERPC_ALTIVEC_TRUE='#'
+  ARCH_POWERPC_ALTIVEC_FALSE=
+fi
+
+
+TRIO_CFLAGS=""
+
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+asm volatile("vcvtss2si %xmm6,%ecx\n\tvhaddps %ymm7,%ymm7,%ymm7\n\tvzeroupper\n\t");
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+
+$as_echo "#define HAVE_INLINEASM_AVX 1" >>confdefs.h
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+case "$host_cpu" in
+	x86_64|amd64)
+
+$as_echo "#define ARCH_X86 1" >>confdefs.h
+
+	         if true; then
+  ARCH_X86_TRUE=
+  ARCH_X86_FALSE='#'
+else
+  ARCH_X86_TRUE='#'
+  ARCH_X86_FALSE=
+fi
+
+
+$as_echo "#define ARCH_X86_64 1" >>confdefs.h
+
+                 if true; then
+  ARCH_X86_64_TRUE=
+  ARCH_X86_64_FALSE='#'
+else
+  ARCH_X86_64_TRUE='#'
+  ARCH_X86_64_FALSE=
+fi
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking CODEGEN_FLAGS for gcc -mcmodel=small" >&5
+$as_echo_n "checking CODEGEN_FLAGS for gcc -mcmodel=small... " >&6; }
+if ${ax_cv_cflags_gcc_option__mcmodel_small+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mcmodel_small="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mcmodel=small"     "-pedantic % -mcmodel=small %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mcmodel_small=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mcmodel_small" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mcmodel_small" >&6; }
+var=$ax_cv_cflags_gcc_option__mcmodel_small
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $CODEGEN_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS does contain \$var"; } >&5
+  (: CODEGEN_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : CODEGEN_FLAGS=\"\$CODEGEN_FLAGS \$var\""; } >&5
+  (: CODEGEN_FLAGS="$CODEGEN_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      CODEGEN_FLAGS="$CODEGEN_FLAGS $var"
+   fi
+ ;;
+esac
+
+		;;
+
+	i*86)
+
+$as_echo "#define ARCH_X86 1" >>confdefs.h
+
+                 if true; then
+  ARCH_X86_TRUE=
+  ARCH_X86_FALSE='#'
+else
+  ARCH_X86_TRUE='#'
+  ARCH_X86_FALSE=
+fi
+
+
+$as_echo "#define ARCH_X86_32 1" >>confdefs.h
+
+                 if true; then
+  ARCH_X86_32_TRUE=
+  ARCH_X86_32_FALSE='#'
+else
+  ARCH_X86_32_TRUE='#'
+  ARCH_X86_32_FALSE=
+fi
+
+		;;
+
+	powerpc)
+
+$as_echo "#define ARCH_POWERPC 1" >>confdefs.h
+
+	         if true; then
+  ARCH_POWERPC_TRUE=
+  ARCH_POWERPC_FALSE='#'
+else
+  ARCH_POWERPC_TRUE='#'
+  ARCH_POWERPC_FALSE=
+fi
+
+
+	        if test x$enable_altivec = xyes; then
+        	        ALTIVEC_FLAGS=""
+                	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking ALTIVEC_FLAGS for gcc -faltivec" >&5
+$as_echo_n "checking ALTIVEC_FLAGS for gcc -faltivec... " >&6; }
+if ${ax_cv_cflags_gcc_option__faltivec+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__faltivec="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -faltivec"     "-pedantic % -faltivec %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__faltivec=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__faltivec" >&5
+$as_echo "$ax_cv_cflags_gcc_option__faltivec" >&6; }
+var=$ax_cv_cflags_gcc_option__faltivec
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $ALTIVEC_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : ALTIVEC_FLAGS does contain \$var"; } >&5
+  (: ALTIVEC_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : ALTIVEC_FLAGS=\"\$ALTIVEC_FLAGS \$var\""; } >&5
+  (: ALTIVEC_FLAGS="$ALTIVEC_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      ALTIVEC_FLAGS="$ALTIVEC_FLAGS $var"
+   fi
+ ;;
+esac
+
+	                { $as_echo "$as_me:${as_lineno-$LINENO}: checking ALTIVEC_FLAGS for gcc -maltivec" >&5
+$as_echo_n "checking ALTIVEC_FLAGS for gcc -maltivec... " >&6; }
+if ${ax_cv_cflags_gcc_option__maltivec+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__maltivec="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -maltivec"     "-pedantic % -maltivec %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__maltivec=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__maltivec" >&5
+$as_echo "$ax_cv_cflags_gcc_option__maltivec" >&6; }
+var=$ax_cv_cflags_gcc_option__maltivec
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $ALTIVEC_FLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : ALTIVEC_FLAGS does contain \$var"; } >&5
+  (: ALTIVEC_FLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : ALTIVEC_FLAGS=\"\$ALTIVEC_FLAGS \$var\""; } >&5
+  (: ALTIVEC_FLAGS="$ALTIVEC_FLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      ALTIVEC_FLAGS="$ALTIVEC_FLAGS $var"
+   fi
+ ;;
+esac
+
+	                if test "x$ALTIVEC_FLAGS" != "x"; then
+
+$as_echo "#define ARCH_POWERPC_ALTIVEC 1" >>confdefs.h
+
+                	         if true; then
+  ARCH_POWERPC_ALTIVEC_TRUE=
+  ARCH_POWERPC_ALTIVEC_FALSE='#'
+else
+  ARCH_POWERPC_ALTIVEC_TRUE='#'
+  ARCH_POWERPC_ALTIVEC_FALSE=
+fi
+
+
+				altivec_save_CPPFLAGS="$CPPFLAGS"
+				CPPFLAGS="$CPPFLAGS $ALTIVEC_FLAGS"
+				ac_fn_cxx_check_header_mongrel "$LINENO" "altivec.h" "ac_cv_header_altivec_h" "$ac_includes_default"
+if test "x$ac_cv_header_altivec_h" = xyes; then :
+
+$as_echo "#define HAVE_ALTIVEC_H 1" >>confdefs.h
+
+fi
+
+
+				CPPFLAGS="$altivec_save_CPPFLAGS"
+	                fi
+	        fi
+		;;
+
+	alpha*)
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking TRIO_CFLAGS for gcc -mieee" >&5
+$as_echo_n "checking TRIO_CFLAGS for gcc -mieee... " >&6; }
+if ${ax_cv_cflags_gcc_option__mieee+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ax_cv_cflags_gcc_option__mieee="no, unknown"
+
+ ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+ ac_save_CFLAGS="$CFLAGS"
+for ac_arg in "-pedantic -Werror % -mieee"     "-pedantic % -mieee %% no, obsolete"     #
+do CFLAGS="$ac_save_CFLAGS "`echo $ac_arg | sed -e 's,%%.*,,' -e 's,%,,'`
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ax_cv_cflags_gcc_option__mieee=`echo $ac_arg | sed -e 's,.*% *,,'`; break
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+ CFLAGS="$ac_save_CFLAGS"
+ ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ax_cv_cflags_gcc_option__mieee" >&5
+$as_echo "$ax_cv_cflags_gcc_option__mieee" >&6; }
+var=$ax_cv_cflags_gcc_option__mieee
+case ".$var" in
+     .ok|.ok,*)  ;;
+   .|.no|.no,*)  ;;
+   *)
+   if echo " $TRIO_CFLAGS " | grep " $var " 2>&1 >/dev/null
+   then { { $as_echo "$as_me:${as_lineno-$LINENO}: : TRIO_CFLAGS does contain \$var"; } >&5
+  (: TRIO_CFLAGS does contain $var) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+   else { { $as_echo "$as_me:${as_lineno-$LINENO}: : TRIO_CFLAGS=\"\$TRIO_CFLAGS \$var\""; } >&5
+  (: TRIO_CFLAGS="$TRIO_CFLAGS $var") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+                      TRIO_CFLAGS="$TRIO_CFLAGS $var"
+   fi
+ ;;
+esac
+
+		;;
+esac
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether byte ordering is bigendian" >&5
+$as_echo_n "checking whether byte ordering is bigendian... " >&6; }
+if ${ac_cv_c_bigendian+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_c_bigendian=unknown
+    # See if we're dealing with a universal compiler.
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifndef __APPLE_CC__
+	       not a universal capable compiler
+	     #endif
+	     typedef int dummy;
+
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+
+	# Check for potential -arch flags.  It is not universal unless
+	# there are at least two -arch flags with different values.
+	ac_arch=
+	ac_prev=
+	for ac_word in $CC $CFLAGS $CPPFLAGS $LDFLAGS; do
+	 if test -n "$ac_prev"; then
+	   case $ac_word in
+	     i?86 | x86_64 | ppc | ppc64)
+	       if test -z "$ac_arch" || test "$ac_arch" = "$ac_word"; then
+		 ac_arch=$ac_word
+	       else
+		 ac_cv_c_bigendian=universal
+		 break
+	       fi
+	       ;;
+	   esac
+	   ac_prev=
+	 elif test "x$ac_word" = "x-arch"; then
+	   ac_prev=arch
+	 fi
+       done
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    if test $ac_cv_c_bigendian = unknown; then
+      # See if sys/param.h defines the BYTE_ORDER macro.
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+	     #include <sys/param.h>
+
+int
+main ()
+{
+#if ! (defined BYTE_ORDER && defined BIG_ENDIAN \
+		     && defined LITTLE_ENDIAN && BYTE_ORDER && BIG_ENDIAN \
+		     && LITTLE_ENDIAN)
+	      bogus endian macros
+	     #endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  # It does; now see whether it defined to BIG_ENDIAN or not.
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+		#include <sys/param.h>
+
+int
+main ()
+{
+#if BYTE_ORDER != BIG_ENDIAN
+		 not big endian
+		#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_c_bigendian=yes
+else
+  ac_cv_c_bigendian=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    fi
+    if test $ac_cv_c_bigendian = unknown; then
+      # See if <limits.h> defines _LITTLE_ENDIAN or _BIG_ENDIAN (e.g., Solaris).
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <limits.h>
+
+int
+main ()
+{
+#if ! (defined _LITTLE_ENDIAN || defined _BIG_ENDIAN)
+	      bogus endian macros
+	     #endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  # It does; now see whether it defined to _BIG_ENDIAN or not.
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <limits.h>
+
+int
+main ()
+{
+#ifndef _BIG_ENDIAN
+		 not big endian
+		#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_c_bigendian=yes
+else
+  ac_cv_c_bigendian=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    fi
+    if test $ac_cv_c_bigendian = unknown; then
+      # Compile a test program.
+      if test "$cross_compiling" = yes; then :
+  # Try to guess by grepping values from an object file.
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+short int ascii_mm[] =
+		  { 0x4249, 0x4765, 0x6E44, 0x6961, 0x6E53, 0x7953, 0 };
+		short int ascii_ii[] =
+		  { 0x694C, 0x5454, 0x656C, 0x6E45, 0x6944, 0x6E61, 0 };
+		int use_ascii (int i) {
+		  return ascii_mm[i] + ascii_ii[i];
+		}
+		short int ebcdic_ii[] =
+		  { 0x89D3, 0xE3E3, 0x8593, 0x95C5, 0x89C4, 0x9581, 0 };
+		short int ebcdic_mm[] =
+		  { 0xC2C9, 0xC785, 0x95C4, 0x8981, 0x95E2, 0xA8E2, 0 };
+		int use_ebcdic (int i) {
+		  return ebcdic_mm[i] + ebcdic_ii[i];
+		}
+		extern int foo;
+
+int
+main ()
+{
+return use_ascii (foo) == use_ebcdic (foo);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  if grep BIGenDianSyS conftest.$ac_objext >/dev/null; then
+	      ac_cv_c_bigendian=yes
+	    fi
+	    if grep LiTTleEnDian conftest.$ac_objext >/dev/null ; then
+	      if test "$ac_cv_c_bigendian" = unknown; then
+		ac_cv_c_bigendian=no
+	      else
+		# finding both strings is unlikely to happen, but who knows?
+		ac_cv_c_bigendian=unknown
+	      fi
+	    fi
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$ac_includes_default
+int
+main ()
+{
+
+	     /* Are we little or big endian?  From Harbison&Steele.  */
+	     union
+	     {
+	       long int l;
+	       char c[sizeof (long int)];
+	     } u;
+	     u.l = 1;
+	     return u.c[sizeof (long int) - 1] == 1;
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_run "$LINENO"; then :
+  ac_cv_c_bigendian=no
+else
+  ac_cv_c_bigendian=yes
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+    fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_bigendian" >&5
+$as_echo "$ac_cv_c_bigendian" >&6; }
+ case $ac_cv_c_bigendian in #(
+   yes)
+
+$as_echo "#define MSB_FIRST 1" >>confdefs.h
+;; #(
+   no)
+
+
+$as_echo "#define LSB_FIRST 1" >>confdefs.h
+
+ ;; #(
+   universal)
+
+$as_echo "#define AC_APPLE_UNIVERSAL_BUILD 1" >>confdefs.h
+
+     ;; #(
+   *)
+     as_fn_error $? "unknown endianness
+ presetting ac_cv_c_bigendian=no (or yes) will help" "$LINENO" 5 ;;
+ esac
+
+
+cat >>confdefs.h <<_ACEOF
+#define MEDNAFEN_VERSION "$MEDNAFEN_VERSION"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define MEDNAFEN_VERSION_NUMERIC $MEDNAFEN_VERSION_NUMERIC
+_ACEOF
+
+
+AM_CFLAGS="$ALTIVEC_FLAGS $OPTIMIZER_FLAGS $WARNING_FLAGS $CODEGEN_FLAGS $CODEGEN_CFLAGS"
+
+AM_CXXFLAGS="$ALTIVEC_FLAGS $OPTIMIZER_FLAGS $WARNING_FLAGS $CODEGEN_FLAGS $CODEGEN_CXXFLAGS"
+
+
+ac_config_files="$ac_config_files Makefile po/Makefile.in intl/Makefile src/Makefile src/drivers/Makefile src/drivers_libxxx/Makefile src/drivers_dos/Makefile src/sexyal/Makefile src/ss/Makefile"
+
+cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, we kill variables containing newlines.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(
+  for ac_var in `(set) 2>&1 | sed -n 's/^\([a-zA-Z_][a-zA-Z0-9_]*\)=.*/\1/p'`; do
+    eval ac_val=\$$ac_var
+    case $ac_val in #(
+    *${as_nl}*)
+      case $ac_var in #(
+      *_cv_*) { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cache variable $ac_var contains a newline" >&5
+$as_echo "$as_me: WARNING: cache variable $ac_var contains a newline" >&2;} ;;
+      esac
+      case $ac_var in #(
+      _ | IFS | as_nl) ;; #(
+      BASH_ARGV | BASH_SOURCE) eval $ac_var= ;; #(
+      *) { eval $ac_var=; unset $ac_var;} ;;
+      esac ;;
+    esac
+  done
+
+  (set) 2>&1 |
+    case $as_nl`(ac_space=' '; set) 2>&1` in #(
+    *${as_nl}ac_space=\ *)
+      # `set' does not quote correctly, so add quotes: double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \.
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;; #(
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n "/^[_$as_cr_alnum]*_cv_[_$as_cr_alnum]*=/p"
+      ;;
+    esac |
+    sort
+) |
+  sed '
+     /^ac_cv_env_/b end
+     t clear
+     :clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     :end' >>confcache
+if diff "$cache_file" confcache >/dev/null 2>&1; then :; else
+  if test -w "$cache_file"; then
+    if test "x$cache_file" != "x/dev/null"; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: updating cache $cache_file" >&5
+$as_echo "$as_me: updating cache $cache_file" >&6;}
+      if test ! -f "$cache_file" || test -h "$cache_file"; then
+	cat confcache >"$cache_file"
+      else
+        case $cache_file in #(
+        */* | ?:*)
+	  mv -f confcache "$cache_file"$$ &&
+	  mv -f "$cache_file"$$ "$cache_file" ;; #(
+        *)
+	  mv -f confcache "$cache_file" ;;
+	esac
+      fi
+    fi
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: not updating unwritable cache $cache_file" >&5
+$as_echo "$as_me: not updating unwritable cache $cache_file" >&6;}
+  fi
+fi
+rm -f confcache
+
+test "x$prefix" = xNONE && prefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
+
+DEFS=-DHAVE_CONFIG_H
+
+ac_libobjs=
+ac_ltlibobjs=
+U=
+for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
+  # 1. Remove the extension, and $U if already installed.
+  ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
+  ac_i=`$as_echo "$ac_i" | sed "$ac_script"`
+  # 2. Prepend LIBOBJDIR.  When used with automake>=1.10 LIBOBJDIR
+  #    will be set to the directory where LIBOBJS objects are built.
+  as_fn_append ac_libobjs " \${LIBOBJDIR}$ac_i\$U.$ac_objext"
+  as_fn_append ac_ltlibobjs " \${LIBOBJDIR}$ac_i"'$U.lo'
+done
+LIBOBJS=$ac_libobjs
+
+LTLIBOBJS=$ac_ltlibobjs
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking that generated files are newer than configure" >&5
+$as_echo_n "checking that generated files are newer than configure... " >&6; }
+   if test -n "$am_sleep_pid"; then
+     # Hide warnings about reused PIDs.
+     wait $am_sleep_pid 2>/dev/null
+   fi
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: done" >&5
+$as_echo "done" >&6; }
+if test -z "${AMDEP_TRUE}" && test -z "${AMDEP_FALSE}"; then
+  as_fn_error $? "conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${am__fastdepCC_TRUE}" && test -z "${am__fastdepCC_FALSE}"; then
+  as_fn_error $? "conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+ if test -n "$EXEEXT"; then
+  am__EXEEXT_TRUE=
+  am__EXEEXT_FALSE='#'
+else
+  am__EXEEXT_TRUE='#'
+  am__EXEEXT_FALSE=
+fi
+
+if test -z "${am__fastdepCCAS_TRUE}" && test -z "${am__fastdepCCAS_FALSE}"; then
+  as_fn_error $? "conditional \"am__fastdepCCAS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${am__fastdepCXX_TRUE}" && test -z "${am__fastdepCXX_FALSE}"; then
+  as_fn_error $? "conditional \"am__fastdepCXX\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_DEBUGGER_TRUE}" && test -z "${WANT_DEBUGGER_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_DEBUGGER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_FANCY_SCALERS_TRUE}" && test -z "${WANT_FANCY_SCALERS_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_FANCY_SCALERS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_DEBUGGER_TRUE}" && test -z "${WANT_DEBUGGER_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_DEBUGGER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_FANCY_SCALERS_TRUE}" && test -z "${WANT_FANCY_SCALERS_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_FANCY_SCALERS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_APPLE2_EMU_TRUE}" && test -z "${WANT_APPLE2_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_APPLE2_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_GB_EMU_TRUE}" && test -z "${WANT_GB_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_GB_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_GBA_EMU_TRUE}" && test -z "${WANT_GBA_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_GBA_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_LYNX_EMU_TRUE}" && test -z "${WANT_LYNX_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_LYNX_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_MD_EMU_TRUE}" && test -z "${WANT_MD_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_MD_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SMS_EMU_TRUE}" && test -z "${WANT_SMS_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SMS_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_NES_EMU_TRUE}" && test -z "${WANT_NES_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_NES_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_NES_NEW_EMU_TRUE}" && test -z "${WANT_NES_NEW_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_NES_NEW_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_NGP_EMU_TRUE}" && test -z "${WANT_NGP_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_NGP_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PCE_EMU_TRUE}" && test -z "${WANT_PCE_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PCE_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PCE_FAST_EMU_TRUE}" && test -z "${WANT_PCE_FAST_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PCE_FAST_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PCFX_EMU_TRUE}" && test -z "${WANT_PCFX_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PCFX_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PSX_EMU_TRUE}" && test -z "${WANT_PSX_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PSX_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SMS_EMU_TRUE}" && test -z "${WANT_SMS_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SMS_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SNES_EMU_TRUE}" && test -z "${WANT_SNES_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SNES_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SNES_FAUST_EMU_TRUE}" && test -z "${WANT_SNES_FAUST_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SNES_FAUST_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SS_EMU_TRUE}" && test -z "${WANT_SS_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SS_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SSFPLAY_EMU_TRUE}" && test -z "${WANT_SSFPLAY_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SSFPLAY_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_VB_EMU_TRUE}" && test -z "${WANT_VB_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_VB_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_WSWAN_EMU_TRUE}" && test -z "${WANT_WSWAN_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_WSWAN_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_GB_APU_EMU_TRUE}" && test -z "${NEED_GB_APU_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_GB_APU_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_YM2413_EMU_TRUE}" && test -z "${NEED_YM2413_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_YM2413_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_YM2612_EMU_TRUE}" && test -z "${NEED_YM2612_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_YM2612_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_PCE_PSG_EMU_TRUE}" && test -z "${NEED_PCE_PSG_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_PCE_PSG_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_SMS_APU_EMU_TRUE}" && test -z "${NEED_SMS_APU_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_SMS_APU_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_68K_EMU_TRUE}" && test -z "${NEED_68K_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_68K_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_Z80_EMU_TRUE}" && test -z "${NEED_Z80_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_Z80_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_V810_EMU_TRUE}" && test -z "${NEED_V810_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_V810_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_HUC6270_EMU_TRUE}" && test -z "${NEED_HUC6270_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_HUC6270_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_ARCADE_CARD_EMU_TRUE}" && test -z "${NEED_ARCADE_CARD_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_ARCADE_CARD_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_APPLE2_EMU_TRUE}" && test -z "${WANT_APPLE2_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_APPLE2_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_GB_EMU_TRUE}" && test -z "${WANT_GB_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_GB_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_GB_APU_EMU_TRUE}" && test -z "${NEED_GB_APU_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_GB_APU_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_GBA_EMU_TRUE}" && test -z "${WANT_GBA_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_GBA_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_GB_APU_EMU_TRUE}" && test -z "${NEED_GB_APU_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_GB_APU_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_LYNX_EMU_TRUE}" && test -z "${WANT_LYNX_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_LYNX_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_MD_EMU_TRUE}" && test -z "${WANT_MD_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_MD_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_68K_EMU_TRUE}" && test -z "${NEED_68K_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_68K_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_Z80_EMU_TRUE}" && test -z "${NEED_Z80_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_Z80_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_YM2612_EMU_TRUE}" && test -z "${NEED_YM2612_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_YM2612_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_SMS_APU_EMU_TRUE}" && test -z "${NEED_SMS_APU_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_SMS_APU_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_NES_EMU_TRUE}" && test -z "${WANT_NES_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_NES_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_NGP_EMU_TRUE}" && test -z "${WANT_NGP_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_NGP_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_Z80_EMU_TRUE}" && test -z "${NEED_Z80_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_Z80_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PCE_EMU_TRUE}" && test -z "${WANT_PCE_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PCE_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_PCE_PSG_EMU_TRUE}" && test -z "${NEED_PCE_PSG_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_PCE_PSG_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_HUC6270_EMU_TRUE}" && test -z "${NEED_HUC6270_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_HUC6270_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_ARCADE_CARD_EMU_TRUE}" && test -z "${NEED_ARCADE_CARD_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_ARCADE_CARD_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PCE_FAST_EMU_TRUE}" && test -z "${WANT_PCE_FAST_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PCE_FAST_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_ARCADE_CARD_EMU_TRUE}" && test -z "${NEED_ARCADE_CARD_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_ARCADE_CARD_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PCFX_EMU_TRUE}" && test -z "${WANT_PCFX_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PCFX_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_V810_EMU_TRUE}" && test -z "${NEED_V810_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_V810_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_PCE_PSG_EMU_TRUE}" && test -z "${NEED_PCE_PSG_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_PCE_PSG_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_HUC6270_EMU_TRUE}" && test -z "${NEED_HUC6270_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_HUC6270_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_PSX_EMU_TRUE}" && test -z "${WANT_PSX_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_PSX_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SMS_EMU_TRUE}" && test -z "${WANT_SMS_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SMS_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_Z80_EMU_TRUE}" && test -z "${NEED_Z80_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_Z80_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_SMS_APU_EMU_TRUE}" && test -z "${NEED_SMS_APU_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_SMS_APU_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_YM2413_EMU_TRUE}" && test -z "${NEED_YM2413_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_YM2413_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SNES_EMU_TRUE}" && test -z "${WANT_SNES_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SNES_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SNES_FAUST_EMU_TRUE}" && test -z "${WANT_SNES_FAUST_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SNES_FAUST_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SS_EMU_TRUE}" && test -z "${WANT_SS_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SS_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_68K_EMU_TRUE}" && test -z "${NEED_68K_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_68K_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_SSFPLAY_EMU_TRUE}" && test -z "${WANT_SSFPLAY_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_SSFPLAY_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_68K_EMU_TRUE}" && test -z "${NEED_68K_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_68K_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_VB_EMU_TRUE}" && test -z "${WANT_VB_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_VB_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_V810_EMU_TRUE}" && test -z "${NEED_V810_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_V810_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WANT_WSWAN_EMU_TRUE}" && test -z "${WANT_WSWAN_EMU_FALSE}"; then
+  as_fn_error $? "conditional \"WANT_WSWAN_EMU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${NEED_BLIP_BUFFER_TRUE}" && test -z "${NEED_BLIP_BUFFER_FALSE}"; then
+  as_fn_error $? "conditional \"NEED_BLIP_BUFFER\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_ALSA_TRUE}" && test -z "${HAVE_ALSA_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_ALSA\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_ALSA_TRUE}" && test -z "${HAVE_ALSA_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_ALSA\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_JACK_TRUE}" && test -z "${HAVE_JACK_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_JACK\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_JACK_TRUE}" && test -z "${HAVE_JACK_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_JACK\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_OPENBSD_AUDIO_TRUE}" && test -z "${HAVE_OPENBSD_AUDIO_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_OPENBSD_AUDIO\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_OPENBSD_AUDIO_TRUE}" && test -z "${HAVE_OPENBSD_AUDIO_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_OPENBSD_AUDIO\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_MPCDEC_TRUE}" && test -z "${HAVE_EXTERNAL_MPCDEC_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_MPCDEC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_MPCDEC_TRUE}" && test -z "${HAVE_EXTERNAL_MPCDEC_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_MPCDEC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_TREMOR_TRUE}" && test -z "${HAVE_EXTERNAL_TREMOR_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_TREMOR\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_TREMOR_TRUE}" && test -z "${HAVE_EXTERNAL_TREMOR_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_TREMOR\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_TRIO_TRUE}" && test -z "${HAVE_EXTERNAL_TRIO_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_TRIO\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_TRIO_TRUE}" && test -z "${HAVE_EXTERNAL_TRIO_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_TRIO\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_LZO2_TRUE}" && test -z "${HAVE_EXTERNAL_LZO2_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_LZO2\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_EXTERNAL_LZO2_TRUE}" && test -z "${HAVE_EXTERNAL_LZO2_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_EXTERNAL_LZO2\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_LIBSNDFILE_TRUE}" && test -z "${HAVE_LIBSNDFILE_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_LIBSNDFILE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_LIBSNDFILE_TRUE}" && test -z "${HAVE_LIBSNDFILE_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_LIBSNDFILE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_OSSDSP_TRUE}" && test -z "${HAVE_OSSDSP_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_OSSDSP\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_DIRECTSOUND_TRUE}" && test -z "${HAVE_DIRECTSOUND_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_DIRECTSOUND\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_WASAPI_TRUE}" && test -z "${HAVE_WASAPI_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_WASAPI\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_SDL_TRUE}" && test -z "${HAVE_SDL_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_SDL\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${DOS_TRUE}" && test -z "${DOS_FALSE}"; then
+  as_fn_error $? "conditional \"DOS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WIN32_TRUE}" && test -z "${WIN32_FALSE}"; then
+  as_fn_error $? "conditional \"WIN32\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${UNIX_TRUE}" && test -z "${UNIX_FALSE}"; then
+  as_fn_error $? "conditional \"UNIX\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_LINUX_JOYSTICK_TRUE}" && test -z "${HAVE_LINUX_JOYSTICK_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_LINUX_JOYSTICK\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ENABLE_LIBXXX_MODE_TRUE}" && test -z "${ENABLE_LIBXXX_MODE_FALSE}"; then
+  as_fn_error $? "conditional \"ENABLE_LIBXXX_MODE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ENABLE_LIBXXX_MODE_TRUE}" && test -z "${ENABLE_LIBXXX_MODE_FALSE}"; then
+  as_fn_error $? "conditional \"ENABLE_LIBXXX_MODE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_DIRECTSOUND_TRUE}" && test -z "${HAVE_DIRECTSOUND_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_DIRECTSOUND\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_WASAPI_TRUE}" && test -z "${HAVE_WASAPI_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_WASAPI\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${WIN32_TRUE}" && test -z "${WIN32_FALSE}"; then
+  as_fn_error $? "conditional \"WIN32\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${DOS_TRUE}" && test -z "${DOS_FALSE}"; then
+  as_fn_error $? "conditional \"DOS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_OSSDSP_TRUE}" && test -z "${HAVE_OSSDSP_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_OSSDSP\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_LINUX_JOYSTICK_TRUE}" && test -z "${HAVE_LINUX_JOYSTICK_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_LINUX_JOYSTICK\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_SDL_TRUE}" && test -z "${HAVE_SDL_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_SDL\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_POSIX_SOCKETS_TRUE}" && test -z "${HAVE_POSIX_SOCKETS_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_POSIX_SOCKETS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${HAVE_POSIX_SOCKETS_TRUE}" && test -z "${HAVE_POSIX_SOCKETS_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_POSIX_SOCKETS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_TRUE}" && test -z "${ARCH_X86_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_32_TRUE}" && test -z "${ARCH_X86_32_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86_32\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_64_TRUE}" && test -z "${ARCH_X86_64_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86_64\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_POWERPC_TRUE}" && test -z "${ARCH_POWERPC_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_POWERPC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_POWERPC_ALTIVEC_TRUE}" && test -z "${ARCH_POWERPC_ALTIVEC_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_POWERPC_ALTIVEC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_TRUE}" && test -z "${ARCH_X86_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_64_TRUE}" && test -z "${ARCH_X86_64_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86_64\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_TRUE}" && test -z "${ARCH_X86_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_X86_32_TRUE}" && test -z "${ARCH_X86_32_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_X86_32\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_POWERPC_TRUE}" && test -z "${ARCH_POWERPC_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_POWERPC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${ARCH_POWERPC_ALTIVEC_TRUE}" && test -z "${ARCH_POWERPC_ALTIVEC_FALSE}"; then
+  as_fn_error $? "conditional \"ARCH_POWERPC_ALTIVEC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+
+
+: "${CONFIG_STATUS=./config.status}"
+ac_write_fail=0
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files $CONFIG_STATUS"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: creating $CONFIG_STATUS" >&5
+$as_echo "$as_me: creating $CONFIG_STATUS" >&6;}
+as_write_fail=0
+cat >$CONFIG_STATUS <<_ASEOF || as_write_fail=1
+#! $SHELL
+# Generated by $as_me.
+# Run this file to recreate the current configuration.
+# Compiler output produced by configure, useful for debugging
+# configure, is in config.log if it exists.
+
+debug=false
+ac_cs_recheck=false
+ac_cs_silent=false
+
+SHELL=\${CONFIG_SHELL-$SHELL}
+export SHELL
+_ASEOF
+cat >>$CONFIG_STATUS <<\_ASEOF || as_write_fail=1
+## -------------------- ##
+## M4sh Initialization. ##
+## -------------------- ##
+
+# Be more Bourne compatible
+DUALCASE=1; export DUALCASE # for MKS sh
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
+  emulate sh
+  NULLCMD=:
+  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+"$@"}'='"$@"'
+  setopt NO_GLOB_SUBST
+else
+  case `(set -o) 2>/dev/null` in #(
+  *posix*) :
+    set -o posix ;; #(
+  *) :
+     ;;
+esac
+fi
+
+
+as_nl='
+'
+export as_nl
+# Printing a long string crashes Solaris 7 /usr/bin/printf.
+as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
+as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
+# Prefer a ksh shell builtin over an external printf program on Solaris,
+# but without wasting forks for bash or zsh.
+if test -z "$BASH_VERSION$ZSH_VERSION" \
+    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='print -r --'
+  as_echo_n='print -rn --'
+elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
+  as_echo='printf %s\n'
+  as_echo_n='printf %s'
+else
+  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
+    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
+    as_echo_n='/usr/ucb/echo -n'
+  else
+    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
+    as_echo_n_body='eval
+      arg=$1;
+      case $arg in #(
+      *"$as_nl"*)
+	expr "X$arg" : "X\\(.*\\)$as_nl";
+	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
+      esac;
+      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
+    '
+    export as_echo_n_body
+    as_echo_n='sh -c $as_echo_n_body as_echo'
+  fi
+  export as_echo_body
+  as_echo='sh -c $as_echo_body as_echo'
+fi
+
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  PATH_SEPARATOR=:
+  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
+    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
+      PATH_SEPARATOR=';'
+  }
+fi
+
+
+# IFS
+# We need space, tab and new line, in precisely that order.  Quoting is
+# there to prevent editors from complaining about space-tab.
+# (If _AS_PATH_WALK were called with IFS unset, it would disable word
+# splitting by setting IFS to empty value.)
+IFS=" ""	$as_nl"
+
+# Find who we are.  Look in the path if we contain no directory separator.
+as_myself=
+case $0 in #((
+  *[\\/]* ) as_myself=$0 ;;
+  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+  done
+IFS=$as_save_IFS
+
+     ;;
+esac
+# We did not find ourselves, most probably we were run as `sh COMMAND'
+# in which case we are not to be found in the path.
+if test "x$as_myself" = x; then
+  as_myself=$0
+fi
+if test ! -f "$as_myself"; then
+  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
+  exit 1
+fi
+
+# Unset variables that we do not need and which cause bugs (e.g. in
+# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
+# suppresses any "Segmentation fault" message there.  '((' could
+# trigger a bug in pdksh 5.2.14.
+for as_var in BASH_ENV ENV MAIL MAILPATH
+do eval test x\${$as_var+set} = xset \
+  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
+done
+PS1='$ '
+PS2='> '
+PS4='+ '
+
+# NLS nuisances.
+LC_ALL=C
+export LC_ALL
+LANGUAGE=C
+export LANGUAGE
+
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
+# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
+# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
+# script with STATUS, using 1 if that was 0.
+as_fn_error ()
+{
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
+  fi
+  $as_echo "$as_me: error: $2" >&2
+  as_fn_exit $as_status
+} # as_fn_error
+
+
+# as_fn_set_status STATUS
+# -----------------------
+# Set $? to STATUS, without forking.
+as_fn_set_status ()
+{
+  return $1
+} # as_fn_set_status
+
+# as_fn_exit STATUS
+# -----------------
+# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
+as_fn_exit ()
+{
+  set +e
+  as_fn_set_status $1
+  exit $1
+} # as_fn_exit
+
+# as_fn_unset VAR
+# ---------------
+# Portably unset VAR.
+as_fn_unset ()
+{
+  { eval $1=; unset $1;}
+}
+as_unset=as_fn_unset
+# as_fn_append VAR VALUE
+# ----------------------
+# Append the text in VALUE to the end of the definition contained in VAR. Take
+# advantage of any shell optimizations that allow amortized linear growth over
+# repeated appends, instead of the typical quadratic growth present in naive
+# implementations.
+if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
+  eval 'as_fn_append ()
+  {
+    eval $1+=\$2
+  }'
+else
+  as_fn_append ()
+  {
+    eval $1=\$$1\$2
+  }
+fi # as_fn_append
+
+# as_fn_arith ARG...
+# ------------------
+# Perform arithmetic evaluation on the ARGs, and store the result in the
+# global $as_val. Take advantage of shells that can avoid forks. The arguments
+# must be portable across $(()) and expr.
+if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
+  eval 'as_fn_arith ()
+  {
+    as_val=$(( $* ))
+  }'
+else
+  as_fn_arith ()
+  {
+    as_val=`expr "$@" || test $? -eq 1`
+  }
+fi # as_fn_arith
+
+
+if expr a : '\(a\)' >/dev/null 2>&1 &&
+   test "X`expr 00001 : '.*\(...\)'`" = X001; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
+fi
+
+if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
+  as_dirname=dirname
+else
+  as_dirname=false
+fi
+
+as_me=`$as_basename -- "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\/\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+ECHO_C= ECHO_N= ECHO_T=
+case `echo -n x` in #(((((
+-n*)
+  case `echo 'xy\c'` in
+  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
+  xy)  ECHO_C='\c';;
+  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
+       ECHO_T='	';;
+  esac;;
+*)
+  ECHO_N='-n';;
+esac
+
+rm -f conf$$ conf$$.exe conf$$.file
+if test -d conf$$.dir; then
+  rm -f conf$$.dir/conf$$.file
+else
+  rm -f conf$$.dir
+  mkdir conf$$.dir 2>/dev/null
+fi
+if (echo >conf$$.file) 2>/dev/null; then
+  if ln -s conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s='ln -s'
+    # ... but there are two gotchas:
+    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
+    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
+    # In both cases, we have to default to `cp -pR'.
+    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
+      as_ln_s='cp -pR'
+  elif ln conf$$.file conf$$ 2>/dev/null; then
+    as_ln_s=ln
+  else
+    as_ln_s='cp -pR'
+  fi
+else
+  as_ln_s='cp -pR'
+fi
+rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
+rmdir conf$$.dir 2>/dev/null
+
+
+# as_fn_mkdir_p
+# -------------
+# Create "$as_dir" as a directory, including parents if necessary.
+as_fn_mkdir_p ()
+{
+
+  case $as_dir in #(
+  -*) as_dir=./$as_dir;;
+  esac
+  test -d "$as_dir" || eval $as_mkdir_p || {
+    as_dirs=
+    while :; do
+      case $as_dir in #(
+      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
+      *) as_qdir=$as_dir;;
+      esac
+      as_dirs="'$as_qdir' $as_dirs"
+      as_dir=`$as_dirname -- "$as_dir" ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      test -d "$as_dir" && break
+    done
+    test -z "$as_dirs" || eval "mkdir $as_dirs"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
+
+
+} # as_fn_mkdir_p
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p='mkdir -p "$as_dir"'
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
+fi
+
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
+
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+
+
+exec 6>&1
+## ----------------------------------- ##
+## Main body of $CONFIG_STATUS script. ##
+## ----------------------------------- ##
+_ASEOF
+test $as_write_fail = 0 && chmod +x $CONFIG_STATUS || ac_write_fail=1
+
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# Save the log message, to keep $0 and so on meaningful, and to
+# report actual input values of CONFIG_FILES etc. instead of their
+# values after options handling.
+ac_log="
+This file was extended by $as_me, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
+
+  CONFIG_FILES    = $CONFIG_FILES
+  CONFIG_HEADERS  = $CONFIG_HEADERS
+  CONFIG_LINKS    = $CONFIG_LINKS
+  CONFIG_COMMANDS = $CONFIG_COMMANDS
+  $ $0 $@
+
+on `(hostname || uname -n) 2>/dev/null | sed 1q`
+"
+
+_ACEOF
+
+case $ac_config_files in *"
+"*) set x $ac_config_files; shift; ac_config_files=$*;;
+esac
+
+case $ac_config_headers in *"
+"*) set x $ac_config_headers; shift; ac_config_headers=$*;;
+esac
+
+
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+# Files that config.status was made for.
+config_files="$ac_config_files"
+config_headers="$ac_config_headers"
+config_links="$ac_config_links"
+config_commands="$ac_config_commands"
+
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+ac_cs_usage="\
+\`$as_me' instantiates files and other configuration actions
+from templates according to the current configuration.  Unless the files
+and actions are specified as TAGs, all are instantiated by default.
+
+Usage: $0 [OPTION]... [TAG]...
+
+  -h, --help       print this help, then exit
+  -V, --version    print version number and configuration settings, then exit
+      --config     print configuration, then exit
+  -q, --quiet, --silent
+                   do not print progress messages
+  -d, --debug      don't remove temporary files
+      --recheck    update $as_me by reconfiguring in the same conditions
+      --file=FILE[:TEMPLATE]
+                   instantiate the configuration file FILE
+      --header=FILE[:TEMPLATE]
+                   instantiate the configuration header FILE
+
+Configuration files:
+$config_files
+
+Configuration headers:
+$config_headers
+
+Configuration links:
+$config_links
+
+Configuration commands:
+$config_commands
+
+Report bugs to the package provider."
+
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
+ac_cs_version="\\
+config.status
+configured by $0, generated by GNU Autoconf 2.69,
+  with options \\"\$ac_cs_config\\"
+
+Copyright (C) 2012 Free Software Foundation, Inc.
+This config.status script is free software; the Free Software Foundation
+gives unlimited permission to copy, distribute and modify it."
+
+ac_pwd='$ac_pwd'
+srcdir='$srcdir'
+INSTALL='$INSTALL'
+MKDIR_P='$MKDIR_P'
+AWK='$AWK'
+test -n "\$AWK" || AWK=awk
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# The default lists apply if the user does not specify any file.
+ac_need_defaults=:
+while test $# != 0
+do
+  case $1 in
+  --*=?*)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
+    ac_shift=:
+    ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
+  *)
+    ac_option=$1
+    ac_optarg=$2
+    ac_shift=shift
+    ;;
+  esac
+
+  case $ac_option in
+  # Handling of the options.
+  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
+    ac_cs_recheck=: ;;
+  --version | --versio | --versi | --vers | --ver | --ve | --v | -V )
+    $as_echo "$ac_cs_version"; exit ;;
+  --config | --confi | --conf | --con | --co | --c )
+    $as_echo "$ac_cs_config"; exit ;;
+  --debug | --debu | --deb | --de | --d | -d )
+    debug=: ;;
+  --file | --fil | --fi | --f )
+    $ac_shift
+    case $ac_optarg in
+    *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
+    esac
+    as_fn_append CONFIG_FILES " '$ac_optarg'"
+    ac_need_defaults=false;;
+  --header | --heade | --head | --hea )
+    $ac_shift
+    case $ac_optarg in
+    *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    as_fn_append CONFIG_HEADERS " '$ac_optarg'"
+    ac_need_defaults=false;;
+  --he | --h)
+    # Conflict between --help and --header
+    as_fn_error $? "ambiguous option: \`$1'
+Try \`$0 --help' for more information.";;
+  --help | --hel | -h )
+    $as_echo "$ac_cs_usage"; exit ;;
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil | --si | --s)
+    ac_cs_silent=: ;;
+
+  # This is an error.
+  -*) as_fn_error $? "unrecognized option: \`$1'
+Try \`$0 --help' for more information." ;;
+
+  *) as_fn_append ac_config_targets " $1"
+     ac_need_defaults=false ;;
+
+  esac
+  shift
+done
+
+ac_configure_extra_args=
+
+if $ac_cs_silent; then
+  exec 6>/dev/null
+  ac_configure_extra_args="$ac_configure_extra_args --silent"
+fi
+
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+if \$ac_cs_recheck; then
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  shift
+  \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
+  CONFIG_SHELL='$SHELL'
+  export CONFIG_SHELL
+  exec "\$@"
+fi
+
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+exec 5>>config.log
+{
+  echo
+  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
+## Running $as_me. ##
+_ASBOX
+  $as_echo "$ac_log"
+} >&5
+
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+#
+# INIT-COMMANDS
+#
+AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"
+# Capture the value of obsolete ALL_LINGUAS because we need it to compute
+    # POFILES, UPDATEPOFILES, DUMMYPOFILES, GMOFILES, CATALOGS. But hide it
+    # from automake < 1.5.
+    eval 'OBSOLETE_ALL_LINGUAS''="$ALL_LINGUAS"'
+    # Capture the value of LINGUAS because we need it to compute CATALOGS.
+    LINGUAS="${LINGUAS-%UNSET%}"
+
+
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+
+# Handling of arguments.
+for ac_config_target in $ac_config_targets
+do
+  case $ac_config_target in
+    "depfiles") CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
+    "include/config.h") CONFIG_HEADERS="$CONFIG_HEADERS include/config.h:include/config.h.in" ;;
+    "po-directories") CONFIG_COMMANDS="$CONFIG_COMMANDS po-directories" ;;
+    "include/trio/triodef.h") CONFIG_LINKS="$CONFIG_LINKS include/trio/triodef.h:$trio_include_symsrc/triodef.h" ;;
+    "include/trio/trio.h") CONFIG_LINKS="$CONFIG_LINKS include/trio/trio.h:$trio_include_symsrc/trio.h" ;;
+    "include/trio/trionan.h") CONFIG_LINKS="$CONFIG_LINKS include/trio/trionan.h:$trio_include_symsrc/trionan.h" ;;
+    "include/trio/triop.h") CONFIG_LINKS="$CONFIG_LINKS include/trio/triop.h:$trio_include_symsrc/triop.h" ;;
+    "include/trio/triostr.h") CONFIG_LINKS="$CONFIG_LINKS include/trio/triostr.h:$trio_include_symsrc/triostr.h" ;;
+    "include/minilzo/minilzo.h") CONFIG_LINKS="$CONFIG_LINKS include/minilzo/minilzo.h:$minilzo_include_symsrc/minilzo.h" ;;
+    "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
+    "po/Makefile.in") CONFIG_FILES="$CONFIG_FILES po/Makefile.in" ;;
+    "intl/Makefile") CONFIG_FILES="$CONFIG_FILES intl/Makefile" ;;
+    "src/Makefile") CONFIG_FILES="$CONFIG_FILES src/Makefile" ;;
+    "src/drivers/Makefile") CONFIG_FILES="$CONFIG_FILES src/drivers/Makefile" ;;
+    "src/drivers_libxxx/Makefile") CONFIG_FILES="$CONFIG_FILES src/drivers_libxxx/Makefile" ;;
+    "src/drivers_dos/Makefile") CONFIG_FILES="$CONFIG_FILES src/drivers_dos/Makefile" ;;
+    "src/sexyal/Makefile") CONFIG_FILES="$CONFIG_FILES src/sexyal/Makefile" ;;
+    "src/ss/Makefile") CONFIG_FILES="$CONFIG_FILES src/ss/Makefile" ;;
+
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
+  esac
+done
+
+
+# If the user did not use the arguments to specify the items to instantiate,
+# then the envvar interface is used.  Set only those that are not.
+# We use the long form for the default assignment because of an extremely
+# bizarre bug on SunOS 4.1.3.
+if $ac_need_defaults; then
+  test "${CONFIG_FILES+set}" = set || CONFIG_FILES=$config_files
+  test "${CONFIG_HEADERS+set}" = set || CONFIG_HEADERS=$config_headers
+  test "${CONFIG_LINKS+set}" = set || CONFIG_LINKS=$config_links
+  test "${CONFIG_COMMANDS+set}" = set || CONFIG_COMMANDS=$config_commands
+fi
+
+# Have a temporary directory for convenience.  Make it in the build tree
+# simply because there is no reason against having it here, and in addition,
+# creating and moving files from /tmp can sometimes cause problems.
+# Hook for its removal unless debugging.
+# Note that there is a small window in which the directory will not be cleaned:
+# after its creation but before its name has been assigned to `$tmp'.
+$debug ||
+{
+  tmp= ac_tmp=
+  trap 'exit_status=$?
+  : "${ac_tmp:=$tmp}"
+  { test ! -d "$ac_tmp" || rm -fr "$ac_tmp"; } && exit $exit_status
+' 0
+  trap 'as_fn_exit 1' 1 2 13 15
+}
+# Create a (secure) tmp directory for tmp files.
+
+{
+  tmp=`(umask 077 && mktemp -d "./confXXXXXX") 2>/dev/null` &&
+  test -d "$tmp"
+}  ||
+{
+  tmp=./conf$$-$RANDOM
+  (umask 077 && mkdir "$tmp")
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
+ac_tmp=$tmp
+
+# Set up the scripts for CONFIG_FILES section.
+# No need to generate them if there are no CONFIG_FILES.
+# This happens for instance with `./config.status config.h'.
+if test -n "$CONFIG_FILES"; then
+
+
+ac_cr=`echo X | tr X '\015'`
+# On cygwin, bash can eat \r inside `` if the user requested igncr.
+# But we know of no other shell where ac_cr would be empty at this
+# point, so we can use a bashism as a fallback.
+if test "x$ac_cr" = x; then
+  eval ac_cr=\$\'\\r\'
+fi
+ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
+if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
+  ac_cs_awk_cr='\\r'
+else
+  ac_cs_awk_cr=$ac_cr
+fi
+
+echo 'BEGIN {' >"$ac_tmp/subs1.awk" &&
+_ACEOF
+
+
+{
+  echo "cat >conf$$subs.awk <<_ACEOF" &&
+  echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
+  echo "_ACEOF"
+} >conf$$subs.sh ||
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
+ac_delim='%!_!# '
+for ac_last_try in false false false false false :; do
+  . ./conf$$subs.sh ||
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+
+  ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
+  if test $ac_delim_n = $ac_delim_num; then
+    break
+  elif $ac_last_try; then
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+  else
+    ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
+  fi
+done
+rm -f conf$$subs.sh
+
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+cat >>"\$ac_tmp/subs1.awk" <<\\_ACAWK &&
+_ACEOF
+sed -n '
+h
+s/^/S["/; s/!.*/"]=/
+p
+g
+s/^[^!]*!//
+:repl
+t repl
+s/'"$ac_delim"'$//
+t delim
+:nl
+h
+s/\(.\{148\}\)..*/\1/
+t more1
+s/["\\]/\\&/g; s/^/"/; s/$/\\n"\\/
+p
+n
+b repl
+:more1
+s/["\\]/\\&/g; s/^/"/; s/$/"\\/
+p
+g
+s/.\{148\}//
+t nl
+:delim
+h
+s/\(.\{148\}\)..*/\1/
+t more2
+s/["\\]/\\&/g; s/^/"/; s/$/"/
+p
+b
+:more2
+s/["\\]/\\&/g; s/^/"/; s/$/"\\/
+p
+g
+s/.\{148\}//
+t delim
+' <conf$$subs.awk | sed '
+/^[^""]/{
+  N
+  s/\n//
+}
+' >>$CONFIG_STATUS || ac_write_fail=1
+rm -f conf$$subs.awk
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+_ACAWK
+cat >>"\$ac_tmp/subs1.awk" <<_ACAWK &&
+  for (key in S) S_is_set[key] = 1
+  FS = ""
+
+}
+{
+  line = $ 0
+  nfields = split(line, field, "@")
+  substed = 0
+  len = length(field[1])
+  for (i = 2; i < nfields; i++) {
+    key = field[i]
+    keylen = length(key)
+    if (S_is_set[key]) {
+      value = S[key]
+      line = substr(line, 1, len) "" value "" substr(line, len + keylen + 3)
+      len += length(value) + length(field[++i])
+      substed = 1
+    } else
+      len += 1 + keylen
+  }
+
+  print line
+}
+
+_ACAWK
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+if sed "s/$ac_cr//" < /dev/null > /dev/null 2>&1; then
+  sed "s/$ac_cr\$//; s/$ac_cr/$ac_cs_awk_cr/g"
+else
+  cat
+fi < "$ac_tmp/subs1.awk" > "$ac_tmp/subs.awk" \
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
+_ACEOF
+
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
+# trailing colons and then remove the whole line if VPATH becomes empty
+# (actually we leave an empty line to preserve line numbers).
+if test "x$srcdir" = x.; then
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
+s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
+s/^[^=]*=[	 ]*$//
+}'
+fi
+
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+fi # test -n "$CONFIG_FILES"
+
+# Set up the scripts for CONFIG_HEADERS section.
+# No need to generate them if there are no CONFIG_HEADERS.
+# This happens for instance with `./config.status Makefile'.
+if test -n "$CONFIG_HEADERS"; then
+cat >"$ac_tmp/defines.awk" <<\_ACAWK ||
+BEGIN {
+_ACEOF
+
+# Transform confdefs.h into an awk script `defines.awk', embedded as
+# here-document in config.status, that substitutes the proper values into
+# config.h.in to produce config.h.
+
+# Create a delimiter string that does not exist in confdefs.h, to ease
+# handling of long lines.
+ac_delim='%!_!# '
+for ac_last_try in false false :; do
+  ac_tt=`sed -n "/$ac_delim/p" confdefs.h`
+  if test -z "$ac_tt"; then
+    break
+  elif $ac_last_try; then
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
+  else
+    ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
+  fi
+done
+
+# For the awk script, D is an array of macro values keyed by name,
+# likewise P contains macro parameters if any.  Preserve backslash
+# newline sequences.
+
+ac_word_re=[_$as_cr_Letters][_$as_cr_alnum]*
+sed -n '
+s/.\{148\}/&'"$ac_delim"'/g
+t rset
+:rset
+s/^[	 ]*#[	 ]*define[	 ][	 ]*/ /
+t def
+d
+:def
+s/\\$//
+t bsnl
+s/["\\]/\\&/g
+s/^ \('"$ac_word_re"'\)\(([^()]*)\)[	 ]*\(.*\)/P["\1"]="\2"\
+D["\1"]=" \3"/p
+s/^ \('"$ac_word_re"'\)[	 ]*\(.*\)/D["\1"]=" \2"/p
+d
+:bsnl
+s/["\\]/\\&/g
+s/^ \('"$ac_word_re"'\)\(([^()]*)\)[	 ]*\(.*\)/P["\1"]="\2"\
+D["\1"]=" \3\\\\\\n"\\/p
+t cont
+s/^ \('"$ac_word_re"'\)[	 ]*\(.*\)/D["\1"]=" \2\\\\\\n"\\/p
+t cont
+d
+:cont
+n
+s/.\{148\}/&'"$ac_delim"'/g
+t clear
+:clear
+s/\\$//
+t bsnlc
+s/["\\]/\\&/g; s/^/"/; s/$/"/p
+d
+:bsnlc
+s/["\\]/\\&/g; s/^/"/; s/$/\\\\\\n"\\/p
+b cont
+' <confdefs.h | sed '
+s/'"$ac_delim"'/"\\\
+"/g' >>$CONFIG_STATUS || ac_write_fail=1
+
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+  for (key in D) D_is_set[key] = 1
+  FS = ""
+}
+/^[\t ]*#[\t ]*(define|undef)[\t ]+$ac_word_re([\t (]|\$)/ {
+  line = \$ 0
+  split(line, arg, " ")
+  if (arg[1] == "#") {
+    defundef = arg[2]
+    mac1 = arg[3]
+  } else {
+    defundef = substr(arg[1], 2)
+    mac1 = arg[2]
+  }
+  split(mac1, mac2, "(") #)
+  macro = mac2[1]
+  prefix = substr(line, 1, index(line, defundef) - 1)
+  if (D_is_set[macro]) {
+    # Preserve the white space surrounding the "#".
+    print prefix "define", macro P[macro] D[macro]
+    next
+  } else {
+    # Replace #undef with comments.  This is necessary, for example,
+    # in the case of _POSIX_SOURCE, which is predefined and required
+    # on some systems where configure will not decide to define it.
+    if (defundef == "undef") {
+      print "/*", prefix defundef, macro, "*/"
+      next
+    }
+  }
+}
+{ print }
+_ACAWK
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
+fi # test -n "$CONFIG_HEADERS"
+
+
+eval set X "  :F $CONFIG_FILES  :H $CONFIG_HEADERS  :L $CONFIG_LINKS  :C $CONFIG_COMMANDS"
+shift
+for ac_tag
+do
+  case $ac_tag in
+  :[FHLC]) ac_mode=$ac_tag; continue;;
+  esac
+  case $ac_mode$ac_tag in
+  :[FHL]*:*);;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5;;
+  :[FH]-) ac_tag=-:-;;
+  :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
+  esac
+  ac_save_IFS=$IFS
+  IFS=:
+  set x $ac_tag
+  IFS=$ac_save_IFS
+  shift
+  ac_file=$1
+  shift
+
+  case $ac_mode in
+  :L) ac_source=$1;;
+  :[FH])
+    ac_file_inputs=
+    for ac_f
+    do
+      case $ac_f in
+      -) ac_f="$ac_tmp/stdin";;
+      *) # Look for the file first in the build tree, then in the source tree
+	 # (if the path is not absolute).  The absolute path cannot be DOS-style,
+	 # because $ac_f cannot contain `:'.
+	 test -f "$ac_f" ||
+	   case $ac_f in
+	   [\\/$]*) false;;
+	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
+	   esac ||
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5;;
+      esac
+      case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
+      as_fn_append ac_file_inputs " '$ac_f'"
+    done
+
+    # Let's still pretend it is `configure' which instantiates (i.e., don't
+    # use $as_me), people would be surprised to read:
+    #    /* config.h.  Generated by config.status.  */
+    configure_input='Generated from '`
+	  $as_echo "$*" | sed 's|^[^:]*/||;s|:[^:]*/|, |g'
+	`' by configure.'
+    if test x"$ac_file" != x-; then
+      configure_input="$ac_file.  $configure_input"
+      { $as_echo "$as_me:${as_lineno-$LINENO}: creating $ac_file" >&5
+$as_echo "$as_me: creating $ac_file" >&6;}
+    fi
+    # Neutralize special characters interpreted by sed in replacement strings.
+    case $configure_input in #(
+    *\&* | *\|* | *\\* )
+       ac_sed_conf_input=`$as_echo "$configure_input" |
+       sed 's/[\\\\&|]/\\\\&/g'`;; #(
+    *) ac_sed_conf_input=$configure_input;;
+    esac
+
+    case $ac_tag in
+    *:-:* | *:-) cat >"$ac_tmp/stdin" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5 ;;
+    esac
+    ;;
+  esac
+
+  ac_dir=`$as_dirname -- "$ac_file" ||
+$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_file" : 'X\(//\)[^/]' \| \
+	 X"$ac_file" : 'X\(//\)$' \| \
+	 X"$ac_file" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$ac_file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+  as_dir="$ac_dir"; as_fn_mkdir_p
+  ac_builddir=.
+
+case "$ac_dir" in
+.) ac_dir_suffix= ac_top_builddir_sub=. ac_top_build_prefix= ;;
+*)
+  ac_dir_suffix=/`$as_echo "$ac_dir" | sed 's|^\.[\\/]||'`
+  # A ".." for each directory in $ac_dir_suffix.
+  ac_top_builddir_sub=`$as_echo "$ac_dir_suffix" | sed 's|/[^\\/]*|/..|g;s|/||'`
+  case $ac_top_builddir_sub in
+  "") ac_top_builddir_sub=. ac_top_build_prefix= ;;
+  *)  ac_top_build_prefix=$ac_top_builddir_sub/ ;;
+  esac ;;
+esac
+ac_abs_top_builddir=$ac_pwd
+ac_abs_builddir=$ac_pwd$ac_dir_suffix
+# for backward compatibility:
+ac_top_builddir=$ac_top_build_prefix
+
+case $srcdir in
+  .)  # We are building in place.
+    ac_srcdir=.
+    ac_top_srcdir=$ac_top_builddir_sub
+    ac_abs_top_srcdir=$ac_pwd ;;
+  [\\/]* | ?:[\\/]* )  # Absolute name.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir
+    ac_abs_top_srcdir=$srcdir ;;
+  *) # Relative name.
+    ac_srcdir=$ac_top_build_prefix$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_build_prefix$srcdir
+    ac_abs_top_srcdir=$ac_pwd/$srcdir ;;
+esac
+ac_abs_srcdir=$ac_abs_top_srcdir$ac_dir_suffix
+
+
+  case $ac_mode in
+  :F)
+  #
+  # CONFIG_FILE
+  #
+
+  case $INSTALL in
+  [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
+  *) ac_INSTALL=$ac_top_build_prefix$INSTALL ;;
+  esac
+  ac_MKDIR_P=$MKDIR_P
+  case $MKDIR_P in
+  [\\/$]* | ?:[\\/]* ) ;;
+  */*) ac_MKDIR_P=$ac_top_build_prefix$MKDIR_P ;;
+  esac
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+# If the template does not know about datarootdir, expand it.
+# FIXME: This hack should be removed a few years after 2.60.
+ac_datarootdir_hack=; ac_datarootdir_seen=
+ac_sed_dataroot='
+/datarootdir/ {
+  p
+  q
+}
+/@datadir@/p
+/@docdir@/p
+/@infodir@/p
+/@localedir@/p
+/@mandir@/p'
+case `eval "sed -n \"\$ac_sed_dataroot\" $ac_file_inputs"` in
+*datarootdir*) ac_datarootdir_seen=yes;;
+*@datadir@*|*@docdir@*|*@infodir@*|*@localedir@*|*@mandir@*)
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&5
+$as_echo "$as_me: WARNING: $ac_file_inputs seems to ignore the --datarootdir setting" >&2;}
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+  ac_datarootdir_hack='
+  s&@datadir@&$datadir&g
+  s&@docdir@&$docdir&g
+  s&@infodir@&$infodir&g
+  s&@localedir@&$localedir&g
+  s&@mandir@&$mandir&g
+  s&\\\${datarootdir}&$datarootdir&g' ;;
+esac
+_ACEOF
+
+# Neutralize VPATH when `$srcdir' = `.'.
+# Shell code in configure.ac might set extrasub.
+# FIXME: do we really want to maintain this feature?
+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
+ac_sed_extra="$ac_vpsub
+$extrasub
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
+:t
+/@[a-zA-Z_][a-zA-Z_0-9]*@/!b
+s|@configure_input@|$ac_sed_conf_input|;t t
+s&@top_builddir@&$ac_top_builddir_sub&;t t
+s&@top_build_prefix@&$ac_top_build_prefix&;t t
+s&@srcdir@&$ac_srcdir&;t t
+s&@abs_srcdir@&$ac_abs_srcdir&;t t
+s&@top_srcdir@&$ac_top_srcdir&;t t
+s&@abs_top_srcdir@&$ac_abs_top_srcdir&;t t
+s&@builddir@&$ac_builddir&;t t
+s&@abs_builddir@&$ac_abs_builddir&;t t
+s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
+s&@INSTALL@&$ac_INSTALL&;t t
+s&@MKDIR_P@&$ac_MKDIR_P&;t t
+$ac_datarootdir_hack
+"
+eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$ac_tmp/subs.awk" \
+  >$ac_tmp/out || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+
+test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
+  { ac_out=`sed -n '/\${datarootdir}/p' "$ac_tmp/out"`; test -n "$ac_out"; } &&
+  { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' \
+      "$ac_tmp/out"`; test -z "$ac_out"; } &&
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&5
+$as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
+which seems to be undefined.  Please make sure it is defined" >&2;}
+
+  rm -f "$ac_tmp/stdin"
+  case $ac_file in
+  -) cat "$ac_tmp/out" && rm -f "$ac_tmp/out";;
+  *) rm -f "$ac_file" && mv "$ac_tmp/out" "$ac_file";;
+  esac \
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+ ;;
+  :H)
+  #
+  # CONFIG_HEADER
+  #
+  if test x"$ac_file" != x-; then
+    {
+      $as_echo "/* $configure_input  */" \
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs"
+    } >"$ac_tmp/config.h" \
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    if diff "$ac_file" "$ac_tmp/config.h" >/dev/null 2>&1; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
+$as_echo "$as_me: $ac_file is unchanged" >&6;}
+    else
+      rm -f "$ac_file"
+      mv "$ac_tmp/config.h" "$ac_file" \
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
+    fi
+  else
+    $as_echo "/* $configure_input  */" \
+      && eval '$AWK -f "$ac_tmp/defines.awk"' "$ac_file_inputs" \
+      || as_fn_error $? "could not create -" "$LINENO" 5
+  fi
+# Compute "$ac_file"'s index in $config_headers.
+_am_arg="$ac_file"
+_am_stamp_count=1
+for _am_header in $config_headers :; do
+  case $_am_header in
+    $_am_arg | $_am_arg:* )
+      break ;;
+    * )
+      _am_stamp_count=`expr $_am_stamp_count + 1` ;;
+  esac
+done
+echo "timestamp for $_am_arg" >`$as_dirname -- "$_am_arg" ||
+$as_expr X"$_am_arg" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$_am_arg" : 'X\(//\)[^/]' \| \
+	 X"$_am_arg" : 'X\(//\)$' \| \
+	 X"$_am_arg" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$_am_arg" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`/stamp-h$_am_stamp_count
+ ;;
+  :L)
+  #
+  # CONFIG_LINK
+  #
+
+  if test "$ac_source" = "$ac_file" && test "$srcdir" = '.'; then
+    :
+  else
+    # Prefer the file from the source tree if names are identical.
+    if test "$ac_source" = "$ac_file" || test ! -r "$ac_source"; then
+      ac_source=$srcdir/$ac_source
+    fi
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: linking $ac_source to $ac_file" >&5
+$as_echo "$as_me: linking $ac_source to $ac_file" >&6;}
+
+    if test ! -r "$ac_source"; then
+      as_fn_error $? "$ac_source: file not found" "$LINENO" 5
+    fi
+    rm -f "$ac_file"
+
+    # Try a relative symlink, then a hard link, then a copy.
+    case $ac_source in
+    [\\/$]* | ?:[\\/]* ) ac_rel_source=$ac_source ;;
+	*) ac_rel_source=$ac_top_build_prefix$ac_source ;;
+    esac
+    ln -s "$ac_rel_source" "$ac_file" 2>/dev/null ||
+      ln "$ac_source" "$ac_file" 2>/dev/null ||
+      cp -p "$ac_source" "$ac_file" ||
+      as_fn_error $? "cannot link or copy $ac_source to $ac_file" "$LINENO" 5
+  fi
+ ;;
+  :C)  { $as_echo "$as_me:${as_lineno-$LINENO}: executing $ac_file commands" >&5
+$as_echo "$as_me: executing $ac_file commands" >&6;}
+ ;;
+  esac
+
+
+  case $ac_file$ac_mode in
+    "depfiles":C) test x"$AMDEP_TRUE" != x"" || {
+  # Older Autoconf quotes --file arguments for eval, but not when files
+  # are listed without --file.  Let's play safe and only enable the eval
+  # if we detect the quoting.
+  case $CONFIG_FILES in
+  *\'*) eval set x "$CONFIG_FILES" ;;
+  *)   set x $CONFIG_FILES ;;
+  esac
+  shift
+  for mf
+  do
+    # Strip MF so we end up with the name of the file.
+    mf=`echo "$mf" | sed -e 's/:.*$//'`
+    # Check whether this is an Automake generated Makefile or not.
+    # We used to match only the files named 'Makefile.in', but
+    # some people rename them; so instead we look at the file content.
+    # Grep'ing the first line is not enough: some people post-process
+    # each Makefile.in and add a new line on top of each file to say so.
+    # Grep'ing the whole file is not good either: AIX grep has a line
+    # limit of 2048, but all sed's we know have understand at least 4000.
+    if sed -n 's,^#.*generated by automake.*,X,p' "$mf" | grep X >/dev/null 2>&1; then
+      dirpart=`$as_dirname -- "$mf" ||
+$as_expr X"$mf" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$mf" : 'X\(//\)[^/]' \| \
+	 X"$mf" : 'X\(//\)$' \| \
+	 X"$mf" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$mf" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+    else
+      continue
+    fi
+    # Extract the definition of DEPDIR, am__include, and am__quote
+    # from the Makefile without running 'make'.
+    DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
+    test -z "$DEPDIR" && continue
+    am__include=`sed -n 's/^am__include = //p' < "$mf"`
+    test -z "$am__include" && continue
+    am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
+    # Find all dependency output files, they are included files with
+    # $(DEPDIR) in their names.  We invoke sed twice because it is the
+    # simplest approach to changing $(DEPDIR) to its actual value in the
+    # expansion.
+    for file in `sed -n "
+      s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
+	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g'`; do
+      # Make sure the directory exists.
+      test -f "$dirpart/$file" && continue
+      fdir=`$as_dirname -- "$file" ||
+$as_expr X"$file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$file" : 'X\(//\)[^/]' \| \
+	 X"$file" : 'X\(//\)$' \| \
+	 X"$file" : 'X\(/\)' \| . 2>/dev/null ||
+$as_echo X"$file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)[^/].*/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\/\)$/{
+	    s//\1/
+	    q
+	  }
+	  /^X\(\/\).*/{
+	    s//\1/
+	    q
+	  }
+	  s/.*/./; q'`
+      as_dir=$dirpart/$fdir; as_fn_mkdir_p
+      # echo "creating $dirpart/$file"
+      echo '# dummy' > "$dirpart/$file"
+    done
+  done
+}
+ ;;
+    "po-directories":C)
+    for ac_file in $CONFIG_FILES; do
+      # Support "outfile[:infile[:infile...]]"
+      case "$ac_file" in
+        *:*) ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
+      esac
+      # PO directories have a Makefile.in generated from Makefile.in.in.
+      case "$ac_file" in */Makefile.in)
+        # Adjust a relative srcdir.
+        ac_dir=`echo "$ac_file"|sed 's%/[^/][^/]*$%%'`
+        ac_dir_suffix="/`echo "$ac_dir"|sed 's%^\./%%'`"
+        ac_dots=`echo "$ac_dir_suffix"|sed 's%/[^/]*%../%g'`
+        # In autoconf-2.13 it is called $ac_given_srcdir.
+        # In autoconf-2.50 it is called $srcdir.
+        test -n "$ac_given_srcdir" || ac_given_srcdir="$srcdir"
+        case "$ac_given_srcdir" in
+          .)  top_srcdir=`echo $ac_dots|sed 's%/$%%'` ;;
+          /*) top_srcdir="$ac_given_srcdir" ;;
+          *)  top_srcdir="$ac_dots$ac_given_srcdir" ;;
+        esac
+        # Treat a directory as a PO directory if and only if it has a
+        # POTFILES.in file. This allows packages to have multiple PO
+        # directories under different names or in different locations.
+        if test -f "$ac_given_srcdir/$ac_dir/POTFILES.in"; then
+          rm -f "$ac_dir/POTFILES"
+          test -n "$as_me" && echo "$as_me: creating $ac_dir/POTFILES" || echo "creating $ac_dir/POTFILES"
+          cat "$ac_given_srcdir/$ac_dir/POTFILES.in" | sed -e "/^#/d" -e "/^[ 	]*\$/d" -e "s,.*,     $top_srcdir/& \\\\," | sed -e "\$s/\(.*\) \\\\/\1/" > "$ac_dir/POTFILES"
+          POMAKEFILEDEPS="POTFILES.in"
+          # ALL_LINGUAS, POFILES, UPDATEPOFILES, DUMMYPOFILES, GMOFILES depend
+          # on $ac_dir but don't depend on user-specified configuration
+          # parameters.
+          if test -f "$ac_given_srcdir/$ac_dir/LINGUAS"; then
+            # The LINGUAS file contains the set of available languages.
+            if test -n "$OBSOLETE_ALL_LINGUAS"; then
+              test -n "$as_me" && echo "$as_me: setting ALL_LINGUAS in configure.in is obsolete" || echo "setting ALL_LINGUAS in configure.in is obsolete"
+            fi
+            ALL_LINGUAS_=`sed -e "/^#/d" -e "s/#.*//" "$ac_given_srcdir/$ac_dir/LINGUAS"`
+            # Hide the ALL_LINGUAS assigment from automake < 1.5.
+            eval 'ALL_LINGUAS''=$ALL_LINGUAS_'
+            POMAKEFILEDEPS="$POMAKEFILEDEPS LINGUAS"
+          else
+            # The set of available languages was given in configure.in.
+            # Hide the ALL_LINGUAS assigment from automake < 1.5.
+            eval 'ALL_LINGUAS''=$OBSOLETE_ALL_LINGUAS'
+          fi
+          # Compute POFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).po)
+          # Compute UPDATEPOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(lang).po-update)
+          # Compute DUMMYPOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(lang).nop)
+          # Compute GMOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).gmo)
+          case "$ac_given_srcdir" in
+            .) srcdirpre= ;;
+            *) srcdirpre='$(srcdir)/' ;;
+          esac
+          POFILES=
+          UPDATEPOFILES=
+          DUMMYPOFILES=
+          GMOFILES=
+          for lang in $ALL_LINGUAS; do
+            POFILES="$POFILES $srcdirpre$lang.po"
+            UPDATEPOFILES="$UPDATEPOFILES $lang.po-update"
+            DUMMYPOFILES="$DUMMYPOFILES $lang.nop"
+            GMOFILES="$GMOFILES $srcdirpre$lang.gmo"
+          done
+          # CATALOGS depends on both $ac_dir and the user's LINGUAS
+          # environment variable.
+          INST_LINGUAS=
+          if test -n "$ALL_LINGUAS"; then
+            for presentlang in $ALL_LINGUAS; do
+              useit=no
+              if test "%UNSET%" != "$LINGUAS"; then
+                desiredlanguages="$LINGUAS"
+              else
+                desiredlanguages="$ALL_LINGUAS"
+              fi
+              for desiredlang in $desiredlanguages; do
+                # Use the presentlang catalog if desiredlang is
+                #   a. equal to presentlang, or
+                #   b. a variant of presentlang (because in this case,
+                #      presentlang can be used as a fallback for messages
+                #      which are not translated in the desiredlang catalog).
+                case "$desiredlang" in
+                  "$presentlang"*) useit=yes;;
+                esac
+              done
+              if test $useit = yes; then
+                INST_LINGUAS="$INST_LINGUAS $presentlang"
+              fi
+            done
+          fi
+          CATALOGS=
+          if test -n "$INST_LINGUAS"; then
+            for lang in $INST_LINGUAS; do
+              CATALOGS="$CATALOGS $lang.gmo"
+            done
+          fi
+          test -n "$as_me" && echo "$as_me: creating $ac_dir/Makefile" || echo "creating $ac_dir/Makefile"
+          sed -e "/^POTFILES =/r $ac_dir/POTFILES" -e "/^# Makevars/r $ac_given_srcdir/$ac_dir/Makevars" -e "s|@POFILES@|$POFILES|g" -e "s|@UPDATEPOFILES@|$UPDATEPOFILES|g" -e "s|@DUMMYPOFILES@|$DUMMYPOFILES|g" -e "s|@GMOFILES@|$GMOFILES|g" -e "s|@CATALOGS@|$CATALOGS|g" -e "s|@POMAKEFILEDEPS@|$POMAKEFILEDEPS|g" "$ac_dir/Makefile.in" > "$ac_dir/Makefile"
+          for f in "$ac_given_srcdir/$ac_dir"/Rules-*; do
+            if test -f "$f"; then
+              case "$f" in
+                *.orig | *.bak | *~) ;;
+                *) cat "$f" >> "$ac_dir/Makefile" ;;
+              esac
+            fi
+          done
+        fi
+        ;;
+      esac
+    done ;;
+
+  esac
+done # for ac_tag
+
+
+as_fn_exit 0
+_ACEOF
+ac_clean_files=$ac_clean_files_save
+
+test $ac_write_fail = 0 ||
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
+
+
+# configure is writing to config.log, and then calls config.status.
+# config.status does its own redirection, appending to config.log.
+# Unfortunately, on DOS this fails, as config.log is still kept open
+# by configure, so config.status won't be able to write to it; its
+# output is simply discarded.  So we exec the FD to /dev/null,
+# effectively closing config.log, so it can be properly (re)opened and
+# appended to by config.status.  When coming back to configure, we
+# need to make the FD available again.
+if test "$no_create" != yes; then
+  ac_cs_success=:
+  ac_config_status_args=
+  test "$silent" = yes &&
+    ac_config_status_args="$ac_config_status_args --quiet"
+  exec 5>/dev/null
+  $SHELL $CONFIG_STATUS $ac_config_status_args || ac_cs_success=false
+  exec 5>>config.log
+  # Use ||, not &&, to avoid exiting from the if with $? = 1, which
+  # would make configure fail if this is the last instruction.
+  $ac_cs_success || as_fn_exit 1
+fi
+if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
+$as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2;}
+fi
+
diff -Naur -r --no-dereference ./mednafen/Documentation/modules.def ./emu4crt/Documentation/modules.def
--- ./mednafen/Documentation/modules.def	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/Documentation/modules.def	2019-10-07 11:47:21.224338307 -0700
@@ -1,4 +1,4 @@
-1.23.0-UNSTABLE
+1.23.0-UNSTABLE-emu4crt-A09
 apple2
 Apple II/II+
 250
diff -Naur -r --no-dereference ./mednafen/src/drivers/main.cpp ./emu4crt/src/drivers/main.cpp
--- ./mednafen/src/drivers/main.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/drivers/main.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -270,6 +270,7 @@
 MDFNGI *CurGame=NULL;
 
 
+
 #ifdef WIN32
 static std::string GetModuleFileName_UTF8(HMODULE hModule)
 {
@@ -284,6 +285,47 @@
  return UTF16_to_UTF8(&path[0], nullptr, true);
 }
 
+
+static bool HandleConsoleMadness(void) // SLK - enforce stdout.txt & stderr.txt out to files
+{
+  bool ret;
+  if(AllocConsole())
+  {
+	HWND cwin = GetConsoleWindow();
+	ShowWindow(cwin, SW_HIDE);
+
+    freopen("CONOUT$", "w", stdout);
+    freopen("CONOUT$", "w", stderr);
+
+    SetConsoleOutputCP(65001);	// UTF-8
+
+	std::string path;
+ 	size_t catpos;	// Meow meow.
+ 	path = GetModuleFileName_UTF8(NULL);
+	if((catpos = path.find_last_of('\\')) != std::string::npos) path.resize(catpos + 1);
+	const std::u16string stdout_path = UTF8_to_UTF16(path + "stdout.txt", nullptr, true);
+ 	const std::u16string stderr_path = UTF8_to_UTF16(path + "stderr.txt", nullptr, true);
+ 	int new_stdout = -1;
+ 	int new_stderr = -1;
+ 	new_stdout = _wopen((const wchar_t*)stdout_path.c_str(), O_WRONLY | O_CREAT | O_TRUNC, _S_IREAD | _S_IWRITE);
+ 	new_stderr = _wopen((const wchar_t*)stderr_path.c_str(), O_WRONLY | O_CREAT | O_TRUNC, _S_IREAD | _S_IWRITE);
+
+  	fflush(stdout);
+  	fflush(stderr);
+
+  	dup2(new_stdout, fileno(stdout));
+  	dup2(new_stderr, fileno(stderr));
+
+   close(new_stdout);
+   close(new_stderr);
+
+  }
+  ret = false;
+  return ret;
+}
+
+/* // SLK - Disable native redirection functions due to switch back to windows application
+
 // returns 1 if redirected, 0 if not redirected due to error, -1 if not redirected due to env variable
 static int RedirectSTDxxx(void)
 {
@@ -395,6 +437,8 @@
 
  return ret;
 }
+*/
+
 #endif
 
 void Mednafen::MDFND_OutputNotice(MDFN_NoticeType t, const char* s) noexcept
@@ -1188,56 +1232,79 @@
 {
 	while(GameThreadRun)
 	{
-         int16 *sound;
-         int32 ssize;
-         bool fskip;
-        
+	  //SLK trap change resolution request
+	  if(resolution_to_change)
+	  {
+	    if(use_native_resolution)
+	    {
+	      if((current_resolution_w != resolution_to_change_w) || (current_resolution_h != resolution_to_change_h))
+				{
+		  		GT_ChangeVideoResolution();
+		  		printf("MAIN - native resolution switched\n");
+				}
+				else {printf("MAIN - resolution change bypassed\n");}
+			}	
+	    if(use_super_resolution)
+	    {
+	      if(resolution_to_change_h != current_resolution_h)
+	      {
+					GT_ChangeVideoResolution();
+					printf("MAIN - Super resolution switched\n");
+	      }
+	      else {printf("MAIN - Super resolution change bypassed\n");}
+			}
+			resolution_to_change = false;
+	  }
+	  // SLK - end
+		int16 *sound;
+		int32 ssize;
+		bool fskip;
+	
 	 /* If we requested a new video mode, wait until it's set before calling the emulation code again.
 	 */
-	 while(NeedVideoSync)
-	 {
-	  if(!GameThreadRun) return(1);	// Might happen if video initialization failed
+	while(NeedVideoSync)
+	{
+		if(!GameThreadRun) return(1);	// Might happen if video initialization failed
 	  Time::SleepMS(2);
-	 }
-
-	 if(Sound_NeedReInit())
-	  GT_ReinitSound();
+	}
+	if(Sound_NeedReInit())
+		GT_ReinitSound();
 
-	 if(MDFNDnetplay && !(NoWaiting & 0x2))	// TODO: Hacky, clean up.
-	  ers.SetETtoRT();
-	 //
-	 //
-	 fskip = ers.NeedFrameSkip();
-	 fskip &= MDFN_GetSettingB("video.frameskip");
-	 fskip &= !(pending_ssnapshot || pending_snapshot || pending_save_state || pending_save_movie || NeedFrameAdvance);
-	 fskip |= (bool)NoWaiting;
+	if(MDFNDnetplay && !(NoWaiting & 0x2))	// TODO: Hacky, clean up.
+		ers.SetETtoRT();
+	//
+	//
+	fskip = ers.NeedFrameSkip();
+	fskip &= MDFN_GetSettingB("video.frameskip");
+	fskip &= !(pending_ssnapshot || pending_snapshot || pending_save_state || pending_save_movie || NeedFrameAdvance);
+	fskip |= (bool)NoWaiting;
 
-	 //printf("fskip %d; NeedFrameAdvance=%d\n", fskip, NeedFrameAdvance);
+	//printf("fskip %d; NeedFrameAdvance=%d\n", fskip, NeedFrameAdvance);
 
-	 NeedFrameAdvance = false;
-	 //
-	 //
-	 SoftFB[SoftFB_BackBuffer].lw[0] = ~0;
+	NeedFrameAdvance = false;
+	//
+	//
+	SoftFB[SoftFB_BackBuffer].lw[0] = ~0;
 
-	 //
-	 //
-	 //
-	 EmulateSpecStruct espec;
+	//
+	//
+	//
+	EmulateSpecStruct espec;
 
-         espec.surface = SoftFB[SoftFB_BackBuffer].surface.get();
-         espec.LineWidths = SoftFB[SoftFB_BackBuffer].lw.get();
-	 espec.skip = fskip;
-	 espec.soundmultiplier = CurGameSpeed;
-	 espec.NeedRewind = DNeedRewind;
-
- 	 espec.SoundRate = Sound_GetRate();
-	 espec.SoundBuf = Sound_GetEmuModBuffer(&espec.SoundBufMaxSize);
- 	 espec.SoundVolume = (double)MDFN_GetSettingUI("sound.volume") / 100;
+	espec.surface = SoftFB[SoftFB_BackBuffer].surface.get();
+	espec.LineWidths = SoftFB[SoftFB_BackBuffer].lw.get();
+	espec.skip = fskip;
+	espec.soundmultiplier = CurGameSpeed;
+	espec.NeedRewind = DNeedRewind;
+
+	espec.SoundRate = Sound_GetRate();
+	espec.SoundBuf = Sound_GetEmuModBuffer(&espec.SoundBufMaxSize);
+	espec.SoundVolume = (double)MDFN_GetSettingUI("sound.volume") / 100;
 
-	 if(MDFN_UNLIKELY(StateRCTest))
-	 {
-	  // Note: Won't work correctly with modules that do mid-sync.
-	  EmulateSpecStruct estmp = espec;
+	if(MDFN_UNLIKELY(StateRCTest))
+	{
+		// Note: Won't work correctly with modules that do mid-sync.
+		EmulateSpecStruct estmp = espec;
 
 	  MemoryStream state0(524288);
 	  MemoryStream state1(524288);
@@ -1255,19 +1322,19 @@
 
 	  if(!(state1.map_size() == state2.map_size() && !memcmp(state1.map() + 32, state2.map() + 32, state1.map_size() - 32)))
 	  {
-	   FileStream sd0("/tmp/sdump0", FileStream::MODE_WRITE);
-	   FileStream sd1("/tmp/sdump1", FileStream::MODE_WRITE);
+			FileStream sd0("/tmp/sdump0", FileStream::MODE_WRITE);
+	   	FileStream sd1("/tmp/sdump1", FileStream::MODE_WRITE);
 
-	   sd0.write(state1.map(), state1.map_size());
-	   sd1.write(state2.map(), state2.map_size());
-	   sd0.close();
-	   sd1.close();
-	   //assert(orig_state.map_size() == new_state.map_size() && !memcmp(orig_state.map() + 32, new_state.map() + 32, orig_state.map_size() - 32));
-	   abort();
+			sd0.write(state1.map(), state1.map_size());
+			sd1.write(state2.map(), state2.map_size());
+	   	sd0.close();
+	   	sd1.close();
+	   	//assert(orig_state.map_size() == new_state.map_size() && !memcmp(orig_state.map() + 32, new_state.map() + 32, orig_state.map_size() - 32));
+	   	abort();
 	  }
-	 }
-	 else
-          MDFNI_Emulate(&espec);
+	}
+	else
+		MDFNI_Emulate(&espec);
 
 	 if(MDFN_UNLIKELY(StateSLSTest))
 	 {
@@ -1512,6 +1579,22 @@
  return(true);	// FIXME!
 }
 
+//SLK - called to change resolution
+void GT_ChangeVideoResolution(void)
+{
+ // assert(MDFN_ThreadID() == GameThreadID);
+ MThreading::LockMutex(VTMutex);
+ NeedVideoSync++;
+ MThreading::UnlockMutex(VTMutex);
+
+ MThreading::PostSem(VTWakeupSem);
+ while(NeedVideoSync && GameThreadRun)
+ {
+  Time::SleepMS(2);
+ }
+}
+//SLK - end
+
 bool GT_ReinitSound(void)
 {
  bool ret = true;
@@ -2070,7 +2153,7 @@
 	}
 
 	#ifdef WIN32
-	HandleConsoleMadness();
+	HandleConsoleMadness(); // SLK
 	#endif
 
 	//ThreadTest();
diff -Naur -r --no-dereference ./mednafen/src/drivers/main.cpp.orig ./emu4crt/src/drivers/main.cpp.orig
--- ./mednafen/src/drivers/main.cpp.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/drivers/main.cpp.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,2591 @@
+/* Mednafen - Multi-system Emulator
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#include "main.h"
+#include <SDL_revision.h>
+
+#ifdef WIN32
+ #include <mednafen/win32-common.h>
+#else
+ #include <unistd.h>
+#endif
+
+#include <fcntl.h>
+#include <sys/types.h>
+#include <signal.h>
+#include <sys/stat.h>
+#include <trio/trio.h>
+#include <locale.h>
+
+#ifdef HAVE_GETPWUID
+#include <pwd.h>
+#endif
+
+#ifdef HAVE_ICONV
+#include <iconv.h>
+#endif
+
+#include <atomic>
+
+#include "input.h"
+#include "Joystick.h"
+#include "video.h"
+#include "opengl.h"
+#include "shader.h"
+#include "sound.h"
+#include "netplay.h"
+#include "cheat.h"
+#include "fps.h"
+#include "debugger.h"
+#include "help.h"
+#include "video-state.h"
+#include "remote.h"
+#include "ers.h"
+#include "rmdui.h"
+#include <mednafen/qtrecord.h>
+#include <mednafen/tests.h>
+#include <mednafen/MemoryStream.h>
+#include <mednafen/string/string.h>
+#include <mednafen/file.h>
+
+static bool SuppressErrorPopups;	// Set from env variable "MEDNAFEN_NOPOPUPS"
+
+static int StateSLSTest = false;
+static int StateRCTest = false;	// Rewind consistency
+#if 0
+static int StatePCTest = false;	// Power(toggle) consistency
+#endif
+static WMInputBehavior NeededWMInputBehavior = { false, false, false, false };
+static bool NeededWMInputBehavior_Dirty = false;
+
+bool MDFNDHaveFocus;
+static bool RemoteOn = FALSE;
+bool pending_save_state, pending_snapshot, pending_ssnapshot, pending_save_movie;
+static uint64 MainThreadID = 0;
+static bool ffnosound;
+
+static const MDFNSetting_EnumList SDriver_List[] =
+{
+ { "default", -1, "Default", gettext_noop("Selects the default sound driver.") },
+
+ { "alsa", -1, "ALSA", gettext_noop("The default for Linux(if available).") },
+ { "openbsd", -1, "OpenBSD Audio", gettext_noop("The default for OpenBSD.") },
+ { "oss", -1, "Open Sound System", gettext_noop("The default for non-Linux UN*X/POSIX/BSD(other than OpenBSD) systems, or anywhere ALSA is unavailable. If the ALSA driver gives you problems, you can try using this one instead.\n\nIf you are using OSSv4 or newer, you should edit \"/usr/lib/oss/conf/osscore.conf\", uncomment the max_intrate= line, and change the value from 100(default) to 1000(or higher if you know what you're doing), and restart OSS. Otherwise, performance will be poor, and the sound buffer size in Mednafen will be orders of magnitude larger than specified.\n\nIf the sound buffer size is still excessively larger than what is specified via the \"sound.buffer_time\" setting, you can try setting \"sound.period_time\" to 2666, and as a last resort, 5333, to work around a design flaw/limitation/choice in the OSS API and OSS implementation.") },
+
+ { "wasapish", -1, "WASAPI(Shared Mode)", gettext_noop("The default when it's available(running on Microsoft Windows Vista and newer).") },
+
+ { "dsound", -1, "DirectSound", gettext_noop("The default for Microsoft Windows XP and older.") },
+
+ { "wasapi", -1, "WASAPI(Exclusive Mode)", gettext_noop("Experimental exclusive-mode WASAPI driver, usable on Windows Vista and newer.  Use it for lower-latency sound.  May not work properly on all sound cards.") },
+
+ { "sdl", -1, "Simple Directmedia Layer", gettext_noop("This driver is not recommended, but it serves as a backup driver if the others aren't available. Its performance is generally sub-par, requiring higher latency or faster CPUs/SMP for glitch-free playback, except where the OS provides a sound callback API itself, such as with Mac OS X and BeOS.") },
+
+ { "jack", -1, "JACK", gettext_noop("The latency reported during startup is for the local sound buffer only and does not include server-side latency.  Please note that video card drivers(in the kernel or X), and hardware-accelerated OpenGL, may interfere with jackd's ability to effectively run with realtime response.") },
+
+ { "dummy", -1 },
+
+ { NULL, 0 },
+};
+
+static const MDFNSetting_EnumList FontSize_List[] =
+{
+ { "5x7",	MDFN_FONT_5x7, gettext_noop("5x7") },
+ { "6x9",	MDFN_FONT_6x9, gettext_noop("6x9") },
+ { "6x12",	MDFN_FONT_6x12, gettext_noop("6x12") },
+#ifdef WANT_INTERNAL_CJK
+ { "6x13",	MDFN_FONT_6x13_12x13, gettext_noop("6x13.  CJK support.") },
+ { "9x18",	MDFN_FONT_9x18_18x18, gettext_noop("9x18;  CJK support.") },
+#else
+ { "6x13",	MDFN_FONT_6x13_12x13, gettext_noop("6x13.") },
+ { "9x18",	MDFN_FONT_9x18_18x18, gettext_noop("9x18.") },
+#endif
+ // Backwards compat:
+ { "xsmall", 	MDFN_FONT_5x7 }, // 4x5 font was removed.
+ { "small",	MDFN_FONT_5x7 },
+ { "medium",	MDFN_FONT_6x13_12x13 },
+ { "large",	MDFN_FONT_9x18_18x18 },
+
+ { "0",		MDFN_FONT_9x18_18x18 },
+ { "1",		MDFN_FONT_5x7 },
+
+ { NULL, 0 },
+};
+
+static const MDFNSetting_EnumList FPSPos_List[] =
+{
+ { "upper_left", 0 },
+ { "upper_right", 1 },
+
+ { NULL, 0 },
+};
+
+static std::vector <MDFNSetting> NeoDriverSettings;
+static const MDFNSetting DriverSettings[] =
+{
+  { "input.joystick.global_focus", MDFNSF_NOFLAGS, gettext_noop("Update physical joystick(s) internal state in Mednafen even when Mednafen lacks OS focus."), NULL, MDFNST_BOOL, "1" },
+  { "input.joystick.axis_threshold", MDFNSF_NOFLAGS, gettext_noop("Analog axis binary press detection threshold."), gettext_noop("Threshold for detecting a digital-like \"button\" press on analog axis, in percent."), MDFNST_FLOAT, "75", "0", "100" },
+  { "input.autofirefreq", MDFNSF_NOFLAGS, gettext_noop("Auto-fire frequency."), gettext_noop("Auto-fire frequency = GameSystemFrameRateHz / (value + 1)"), MDFNST_UINT, "3", "0", "1000" },
+  { "input.ckdelay", MDFNSF_NOFLAGS, gettext_noop("Dangerous key action delay."), gettext_noop("The length of time, in milliseconds, that a button/key corresponding to a \"dangerous\" command like power, reset, exit, etc. must be pressed before the command is executed."), MDFNST_UINT, "0", "0", "99999" },
+
+  { "netplay.host", MDFNSF_NOFLAGS, gettext_noop("Server hostname."), NULL, MDFNST_STRING, "netplay.fobby.net" },
+  { "netplay.port", MDFNSF_NOFLAGS, gettext_noop("Server port."), NULL, MDFNST_UINT, "4046", "1", "65535" },
+  { "netplay.console.font", MDFNSF_NOFLAGS, gettext_noop("Font for netplay chat console."), NULL, MDFNST_ENUM, "9x18", NULL, NULL, NULL, NULL, FontSize_List },
+  { "netplay.console.scale", MDFNSF_NOFLAGS, gettext_noop("Netplay chat console text scale factor."), gettext_noop("A value of 0 enables auto-scaling."), MDFNST_UINT, "1", "0", "16" },
+  { "netplay.console.lines", MDFNSF_NOFLAGS, gettext_noop("Height of chat console, in lines."), NULL, MDFNST_UINT, "5", "5", "64" },
+
+  { "video.frameskip", MDFNSF_NOFLAGS, gettext_noop("Enable frameskip during emulation rendering."), 
+					gettext_noop("Disable for rendering code performance testing."), MDFNST_BOOL, "1" },
+
+  { "video.blit_timesync", MDFNSF_NOFLAGS, gettext_noop("Enable time synchronization(waiting) for frame blitting."),
+					gettext_noop("Disable to reduce latency, at the cost of potentially increased video \"juddering\", with the maximum reduction in latency being about 1 video frame's time.\nWill work best with emulated systems that are not very computationally expensive to emulate, combined with running on a relatively fast CPU."),
+					MDFNST_BOOL, "1" },
+
+  { "ffspeed", MDFNSF_NOFLAGS, gettext_noop("Fast-forwarding speed multiplier."), NULL, MDFNST_FLOAT, "4", "0.25", "15" },
+  { "fftoggle", MDFNSF_NOFLAGS, gettext_noop("Treat the fast-forward button as a toggle."), NULL, MDFNST_BOOL, "0" },
+  { "ffnosound", MDFNSF_NOFLAGS, gettext_noop("Silence sound output when fast-forwarding."), NULL, MDFNST_BOOL, "0" },
+
+  { "sfspeed", MDFNSF_NOFLAGS, gettext_noop("SLOW-forwarding speed multiplier."), NULL, MDFNST_FLOAT, "0.75", "0.25", "15" },
+  { "sftoggle", MDFNSF_NOFLAGS, gettext_noop("Treat the SLOW-forward button as a toggle."), NULL, MDFNST_BOOL, "0" },
+
+  { "nothrottle", MDFNSF_NOFLAGS, gettext_noop("Disable speed throttling when sound is disabled."), NULL, MDFNST_BOOL, "0"},
+  { "autosave", MDFNSF_NOFLAGS, gettext_noop("Automatically load/save state on game load/close."), gettext_noop("Automatically save and load save states when a game is closed or loaded, respectively."), MDFNST_BOOL, "0"},
+  { "sound.driver", MDFNSF_NOFLAGS, gettext_noop("Select sound driver."), gettext_noop("The following choices are possible, sorted by preference, high to low, when \"default\" driver is used, but dependent on being compiled in."), MDFNST_ENUM, "default", NULL, NULL, NULL, NULL, SDriver_List },
+  { "sound.device", MDFNSF_NOFLAGS, gettext_noop("Select sound output device."), gettext_noop("When using ALSA sound output under Linux, the \"sound.device\" setting \"default\" is Mednafen's default, IE \"hw:0\", not ALSA's \"default\". If you want to use ALSA's \"default\", use \"sexyal-literal-default\"."), MDFNST_STRING, "default", NULL, NULL },
+  { "sound.volume", MDFNSF_NOFLAGS, gettext_noop("Sound volume level, in percent."), gettext_noop("Setting this volume control higher than the default of \"100\" may severely distort the sound."), MDFNST_UINT, "100", "0", "150" },
+  { "sound", MDFNSF_NOFLAGS, gettext_noop("Enable sound output."), NULL, MDFNST_BOOL, "1" },
+  { "sound.period_time", MDFNSF_NOFLAGS, gettext_noop("Desired period size in microseconds(μs)."), gettext_noop("Currently only affects OSS, ALSA, WASAPI(exclusive mode), and SDL output.  A value of 0 defers to the default in the driver code in SexyAL.\n\nNote: This is not the \"sound buffer size\" setting, that would be \"sound.buffer_time\"."), MDFNST_UINT,  "0", "0", "100000" },
+  { "sound.buffer_time", MDFNSF_NOFLAGS, gettext_noop("Desired buffer size in milliseconds(ms)."), gettext_noop("The default value of 0 enables automatic buffer size selection."), MDFNST_UINT, "0", "0", "1000" },
+  { "sound.rate", MDFNSF_NOFLAGS, gettext_noop("Specifies the sound playback rate, in sound frames per second(\"Hz\")."), NULL, MDFNST_UINT, "48000", "22050", "192000"},
+
+  #ifdef WANT_DEBUGGER
+  { "debugger.autostepmode", MDFNSF_NOFLAGS, gettext_noop("Automatically go into the debugger's step mode after a game is loaded."), NULL, MDFNST_BOOL, "0" },
+  #endif
+
+  { "osd.message_display_time", MDFNSF_NOFLAGS, gettext_noop("Length of time, in milliseconds, to display internal status and error messages"), gettext_noop("Time lengths less than 100ms are recommended against unless you understand you may miss important non-fatal error messages, and that the input configuration process may become unusable."), MDFNST_UINT, "2500", "0", "15000" },
+  { "osd.state_display_time", MDFNSF_NOFLAGS, gettext_noop("Length of time, in milliseconds, to display the save state or the movie selector after selecting a state or movie."),  NULL, MDFNST_UINT, "2000", "0", "15000" },
+  { "osd.alpha_blend", MDFNSF_NOFLAGS, gettext_noop("Enable alpha blending for OSD elements."), NULL, MDFNST_BOOL, "1" },
+
+  { "fps.autoenable", MDFNSF_NOFLAGS, gettext_noop("Automatically enable FPS display on startup."), NULL, MDFNST_BOOL, "0" },
+  { "fps.position", MDFNSF_NOFLAGS, gettext_noop("FPS display position."), NULL, MDFNST_ENUM, "upper_left", NULL, NULL, NULL, NULL, FPSPos_List },
+  { "fps.scale", MDFNSF_NOFLAGS, gettext_noop("FPS display scale factor."), gettext_noop("A value of 0 enables auto-scaling."), MDFNST_UINT, "1", "0", "32" },
+  { "fps.font", MDFNSF_NOFLAGS, gettext_noop("FPS display font."), NULL, MDFNST_ENUM, "5x7", NULL, NULL, NULL, NULL, FontSize_List },
+  { "fps.textcolor", MDFNSF_NOFLAGS, gettext_noop("FPS display text color."), gettext_noop("0xAARRGGBB"), MDFNST_UINT, "0xFFFFFFFF", "0x00000000", "0xFFFFFFFF" },
+  { "fps.bgcolor", MDFNSF_NOFLAGS, gettext_noop("FPS display background color."), gettext_noop("0xAARRGGBB"), MDFNST_UINT, "0x80000000", "0x00000000", "0xFFFFFFFF" },
+
+  { "srwautoenable", MDFNSF_SUPPRESS_DOC, gettext_noop("DO NOT USE UNLESS YOU'RE A SPACE GOAT"/*"Automatically enable state rewinding functionality on game load."*/), gettext_noop("Use this setting with caution, as save state rewinding can have widely variable memory and CPU usage requirements among different games and different emulated systems."), MDFNST_BOOL, "0" },
+};
+
+void BuildSystemSetting(MDFNSetting *setting, const char *system_name, const char *name, const char *description, const char *description_extra, MDFNSettingType type, 
+	const char *default_value, const char *minimum, const char *maximum,
+	bool (*validate_func)(const char *name, const char *value), void (*ChangeNotification)(const char *name), 
+        const MDFNSetting_EnumList *enum_list)
+{
+ char setting_name[256];
+
+ memset(setting, 0, sizeof(MDFNSetting));
+
+ trio_snprintf(setting_name, 256, "%s.%s", system_name, name);
+
+ setting->name = strdup(setting_name);
+ setting->flags = MDFNSF_COMMON_TEMPLATE;
+ setting->description = description;
+ setting->description_extra = description_extra;
+ setting->type = type;
+ setting->default_value = default_value;
+ setting->minimum = minimum;
+ setting->maximum = maximum;
+ setting->validate_func = validate_func;
+ setting->ChangeNotification = ChangeNotification;
+ setting->enum_list = enum_list;
+}
+
+void MakeDebugSettings(std::vector <MDFNSetting> &settings)
+{
+ #ifdef WANT_DEBUGGER
+ for(unsigned int i = 0; i < MDFNSystems.size(); i++)
+ {
+  const DebuggerInfoStruct *dbg = MDFNSystems[i]->Debugger;
+  MDFNSetting setting;
+  const char *sysname = MDFNSystems[i]->shortname;
+
+  if(!dbg)
+   continue;
+
+  BuildSystemSetting(&setting, sysname, "debugger.disfontsize", gettext_noop("Disassembly font size."), gettext_noop("Note: Setting the font size to larger than the default may cause text overlap in the debugger."), MDFNST_ENUM, "5x7", NULL, NULL, NULL, NULL, FontSize_List);
+  settings.push_back(setting);
+
+  BuildSystemSetting(&setting, sysname, "debugger.memcharenc", gettext_noop("Character encoding for the debugger's memory editor."), NULL, MDFNST_STRING, dbg->DefaultCharEnc);
+  settings.push_back(setting);
+ }
+ #endif
+}
+
+static MThreading::Thread* GameThread;
+
+static struct
+{
+ std::unique_ptr<MDFN_Surface> surface = nullptr;
+ MDFN_Rect rect;
+ std::unique_ptr<int32[]> lw = nullptr;
+ int field = -1;
+} SoftFB[2];
+
+static bool SoftFB_BackBuffer = false;
+
+static std::atomic_int VTReady;
+static unsigned VTRotated = 0;
+static bool VTSSnapshot = false;
+static MThreading::Sem* VTWakeupSem;
+static MThreading::Mutex *VTMutex = NULL, *EVMutex = NULL;
+static MThreading::Mutex *StdoutMutex = NULL;
+
+//
+//
+//
+//
+//
+
+static bool sc_blit_timesync;
+
+static char *soundrecfn=0;	/* File name of sound recording. */
+
+static char *qtrecfn = NULL;
+
+static std::string DrBaseDirectory;
+
+MDFNGI *CurGame=NULL;
+
+
+#ifdef WIN32
+static std::string GetModuleFileName_UTF8(HMODULE hModule)
+{
+ const size_t path_size = 32767;
+ std::unique_ptr<char16_t[]> path(new char16_t[path_size]);
+ DWORD fnl;
+
+ fnl = GetModuleFileNameW(hModule, (LPWSTR)&path[0], path_size);
+ if(fnl == 0 || fnl == path_size)
+  throw MDFN_Error(0, "GetModuleFileNameW() error.");
+
+ return UTF16_to_UTF8(&path[0], nullptr, true);
+}
+
+// returns 1 if redirected, 0 if not redirected due to error, -1 if not redirected due to env variable
+static int RedirectSTDxxx(void)
+{
+ const char* env_noredir = getenv("MEDNAFEN_NOSTDREDIR");
+
+ if(env_noredir && atoi(env_noredir))
+  return -1;
+ //
+ //
+ //
+ std::string path;
+ size_t catpos;	// Meow meow.
+
+ path = GetModuleFileName_UTF8(NULL);
+ if((catpos = path.find_last_of('\\')) != std::string::npos)
+  path.resize(catpos + 1);
+
+ const std::u16string stdout_path = UTF8_to_UTF16(path + "stdout.txt", nullptr, true);
+ const std::u16string stderr_path = UTF8_to_UTF16(path + "stderr.txt", nullptr, true);
+ int new_stdout = -1;
+ int new_stderr = -1;
+
+ new_stdout = _wopen((const wchar_t*)stdout_path.c_str(), O_WRONLY | O_CREAT | O_TRUNC, _S_IREAD | _S_IWRITE);
+ new_stderr = _wopen((const wchar_t*)stderr_path.c_str(), O_WRONLY | O_CREAT | O_TRUNC, _S_IREAD | _S_IWRITE);
+
+ // Not sure if we need to handle stdin here...
+
+ if(new_stdout != -1 && new_stderr != -1)
+ {
+  fflush(stdout);
+  fflush(stderr);
+
+  dup2(new_stdout, fileno(stdout));
+  dup2(new_stderr, fileno(stderr));
+
+  close(new_stdout);
+  close(new_stderr);
+
+  return true;
+ }
+ else
+ {
+  if(new_stdout != -1)
+   close(new_stdout);
+
+  if(new_stderr != -1)
+   close(new_stderr);
+
+  return false;
+ }
+}
+
+static bool HandleConsoleMadness(void)
+{
+ HWND cwin = GetConsoleWindow();
+ bool ret = false;
+
+ if(cwin)
+ {
+  DWORD cwin_pid = 0;
+
+  SetConsoleOutputCP(65001);	// UTF-8
+
+  ret = true;
+
+  GetWindowThreadProcessId(cwin, &cwin_pid);
+  if(GetCurrentProcessId() == cwin_pid)
+  {
+   if(RemoteOn || RedirectSTDxxx())
+   {
+    // Just hide the console window, don't call FreeConsole(), as Windows 10 does something weird that feels
+    // like it's asynchronously screwing with the stdout and stderr file descriptors/handles.
+    ShowWindow(cwin, SW_HIDE);
+    ret = false;
+   }
+  }
+ }
+ else if(!RedirectSTDxxx())
+ {
+  if(AllocConsole())
+  {
+   SetConsoleOutputCP(65001);	// UTF-8
+   //
+   HANDLE hand_stdout, hand_stderr;
+
+   hand_stdout = GetStdHandle(STD_OUTPUT_HANDLE);
+   hand_stderr = GetStdHandle(STD_ERROR_HANDLE);
+
+   if(hand_stdout && hand_stderr)
+   {
+    int new_stdout = _open_osfhandle((intptr_t)hand_stdout, _O_WRONLY);
+    int new_stderr = _open_osfhandle((intptr_t)hand_stderr, _O_WRONLY);
+
+    if(new_stdout != -1 && new_stderr != -1)
+    {
+     fflush(stdout);
+     fflush(stderr);
+
+     dup2(new_stdout, fileno(stdout));
+     dup2(new_stderr, fileno(stderr));
+
+     close(new_stdout);
+     close(new_stderr);
+    }
+   }
+  }
+  ret = false;	// We still want console-less behavior elsewhere.
+ }
+
+ return ret;
+}
+#endif
+
+void Mednafen::MDFND_OutputNotice(MDFN_NoticeType t, const char* s) noexcept
+{
+ bool did_message_box = false;
+
+ if(RemoteOn)
+ {
+  if(t == MDFN_NOTICE_ERROR)
+   Remote_SendErrorMessage(s);
+  else if(t == MDFN_NOTICE_WARNING)
+   Remote_SendWarningMessage(s);
+ }
+ else if(t != MDFN_NOTICE_STATUS)
+ {
+  if(StdoutMutex)
+   MThreading::LockMutex(StdoutMutex);
+ 
+  puts(s);
+  fflush(stdout);
+
+  if(StdoutMutex)
+   MThreading::UnlockMutex(StdoutMutex);
+  //
+  //
+  //
+  if(MThreading::ThreadID() == MainThreadID && !SuppressErrorPopups)
+  {
+   const char* title = "";
+
+   if(t == MDFN_NOTICE_ERROR)
+    title = _("Mednafen(" MEDNAFEN_VERSION ") Error");
+   else
+    title = _("Mednafen(" MEDNAFEN_VERSION ") Warning");
+
+   did_message_box = Video_ErrorPopup((t != MDFN_NOTICE_ERROR), title, s);
+  }
+ }
+ //
+ //
+ //
+ if(!did_message_box)
+ {
+  char* ds = strdup(s);
+
+  if(!ds)
+  {
+
+  }
+  else
+  {
+   SendCEvent(CEVT_OUTPUT_NOTICE, ds, nullptr, (uint16)t);
+  }
+ }
+}
+
+void Mednafen::MDFND_OutputInfo(const char *s) noexcept
+{
+ if(RemoteOn)
+  Remote_SendInfoMessage(s);
+ else
+ {
+  if(StdoutMutex)
+   MThreading::LockMutex(StdoutMutex);
+
+  fputs(s,stdout);
+  fflush(stdout);
+
+  if(StdoutMutex)
+   MThreading::UnlockMutex(StdoutMutex);
+ }
+}
+
+static void CreateDirs(void)
+{
+ static const char* const subs[] = { "mcs", "mcm", "snaps", "palettes", "sav", "cheats", "firmware", "pgconfig" };
+
+ NVFS.mkdir(DrBaseDirectory, false);
+
+ for(auto const& s : subs)
+ {
+  std::string tdir = DrBaseDirectory + PSS + s;
+
+  NVFS.mkdir(tdir, false);
+ }
+}
+
+static bool volatile SignalSafeExitWanted = false;
+#if defined(HAVE_SIGNAL) || defined(HAVE_SIGACTION)
+static const char *SiginfoString = NULL;
+typedef struct
+{
+ int number;
+ const char *name;
+ const char *message;
+ const char *translated;	// Needed since gettext() can potentially deadlock when used in a signal handler.
+ const bool SafeTryExit;
+} SignalInfo;
+
+static SignalInfo SignalDefs[] =
+{
+ #ifdef SIGINT
+ { SIGINT, "SIGINT", gettext_noop("How DARE you interrupt me!\n"), NULL, TRUE },
+ #endif
+
+ #ifdef SIGTERM
+ { SIGTERM, "SIGTERM", gettext_noop("MUST TERMINATE ALL HUMANS\n"), NULL, TRUE },
+ #endif
+
+ #ifdef SIGHUP
+ { SIGHUP, "SIGHUP", gettext_noop("Reach out and hang-up on someone.\n"), NULL, FALSE },
+ #endif
+
+ #ifdef SIGSEGV
+ { SIGSEGV, "SIGSEGV", gettext_noop("Iyeeeeeeeee!!!  A segmentation fault has occurred.  Have a fluffy day.\n"), NULL, FALSE },
+ #endif
+
+ #ifdef SIGPIPE
+ { SIGPIPE, "SIGPIPE", gettext_noop("The pipe has broken!  Better watch out for floods...\n"), NULL, FALSE },
+ #endif
+
+ #if defined(SIGBUS) && SIGBUS != SIGSEGV
+ /* SIGBUS can == SIGSEGV on some platforms */
+ { SIGBUS, "SIGBUS", gettext_noop("I told you to be nice to the driver.\n"), NULL, FALSE },
+ #endif
+
+ #ifdef SIGFPE
+ { SIGFPE, "SIGFPE", gettext_noop("Those darn floating points.  Ne'er know when they'll bite!\n"), NULL, FALSE },
+ #endif
+
+ #ifdef SIGALRM
+ { SIGALRM, "SIGALRM", gettext_noop("Don't throw your clock at the meowing cats!\n"), NULL, TRUE },
+ #endif
+
+ #ifdef SIGABRT
+ { SIGABRT, "SIGABRT", gettext_noop("Abort, Retry, Ignore, Fail?\n"), NULL, FALSE },
+ #endif
+ 
+ #ifdef SIGUSR1
+ { SIGUSR1, "SIGUSR1", gettext_noop("Killing your processes is not nice.\n"), NULL, TRUE },
+ #endif
+
+ #ifdef SIGUSR2
+ { SIGUSR2, "SIGUSR2", gettext_noop("Killing your processes is not nice.\n"), NULL, TRUE },
+ #endif
+};
+
+static volatile int SignalSTDOUT;
+
+static void SetSignals(void (*t)(int))
+{
+ SignalSTDOUT = fileno(stdout);
+
+ SiginfoString = _("\nSignal has been caught and dealt with: ");
+ for(unsigned int x = 0; x < sizeof(SignalDefs) / sizeof(SignalInfo); x++)
+ {
+  if(!SignalDefs[x].translated)
+   SignalDefs[x].translated = _(SignalDefs[x].message);
+
+  #ifdef HAVE_SIGACTION
+  struct sigaction act;
+
+  memset(&act, 0, sizeof(struct sigaction));
+
+  act.sa_handler = t;
+  act.sa_flags = SA_RESTART;
+
+  sigaction(SignalDefs[x].number, &act, NULL);
+  #else
+  signal(SignalDefs[x].number, t);
+
+  //#ifdef HAVE_SIGINTERRUPT
+  //siginterrupt(SignalDefs[x].number, 0);
+  //#endif
+
+  #endif
+ }
+}
+
+static void SignalPutString(const char *string)
+{
+ size_t count = 0;
+
+ while(string[count]) { count++; }
+
+ write(SignalSTDOUT, string, count);
+}
+
+static void CloseStuff(int signum)
+{
+	const int save_errno = errno;
+	const char *name = "unknown";
+	const char *translated = NULL;
+	bool safetryexit = false;
+
+	for(unsigned int x = 0; x < sizeof(SignalDefs) / sizeof(SignalInfo); x++)
+	{
+	 if(SignalDefs[x].number == signum)
+	 {
+	  name = SignalDefs[x].name;
+	  translated = SignalDefs[x].translated;
+	  safetryexit = SignalDefs[x].SafeTryExit;
+	  break;
+	 }
+	}
+
+	SignalPutString(SiginfoString);
+	SignalPutString(name);
+        SignalPutString("\n");
+	SignalPutString(translated);
+
+	if(safetryexit)
+	{
+         SignalSafeExitWanted = safetryexit;
+	 errno = save_errno;
+         return;
+	}
+
+	_exit(1);
+}
+
+static void InstallSignalHandlers(void)
+{
+ SetSignals(CloseStuff);
+}
+
+static void RemoveSignalHandlers(void)
+{
+ SetSignals(SIG_IGN);
+}
+
+#else
+static void InstallSignalHandlers(void) { }
+static void RemoveSignalHandlers(void) { }
+#endif
+
+//
+//
+//
+#include <mednafen/FileStream.h>
+#include <mednafen/compress/GZFileStream.h>
+static void Stream64Test(const char* path)
+{
+ try
+ {
+  {
+   FileStream fp(path, FileStream::MODE_WRITE_SAFE);
+
+   assert(fp.tell() == 0);
+   assert(fp.size() == 0);
+   fp.put_BE<uint32>(0xDEADBEEF);
+   assert(fp.tell() == 4);
+   assert(fp.size() == 4);
+
+   fp.seek(0x7FFFFFFFU, SEEK_SET);
+   assert(fp.tell() == 0x7FFFFFFFU);
+   fp.truncate(0x7FFFFFFFU);
+   assert(fp.size() == 0x7FFFFFFFU);
+   fp.put_LE<uint8>(0xB0);
+   assert(fp.tell() == 0x80000000U);
+   assert(fp.size() == 0x80000000U);
+   fp.put_LE<uint8>(0x0F);
+   assert(fp.tell() == 0x80000001U);
+   assert(fp.size() == 0x80000001U);
+
+   fp.seek(0xFFFFFFFFU, SEEK_SET);
+   assert(fp.tell() == 0xFFFFFFFFU);
+   fp.truncate(0xFFFFFFFFU);
+   assert(fp.size() == 0xFFFFFFFFU);
+   fp.put_LE<uint8>(0xCA);
+   assert(fp.tell() == 0x100000000ULL);
+   assert(fp.size() == 0x100000000ULL);
+   fp.put_LE<uint8>(0xAD);
+   assert(fp.tell() == 0x100000001ULL);
+   assert(fp.size() == 0x100000001ULL);
+
+   fp.seek((uint64)8192 * 1024 * 1024, SEEK_SET);
+   fp.put_BE<uint32>(0xCAFEBABE);
+   assert(fp.tell() == (uint64)8192 * 1024 * 1024 + 4);
+   assert(fp.size() == (uint64)8192 * 1024 * 1024 + 4);
+
+   fp.put_BE<uint32>(0xAAAAAAAA);
+   assert(fp.tell() == (uint64)8192 * 1024 * 1024 + 8);
+   assert(fp.size() == (uint64)8192 * 1024 * 1024 + 8);
+
+   fp.truncate((uint64)8192 * 1024 * 1024 + 4);
+   assert(fp.size() == (uint64)8192 * 1024 * 1024 + 4);
+
+   fp.seek(-((uint64)8192 * 1024 * 1024 + 8), SEEK_CUR);
+   assert(fp.tell() == 0);
+   fp.seek((uint64)-4, SEEK_END);
+   assert(fp.tell() == (uint64)8192 * 1024 * 1024);
+  }
+
+  {
+   FileStream fp(path, FileStream::MODE_READ);
+   uint32 tmp;
+
+   assert(fp.size() == (uint64)8192 * 1024 * 1024 + 4);
+   tmp = fp.get_LE<uint32>();
+   assert(tmp == 0xEFBEADDE);
+   fp.seek((uint64)8192 * 1024 * 1024 - 4, SEEK_CUR);
+   tmp = fp.get_LE<uint32>(); 
+   assert(tmp == 0xBEBAFECA);
+  }
+
+  {
+   GZFileStream fp(path, GZFileStream::MODE::READ);
+   uint32 tmp;
+
+   tmp = fp.get_LE<uint32>();
+   assert(tmp == 0xEFBEADDE);
+   fp.seek((uint64)8192 * 1024 * 1024 - 4, SEEK_CUR);
+   tmp = fp.get_LE<uint32>(); 
+   assert(tmp == 0xBEBAFECA);  
+   assert(fp.tell() == (uint64)8192 * 1024 * 1024 + 4);
+  }
+ }
+ catch(std::exception& e)
+ {
+  printf("%s\n", e.what());
+  abort();
+ }
+}
+//
+//
+//
+#include <mednafen/cdrom/CDInterface.h>
+static void CDTest(const char* path)
+{
+ try
+ {
+  CDInterface* cds[2];
+  CDUtility::TOC toc[2];
+
+  cds[0] = CDInterface::Open(&NVFS, path, false);
+  cds[1] = CDInterface::Open(&NVFS, path, true);
+
+  for(unsigned i = 0; i < 2; i++)
+   cds[0]->ReadTOC(&toc[i]);
+
+  assert(!memcmp(&toc[0], &toc[1], sizeof(CDUtility::TOC)));
+
+  srand(0xDEADBEEF);
+
+  for(int32 lba = -150; lba < (int32)toc[0].tracks[100].lba + 5*60*75; lba++)
+  {
+   uint8 secbuf[2][2352 + 96];
+   uint8 pwobuf[2][96];
+
+   for(unsigned i = 0; i < 2; i++)
+   {
+    for(unsigned sbj = 0; sbj < 2352 + 96; sbj++)
+     secbuf[i][sbj] = rand() >> 8;
+
+    for(unsigned sbj = 0; sbj < 96; sbj++)
+     pwobuf[i][sbj] = rand() >> 8;
+
+    cds[i]->ReadRawSector(secbuf[i], lba);
+    cds[i]->ReadRawSectorPWOnly(pwobuf[i], lba, true);
+
+    for(unsigned p = 0; p < 96; p++)
+     assert(secbuf[i][2352 + p] == pwobuf[i][p]);
+   }
+   assert(!memcmp(secbuf[0], secbuf[1], 2352 + 96));
+   assert(!memcmp(pwobuf[0], pwobuf[1], 96));
+
+   uint8 subq[12];
+   CDUtility::subq_deinterleave(pwobuf[0], subq);
+   if(CDUtility::subq_check_checksum(subq))
+   {
+    /*if(lba == 0 || lba == 1)
+    {
+     for(unsigned i = 0; i < 12; i++)
+      printf("0x%02x ", subq[i]);
+     printf("\n");
+    }*/
+   }
+   else
+    printf("SubQ checksum error at lba=%d\n", lba);
+  }
+ }
+ catch(std::exception& e)
+ {
+  printf("%s\n", e.what());
+  abort();
+ }
+
+ printf("CDTest Done.\n");
+}
+//
+//
+//
+
+static int DoArgs_SetSetting(const char *name, const char *value)
+{
+ return MDFNI_SetSetting(name, value);
+}
+
+static int netconnect = 0;
+static char* loadcd = NULL;	// Deprecated
+static int which_medium = -2;
+
+static char* force_module_arg = NULL;
+static bool DoArgs(int argc, char *argv[], char **filename)
+{
+	const std::vector<MDFNCS>* const settings = MDFNI_GetSettings();
+	std::unique_ptr<ARGPSTRUCT[]> InternalArgs(new ARGPSTRUCT[1 + settings->size()]);
+
+	for(size_t x = 0; x < settings->size(); x++)
+	{
+	 const MDFNCS* sit = &(*settings)[x];
+
+	 InternalArgs[x].name = sit->name;
+	 InternalArgs[x].description = sit->desc->description ? _(sit->desc->description) : NULL;
+	 InternalArgs[x].var = NULL;
+	 InternalArgs[x].subs = (void *)DoArgs_SetSetting;
+	 InternalArgs[x].substype = SUBSTYPE_FUNCTION;
+	}
+	InternalArgs[settings->size()].name = NULL;
+	InternalArgs[settings->size()].var = NULL;
+	InternalArgs[settings->size()].subs = NULL;
+	//
+	//
+	//
+	int ShowCLHelp = 0;
+
+	char *dsfn = NULL;
+	char *dmfn = NULL;
+	char *dummy_remote = NULL;
+	char *stream64testpath = NULL;
+	char *cdtestpath = NULL;
+	int mtetest = 0;
+	int swiftresamptest = 0;
+	int owlresamptest = 0;
+
+        ARGPSTRUCT MDFNArgs[] = 
+	{
+	 { "help", _("Show help!"), &ShowCLHelp, 0, 0 },
+	 { "remote", _("Enable remote mode with the specified stdout key(EXPERIMENTAL AND INCOMPLETE)."), 0, &dummy_remote, SUBSTYPE_STRING_ALLOC },
+
+	 // -loadcd is deprecated and only still supported because it's been around for yeaaaars.
+	 { "loadcd", NULL/*_("Load and boot a CD for the specified system.")*/, 0, &loadcd, SUBSTYPE_STRING_ALLOC },
+
+	 { "which_medium", _("Start with specified disk/CD(numbered from 0) inserted."), 0, &which_medium, SUBSTYPE_INTEGER },
+
+	 { "force_module", _("Force usage of specified emulation module."), 0, &force_module_arg, SUBSTYPE_STRING_ALLOC },
+
+	 { "soundrecord", _("Record sound output to the specified filename in the MS WAV format."), 0,&soundrecfn, SUBSTYPE_STRING_ALLOC },
+	 { "qtrecord", _("Record video and audio output to the specified filename in the QuickTime format."), 0, &qtrecfn, SUBSTYPE_STRING_ALLOC }, // TODOC: Video recording done without filtering applied.
+
+	 { "dump_settings_def", _("Dump settings definition data to specified file."), 0, &dsfn, SUBSTYPE_STRING_ALLOC },
+	 { "dump_modules_def", _("Dump modules definition data to specified file."), 0, &dmfn, SUBSTYPE_STRING_ALLOC },
+
+         { 0, NULL, (int *)InternalArgs.get(), 0, 0},
+
+	 { "connect", _("Connect to the remote server and start network play."), &netconnect, 0, 0 },
+
+	 // Largefile support test(with FileStream and GZFileStream).
+	 { "stream64test", NULL, 0, &stream64testpath, SUBSTYPE_STRING_ALLOC },
+
+	 { "cdtest", NULL, 0, &cdtestpath, SUBSTYPE_STRING_ALLOC },
+
+	 // Multithreaded exception handling test.
+	 { "mtetest", NULL, &mtetest, 0, 0 },
+
+	 // Save state save->load->save consistency test.
+	 { "stateslstest", NULL, &StateSLSTest, 0, 0 },
+
+	 // Save state rewind consistency test.
+	 { "staterctest", NULL, &StateRCTest, 0, 0 },
+
+#if 0
+	 // Save state power consistency test.
+	 { "statepctest", NULL, &StatePCTest, 0, 0 },
+#endif
+
+	 // SwiftResampler test.
+	 { "swiftresamptest", NULL, &swiftresamptest, 0, 0 },
+
+	 // OwlResampler test.
+	 { "owlresamptest", NULL, &owlresamptest, 0, 0 },
+
+	 { 0, 0, 0, 0 }
+        };
+
+	const char *usage_string = _("Usage: %s [OPTION]... [FILE]\n");
+	if(argc <= 1)
+	{
+	 MDFN_Notify(MDFN_NOTICE_ERROR, _("No command-line arguments specified."));
+	 fprintf(stderr, "\n");
+	 fprintf(stderr, usage_string, argv[0]);
+	 fprintf(stderr, _("\tPlease refer to the documentation for option parameters and usage.\n\n"));
+	 return false;
+	}
+	else
+	{
+	 if(!ParseArguments(argc - 1, &argv[1], MDFNArgs, filename))
+	  return false;
+
+	 if(dummy_remote)
+	 {
+	  free(dummy_remote);
+	  dummy_remote = NULL;
+	 }
+
+	 if(ShowCLHelp)
+	 {
+          printf(usage_string, argv[0]);
+          ShowArgumentsHelp(MDFNArgs, false);
+	  printf("\n");
+	  printf(_("Each setting(listed in the documentation) can also be passed as an argument by prefixing the name with a hyphen,\nand specifying the value to change the setting to as the next argument.\n\n"));
+	  printf(_("For example:\n\t%s -pce.stretch aspect -pce.shader autoipsharper \"Hyper Bonk Soldier.pce\"\n\n"), argv[0]);
+	  printf(_("Settings specified in this manner are automatically saved to the configuration file, hence they\ndo not need to be passed to future invocations of the Mednafen executable.\n"));
+	  printf("\n");
+	  return false;
+	 }
+
+	 if(mtetest)
+	  MDFN_RunExceptionTests(4, 30000);
+
+	 if(swiftresamptest)
+	  MDFN_RunSwiftResamplerTest();
+
+	 if(owlresamptest)
+	  MDFN_RunOwlResamplerTest();
+
+	 if(stream64testpath)
+	 {
+	  Stream64Test(stream64testpath);
+	  free(stream64testpath);
+	  stream64testpath = NULL;
+	 }
+
+	 if(cdtestpath)
+	 {
+	  CDTest(cdtestpath);
+	  free(cdtestpath);
+	  cdtestpath = NULL;
+	 }
+
+	 if(dsfn)
+	  MDFNI_DumpSettingsDef(dsfn);
+
+	 if(dmfn)
+	  MDFNI_DumpModulesDef(dmfn);
+
+	 if(dsfn || dmfn)
+	  return false;
+
+	 if(*filename == NULL)
+	 {
+	  MDFN_Notify(MDFN_NOTICE_ERROR, _("No game filename specified!"));
+	  return false;
+	 }
+	}
+	return true;
+}
+
+static volatile unsigned NeedVideoSync = 0;
+static int GameLoop(void *arg);
+int volatile GameThreadRun = 0;
+static bool MDFND_Update(int WhichVideoBuffer, int16 *Buffer, int Count);
+
+bool sound_active;	// true if sound is enabled and initialized
+
+
+static EmuRealSyncher ers;
+
+static bool autosave_load_error = false;
+
+static int LoadGame(const char *force_module, const char *path)
+{
+	assert(MThreading::ThreadID() == MainThreadID);
+	//
+	MDFNGI *tmp;
+
+	CloseGame();
+
+	pending_save_state = false;
+	pending_save_movie = false;
+	pending_snapshot = false;
+	pending_ssnapshot = false;
+
+	if(loadcd)	// Deprecated
+	{
+	 if(!(tmp = MDFNI_LoadGame(loadcd ? loadcd : force_module, &::Mednafen::NVFS, path, true)))
+	  return(0);
+	}
+	else
+	{
+         if(!(tmp=MDFNI_LoadGame(force_module, &::Mednafen::NVFS, path)))
+	  return 0;
+	}
+	//
+	//
+	//
+#if 0
+	if(StatePCTest)
+	{
+	 MemoryStream state0(524288);
+	 MemoryStream state1(524288);
+	 MDFNI_Power();
+	 MDFNSS_SaveSM(&state0);
+	 state0.rewind();
+	 MDFNSS_LoadSM(&state0, false, true);
+	 MDFNI_CloseGame();
+         if(!(tmp=MDFNI_LoadGame(force_module, &::Mednafen::NVFS, path)))
+	  abort();
+	 MDFNI_Power();
+	 MDFNSS_SaveSM(&state1);
+	 state0.rewind();
+	 MDFNSS_LoadSM(&state0);
+	 MDFNI_CloseGame();
+         if(!(tmp=MDFNI_LoadGame(force_module, &::Mednafen::NVFS, path)))
+	  abort();
+
+	 if(!(state0.map_size() == state1.map_size() && !memcmp(state0.map() + 32, state1.map() + 32, state1.map_size() - 32)))
+	 {
+	  FileStream sd0("/tmp/sdump0", FileStream::MODE_WRITE);
+	  FileStream sd1("/tmp/sdump1", FileStream::MODE_WRITE);
+
+	  sd0.write(state0.map(), state0.map_size());
+	  sd1.write(state1.map(), state1.map_size());
+	  sd0.close();
+	  sd1.close();
+	  abort();
+	 }
+	}
+#endif
+	//
+	//
+	//
+	CurGame = tmp;
+	Input_GameLoaded(tmp);
+	RMDUI_Init(tmp, which_medium);
+
+        RefreshThrottleFPS(1);
+
+	sound_active = 0;
+
+        sc_blit_timesync = MDFN_GetSettingB("video.blit_timesync");
+
+	if(MDFN_GetSettingB("sound"))
+	 sound_active = Sound_Init(tmp);
+
+	// Load state before network connection.
+	// TODO: Move into core, MDFNI_LoadGame()
+        if(MDFN_GetSettingB("autosave"))
+	{
+	 if(!MDFNI_LoadState(NULL, "mca"))
+	 {
+	  autosave_load_error = true;
+	  return 0;
+	 }
+	}
+
+	if(netconnect)
+	 MDFNI_NetplayConnect();
+
+	ers.SetEmuClock(CurGame->MasterClock >> 32);
+
+	Debugger_Init();
+
+	if(qtrecfn)
+	{
+	// MDFNI_StartAVRecord() needs to be called after MDFNI_Load(Game/CD)
+         if(!MDFNI_StartAVRecord(qtrecfn, Sound_GetRate()))
+	 {
+	  free(qtrecfn);
+	  qtrecfn = NULL;
+
+	  return(0);
+	 }
+	}
+
+        if(soundrecfn)
+        {
+ 	 if(!MDFNI_StartWAVRecord(soundrecfn, Sound_GetRate()))
+         {
+          free(soundrecfn);
+          soundrecfn = NULL;
+
+	  return(0);
+         }
+        }
+
+	ffnosound = MDFN_GetSettingB("ffnosound");
+	RewindState = MDFN_GetSettingB("srwautoenable");
+	if(RewindState)
+	{
+	 MDFN_Notify(MDFN_NOTICE_STATUS, _("State rewinding functionality enabled."));
+	 MDFNI_EnableStateRewind(RewindState);
+	}
+
+	return 1;
+}
+
+/* Closes a game and frees memory. */
+int CloseGame(void)
+{
+	if(!CurGame) return(0);
+
+	GameThreadRun = 0;
+
+	if(GameThread)
+	{
+	 MThreading::WaitThread(GameThread, NULL);
+	 GameThread = NULL;
+	}
+
+        if(qtrecfn)	// Needs to be before MDFNI_Closegame() for now
+         MDFNI_StopAVRecord();
+
+        if(soundrecfn)
+         MDFNI_StopWAVRecord();
+
+	if(MDFN_GetSettingB("autosave") && !autosave_load_error)
+	 MDFNI_SaveState(NULL, "mca", NULL, NULL, NULL);
+
+	MDFNI_NetplayDisconnect();
+
+	Debugger_Kill();
+
+	MDFNI_CloseGame();
+
+	RMDUI_Kill();
+	Input_GameClosed();
+	Sound_Kill();
+
+	CurGame = NULL;
+
+	return(1);
+}
+
+static void GameThread_HandleEvents(void);
+static int volatile NeedExitNow = 0;	// Set 'true' in various places, including signal handler.
+double CurGameSpeed = 1;
+
+void MainRequestExit(void)
+{
+ NeedExitNow = 1;
+}
+
+bool Mednafen::MDFND_CheckNeedExit(void)	// Called from netplay code, so we can break out of blocking loops after receiving a signal.
+{
+ return (bool)NeedExitNow;
+}
+
+static bool InFrameAdvance = 0;
+static bool NeedFrameAdvance = 0;
+
+bool IsInFrameAdvance(void)
+{
+ return InFrameAdvance;
+}
+
+void DoRunNormal(void)
+{
+ NeedFrameAdvance = 0;
+ InFrameAdvance = 0;
+}
+
+void DoFrameAdvance(void)
+{
+ NeedFrameAdvance |= InFrameAdvance;
+ InFrameAdvance = 1;
+}
+
+static int GameLoopPaused = 0;
+
+void DebuggerFudge(void)
+{
+ const uint32 WaitMS = 10;
+ uint32 wt = Time::MonoMS() + WaitMS;
+
+ MDFND_Update(SoftFB_BackBuffer ^ 1, nullptr, 0);
+
+ wt -= Time::MonoMS();
+
+ if(wt > 0 && wt <= WaitMS)
+ {
+  if(sound_active)
+   Sound_WriteSilence(wt);
+  else
+   Time::SleepMS(wt);
+ }
+}
+
+static int GameLoop(void *arg)
+{
+	while(GameThreadRun)
+	{
+         int16 *sound;
+         int32 ssize;
+         bool fskip;
+        
+	 /* If we requested a new video mode, wait until it's set before calling the emulation code again.
+	 */
+	 while(NeedVideoSync)
+	 {
+	  if(!GameThreadRun) return(1);	// Might happen if video initialization failed
+	  Time::SleepMS(2);
+	 }
+
+	 if(Sound_NeedReInit())
+	  GT_ReinitSound();
+
+	 if(MDFNDnetplay && !(NoWaiting & 0x2))	// TODO: Hacky, clean up.
+	  ers.SetETtoRT();
+	 //
+	 //
+	 fskip = ers.NeedFrameSkip();
+	 fskip &= MDFN_GetSettingB("video.frameskip");
+	 fskip &= !(pending_ssnapshot || pending_snapshot || pending_save_state || pending_save_movie || NeedFrameAdvance);
+	 fskip |= (bool)NoWaiting;
+
+	 //printf("fskip %d; NeedFrameAdvance=%d\n", fskip, NeedFrameAdvance);
+
+	 NeedFrameAdvance = false;
+	 //
+	 //
+	 SoftFB[SoftFB_BackBuffer].lw[0] = ~0;
+
+	 //
+	 //
+	 //
+	 EmulateSpecStruct espec;
+
+         espec.surface = SoftFB[SoftFB_BackBuffer].surface.get();
+         espec.LineWidths = SoftFB[SoftFB_BackBuffer].lw.get();
+	 espec.skip = fskip;
+	 espec.soundmultiplier = CurGameSpeed;
+	 espec.NeedRewind = DNeedRewind;
+
+ 	 espec.SoundRate = Sound_GetRate();
+	 espec.SoundBuf = Sound_GetEmuModBuffer(&espec.SoundBufMaxSize);
+ 	 espec.SoundVolume = (double)MDFN_GetSettingUI("sound.volume") / 100;
+
+	 if(MDFN_UNLIKELY(StateRCTest))
+	 {
+	  // Note: Won't work correctly with modules that do mid-sync.
+	  EmulateSpecStruct estmp = espec;
+
+	  MemoryStream state0(524288);
+	  MemoryStream state1(524288);
+	  MemoryStream state2(524288);
+
+	  MDFNSS_SaveSM(&state0);
+	  MDFNI_Emulate(&espec);
+	  espec = estmp;
+
+	  MDFNSS_SaveSM(&state1);
+	  state0.rewind();
+	  MDFNSS_LoadSM(&state0);
+	  MDFNI_Emulate(&espec);
+	  MDFNSS_SaveSM(&state2);
+
+	  if(!(state1.map_size() == state2.map_size() && !memcmp(state1.map() + 32, state2.map() + 32, state1.map_size() - 32)))
+	  {
+	   FileStream sd0("/tmp/sdump0", FileStream::MODE_WRITE);
+	   FileStream sd1("/tmp/sdump1", FileStream::MODE_WRITE);
+
+	   sd0.write(state1.map(), state1.map_size());
+	   sd1.write(state2.map(), state2.map_size());
+	   sd0.close();
+	   sd1.close();
+	   //assert(orig_state.map_size() == new_state.map_size() && !memcmp(orig_state.map() + 32, new_state.map() + 32, orig_state.map_size() - 32));
+	   abort();
+	  }
+	 }
+	 else
+          MDFNI_Emulate(&espec);
+
+	 if(MDFN_UNLIKELY(StateSLSTest))
+	 {
+	  MemoryStream orig_state(524288);
+	  MemoryStream new_state(524288);
+
+	  MDFNSS_SaveSM(&orig_state);
+	  orig_state.rewind();
+	  MDFNSS_LoadSM(&orig_state);
+	  MDFNSS_SaveSM(&new_state);
+
+	  if(!(orig_state.map_size() == new_state.map_size() && !memcmp(orig_state.map() + 32, new_state.map() + 32, orig_state.map_size() - 32)))
+	  {
+	   FileStream sd0("/tmp/sdump0", FileStream::MODE_WRITE);
+	   FileStream sd1("/tmp/sdump1", FileStream::MODE_WRITE);
+
+	   sd0.write(orig_state.map(), orig_state.map_size());
+	   sd1.write(new_state.map(), new_state.map_size());
+	   sd0.close();
+	   sd1.close();
+	   //assert(orig_state.map_size() == new_state.map_size() && !memcmp(orig_state.map() + 32, new_state.map() + 32, orig_state.map_size() - 32));
+	   abort();
+	  }
+	 }
+
+	 ers.AddEmuTime((espec.MasterCycles - espec.MasterCyclesALMS) / CurGameSpeed);
+
+	 SoftFB[SoftFB_BackBuffer].rect = espec.DisplayRect;
+	 SoftFB[SoftFB_BackBuffer].field = espec.InterlaceOn ? espec.InterlaceField : -1;
+
+	 sound = espec.SoundBuf + (espec.SoundBufSizeALMS * CurGame->soundchan);
+	 ssize = espec.SoundBufSize - espec.SoundBufSizeALMS;
+	 //
+	 //
+	 //
+
+	 FPS_IncVirtual(espec.MasterCycles);
+	 if(!fskip)
+	  FPS_IncDrawn();
+
+
+	 {
+	  bool do_flip = false;
+
+	  do
+	  {
+ 	   if(fskip && ((InFrameAdvance && !NeedFrameAdvance) || GameLoopPaused))
+	   {
+	    // If this frame was skipped, and the game loop is paused(IE cheat interface is active) or we're in frame advance, just blit the last
+	    // drawn, non-skipped frame so the OSD elements actually get drawn.
+	    //
+	    // Needless to say, do not allow do_flip to be set to true here.
+	    //
+	    // Possible problems with this kludgery:
+	    //	Will fail spectacularly if there is no previous successful frame.  BOOOOOOM.  (But there always should be, especially since we initialize some
+  	    //   of the video buffer and rect structures during startup)
+	    //
+            MDFND_Update(SoftFB_BackBuffer ^ 1, sound, ssize);
+	   }
+	   else
+            do_flip = MDFND_Update(fskip ? -1 : SoftFB_BackBuffer, sound, ssize);
+
+	   FPS_UpdateCalc();
+
+	   Netplay_GT_CheckPendingLine();
+
+           if((InFrameAdvance && !NeedFrameAdvance) || GameLoopPaused)
+	   {
+            if(ssize)
+	     for(int x = 0; x < CurGame->soundchan * ssize; x++)
+	      sound[x] = 0;
+	   }
+	  } while(((InFrameAdvance && !NeedFrameAdvance) || GameLoopPaused) && GameThreadRun);
+	  SoftFB_BackBuffer ^= do_flip;
+	 }
+	}
+
+	return(1);
+}   
+
+
+std::string GetBaseDirectory(void)
+{
+#ifdef WIN32
+ {
+  const wchar_t* ol;
+
+  ol = _wgetenv(L"MEDNAFEN_HOME");
+  if(ol != NULL && ol[0] != 0)
+   return UTF16_to_UTF8((const char16_t*)ol, nullptr, true);
+
+  ol = _wgetenv(L"HOME");
+  if(ol)
+   return UTF16_to_UTF8((const char16_t*)ol, nullptr, true) + PSS + ".mednafen";
+ }
+
+ {
+  std::string path;
+  size_t lsp;
+
+  path = GetModuleFileName_UTF8(NULL);
+
+  if((lsp = path.find_last_of(u'\\')) != std::string::npos)
+   path.resize(lsp);
+
+  return path;
+ }
+#else
+ char *ol;
+
+ ol = getenv("MEDNAFEN_HOME");
+ if(ol != NULL && ol[0] != 0)
+ {
+  return std::string(ol);
+ }
+
+ ol = getenv("HOME");
+ if(ol)
+  return std::string(ol) + PSS + ".mednafen";
+
+ #if defined(HAVE_GETUID) && defined(HAVE_GETPWUID)
+ {
+  struct passwd *psw;
+
+  psw = getpwuid(getuid());
+
+  if(psw != NULL && psw->pw_dir[0] != 0 && strcmp(psw->pw_dir, "/dev/null"))
+   return std::string(psw->pw_dir) + PSS + ".mednafen";
+ }
+ #endif
+ return "";
+#endif
+}
+
+static const int gtevents_size = 2048; // Must be a power of 2.
+static volatile SDL_Event gtevents[gtevents_size];
+static volatile int gte_read = 0;
+static volatile int gte_write = 0;
+
+/* This function may also be called by the main thread if a game is not loaded. */
+/*
+ This function may be called from MDFND_MidSync(), so make sure that it doesn't call directly nor indirectly
+ any MDFNI_* functions that shouldn't be called.
+*/
+static void GameThread_HandleEvents(void)
+{
+ SDL_Event gtevents_temp[gtevents_size];
+ unsigned int numevents = 0;
+
+ MThreading::LockMutex(EVMutex);
+ while(gte_read != gte_write)
+ {
+  memcpy(&gtevents_temp[numevents], (void *)&gtevents[gte_read], sizeof(SDL_Event));
+
+  numevents++;
+  gte_read = (gte_read + 1) & (gtevents_size - 1);
+ }
+ MThreading::UnlockMutex(EVMutex);
+
+ for(unsigned int i = 0; i < numevents; i++)
+ {
+  SDL_Event *event = &gtevents_temp[i];
+
+  switch(event->type)
+  {
+   case SDL_USEREVENT:
+		switch(event->user.code & 0xFFFF)
+		{
+		 case CEVT_SET_INPUT_FOCUS:
+			MDFNDHaveFocus = (event->user.data1 != NULL);
+			//printf("%u\n", MDFNDHaveFocus);
+			break;
+		}
+		break;
+  }
+
+  Input_Event(event);
+
+  if(Debugger_IsActive())
+   Debugger_GT_Event(event);
+ }
+}
+
+void PauseGameLoop(bool p)
+{
+ GameLoopPaused = p;
+}
+
+
+void SendCEvent(unsigned int code, void *data1, void *data2, uint16 idata16)
+{
+ SDL_Event evt;
+ evt.user.type = SDL_USEREVENT;
+ evt.user.code = code | (idata16 << 16);
+ evt.user.data1 = data1;
+ evt.user.data2 = data2;
+ SDL_PushEvent(&evt);
+}
+
+static void SendCEvent_to_GT(unsigned int code, void *data1, void *data2, uint16 idata16 = 0)
+{
+ SDL_Event evt;
+ evt.user.type = SDL_USEREVENT;
+ evt.user.code = code | (idata16 << 16);
+ evt.user.data1 = data1;
+ evt.user.data2 = data2;
+
+ MThreading::LockMutex(EVMutex);
+ memcpy((void *)&gtevents[gte_write], &evt, sizeof(SDL_Event));
+ gte_write = (gte_write + 1) & (gtevents_size - 1);
+ MThreading::UnlockMutex(EVMutex);
+}
+
+void GT_ToggleFS(void)
+{
+ // assert(MThreading::ThreadID() == GameThreadID);
+ MThreading::LockMutex(VTMutex);
+ MDFNI_SetSettingB("video.fs", !MDFN_GetSettingB("video.fs"));
+ NeedVideoSync++;
+ MThreading::UnlockMutex(VTMutex);
+
+ MThreading::PostSem(VTWakeupSem);
+ while(NeedVideoSync && GameThreadRun)
+ {
+  Time::SleepMS(2);
+ }
+}
+
+bool GT_ReinitVideo(void)
+{
+ // assert(MThreading::ThreadID() == GameThreadID);
+ MThreading::LockMutex(VTMutex);
+ NeedVideoSync++;
+ MThreading::UnlockMutex(VTMutex);
+
+ MThreading::PostSem(VTWakeupSem);
+ while(NeedVideoSync && GameThreadRun)
+ {
+  Time::SleepMS(2);
+ }
+
+ return(true);	// FIXME!
+}
+
+bool GT_ReinitSound(void)
+{
+ bool ret = true;
+
+ Sound_Kill();
+ sound_active = 0;
+
+ if(MDFN_GetSettingB("sound"))
+ {
+  sound_active = Sound_Init(CurGame);
+  if(!sound_active)
+   ret = false;
+ }
+
+ return(ret);
+}
+
+void GT_SetWMInputBehavior(bool CursorNeeded, bool MouseAbsNeeded, bool MouseRelNeeded, bool GrabNeeded)
+{
+ SendCEvent(CEVT_SET_WMINPUTBEHAVIOR, nullptr, nullptr, (CursorNeeded << 0) | (MouseAbsNeeded << 1) | (MouseRelNeeded << 2) | (GrabNeeded << 3));
+}
+
+void PumpWrap(void)
+{
+ SDL_Event event;
+ SDL_Event gtevents_temp[gtevents_size];
+ int numevents = 0;
+
+ if(SignalSafeExitWanted)
+  NeedExitNow = true;
+
+ while(SDL_PollEvent(&event))
+ {
+  if(CheatIF_Active())
+   CheatIF_MT_EventHook(&event);
+
+  NetplayEventHook(&event);
+
+  /* Handle the event, and THEN hand it over to the GUI. Order is important due to global variable mayhem(CEVT_TOGGLEFS. */
+  switch(event.type)
+  {
+   case SDL_WINDOWEVENT:
+	// event.window.windowID
+	switch(event.window.event)
+	{
+	 case SDL_WINDOWEVENT_EXPOSED:
+		Video_Exposed();
+		break;
+
+	 case SDL_WINDOWEVENT_FOCUS_GAINED:
+		//SDL_ShowWindow(window);
+		//SDL_RestoreWindow(window);
+		//puts("Gain");
+		SendCEvent_to_GT(CEVT_SET_INPUT_FOCUS, (void*)gtevents/* Dummy valid pointer*/, NULL);
+		break;
+
+	 case SDL_WINDOWEVENT_FOCUS_LOST:
+		//puts("Lost");
+		SendCEvent_to_GT(CEVT_SET_INPUT_FOCUS, NULL, NULL);
+		break;
+	}
+	break;
+
+   case SDL_QUIT:
+	NeedExitNow = 1;
+	break;
+
+   case SDL_USEREVENT:
+	{
+	const uint16 idata16 = event.user.code >> 16;
+
+	switch(event.user.code & 0xFFFF)
+	{
+	 case CEVT_SET_STATE_STATUS:
+		MT_SetStateStatus((StateStatusStruct *)event.user.data1);
+		break;
+
+	 case CEVT_SET_MOVIE_STATUS:
+		MT_SetMovieStatus((StateStatusStruct *)event.user.data1);
+		break;
+
+	 case CEVT_WANT_EXIT:
+		if(!Netplay_TryTextExit())
+		{
+		 SDL_Event evt;
+		 evt.quit.type = SDL_QUIT;
+		 SDL_PushEvent(&evt);
+		}
+		break;
+
+	 case CEVT_SET_WMINPUTBEHAVIOR:
+		NeededWMInputBehavior.Cursor = (bool)(idata16 & 0x1);
+		NeededWMInputBehavior.MouseAbs = (bool)(idata16 & 0x2);
+		NeededWMInputBehavior.MouseRel = (bool)(idata16 & 0x4);
+		NeededWMInputBehavior.Grab = (bool)(idata16 & 0x8);
+		NeededWMInputBehavior_Dirty = true;
+		break;
+
+  	 case CEVT_OUTPUT_NOTICE:
+		Video_ShowNotice((MDFN_NoticeType)idata16, (char*)event.user.data1);
+		break;
+
+	 default: 
+		if(numevents < gtevents_size)
+		{
+		 memcpy(&gtevents_temp[numevents], &event, sizeof(SDL_Event));
+		 numevents++;
+		}
+		break;
+	}
+	}
+	break;
+
+   default: 
+	if(numevents < gtevents_size)
+	{
+	 memcpy(&gtevents_temp[numevents], &event, sizeof(SDL_Event));
+	 numevents++;
+	}
+	break;
+  }
+ }
+
+ if(numevents > 0)
+ {
+  MThreading::LockMutex(EVMutex);
+  for(int i = 0; i < numevents; i++)
+  {
+   memcpy((void *)&gtevents[gte_write], &gtevents_temp[i], sizeof(SDL_Event));
+   gte_write = (gte_write + 1) & (gtevents_size - 1);
+  }
+  MThreading::UnlockMutex(EVMutex);
+ }
+
+ if(!CurGame)
+  GameThread_HandleEvents();
+}
+
+void RefreshThrottleFPS(double multiplier)
+{
+        CurGameSpeed = multiplier;
+}
+
+void PrintCompilerVersion(void)
+{
+ #if defined(__GNUC__)
+  MDFN_printf(_("Compiled with gcc %s\n"), __VERSION__);
+ #endif
+
+ #ifdef HAVE___MINGW_GET_CRT_INFO
+  MDFN_printf(_("Running with %s\n"), __mingw_get_crt_info());
+ #endif
+}
+
+#if 0
+#include <vector>	// To make sure we pick up c++config.h if it's there
+void PrintGLIBCXXInfo(void)
+{
+ #if defined(__GLIBCXX__)
+  MDFN_printf(_("Compiled with GNU libstdc++ %lu\n"), (unsigned long)__GLIBCXX__);
+  {
+   MDFN_AutoIndent aind(1);
+   const char* sjljresp;
+   #if defined(_GLIBCXX_SJLJ_EXCEPTIONS)
+    sjljresp = _("Yes");
+   #else
+    sjljresp = _("No");
+   #endif
+   MDFN_printf(_("Using SJLJ Exceptions: %s\n"), sjljresp);
+  }
+ #endif
+}
+#endif
+
+void PrintSDLVersion(void)
+{
+ SDL_version sver;
+
+ SDL_GetVersion(&sver);
+
+ MDFN_printf(_("Compiled against SDL %u.%u.%u(%s), running with SDL %u.%u.%u(%s)\n"), SDL_MAJOR_VERSION, SDL_MINOR_VERSION, SDL_PATCHLEVEL, SDL_REVISION, sver.major, sver.minor, sver.patch, SDL_GetRevision());
+
+ if(SDL_VERSIONNUM(sver.major, sver.minor, sver.patch) < SDL_VERSIONNUM(SDL_MAJOR_VERSION, SDL_MINOR_VERSION, SDL_PATCHLEVEL))
+ {
+  MDFN_Notify(MDFN_NOTICE_ERROR, _("Running with a version of SDL older than the version compiled and linked against!"));
+  abort();
+ }
+}
+
+#ifdef HAVE_LIBSNDFILE
+ #include <sndfile.h>
+#endif
+
+void PrintLIBSNDFILEVersion(void)
+{
+ #ifdef HAVE_LIBSNDFILE
+  MDFN_printf(_("Running with %s\n"), sf_version_string());
+ #endif
+}
+
+#include <zlib.h>
+void PrintZLIBVersion(void)
+{
+ #ifdef ZLIB_VERSION
+  MDFN_printf(_("Compiled against zlib %s, running with zlib %s(flags=0x%08lx)\n"), ZLIB_VERSION, zlibVersion(), (unsigned long)zlibCompileFlags());
+ #endif
+}
+
+void PrintLIBICONVVersion(void)
+{
+ #ifdef _LIBICONV_VERSION
+  MDFN_printf(_("Compiled against libiconv %u.%u, running with libiconv %u.%u\n"), _LIBICONV_VERSION & 0xFF, _LIBICONV_VERSION >> 8,
+										   _libiconv_version & 0xFF, _libiconv_version >> 8);
+ #endif
+}
+
+#if 0//#ifdef WIN32
+char *GetFileDialog(void)
+{
+ OPENFILENAME ofn;
+ char returned_fn[2048];
+ std::string filter;
+ bool first_extension = true;
+
+ filter = std::string("Recognized files");
+ filter.push_back(0);
+
+ for(unsigned int i = 0; i < MDFNSystems.size(); i++)
+ {
+  if(MDFNSystems[i]->FileExtensions)
+  {
+   const FileExtensionSpecStruct *fesc = MDFNSystems[i]->FileExtensions;
+
+   while(fesc->extension && fesc->description)
+   {
+    if(!first_extension)
+     filter.push_back(';');
+
+    filter.push_back('*');
+    filter += std::string(fesc->extension);
+
+    first_extension = false;
+    fesc++;
+   }
+  }
+ }
+
+ filter.push_back(0);
+ filter.push_back(0);
+
+ //fwrite(filter.data(), 1, filter.size(), stdout);
+
+ memset(&ofn, 0, sizeof(ofn));
+
+ ofn.lStructSize = sizeof(ofn);
+ ofn.lpstrTitle = "Mednafen Open File";
+ ofn.lpstrFilter = filter.data();
+
+ ofn.nMaxFile = sizeof(returned_fn);
+ ofn.lpstrFile = returned_fn;
+
+ ofn.Flags = OFN_EXPLORER | OFN_FILEMUSTEXIST | OFN_HIDEREADONLY;
+
+ if(GetOpenFileName(&ofn))
+  return(strdup(returned_fn));
+ 
+ return(NULL);
+}
+#endif
+
+#if 0
+static MThreading::Mutex* milk_mutex = NULL;
+static MThreading::Cond* milk_cond = NULL;
+static volatile unsigned cow_milk = 0;
+static volatile unsigned farmer_milk = 0;
+static volatile unsigned calf_milk = 0;
+static volatile unsigned am3000_milk = 0;
+
+static int CowEntry(void*)
+{
+ uint32 start_time = Time::MonoMS();
+
+ for(unsigned i = 0; i < 1000 * 1000; i++)
+ {
+  MThreading::LockMutex(milk_mutex);
+  cow_milk++;
+
+  MThreading::SignalCond(milk_cond);
+  MThreading::UnlockMutex(milk_mutex);
+
+  while(cow_milk != 0);
+ }
+
+ while(cow_milk != 0);
+
+ return(Time::MonoMS() - start_time);
+}
+
+static int FarmerEntry(void*)
+{
+ MThreading::LockMutex(milk_mutex);
+ while(1)
+ {
+  MThreading::WaitCond(milk_cond, milk_mutex);
+
+  farmer_milk += cow_milk;
+  cow_milk = 0;
+ }
+ MThreading::UnlockMutex(milk_mutex);
+ return(0);
+}
+
+static int CalfEntry(void*)
+{
+ MThreading::LockMutex(milk_mutex);
+ while(1)
+ {
+  MThreading::WaitCond(milk_cond, milk_mutex);
+
+  calf_milk += cow_milk;
+  cow_milk = 0;
+ }
+ MThreading::UnlockMutex(milk_mutex);
+ return(0);
+}
+
+static int AutoMilker3000Entry(void*)
+{
+ MThreading::LockMutex(milk_mutex);
+ while(1)
+ {
+  MThreading::WaitCond(milk_cond, milk_mutex);
+
+  am3000_milk += cow_milk;
+  cow_milk = 0;
+ }
+ MThreading::UnlockMutex(milk_mutex);
+ return(0);
+}
+
+static void ThreadTest(void)
+{
+ MThreading::Thread *cow_thread, *farmer_thread, *calf_thread, *am3000_thread;
+ int rec;
+
+ milk_mutex = MThreading::CreateMutex();
+ milk_cond = MThreading::CreateCond();
+
+ //farmer_thread = MThreading::CreateThread(FarmerEntry, NULL);
+ //calf_thread = MThreading::CreateThread(CalfEntry, NULL);
+ //am3000_thread = MThreading::CreateThread(AutoMilker3000Entry, NULL);
+
+ cow_thread = MThreading::CreateThread(CowEntry, NULL);
+ MThreading::WaitThread(cow_thread, &rec);
+
+ printf("%8u %8u %8u --- %8u, time=%u\n", farmer_milk, calf_milk, am3000_milk, farmer_milk + calf_milk + am3000_milk, rec);
+
+ exit(0);
+}
+
+#endif
+
+static bool LoadSettings(void)
+{
+ const std::string npath = DrBaseDirectory + PSS + "mednafen.cfg";
+ bool mednafencfg_old = false;	// old or nonexistent
+
+ try
+ {
+  std::unique_ptr<FileStream> fp(new FileStream(npath, FileStream::MODE_READ));
+  std::string linebuf;
+
+  if(fp->get_line(linebuf) >= 0)
+  {
+   if(linebuf.find(";VERSION 0.") != std::string::npos)
+    mednafencfg_old = true;
+  }
+  fp.reset(nullptr);
+  //
+  if(mednafencfg_old)
+  {
+   char tmp[256];
+   trio_snprintf(tmp, sizeof(tmp), "%llu", (unsigned long long)Time::EpochTime());
+   NVFS.rename(npath, npath + "." + tmp);
+  }
+ }
+ catch(MDFN_Error& e)
+ {
+  if(e.GetErrno() == ENOENT)
+   mednafencfg_old = true;
+  else
+  {
+   MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+   return false;
+  }
+ }
+
+ if(mednafencfg_old)
+ {
+  switch(MDFNI_LoadSettings((DrBaseDirectory + PSS + "mednafen-09x.cfg").c_str()))
+  {
+   case -1: return true;
+   case 0: return false;
+  }
+  //
+  MDFNI_SetSetting("video.driver", MDFNI_GetSettingDefault("video.driver"));
+  //
+#ifdef WIN32
+  try
+  {
+   const std::vector<MDFNCS>* cs = MDFNI_GetSettings();
+   for(const MDFNCS& s : *cs)
+   {
+    if(s.desc->flags & MDFNSF_CAT_PATH)
+    {
+     assert(s.desc->type == MDFNST_STRING);
+     //
+     const size_t s_value_len = strlen(s.value);
+     if(s_value_len > 0)
+     {
+      int req;
+
+      if((req = MultiByteToWideChar(CP_ACP, 0, s.value, s_value_len, NULL, 0)) > 0) // not CP_THREAD_ACP
+      {
+       std::unique_ptr<char16_t[]> ws(new char16_t[req]);
+
+       if(MultiByteToWideChar(CP_ACP, 0, s.value, s_value_len, (wchar_t*)ws.get(), req) == req)
+        MDFNI_SetSetting(s.name, UTF16_to_UTF8(ws.get(), req));
+       else
+        throw MDFN_Error(0, _("Error converting value of setting \"%s\" to UTF-8."), s.name);
+      }
+      else
+       throw MDFN_Error(0, _("Error converting value of setting \"%s\" to UTF-8."), s.name);
+     }
+    }
+   }
+  }
+  catch(std::exception& e)
+  {
+   MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+   return false;
+  }
+#endif
+
+  return true;
+ }
+ else
+  return (bool)MDFNI_LoadSettings(npath.c_str());
+}
+
+static void SaveSettings(void)
+{
+ const std::string npath = DrBaseDirectory + PSS + "mednafen.cfg";
+
+ MDFNI_SaveSettings(npath.c_str());
+}
+
+#ifdef WIN32
+static char** MSW_GetArgcArgv(int *argc)
+{
+ wchar_t** argvw = CommandLineToArgvW(GetCommandLineW(), argc);
+ char** ret;
+
+ if(!argvw)
+  return nullptr;
+
+ if(!(ret = (char**)malloc((*argc + 1) * sizeof(char*))))
+  return nullptr;
+
+ ret[*argc] = nullptr;
+
+ for(int i = 0; i < *argc; i++)
+ {
+  const size_t argvw_i_slen = wcslen(argvw[i]);
+  size_t dlen = 0;
+
+  UTF16_to_UTF8((char16_t*)argvw[i], argvw_i_slen + 1, nullptr, &dlen, true);
+  if(!(ret[i] = (char*)malloc(dlen)))
+   return nullptr;
+  UTF16_to_UTF8((char16_t*)argvw[i], argvw_i_slen + 1, ret[i],  &dlen, true);
+ }
+
+ LocalFree(argvw);
+ argvw = nullptr;
+
+ return ret;
+}
+#endif
+
+
+#ifdef WIN32
+extern "C"
+{
+ void __set_app_type(int);
+ extern int mingw_app_type;
+}
+
+__attribute__((force_align_arg_pointer))	// Not sure what's going on to cause this to be needed.
+#endif
+int main(int argc, char *argv[])
+{
+	// SuppressErrorPopups must be set very early.
+	{
+	 char* mnp = getenv("MEDNAFEN_NOPOPUPS");
+
+	 if(mnp)
+	  SuppressErrorPopups = atoi(mnp);
+	 else
+	  SuppressErrorPopups = false;
+
+#ifdef WIN32
+	 // for assert() and abort()
+	 if(SuppressErrorPopups)
+	 {
+	  __set_app_type(1);
+	  mingw_app_type = 0;
+	 }
+	 else
+	 {
+	  __set_app_type(2);
+	  mingw_app_type = 1;
+	 }
+#endif
+	}
+	//
+	//
+	//
+	std::unique_ptr<FileStream> lockfs;
+	int FatalVideoError = -1;
+
+	#ifdef WIN32
+	if(!(argv = MSW_GetArgcArgv(&argc)))
+	{
+	 if(!SuppressErrorPopups)
+	  MessageBoxA(NULL, "Error getting/allocating arguments.", "Mednafen Startup Error", MB_OK | MB_ICONERROR | MB_TASKMODAL | MB_SETFOREGROUND | MB_TOPMOST);
+
+	 printf("Error getting/allocating arguments.\n");
+	 return -1;
+	}
+	#endif
+	// Place before calls to SDL_Init()
+	putenv(strdup("SDL_DISABLE_LOCK_KEYS=1"));
+	SDL_SetHint(SDL_HINT_NO_SIGNAL_HANDLERS, "1");
+	SDL_SetHint(SDL_HINT_GRAB_KEYBOARD, "1");
+	//
+	//
+	//
+	MainThreadID = MThreading::ThreadID();	// Must come before any direct or indirect calls to MDFND_OutputNotice()
+	//
+	//
+	//
+	if(argc >= 3 && (!MDFN_strazicmp(argv[1], "-remote") || !MDFN_strazicmp(argv[1], "--remote")))
+	{
+	 RemoteOn = true;
+	 InitSTDIOInterface(argv[2]);
+	}
+
+	#ifdef WIN32
+	HandleConsoleMadness();
+	#endif
+
+	//ThreadTest();
+	char *needie = NULL;
+
+        //
+
+	MDFNDHaveFocus = false;
+
+	DrBaseDirectory = GetBaseDirectory();
+
+	#ifdef ENABLE_NLS
+	setlocale(LC_ALL, "");
+
+	#ifdef WIN32
+	setlocale(LC_CTYPE, "C");
+	setlocale(LC_COLLATE, "C");
+	setlocale(LC_NUMERIC, "C");
+
+	for(int i = 128; i < 256; i++)
+	{
+	 assert(!isspace(i));
+	}
+
+        bindtextdomain(PACKAGE, DrBaseDirectory.c_str());
+	#else
+	bindtextdomain(PACKAGE, LOCALEDIR);
+	#endif
+
+	bind_textdomain_codeset(PACKAGE, "UTF-8");
+	textdomain(PACKAGE);
+	#endif
+	//
+	//
+	//
+	MDFNI_printf(_("Starting Mednafen %s\n"), MEDNAFEN_VERSION);
+	MDFN_indent(1);
+
+        MDFN_printf(_("Build information:\n"));
+        MDFN_indent(2);
+        PrintCompilerVersion();
+	//PrintGLIBCXXInfo();
+        PrintZLIBVersion();
+	PrintLIBICONVVersion();
+        PrintSDLVersion();
+        PrintLIBSNDFILEVersion();
+        MDFN_indent(-2);
+
+        MDFN_printf(_("Base directory: %s\n"), DrBaseDirectory.c_str());
+
+	if(SDL_Init(SDL_INIT_VIDEO)) /* SDL_INIT_VIDEO Needed for (joystick config) event processing? */
+	{
+	 fprintf(stderr, "Could not initialize SDL: %s\n", SDL_GetError());
+	 return -1;
+	}
+	SDL_JoystickEventState(SDL_IGNORE);
+	SDL_DisableScreenSaver();
+	//SDL_StopTextInput();
+
+	if(!(StdoutMutex = MThreading::CreateMutex()))
+	{
+	 MDFN_Notify(MDFN_NOTICE_ERROR, _("Could not create mutex: %s\n"), SDL_GetError());
+	 return -1;
+	}
+
+	if(!MDFNI_InitializeModules())
+	 return -1;
+
+	for(unsigned int x = 0; x < sizeof(DriverSettings) / sizeof(MDFNSetting); x++)
+	 NeoDriverSettings.push_back(DriverSettings[x]);
+
+	MakeDebugSettings(NeoDriverSettings);
+	Video_MakeSettings(NeoDriverSettings);
+	Input_MakeSettings(NeoDriverSettings);
+
+        if(!MDFNI_Initialize(DrBaseDirectory.c_str(), NeoDriverSettings))
+         return -1;
+	//
+	//
+	//
+	try
+	{
+	 CreateDirs();
+	}
+	catch(std::exception &e)
+	{
+	 MDFN_Notify(MDFN_NOTICE_ERROR, _("Error creating directories: %s\n"), e.what());
+	 return -1;
+	}
+	//
+	//
+	//
+	MDFN_printf(_("Opening lockfile...\n"));
+	{
+	 MDFN_AutoIndent aind(1);
+	 try
+	 {
+	  lockfs.reset(new FileStream(DrBaseDirectory + PSS + "mednafen.lck", FileStream::MODE_WRITE_INPLACE, -1));
+	 }
+	 catch(MDFN_Error& e)
+	 {
+	  if(e.GetErrno() == EWOULDBLOCK)	// Fragile, FIXME with proper class-specific error types.
+	  {
+	   char* env_aw = getenv("MEDNAFEN_ALLOWMULTI");
+
+	   if(env_aw && atoi(env_aw) != 0)
+	   {	
+	    MDFN_printf(_("Error, but proceeding anyway per environment variable \"MEDNAFEN_ALLOWMULTI\".\n"));
+	   }
+	   else
+	   {
+	    MDFN_Notify(MDFN_NOTICE_ERROR, _("Multiple instances of Mednafen using the same base directory should not run simultaneously, otherwise settings file changes may be lost, along with other similar problems.  If you understand the risks, and want to anyway, run Mednafen with environment variable \"MEDNAFEN_ALLOWMULTI\" set to \"1\" to bypass this check."));
+	    return -1;
+	   }
+	  }
+	  else
+	  {
+	   MDFN_printf(_("Error: %s\n"), e.what());
+	   MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+	   return -1;
+	  }
+	 }
+	 catch(std::exception& e)
+	 {
+	  MDFN_printf(_("Error: %s\n"), e.what());
+	  MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+	  return -1;
+	 }
+	}
+	//
+	//
+	//
+	if(!LoadSettings())
+	 return -1;
+
+	if(!DoArgs(argc, argv, &needie))
+	{
+	 SaveSettings();
+	 MDFNI_Kill();
+	 return -1;
+	}
+
+	InstallSignalHandlers();
+	//
+	//
+	//
+
+	/* Now the fun begins! */
+	/* Run the video and event pumping in the main thread, and create a 
+	   secondary thread to run the game in(and do sound output, since we use
+	   separate sound code which should be thread safe(?)).
+	*/
+	int ret = 0;
+
+	VTMutex = MThreading::CreateMutex();
+        EVMutex = MThreading::CreateMutex();
+
+	VTWakeupSem = MThreading::CreateSem();
+	//
+	Video_Init();
+	//
+	JoystickManager::Init();
+	JoystickManager::SetAnalogThreshold(MDFN_GetSettingF("analogthreshold") / 100);
+
+#if 0
+for(int zgi = 1; zgi < argc; zgi++)// start game load test loop
+{
+ needie = argv[zgi];
+#endif
+
+	VTReady.store(-1, std::memory_order_release);
+
+	NeedExitNow = 0;
+
+	#if 0
+	{
+	 int64 start_ticks = Time::MonoUS();
+
+	 for(int i = 0; i < 65536; i++)
+	  MDFN_GetSettingB("gg.forcemono");
+
+	 printf("%lld\n", (long long)(Time::MonoUS() - start_ticks));
+	}
+	#endif
+
+        if(LoadGame(force_module_arg, needie))
+        {
+         NeedVideoSync = 1;	// Set to 1 before creating game thread.
+	 //
+	 //
+	 GameThreadRun = 1;
+	 GameThread = MThreading::CreateThread(GameLoop, NULL, "MDFN Emulation");
+	 //
+	 //
+	 //
+	 uint32 pitch32 = CurGame->fb_width; 
+	 MDFN_PixelFormat nf(MDFN_COLORSPACE_RGB, 0, 8, 16, 24);
+
+         for(int i = 0; i < 2; i++)
+	 {
+	  SoftFB[i].surface.reset(new MDFN_Surface(NULL, CurGame->fb_width, CurGame->fb_height, pitch32, nf));
+          SoftFB[i].lw.reset(new int32[CurGame->fb_height]);
+
+	  SoftFB[i].surface->Fill(0, 0, 0, 0);
+
+	  //
+	  // Debugger step mode, cheat interface, and frame advance mode rely on the previous backbuffer being valid in certain situations.  Initialize some stuff here so that
+	  // reliance will still work even immediately after startup.
+	  SoftFB[i].rect.w = std::min<int32>(16, SoftFB[i].surface->w);
+	  SoftFB[i].rect.h = std::min<int32>(16, SoftFB[i].surface->h);
+	  SoftFB[i].lw[0] = ~0;
+	 }
+
+         FPS_Init(MDFN_GetSettingUI("fps.position"), MDFN_GetSettingUI("fps.scale"), MDFN_GetSettingUI("fps.font"), MDFN_GetSettingUI("fps.textcolor"), MDFN_GetSettingUI("fps.bgcolor"));
+	 if(MDFN_GetSettingB("fps.autoenable"))
+          FPS_ToggleView();
+        }
+	else
+	{
+	 ret = -1;
+	 NeedExitNow = 1;
+	}
+
+	while(MDFN_LIKELY(!NeedExitNow))
+	{
+	 MThreading::LockMutex(VTMutex);	/* Lock mutex */
+
+	 try
+	 {
+	  if(FatalVideoError > 0)
+	  {
+	   PumpWrap();
+	   NeedVideoSync = 0;
+	   NeededWMInputBehavior_Dirty = false;
+	   VTReady.store(-1, std::memory_order_release);
+	  }
+	  else
+	  {
+	   PumpWrap();
+
+	   if(MDFN_UNLIKELY(NeedVideoSync))
+           {
+	    Video_Sync(CurGame);
+	    PumpWrap();
+	    //
+	    NeedVideoSync = 0;
+           }
+
+	   if(NeededWMInputBehavior_Dirty)
+	   {
+	    Video_SetWMInputBehavior(NeededWMInputBehavior);
+	    NeededWMInputBehavior_Dirty = false;
+	   }
+
+	   {
+	    const int vtr = VTReady.load(std::memory_order_acquire);
+
+            if(vtr >= 0)
+            {
+             BlitScreen(SoftFB[vtr].surface.get(), &SoftFB[vtr].rect, SoftFB[vtr].lw.get(), VTRotated, SoftFB[vtr].field, VTSSnapshot);
+
+	     // Set to -1 after we're done blitting everything(including on-screen display stuff), and NOT just the emulated system's video surface.
+             VTReady.store(-1, std::memory_order_release);
+            }
+	   }
+	  }
+	  //
+	  //
+	  //
+	  if(FatalVideoError < 0)
+	   FatalVideoError = 0;
+	 }
+	 catch(std::exception& e)
+	 {
+	  MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+	  if(FatalVideoError == 0)
+	  {
+ 	   MThreading::UnlockMutex(VTMutex);   /* Unlock mutex */ 
+	   FatalVideoError = 1;
+	  }
+	  else
+	  {	  
+	   ret = -1;
+           NeedExitNow = 1;
+	   MThreading::UnlockMutex(VTMutex);   /* Unlock mutex */
+	   goto VideoErrorExit;
+	  }
+	 }
+
+         MThreading::UnlockMutex(VTMutex);   /* Unlock mutex */
+
+	 MThreading::WaitSemTimeout(VTWakeupSem, 1);
+	}
+	VideoErrorExit:;
+	//
+	//
+	//
+
+	CloseGame();
+
+	for(int i = 0; i < 2; i++)
+	{
+	 SoftFB[i].surface.reset(nullptr);
+	 SoftFB[i].lw.reset(nullptr);
+	}
+#if 0
+} // end game load test loop
+#endif
+
+	MThreading::DestroySem(VTWakeupSem);
+
+	MThreading::DestroyMutex(VTMutex);
+        MThreading::DestroyMutex(EVMutex);
+
+	RemoveSignalHandlers();
+
+	JoystickManager::Kill();
+
+	SaveSettings();	// Call before we destroy video, so the user has some feedback as to
+		        // when it's safe to start another Mednafen instance.
+
+	// lockfs.reset() after SaveSettings()
+	lockfs.reset(nullptr);
+
+	Video_Kill();
+
+	MDFNI_Kill();
+
+	SDL_Quit();
+
+        return ret;
+}
+
+
+static uint32 last_btime = 0;
+static void UpdateSoundSync(int16 *Buffer, uint32 Count)
+{
+ if(Count)
+ {
+  if(ffnosound && CurGameSpeed != 1)
+  {
+   for(uint32 x = 0; x < Count * CurGame->soundchan; x++)
+    Buffer[x] = 0;
+  }
+  //
+  //
+  //
+  const uint32 cw = Sound_CanWrite();
+  bool NeedETtoRT = (Count >= (cw * 0.95));
+
+  if(NoWaiting && Count > cw)
+  {
+   //printf("NW C to M; count=%d, max=%d\n", Count, max);
+   Count = cw;
+  }
+  else if(MDFNDnetplay)
+  {
+   //
+   // Cheap code to fix sound buffer underruns due to accumulation of time error during netplay.
+   //
+   uint32 dw = 0;
+
+   if(cw >= (Count * 7 / 4)) // || cw >= Sound_BufferSize())
+    dw = cw - std::min<uint32>(cw, Count);
+
+   if(dw)
+   {
+    int16 zbuf[128 * 2];	// *2 for stereo case.
+
+    //printf("DW: %u\n", dw);
+
+    memset(zbuf, 0, sizeof(zbuf));
+
+    while(dw != 0)
+    {
+     uint32 wti = std::min<int>(128, dw);
+     Sound_Write(zbuf, wti);
+     dw -= wti;
+    }
+    NeedETtoRT = true;
+   }
+  }
+
+  Sound_Write(Buffer, Count);
+
+  if(NeedETtoRT)
+   ers.SetETtoRT();
+ }
+ else
+ {
+  bool nothrottle = MDFN_GetSettingB("nothrottle");
+
+  if(!NoWaiting && !nothrottle && GameThreadRun && !MDFNDnetplay)
+   ers.Sync();
+ }
+}
+
+void Mednafen::MDFND_MidSync(const EmulateSpecStruct *espec)
+{
+ ers.AddEmuTime((espec->MasterCycles - espec->MasterCyclesALMS) / CurGameSpeed, false);
+
+ UpdateSoundSync(espec->SoundBuf + (espec->SoundBufSizeALMS * CurGame->soundchan), espec->SoundBufSize - espec->SoundBufSizeALMS);
+
+ GameThread_HandleEvents(); // Should be safe, but be careful about future changes.
+ Input_Update(true, false);
+}
+
+static bool PassBlit(const int WhichVideoBuffer)
+{
+ if(WhichVideoBuffer < 0)
+  return false;
+
+ while(VTReady.load(std::memory_order_acquire) >= 0)
+ {
+  /* If it's been > 100ms since the last blit, assume that the blit
+     thread is being time-slice starved, and let it run.  This is especially necessary
+     for fast-forwarding to respond well(since keyboard updates are
+     handled in the main thread) on slower systems or when using a higher fast-forwarding speed ratio.
+  */
+  if(!GameThreadRun || ((last_btime + 100) >= Time::MonoMS() && !pending_ssnapshot))
+   return false;
+  else
+   Time::SleepMS(1);
+ }
+
+ Debugger_GTR_PassBlit();	// Call before the VTReady = WhichVideoBuffer
+
+ VTSSnapshot = pending_ssnapshot;
+ VTRotated = CurGame->rotated;
+ //
+ VTReady.store(WhichVideoBuffer, std::memory_order_release);
+ //
+ //
+ //
+ pending_ssnapshot = false;
+ last_btime = Time::MonoMS();
+ FPS_IncBlitted();
+
+ MThreading::PostSem(VTWakeupSem);
+
+ return true;
+}
+
+
+//
+// Called from game thread.  Pass -1 for WhichVideoBuffer when the frame is skipped.
+//
+static bool MDFND_Update(int WhichVideoBuffer, int16 *Buffer, int Count)
+{
+ bool ret = false;
+
+ if(WhichVideoBuffer >= 0)
+ {
+  Debugger_GT_Draw();
+
+#if 0
+  // Wait if we're re-blitting an already blitted frame, such as done while in frame advance or debugger step mode.
+  while(VTReady.load(std::memory_order_acquire) == WhichVideoBuffer)
+  {
+   puts("Reblit Wait");
+   Time::SleepMS(1);
+   if(!GameThreadRun)
+    return false;
+  }
+#endif
+
+  //
+  // Save any pending screen snapshots, save states, and movies before any potential calls to PassBlit().
+  //
+  MDFN_Surface* surface = SoftFB[WhichVideoBuffer].surface.get();
+  MDFN_Rect* rect = &SoftFB[WhichVideoBuffer].rect;
+  int32* lw = SoftFB[WhichVideoBuffer].lw.get();
+
+  if(pending_snapshot)
+   MDFNI_SaveSnapshot(surface, rect, lw);
+
+  if(pending_save_state)
+   MDFNI_SaveState(NULL, NULL, surface, rect, lw);
+
+  if(pending_save_movie)
+   MDFNI_SaveMovie(NULL, surface, rect, lw);
+
+  pending_save_movie = pending_snapshot = pending_save_state = false;
+ }
+
+ if(false == sc_blit_timesync)
+ {
+  //puts("ABBYNORMAL");
+  ret |= PassBlit(WhichVideoBuffer);
+ }
+
+ UpdateSoundSync(Buffer, Count);
+
+ GameThread_HandleEvents();
+ Input_Update();
+
+ if(RemoteOn)
+  CheckForSTDIOMessages();	// Note: This function may change settings, and disable sound.
+
+ if(true == sc_blit_timesync)
+ {
+  //puts("NORMAL");
+  ret |= PassBlit(WhichVideoBuffer);
+ }
+
+ return(ret);
+}
+
+void Mednafen::MDFND_SetStateStatus(StateStatusStruct *status) noexcept
+{
+ SendCEvent(CEVT_SET_STATE_STATUS, status, NULL);
+}
+
+void Mednafen::MDFND_SetMovieStatus(StateStatusStruct *status) noexcept
+{
+ SendCEvent(CEVT_SET_MOVIE_STATUS, status, NULL);
+}
+
diff -Naur -r --no-dereference ./mednafen/src/drivers/main.h ./emu4crt/src/drivers/main.h
--- ./mednafen/src/drivers/main.h	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/drivers/main.h	2019-10-04 14:21:10.049110256 -0700
@@ -67,7 +67,7 @@
 void GT_ToggleFS(void);
 bool GT_ReinitVideo(void);
 bool GT_ReinitSound(void);
-
+void GT_ChangeVideoResolution(void); //SLK
 
 void BuildSystemSetting(MDFNSetting *setting, const char *system_name, const char *name, const char *description, const char *description_extra, MDFNSettingType type, 
 	const char *default_value, const char *minimum = NULL, const char *maximum = NULL,
diff -Naur -r --no-dereference ./mednafen/src/drivers/video.cpp ./emu4crt/src/drivers/video.cpp
--- ./mednafen/src/drivers/video.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/drivers/video.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -105,6 +105,16 @@
  VDRIVER__COUNT
 };
 
+// SLK
+static int _resolution_switch;
+enum
+{
+ RES_STATIC = 0,
+ RES_NATIVE = 1,
+ RES_SUPER = 2
+};
+// SLK - end
+
 enum
 {
  NTVB_NONE = 0,
@@ -146,6 +156,17 @@
  { NULL, 0 },
 };
 
+// SLK - custom setting
+static const MDFNSetting_EnumList Resolution_Switch[] =
+{
+ // Legacy:
+ { "0", RES_STATIC},
+ { "native", RES_NATIVE, "Native resolution", gettext_noop("Use emulated system native resolution.") },
+ { "super", RES_SUPER, "Super resolution", gettext_noop("Use super resolutions") },
+ { NULL, 0 },
+};
+// SLK - end
+
 static const MDFNSetting GlobalVideoSettings[] =
 {
  { "video.driver", MDFNSF_NOFLAGS, gettext_noop("Video output driver."), NULL, MDFNST_ENUM, "default", NULL, NULL, NULL, NULL, VDriver_List },
@@ -161,6 +182,11 @@
 				MDFNST_BOOL, "1" },
 
  { "video.disable_composition", MDFNSF_NOFLAGS, gettext_noop("Attempt to disable desktop composition."), gettext_noop("Currently, this setting only has an effect on Windows Vista and Windows 7(and probably the equivalent server versions as well)."), MDFNST_BOOL, "1" },
+ 
+ // SLK - admit new parameter
+ { "video.resolution_switch", MDFNSF_NOFLAGS, gettext_noop("Video resolution switch (0, native or super)."), NULL, MDFNST_ENUM, "0", NULL, NULL, NULL, NULL, Resolution_Switch},
+ // SLK - end
+ 
 };
 
 static const MDFNSetting_EnumList StretchMode_List[] =
@@ -844,6 +870,41 @@
 
  video_settings.shader = (ShaderType)MDFN_GetSettingI(snp + "shader");
  video_settings.shader_str = MDFN_GetSettingS(snp + "shader");
+ 
+ // SLK - set video settings - disable some options in conflict with native resolution
+ _resolution_switch = MDFN_GetSettingI("video.resolution_switch");
+ if(_resolution_switch)
+ {
+  if(_resolution_switch == RES_NATIVE) // Native Res
+  { 
+    use_native_resolution = true;
+    printf("### VIDEO Native resolution init - set to %dx%d\n",resolution_to_change_w,resolution_to_change_h);
+    video_settings.xres = resolution_to_change_w;  // for fullscreen mode
+    VideoGI->nominal_width = resolution_to_change_w;  // for windowed mode
+    video_settings.xscale = 1;
+    video_settings.xscalefs = 1;
+    video_settings.yscalefs = 1;
+    video_settings.stretch = 0;
+    
+  }
+  if(_resolution_switch == RES_SUPER)
+  {
+    use_super_resolution = true;
+    printf("### VIDEO Super resolution init - set to 2560x%d\n",resolution_to_change_h);
+    video_settings.xres = current_resolution_w = 2560;  // for fullscreen mode
+    VideoGI->nominal_width = 2560;  // for windowed mode
+    video_settings.xscale = 1;
+    video_settings.xscalefs = 1;
+    video_settings.yscalefs = 1;
+    video_settings.stretch = 0;
+  }
+  video_settings.yres =  current_resolution_h = resolution_to_change_h;  // for fullscreen mode
+  VideoGI->nominal_height = resolution_to_change_h;  // for windowed mode
+  video_settings.yscale = 1;
+  video_settings.videoip = 0;
+  video_settings.shader = SHADER_NONE;
+ }
+ 
  //
  //
  if(0)
@@ -1238,11 +1299,44 @@
   SMRect.y = 0;
   SMRect.w = screen_w;
 
-  SMDRect.w = SMRect.w * xmu;
+  // SLK - Set OSD message rendering rect.
+  if(use_super_resolution) // enlarge OSD message in super resolution mode
+  {
+    SMDRect.w = SMRect.w * xmu;
+    printf("VIDEO - Init : SMRect.w: %d xmu: %d\n",SMRect.w,xmu);
+  }
+  else
+  {
+    SMDRect.w = SMRect.w * xmu;
+  }
+  // SLK - end
+  
+  //SMDRect.w = SMRect.w * xmu;
   SMDRect.h = SMRect.h * ymu;
   SMDRect.x = (screen_w - SMDRect.w) / 2;
-  SMDRect.y = screen_h - SMDRect.h;
+  // SMDRect.y = screen_h - SMDRect.h;
 
+  // SLK - Vertical offset for OSD messages
+  if(use_native_resolution || use_super_resolution)
+  {
+    switch(screen_h){
+      case 240:SMDRect.y = screen_h - SMDRect.h - 18;
+		break;
+      case 288:SMDRect.y = screen_h - SMDRect.h - 32;
+		break;
+      case 480:SMDRect.y = screen_h - SMDRect.h - 32;
+		break;
+      case 576:SMDRect.y = screen_h - SMDRect.h - 64;
+		break;
+      default:SMDRect.y = screen_h - SMDRect.h * xmu; // TODO: ???
+    }
+  }
+  else
+  {
+    SMDRect.y = screen_h - SMDRect.h;
+  }
+  // SLK - end  
+  
   if(SMDRect.x < 0)
   {
    SMRect.w += SMDRect.x * 2 / xmu;
@@ -1648,6 +1742,16 @@
 
  if(LineWidths[0] == ~0) // Skip multi line widths code?
  {
+  // SLK - blit for: NES
+  //printf("      Src: %dx%d - %d,%d\n",src_rect.w,src_rect.h,src_rect.x,src_rect.y);
+  //printf("     Dest: %dx%d - %d,%d\n",screen_dest_rect.w,screen_dest_rect.h,screen_dest_rect.x,screen_dest_rect.y);
+  //  src_rect.y = (resolution_to_change_h - src_rect.h) / 2 ; //SLK
+  if(use_native_resolution || use_super_resolution)
+  {
+    screen_dest_rect.y = (resolution_to_change_h - src_rect.h) / 2; 
+    screen_dest_rect.h = src_rect.h;
+  }
+  // SLK end
   SubBlit(msurface, src_rect, screen_dest_rect, InterlaceField);
  }
  else
@@ -1687,28 +1791,60 @@
     }
     else
     {
-     sub_dest_rect.x = screen_dest_rect.x;
-     sub_dest_rect.w = screen_dest_rect.w;
-     sub_dest_rect.y = screen_dest_rect.y + (last_y - src_rect.y) * screen_dest_rect.h / src_rect.h;
-     sub_dest_rect.h = sub_src_rect.h * screen_dest_rect.h / src_rect.h;
-    }
-
-    if(!sub_dest_rect.h) // May occur with small yscale values in certain cases, so prevent triggering an assert()
-     sub_dest_rect.h = 1;
-
-    // Blit here!
-    SubBlit(msurface, sub_src_rect, sub_dest_rect, InterlaceField);
+      if(use_native_resolution || use_super_resolution)
+      {
+	// SLK - (prevent) resizing and centering
+	//printf("      src_rect:    %dx%d %d,%d\n",src_rect.w,src_rect.h,src_rect.x,src_rect.y);
+	sub_dest_rect.x = screen_dest_rect.x;
+	sub_dest_rect.w = screen_dest_rect.w;
+	sub_dest_rect.y = screen_dest_rect.y + (last_y - src_rect.y); // * screen_dest_rect.h / src_rect.h;
+	//printf("      sub_src_rect:    %dx%d %d,%d\n",sub_src_rect.w,sub_src_rect.h,sub_src_rect.x,sub_src_rect.y); 
+	//printf("      sub_dest_rect:   %dx%d %d,%d\n",sub_dest_rect.w,sub_dest_rect.h,sub_dest_rect.x,sub_dest_rect.y); 
+	//printf("      sub_screen_rect: %dx%d %d,%d\n",screen_dest_rect.w,screen_dest_rect.h,screen_dest_rect.x,screen_dest_rect.y); 
+
+	if(sub_src_rect.w >= resolution_to_change_w)  // horizontal crop to fit screen
+	{
+	  sub_src_rect.x = sub_src_rect.x + ((sub_src_rect.w - resolution_to_change_w) / 2);
+	  sub_src_rect.w = resolution_to_change_w;
+	}
+	
+	if(native_resolution_vcenter == true)  	// default vertical centering
+	{
+	  sub_dest_rect.y = sub_dest_rect.y + (resolution_to_change_h - sub_src_rect.h) / 2 ;
+	  sub_dest_rect.h =  sub_src_rect.h;
+	}
+	else   // fill screen (psx - half black screen fix)
+	{
+	  sub_dest_rect.h = sub_src_rect.h * screen_dest_rect.h / src_rect.h;
+	}
+	//printf("  SLK sub_src_rect:    %dx%d %d,%d\n",sub_src_rect.w,sub_src_rect.h,sub_src_rect.x,sub_src_rect.y); 
+	//printf("  SLK sub_dest_rect:   %dx%d %d,%d\n",sub_dest_rect.w,sub_dest_rect.h,sub_dest_rect.x,sub_dest_rect.y); 
+	//printf("  SLK sub_screen_rect: %dx%d %d,%d\n",screen_dest_rect.w,screen_dest_rect.h,screen_dest_rect.x,screen_dest_rect.y);      
+      }
+      else
+      {
+	sub_dest_rect.x = screen_dest_rect.x;
+	sub_dest_rect.w = screen_dest_rect.w;
+	sub_dest_rect.y = screen_dest_rect.y + (last_y - src_rect.y) * screen_dest_rect.h / src_rect.h;
+	sub_dest_rect.h = sub_src_rect.h * screen_dest_rect.h / src_rect.h;
+      }
+   
+      if(!sub_dest_rect.h){sub_dest_rect.h = 1;} // May occur with small yscale values in certain cases, so prevent triggering an assert()
+      // SLK - end
+    
+      // Blit here!
+      SubBlit(msurface, sub_src_rect, sub_dest_rect, InterlaceField);
 
-    last_y = y;
+      last_y = y;
 
-    if(y != (src_rect.y + src_rect.h))
-    {
-     last_width = LineWidths[y];
+      if(y != (src_rect.y + src_rect.h))
+      {
+	last_width = LineWidths[y];
+      }
     }
-
-   }
   }
  }
+ }
 
  if(take_ssnapshot)
  {
diff -Naur -r --no-dereference ./mednafen/src/drivers/video-state.cpp ./emu4crt/src/drivers/video-state.cpp
--- ./mednafen/src/drivers/video-state.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/drivers/video-state.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -161,7 +161,7 @@
  } // end if(StateStatus)
 
  if(PreviewSurface)
- {
+{
   MDFN_Rect tdrect, drect;
 
   int meow = ((screen_w / CurGame->nominal_width) + 1) / 2;
@@ -169,19 +169,51 @@
 
   tdrect.w = TextRect.w * meow;
   tdrect.h = TextRect.h * meow;
-  tdrect.x = (screen_w - tdrect.w) / 2;
-  tdrect.y = screen_h - tdrect.h;
-
-  BlitRaw(TextSurface, &TextRect, &tdrect);
-
-  drect.w = PreviewRect.w * meow;
-  drect.h = PreviewRect.h * meow;
-  drect.x = (screen_w - drect.w) / 2;
-  drect.y = screen_h - drect.h - tdrect.h - 4;
-
-  BlitRaw(PreviewSurface, &PreviewRect, &drect);
-
- }
+  tdrect.x = (screen_w - tdrect.w) / 2; 
+  // SLK - Custom savestate selection OSD
+  if(use_native_resolution || use_super_resolution)
+    {
+      switch(screen_h){
+	case 240:tdrect.y = screen_h - tdrect.h - 18;
+		 break;
+	case 288:tdrect.y = screen_h - tdrect.h - 32;
+		 break;
+	case 480:tdrect.y = screen_h - tdrect.h - 32;
+		 break;
+	case 576:tdrect.y = screen_h - tdrect.h - 64;
+		 break;
+	default:tdrect.y = screen_h - tdrect.h;
+      }
+      if(use_super_resolution)
+      {
+	tdrect.w = tdrect.w * 8;
+	tdrect.x = (screen_w - tdrect.w) / 2;
+      }
+      
+      BlitRaw(TextSurface, &TextRect, &tdrect);
+      
+      drect.w = screen_w * 0.5 + 3;  // TODO: Why 3 ???
+      drect.h = screen_h * 0.5 + 3;
+      drect.x = (screen_w - drect.w) / 2;
+      drect.y = tdrect.y - drect.h; // SLK
+
+      BlitRaw(PreviewSurface, &PreviewRect, &drect);
+    }
+  else  // native OSD display
+    {
+      tdrect.y = screen_h - tdrect.h;
+
+      BlitRaw(TextSurface, &TextRect, &tdrect);
+
+      drect.w = PreviewRect.w * meow;
+      drect.h = PreviewRect.h * meow;
+      drect.x = (screen_w - drect.w) / 2;
+      drect.y = screen_h - drect.h - tdrect.h - 4;
+
+      BlitRaw(PreviewSurface, &PreviewRect, &drect);
+    }
+  // SLK - end
+  }
 
 }
 
diff -Naur -r --no-dereference ./mednafen/src/mednafen.cpp ./emu4crt/src/mednafen.cpp
--- ./mednafen/src/mednafen.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/mednafen.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -51,6 +51,18 @@
 #include "video/tblur.h"
 #include "qtrecord.h"
 
+// SLK
+bool use_native_resolution = false;
+bool use_super_resolution = false;
+bool resolution_to_change;
+int resolution_to_change_w;
+int resolution_to_change_h;
+int current_resolution_w;
+int current_resolution_h;
+bool native_resolution_vcenter = true;
+// SLK end
+
+
 namespace Mednafen
 {
 
@@ -64,6 +76,17 @@
 static const char *CSD_tblur_accum = gettext_noop("Accumulate color data rather than discarding it.");
 static const char *CSD_tblur_accum_amount = gettext_noop("Blur amount in accumulation mode, specified in percentage of accumulation buffer to mix with the current frame.");
 
+// SLK
+bool use_native_resolution = false;
+bool use_super_resolution = false;
+bool resolution_to_change;
+int resolution_to_change_w;
+int resolution_to_change_h;
+int current_resolution_w;
+int current_resolution_h;
+bool native_resolution_vcenter = true;
+// SLK end
+
 static const MDFNSetting_EnumList VCodec_List[] =
 {
  { "raw", (int)QTRecord::VCODEC_RAW, "Raw",
diff -Naur -r --no-dereference ./mednafen/src/mednafen.cpp.rej ./emu4crt/src/mednafen.cpp.rej
--- ./mednafen/src/mednafen.cpp.rej	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/mednafen.cpp.rej	2019-10-04 14:21:10.049110256 -0700
@@ -0,0 +1,23 @@
+--- src/mednafen.cpp	2018-02-19 20:21:58.000000000 +0100
++++ src/mednafen.cpp	2018-02-26 22:46:44.597119163 +0100
+@@ -861,10 +872,16 @@
+ 	{
+   	 RMD_Drive dr;
+ 
+-	 dr.Name = std::string("Virtual CD Drive");
+-	 dr.PossibleStates.push_back(RMD_State({"Tray Open", false, false, true}));
+-	 dr.PossibleStates.push_back(RMD_State({"Tray Closed (Empty)", false, false, false}));
+-	 dr.PossibleStates.push_back(RMD_State({"Tray Closed", true, true, false}));
++	 // SLK - shorten messages to fit display in low-res modes
++	 dr.Name = std::string("CD Drive");
++	 dr.PossibleStates.push_back(RMD_State({"Open", false, false, true}));
++	 dr.PossibleStates.push_back(RMD_State({"Closed (Empty)", false, false, false}));
++	 dr.PossibleStates.push_back(RMD_State({"Closed", true, true, false}));
++	 //dr.Name = std::string("Virtual CD Drive");
++	 //dr.PossibleStates.push_back(RMD_State({"Tray Open", false, false, true}));
++	 //dr.PossibleStates.push_back(RMD_State({"Tray Closed (Empty)", false, false, false}));
++	 //dr.PossibleStates.push_back(RMD_State({"Tray Closed", true, true, false}));
++	 // SLK end
+ 	 dr.CompatibleMedia.push_back(0);
+ 	 dr.MediaMtoPDelay = 2000;
+ 
diff -Naur -r --no-dereference ./mednafen/src/mednafen.h ./emu4crt/src/mednafen.h
--- ./mednafen/src/mednafen.h	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/mednafen.h	2019-10-04 14:21:10.049110256 -0700
@@ -21,6 +21,18 @@
 #include "settings.h"
 #include "NativeVFS.h"
 
+// SLK
+extern bool use_native_resolution;
+extern bool use_super_resolution;
+extern bool native_resolution_vcenter;
+extern bool resolution_to_change;
+extern int resolution_to_change_w;
+extern int resolution_to_change_h;
+extern int current_resolution_w;
+extern int current_resolution_h;
+// SLK end
+
+
 namespace Mednafen
 {
 extern NativeVFS NVFS;
diff -Naur -r --no-dereference ./mednafen/src/mednafen.h.rej ./emu4crt/src/mednafen.h.rej
--- ./mednafen/src/mednafen.h.rej	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/mednafen.h.rej	2019-10-04 14:21:10.049110256 -0700
@@ -0,0 +1,21 @@
+--- src/mednafen.h	2018-02-19 20:21:58.000000000 +0100
++++ src/mednafen.h	2018-02-26 22:43:44.976637374 +0100
+@@ -24,6 +24,18 @@
+ 
+ extern MDFNGI *MDFNGameInfo;
+ 
++// SLK
++extern bool use_native_resolution;
++extern bool use_super_resolution;
++extern bool native_resolution_vcenter;
++extern bool resolution_to_change;
++extern int resolution_to_change_w;
++extern int resolution_to_change_h;
++extern int current_resolution_w;
++extern int current_resolution_h;
++// SLK end
++
++
+ #include "settings.h"
+ 
+ enum MDFN_NoticeType : uint8
diff -Naur -r --no-dereference ./mednafen/src/nes/nes.cpp ./emu4crt/src/nes/nes.cpp
--- ./mednafen/src/nes/nes.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/nes/nes.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -287,7 +287,21 @@
 	 MDFNGameInfo->fps = PAL? 838977920 : 1008307711;
 	 MDFNGameInfo->MasterClock = MDFN_MASTERCLOCK_FIXED(PAL ? PAL_CPU : NTSC_CPU);
 	}
-
+	
+	//SLK
+	if(PAL)
+	{
+	 resolution_to_change_h = 288;
+	}
+	else
+	{
+	 resolution_to_change_h = 240;
+	}
+	resolution_to_change_w = 256;	
+	resolution_to_change = true;
+	//SLK end
+	
+	
 	X6502_Init();
 	MDFNPPU_Init();
         MDFNSND_Init(PAL);
diff -Naur -r --no-dereference ./mednafen/src/pce/pce.cpp ./emu4crt/src/pce/pce.cpp
--- ./mednafen/src/pce/pce.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/pce/pce.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -414,6 +414,16 @@
  for(unsigned ch = 0; ch < 2; ch++)
   HRBufs[ch] = new OwlBuffer();
 
+ // SLK
+ if(MDFN_GetSettingB("pce.arcadecard"))
+ {
+   resolution_to_change_w = 256;
+   resolution_to_change_h = 240;
+   resolution_to_change = true;
+ }
+ // SLK
+  
+ 
  // FIXME:  Make these globals less global!
  PCE_ACEnabled = MDFN_GetSettingB("pce.arcadecard");
 
diff -Naur -r --no-dereference ./mednafen/src/pce/pce.cpp.orig ./emu4crt/src/pce/pce.cpp.orig
--- ./mednafen/src/pce/pce.cpp.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/pce/pce.cpp.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,1267 @@
+/* Mednafen - Multi-system Emulator
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#include "pce.h"
+#include "vce.h"
+#include <mednafen/hw_sound/pce_psg/pce_psg.h>
+#include "input.h"
+#include "huc.h"
+#include "pcecd.h"
+#include <mednafen/cdrom/scsicd.h>
+#include "hes.h"
+#include "debug.h"
+#include "tsushin.h"
+#include <mednafen/hw_misc/arcade_card/arcade_card.h>
+#include <mednafen/mempatcher.h>
+#include <mednafen/cdrom/CDInterface.h>
+#include <mednafen/hash/md5.h>
+#include <mednafen/FileStream.h>
+#include <mednafen/sound/OwlResampler.h>
+
+#include <zlib.h>
+
+#define PCE_DEBUG(x, ...) {  /* printf(x, ## __VA_ARGS__); */ }
+
+extern MDFNGI EmulatedPCE;
+
+namespace MDFN_IEN_PCE
+{
+
+static const MDFNSetting_EnumList PSGRevisionList[] =
+{
+ { "huc6280", PCE_PSG::REVISION_HUC6280, "HuC6280", gettext_noop("HuC6280 as found in the original PC Engine.") },
+ { "huc6280a", PCE_PSG::REVISION_HUC6280A, "HuC6280A", gettext_noop("HuC6280A as found in the SuperGrafx and CoreGrafx I.  Provides proper channel amplitude centering.  Many games will have less clicking with the HuC6280A, but it may cause clicking in a few games designed with the original HuC6280's sound characteristics in mind.") },
+ { "match", PCE_PSG::_REVISION_COUNT, gettext_noop("Match emulation mode."), gettext_noop("Selects \"huc6280\" for non-SuperGrafx mode, and \"huc6280a\" for SuperGrafx(full) mode.") },
+ { NULL, 0 },
+};
+
+static std::vector<CDInterface*> *cdifs = NULL;
+
+HuC6280 HuCPU;
+
+VCE *vce = NULL;
+
+static PCE_PSG *psg = NULL;
+
+extern ArcadeCard *arcade_card;	// Bah, lousy globals.
+
+static OwlBuffer* HRBufs[2] = { NULL, NULL };
+static RavenBuffer* ADPCMBuf = NULL;
+static RavenBuffer* CDDABufs[2] = { NULL, NULL };
+static OwlResampler* HRRes = NULL;
+
+static bool SetSoundRate(double rate);
+
+static void Cleanup(void);
+
+bool PCE_ACEnabled;
+uint32 PCE_InDebug = 0;
+uint64 PCE_TimestampBase;	// Only used with the debugger for the time being.
+
+static bool IsSGX;
+static bool IsHES;
+
+// Accessed in debug.cpp
+static uint8 BaseRAM[32768]; // 8KB for PCE, 32KB for Super Grafx
+uint8 PCE_PeekMainRAM(uint32 A)
+{
+ return BaseRAM[A & ((IsSGX ? 32768 : 8192) - 1)];
+}
+
+void PCE_PokeMainRAM(uint32 A, uint8 V)
+{
+ BaseRAM[A & ((IsSGX ? 32768 : 8192) - 1)] = V;
+}
+
+
+
+HuC6280::readfunc NonCheatPCERead[0x100];
+
+static DECLFR(PCEBusRead)
+{
+ if(!PCE_InDebug)
+ {
+  PCE_DEBUG("Unmapped Read: %02x %04x\n", A >> 13, A);
+ }
+ return(0xFF);
+}
+
+static DECLFW(PCENullWrite)
+{
+ if(!PCE_InDebug)
+ {
+  PCE_DEBUG("Unmapped Write: %02x, %08x %02x\n", A >> 13, A, V);
+ }
+}
+
+static DECLFR(BaseRAMReadSGX)
+{
+ return(BaseRAM[A & 0x7FFF]);
+}
+
+static DECLFW(BaseRAMWriteSGX)
+{
+ BaseRAM[A & 0x7FFF] = V;
+}
+
+static DECLFR(BaseRAMRead)
+{
+ return(BaseRAM[A & 0x1FFF]);
+}
+
+static DECLFW(BaseRAMWrite)
+{
+ BaseRAM[A & 0x1FFF] = V;
+}
+
+static DECLFR(IORead)
+{
+ A &= 0x1FFF;
+
+ switch(A & 0x1c00)
+ {
+  case 0x0000: if(!PCE_InDebug)
+		HuCPU.StealCycle(); 
+	       return(vce->ReadVDC(A));
+
+  case 0x0400: if(!PCE_InDebug)
+		HuCPU.StealCycle(); 
+	       return(vce->Read(A));
+
+  case 0x0800: if(HuCPU.InBlockMove())
+		return(0);
+	       return(HuCPU.GetIODataBuffer());
+
+  case 0x0c00: if(HuCPU.InBlockMove())
+                return(0);
+	       {
+		uint8 ret = HuCPU.TimerRead(A, PCE_InDebug);
+                if(!PCE_InDebug)
+		 HuCPU.SetIODataBuffer(ret);
+                return(ret);
+               }
+
+  case 0x1000: if(HuCPU.InBlockMove())
+                return(0);
+	       {
+	        uint8 ret = INPUT_Read(HuCPU.Timestamp(), A);
+                if(!PCE_InDebug)
+		 HuCPU.SetIODataBuffer(ret);
+                return(ret);
+               }
+
+  case 0x1400: if(HuCPU.InBlockMove())
+                return(0);
+	       {
+	        uint8 ret = HuCPU.IRQStatusRead(A, PCE_InDebug);
+		if(!PCE_InDebug)
+		 HuCPU.SetIODataBuffer(ret);
+	        return(ret);
+	       }
+
+  case 0x1800: if(IsTsushin)
+		return(PCE_TsushinRead(A));
+
+	       if(!PCE_IsCD)
+		break;
+	       if((A & 0x1E00) == 0x1A00)
+	       {
+		if(arcade_card)
+		 return(arcade_card->Read(A, PCE_InDebug));
+		else
+		 return(0);
+	       }
+	       else
+	       {
+		int32 next_cd_event;
+		uint8 ret;
+
+		ret = PCECD_Read(HuCPU.Timestamp(), A, next_cd_event, PCE_InDebug);
+
+		vce->SetCDEvent(next_cd_event);
+
+		return(ret);
+	       }
+
+  case 0x1C00: if(IsHES)
+		return(ReadIBP(A)); 
+
+	       break; // Expansion
+ }
+
+ if(!PCE_InDebug)
+ {
+  PCE_DEBUG("I/O Unmapped Read: %04x\n", A);
+ }
+
+ return(0xFF);
+}
+
+static DECLFW(IOWrite)
+{
+ switch(A & 0x1c00)
+ {
+  case 0x0000: HuCPU.StealCycle();
+	       vce->WriteVDC(A & 0x80001FFF, V);
+	       break;
+
+  case 0x0400: HuCPU.StealCycle(); 
+	       vce->Write(A & 0x1FFF, V);
+	       break;
+
+  case 0x0800: HuCPU.SetIODataBuffer(V); 
+	       psg->Write(HuCPU.Timestamp() / 3, A & 0x1FFF, V);
+	       break;
+
+  case 0x0c00: HuCPU.SetIODataBuffer(V);
+	       HuCPU.TimerWrite(A & 0x1FFF, V);
+	       break;
+
+  case 0x1000: HuCPU.SetIODataBuffer(V);
+	       INPUT_Write(HuCPU.Timestamp(), A & 0x1FFF, V);
+	       break;
+
+  case 0x1400: HuCPU.SetIODataBuffer(V);
+	       HuCPU.IRQStatusWrite(A & 0x1FFF, V);
+	       break;
+
+  case 0x1800: if(IsTsushin)
+                PCE_TsushinWrite(A & 0x1FFF, V);
+
+	       if(!PCE_IsCD)
+	       {
+		if(!PCE_InDebug)
+		{
+		 PCE_DEBUG("I/O Unmapped Write: %04x %02x\n", A, V);
+		}
+		break;
+	       }
+
+	       if((A & 0x1E00) == 0x1A00)
+	       {
+		if(arcade_card)
+		 arcade_card->Write(A& 0x1FFF, V);
+	       }
+	       else
+	       {
+	        int32 next_cd_event = PCECD_Write(HuCPU.Timestamp(), A & 0x1FFF, V);
+
+		vce->SetCDEvent(next_cd_event);
+	       }
+
+	       break;
+
+  case 0x1C00:  //if(!PCE_InDebug)
+		//{
+		// PCE_DEBUG("I/O Unmapped Write: %04x %02x\n", A, V);
+		//}
+		break;
+ }
+}
+
+static void PCECDIRQCB(bool asserted)
+{
+ if(asserted)
+  HuCPU.IRQBegin(HuC6280::IQIRQ2);
+ else
+  HuCPU.IRQEnd(HuC6280::IQIRQ2);
+}
+
+static int LoadCommon(void);
+static void LoadCommonPre(void);
+
+static bool TestMagic(GameFile* gf)
+{
+ if(gf->ext != "hes" && gf->ext != "pce" && gf->ext != "sgx")
+  return false;
+
+ return true;
+}
+
+static void SetCDSettings(bool silent_status = false)
+{
+ double cdpsgvolume;
+ PCECD_Settings cd_settings;
+ memset(&cd_settings, 0, sizeof(PCECD_Settings));
+
+ cdpsgvolume = (double)MDFN_GetSettingUI("pce.cdpsgvolume") / 100;
+ cd_settings.CDDA_Volume = (double)MDFN_GetSettingUI("pce.cddavolume") / 100;
+ cd_settings.ADPCM_Volume = (double)MDFN_GetSettingUI("pce.adpcmvolume") / 100;
+ cd_settings.ADPCM_ExtraPrecision = MDFN_GetSettingB("pce.adpcmextraprec");
+
+#if 0
+ if(IsHES)
+ {
+  double new_cdpsgvolume = 1.0 / 0.678;
+
+  if(new_cdpsgvolume > cdpsgvolume)
+  {
+   cd_settings.ADPCM_Volume *= new_cdpsgvolume / (cdpsgvolume ? cdpsgvolume : 1.0);
+   cd_settings.ADPCM_Volume = std::min<double>(cd_settings.ADPCM_Volume, 2.0);
+   cdpsgvolume = new_cdpsgvolume;
+  }
+ }
+#endif
+
+ if(!silent_status)
+ {
+  if(cd_settings.CDDA_Volume != 1.0 || cd_settings.ADPCM_Volume != 1.0 || cdpsgvolume != 1.0)
+  {
+   MDFN_printf(_("CD-DA Volume: %d%%\n"), (int)(100 * cd_settings.CDDA_Volume));
+   MDFN_printf(_("ADPCM Volume: %d%%\n"), (int)(100 * cd_settings.ADPCM_Volume));
+   MDFN_printf(_("CD PSG Volume: %d%%\n"), (int)(100 * cdpsgvolume));
+  }
+ }
+
+ PCECD_SetSettings(&cd_settings);
+ psg->SetVolume(0.678 * cdpsgvolume);
+}
+
+static void CDSettingChanged(const char *name)
+{
+ if(PCE_IsCD)
+  SetCDSettings(true);
+}
+
+
+static const struct
+{
+ uint32 crc;
+ const char* name;
+} sgx_table[] = 
+{
+	{ 0xbebfe042, "Darius Plus", },
+	{ 0x4c2126b0, "Aldynes" },
+	{ 0x8c4588e2, "1941 - Counter Attack" },
+	{ 0x1f041166, "Madouou Granzort" },
+	{ 0xb486a8ed, "Daimakaimura" },
+	{ 0x3b13af61, "Battle Ace" },
+};
+
+static MDFN_COLD void Load(GameFile* gf)
+{
+ try
+ {
+  uint8 hes_header[4];
+
+  IsHES = false;
+  IsSGX = false;
+
+  gf->stream->read(hes_header, 4);
+  gf->stream->seek(0, SEEK_SET);
+
+  if(!memcmp(hes_header, "HESM", 4))
+   IsHES = true;
+
+  LoadCommonPre();
+
+  if(IsHES)
+  {
+   HES_Load(gf->stream);
+
+   ADPCMBuf = new RavenBuffer();
+   PCE_IsCD = 1;
+   PCECD_Init(NULL, PCECDIRQCB, PCE_MASTER_CLOCK, ADPCMBuf->Buf(), NULL, NULL);
+  }
+  else
+  {
+   uint32 crc;
+
+   crc = HuC_Load(gf->stream, MDFN_GetSettingB("pce.disable_bram_hucard"));
+
+   if(gf->ext == "sgx")
+    IsSGX = true;
+   else
+   {
+    for(auto const& e : sgx_table)
+    {
+     if(e.crc == crc)
+     {
+      IsSGX = true;
+      MDFN_printf(_("SuperGrafx: %s\n"), e.name);
+      break;
+     }
+    }
+   }
+  }
+
+  LoadCommon();
+ }
+ catch(...)
+ {
+  Cleanup();
+  throw;
+ }
+}
+
+static MDFN_COLD void LoadCommonPre(void)
+{
+ // Initialize sound buffers
+ for(unsigned ch = 0; ch < 2; ch++)
+  HRBufs[ch] = new OwlBuffer();
+
+ // FIXME:  Make these globals less global!
+ PCE_ACEnabled = MDFN_GetSettingB("pce.arcadecard");
+
+ HuCPU.Init(IsHES);
+
+ for(int x = 0; x < 0x100; x++)
+ {
+  HuCPU.SetFastRead(x, NULL);
+  HuCPU.SetReadHandler(x, PCEBusRead);
+  HuCPU.SetWriteHandler(x, PCENullWrite);
+ }
+
+ MDFNMP_Init(1024, (1 << 21) / 1024);
+}
+
+static MDFN_COLD int LoadCommon(void)
+{ 
+ IsSGX |= MDFN_GetSettingB("pce.forcesgx") ? 1 : 0;
+
+ if(IsHES)
+  IsSGX = 1;
+ // Don't modify IsSGX past this point.
+ const uint32 vram_size = MDFN_GetSettingUI("pce.vramsize");
+
+ vce = new VCE(IsSGX, vram_size);
+ vce->SetVDCUnlimitedSprites(MDFN_GetSettingB("pce.nospritelimit"));
+
+ if(IsSGX)
+  MDFN_printf("SuperGrafx Emulation Enabled.\n");
+
+ for(int i = 0xF8; i < 0xFC; i++)
+ {
+  HuCPU.SetReadHandler(i, IsSGX ? BaseRAMReadSGX : BaseRAMRead);
+  HuCPU.SetWriteHandler(i, IsSGX ? BaseRAMWriteSGX : BaseRAMWrite);
+
+  if(IsSGX)
+   HuCPU.SetFastRead(i, BaseRAM + (i & 0x3) * 8192);
+  else
+   HuCPU.SetFastRead(i, BaseRAM);
+ }
+
+ MDFNMP_AddRAM(IsSGX ? 32768 : 8192, 0xf8 * 8192, BaseRAM);
+
+ HuCPU.SetReadHandler(0xFF, IORead);
+ HuCPU.SetWriteHandler(0xFF, IOWrite);
+
+ {
+  int psgrevision = MDFN_GetSettingI("pce.psgrevision");
+
+  if(psgrevision == PCE_PSG::_REVISION_COUNT)
+  {
+   psgrevision = IsSGX ? PCE_PSG::REVISION_HUC6280A : PCE_PSG::REVISION_HUC6280;
+  }
+
+  for(const MDFNSetting_EnumList *el = PSGRevisionList; el->string; el++)
+  {
+   if(el->number == psgrevision)
+   {
+    MDFN_printf(_("PSG Revision: %s\n"), el->description);
+    break;
+   }
+  }
+  psg = new PCE_PSG(HRBufs[0]->Buf(), HRBufs[1]->Buf(), psgrevision);
+ }
+
+ psg->SetVolume(1.0);
+
+ if(PCE_IsCD)
+  SetCDSettings();
+
+ PCEINPUT_Init();
+
+ PCE_Power();
+
+ MDFNGameInfo->LayerNames = IsSGX ? "BG0\0SPR0\0BG1\0SPR1\0" : "Background\0Sprites\0";
+ MDFNGameInfo->fps = (uint32)((double)7159090.90909090 / 455 / 263 * 65536 * 256);
+ MDFNGameInfo->CPInfoActiveBF = IsHES ? 0 : 1 << 0;
+
+ for(unsigned int i = 0; i < 0x100; i++)
+  NonCheatPCERead[i] = HuCPU.GetReadHandler(i);
+
+ if(!IsHES)
+ {
+  MDFNGameInfo->nominal_height = MDFN_GetSettingUI("pce.slend") - MDFN_GetSettingUI("pce.slstart") + 1;
+  MDFNGameInfo->nominal_width = MDFN_GetSettingB("pce.h_overscan") ? 320 : 288;
+
+  MDFNGameInfo->lcm_width = MDFN_GetSettingB("pce.h_overscan") ? 1120 : 1024;
+  MDFNGameInfo->lcm_height = MDFNGameInfo->nominal_height;
+ }
+
+ vce->SetShowHorizOS(MDFN_GetSettingB("pce.h_overscan")); 
+
+#ifdef WANT_DEBUGGER
+ PCEDBG_Init(IsSGX, psg, vram_size);
+#endif
+
+ return(1);
+}
+
+static bool DetectGECD(CDInterface* cdiface)	// Very half-assed detection until(if) we get ISO-9660 reading code.
+{
+ uint8 sector_buffer[2048];
+ CDUtility::TOC toc;
+
+ cdiface->ReadTOC(&toc);
+
+ // Now, test for the Games Express CD games.  The GE BIOS seems to always look at sector 0x10, but only if the first track is a
+ // data track.
+ if(toc.first_track == 1 && (toc.tracks[1].control & 0x4))
+ {
+  if(cdiface->ReadSectors(sector_buffer, 0x10, 1) == 0x1)
+  {
+   if(!memcmp((char *)sector_buffer + 0x8, "HACKER CD ROM SYSTEM", 0x14))
+    return(true);
+
+   if(!memcmp((char *)sector_buffer + 0x01, "CD001", 0x5))
+   {
+    if(cdiface->ReadSectors(sector_buffer, 0x14, 1) == 0x1)
+    {
+     static const uint32 known_crcs[] =
+     {
+      0xd7b47c06,	// AV Tanjou
+      0x86aec522,	// Bishoujo Jyanshi [...]
+      0xc8d1b5ef,	// CD Bishoujo [...]
+      0x0bdbde64,	// CD Pachisuro [...]
+     };
+     uint32 zecrc = crc32(0, sector_buffer, 2048);
+
+     //printf("%04x\n", zecrc);
+     for(unsigned int i = 0; i < sizeof(known_crcs) / sizeof(uint32); i++)
+      if(known_crcs[i] == zecrc)
+       return(true);
+    }
+   }
+  }
+ }
+
+ return(false);
+}
+
+static bool TestMagicCD(std::vector<CDInterface*> *CDInterfaces)
+{
+ static const uint8 magic_test[0x20] = { 0x82, 0xB1, 0x82, 0xCC, 0x83, 0x76, 0x83, 0x8D, 0x83, 0x4F, 0x83, 0x89, 0x83, 0x80, 0x82, 0xCC,  
+				   	 0x92, 0x98, 0x8D, 0xEC, 0x8C, 0xA0, 0x82, 0xCD, 0x8A, 0x94, 0x8E, 0xAE, 0x89, 0xEF, 0x8E, 0xD0
+				       };
+ CDInterface* cdiface = (*CDInterfaces)[0];
+ uint8 sector_buffer[2048];
+ CDUtility::TOC toc;
+ bool ret = false;
+
+ memset(sector_buffer, 0, sizeof(sector_buffer));
+
+ cdiface->ReadTOC(&toc);
+
+ for(int32 track = toc.first_track; track <= toc.last_track; track++)
+ {
+  if(toc.tracks[track].control & 0x4)
+  {
+   if(cdiface->ReadSectors(sector_buffer, toc.tracks[track].lba, 1) != 0x1)
+    break;
+
+   if(!memcmp((char*)sector_buffer, (char *)magic_test, 0x20))
+    ret = true;
+
+   // PCE CD BIOS apparently only looks at the first data track.
+   break;
+  }
+ }
+
+ // If it's a PC-FX CD(Battle Heat), return false.
+ // This is very kludgy.
+ for(int32 track = toc.first_track; track <= toc.last_track; track++)
+ {
+  if(toc.tracks[track].control & 0x4)
+  {
+   if(cdiface->ReadSectors(sector_buffer, toc.tracks[track].lba, 1) == 0x1)
+   {
+    if(!strncmp("PC-FX:Hu_CD-ROM", (char*)sector_buffer, strlen("PC-FX:Hu_CD-ROM")))
+    {
+     return false;
+    }
+   }
+  }
+ }
+
+ if(DetectGECD(cdiface))
+  ret = true;
+
+ return(ret);
+}
+
+static MDFN_COLD bool DetectSGXCD(std::vector<CDInterface*>* CDInterfaces)
+{
+ CDInterface* cdiface = (*CDInterfaces)[0];
+ CDUtility::TOC toc;
+ uint8 sector_buffer[2048];
+ bool ret = false;
+
+ memset(sector_buffer, 0, sizeof(sector_buffer));
+
+ cdiface->ReadTOC(&toc);
+
+ // Check all data tracks for the 16-byte magic(4D 65 64 6E 61 66 65 6E 74 AB 90 19 42 62 7D E6) at offset 0x86A(assuming mode 1 sectors).
+ for(int32 track = toc.first_track; track <= toc.last_track; track++)
+ {
+  if(toc.tracks[track].control & 0x4)
+  {
+   if(cdiface->ReadSectors(sector_buffer, toc.tracks[track].lba + 1, 1) != 0x1)
+    continue;
+
+   if(MDFN_de64msb(&sector_buffer[0x6A]) == 0x4D65646E6166656EULL && MDFN_de64msb(&sector_buffer[0x6A + 8]) == 0x74AB901942627DE6ULL)
+    ret = true;
+  }
+ }
+
+ return ret;
+}
+
+static MDFN_COLD void LoadCD(std::vector<CDInterface*> *CDInterfaces)
+{
+ try
+ {
+  static const std::vector<FileExtensionSpecStruct> KnownBIOSExtensions =
+  {
+   { ".pce", 0, gettext_noop("PC Engine ROM Image") },
+   { ".bin", -10, gettext_noop("PC Engine ROM Image") },
+   { ".bios", 0, gettext_noop("BIOS Image") },
+  };
+  IsHES = 0;
+  IsSGX = DetectSGXCD(CDInterfaces);
+
+  LoadCommonPre();
+
+  const char *bios_sname = DetectGECD((*CDInterfaces)[0]) ? "pce.gecdbios" : "pce.cdbios";
+  std::string bios_path = MDFN_MakeFName(MDFNMKF_FIRMWARE, 0, MDFN_GetSettingS(bios_sname));
+  MDFNFILE fp(&NVFS, bios_path.c_str(), KnownBIOSExtensions, _("CD BIOS"));
+
+  bool disable_bram_cd = MDFN_GetSettingB("pce.disable_bram_cd");
+
+  if(disable_bram_cd)
+   MDFN_printf(_("Warning: BRAM is disabled per pcfx.disable_bram_cd setting.  This is simulating a malfunction.\n"));
+
+  HuC_Load(fp.stream(), disable_bram_cd, PCE_ACEnabled ? SYSCARD_ARCADE : SYSCARD_3);
+
+  ADPCMBuf = new RavenBuffer();
+  for(unsigned lr = 0; lr < 2; lr++)
+   CDDABufs[lr] = new RavenBuffer();
+
+  PCE_IsCD = 1;
+  PCECD_Init(NULL, PCECDIRQCB, PCE_MASTER_CLOCK, ADPCMBuf->Buf(), CDDABufs[0]->Buf(), CDDABufs[1]->Buf());
+
+  cdifs = CDInterfaces;
+
+  SCSICD_SetDisc(true, NULL, true);
+
+  MDFN_printf(_("CD Layout:   0x%s\n"), md5_context::asciistr(MDFNGameInfo->MD5, 0).c_str());
+  MDFN_printf(_("Arcade Card Emulation:  %s\n"), PCE_ACEnabled ? _("Enabled") : _("Disabled"));
+
+  LoadCommon();
+ }
+ catch(...)
+ {
+  Cleanup();
+  throw;
+ }
+}
+
+static MDFN_COLD void Cleanup(void)
+{
+ #ifdef WANT_DEBUGGER
+ PCEDBG_Kill();
+ #endif
+
+ if(PCE_IsCD)
+ {
+  PCECD_Close();
+ }
+
+ if(IsHES)
+  HES_Close();
+ else
+ {
+  HuC_Kill();
+ }
+
+ if(vce)
+ {
+  delete vce;
+  vce = NULL;
+ }
+
+ if(psg)
+ {
+  delete psg;
+  psg = NULL;
+ }
+
+ for(unsigned ch = 0; ch < 2; ch++)
+ {
+  if(HRBufs[ch])
+  {
+   delete HRBufs[ch];
+   HRBufs[ch] = NULL;
+  }
+
+  if(CDDABufs[ch])
+  {
+   delete CDDABufs[ch];
+   CDDABufs[ch] = NULL;
+  }
+ }
+
+ if(ADPCMBuf)
+ {
+  delete ADPCMBuf;
+  ADPCMBuf = NULL;
+ }
+
+ if(HRRes)
+ {
+  delete HRRes;
+  HRRes = NULL;
+ }
+}
+
+static MDFN_COLD void CloseGame(void)
+{
+ HuC_SaveNV();
+ Cleanup();
+}
+
+#if 0
+void TestThing(unsigned count)
+{
+ int poo = 0;
+
+ //for(int x = 0; x < count; x++)
+ {
+  //static const double pinc = 44100.0 / 1789772.7272;
+  //static double p = 0;
+
+  //p += pinc;
+  //if(p >= 1.0)
+  //{
+  // p -= 1.0;
+  static const uint32 ptv = (int64)(1024 * 1024) * 21477272 / 44100;
+  static int64 p = 0;
+
+  //if(x == (count - 1) || 1) //!(rand() & 1))
+  //{
+  // p -= (12 * (x - poo)) << 20;
+  // poo = x;
+  //}
+  //p -= (12 << 20);
+  int x = count;
+
+  p -= ((int64)12 * x) << 20;
+
+  while(p <= 0)
+  {
+   //const int synthtime = x;
+   //const int synthtime_phase = ((((1 << 20) + p) >> 4) - 0x80;
+   //const int synthtime_phase_int = synthtime_phase >> 8;
+   //const int synthtime_phase_fract = synthtime_phase & 0xFF;
+   const uint64 synthtime_ex = ((((uint64)((x + 1) * 12) << 20) + p) / 3) >> (4 + 2);
+   const int synthtime = synthtime_ex >> 16;
+   const int synthtime_phase = (int)(synthtime_ex & 0xFFFF) - 0x80;
+   const int synthtime_phase_int = synthtime_phase >> 8;
+   const int synthtime_phase_fract = synthtime_phase & 0xFF;
+   static unsigned counter = 0;
+   static int32 wv = 0x6000;
+
+   //printf("%d %d %lld\n", x, synthtime, ptv);
+
+   p += ptv;
+
+   if(!counter)
+   {
+    wv = -wv;
+    counter = 8;
+   }
+   else
+    counter--;
+
+//   HRBufs[0][HRBUF_LEFTOVER_PADDING + x + 0] += wv * 41 * 256;
+//   HRBufs[0][HRBUF_LEFTOVER_PADDING + x + 1] += 0 - (wv * 41 * 256);
+#if 1
+   for(unsigned ch = 0; ch < 2; ch++)
+   {
+    int32 prev = 0;
+    for(unsigned c = 0; c < CDDA_Filter_NumConvolutions; c++)
+    {
+     int32 coeff;
+     int32 mr;
+
+     //coeff = CDDA_Filter[1 + synthtime_phase_int + 0][c];
+     coeff = (CDDA_Filter[1 + synthtime_phase_int + 0][c] * (256 - synthtime_phase_fract) +
+              CDDA_Filter[1 + synthtime_phase_int + 1][c] * (synthtime_phase_fract)) >> 8;
+
+     mr = (wv * coeff) >> (16 - 6 - 8);
+     HRBufs[ch][HRBUF_LEFTOVER_PADDING + synthtime + c] += mr - prev;
+     prev = mr;
+    }
+    HRBufs[ch][HRBUF_LEFTOVER_PADDING + synthtime + CDDA_Filter_NumConvolutions] += 0 - prev;
+   }
+#endif
+  }
+ }
+
+#if 0
+ for(unsigned x = 0; x < count; x++)
+ {
+  HRBufs[0][HRBUF_LEFTOVER_PADDING + x] = 0;
+  HRBufs[1][HRBUF_LEFTOVER_PADDING + x] = 0;
+ }
+#endif
+}
+#endif
+
+static EmulateSpecStruct *es;
+static void Emulate(EmulateSpecStruct *espec)
+{
+ es = espec;
+
+ espec->MasterCycles = 0;
+ espec->SoundBufSize = 0;
+
+ MDFNMP_ApplyPeriodicCheats();
+
+ if(espec->VideoFormatChanged)
+  vce->SetPixelFormat(espec->surface->format, espec->CustomPalette, espec->CustomPaletteNumEntries);
+
+ if(espec->SoundFormatChanged)
+  SetSoundRate(espec->SoundRate);
+
+ //int t = MDFND_GetTime();
+
+ vce->StartFrame(espec->surface, &espec->DisplayRect, espec->LineWidths, IsHES ? 1 : espec->skip);
+
+ // Begin loop here:
+ //for(int i = 0; i < 2; i++)
+ bool rp_rv;
+ do
+ {
+  assert(HuCPU.Timestamp() < 12);
+  //printf("ST: %d\n", HuCPU.Timestamp());
+
+  INPUT_Frame();
+
+  //vce->RunFrame(espec->surface, &espec->DisplayRect, espec->LineWidths, IsHES ? 1 : espec->skip);
+  do
+  {
+   rp_rv = vce->RunPartial();
+  } while(espec->NeedSoundReverse && !rp_rv);
+
+  const uint32 end_timestamp = HuCPU.Timestamp();
+  const uint32 end_timestamp_div12 = end_timestamp / 12;
+  const uint32 end_timestamp_mod12 = end_timestamp % 12;
+
+  INPUT_AdjustTS((int32)end_timestamp_mod12 - (int32)end_timestamp);	// Careful with this!
+
+  psg->Update(end_timestamp / 3);
+  psg->ResetTS(end_timestamp_mod12 / 3);
+
+  HuC_Update(end_timestamp);
+  HuC_ResetTS(end_timestamp_mod12);
+
+  {
+   const unsigned rsc = std::min<unsigned>(65536, end_timestamp_div12);
+   int32 new_sc;
+
+   if(ADPCMBuf)
+    PCECD_ProcessADPCMBuffer(rsc);
+
+   for(unsigned ch = 0; ch < 2; ch++)
+   {
+    if(HRRes)
+    {
+     //
+     // These filter parameters cause much less of a lowpass and much much less of a highpass filter effect than what I've tested on my Turbo Duo,
+     // but I think it's probably broken(in need of capacitor replacements).
+     // 
+     HRBufs[ch]->Integrate(rsc, 2 /* lp shift, lower = less lp effect */, 14 /* hp shift, higher = less hp effect*/, ADPCMBuf, CDDABufs[ch]);
+    }
+
+#if 0
+    for(unsigned x = 0; x < end_timestamp_div12; x++)
+    {
+     static double phase[2] = { 0};
+     static double phase_inc[2] = { 0 };
+     static double phase_inc_inc = 0.000000001; //0.000003;
+
+     if(1)
+     {
+      static int zoom = 32767 * 0.75 * 256 / 4;
+	
+      //if(!(rand() & 0xFFFFFF))
+      // zoom = -zoom;
+      *(float*)&HRBufs[ch]->Buf()[x] = zoom;
+     }
+     else
+      *(float*)&HRBufs[ch]->Buf()[x] = 256 * 0.75 * ((int16)rand());
+
+     *(float*)&HRBufs[ch]->Buf()[x] = 256 * 32767 * 0.75 * sin(phase[ch]);
+
+     phase[ch] += phase_inc[ch];
+     phase_inc[ch] += phase_inc_inc;
+    }
+#endif
+
+#if 0
+    for(unsigned x = 0; x < rsc; x++)
+    {
+     static int32 wv[2] = { 0x6000 * 256, 0x6000 * 256 };
+     static int counter[2] = { 0, 0 };
+
+     *(float*)&HRBufs[ch]->Buf()[x] = wv[ch];
+
+     if(!counter[ch])
+     {
+      wv[ch] = -wv[ch];
+      counter[ch] = 80;
+     }
+     else
+      counter[ch]--;
+    }
+
+#endif
+
+    if(espec->SoundBuf && HRRes)
+    {
+     //printf("%04x\n", rsc);
+     new_sc = HRRes->Resample(HRBufs[ch], rsc, espec->SoundBuf + (espec->SoundBufSize * 2) + ch, espec->SoundBufMaxSize - espec->SoundBufSize, espec->NeedSoundReverse);
+    }
+    else
+    {
+     HRBufs[ch]->ResampleSkipped(rsc);
+     new_sc = 0;
+    }
+   }
+
+   espec->NeedSoundReverse = false;
+
+   if(ADPCMBuf)
+    ADPCMBuf->Finish(rsc);
+
+   if(CDDABufs[0])
+   {
+    CDDABufs[0]->Finish(rsc);
+    CDDABufs[1]->Finish(rsc);
+   }
+
+   espec->SoundBufSize += new_sc;
+  }
+
+  if(PCE_IsCD)
+   PCECD_ResetTS(end_timestamp_mod12);
+
+  vce->ResetTS(end_timestamp_mod12);
+
+  HuCPU.SyncAndResetTimestamp(end_timestamp_mod12);
+
+  //
+  //
+  //
+  PCE_TimestampBase += end_timestamp - end_timestamp_mod12;
+  espec->MasterCycles += end_timestamp - end_timestamp_mod12;
+
+  if(!rp_rv)
+  {
+   MDFN_MidSync(espec);
+  }
+ } while(!rp_rv);
+
+ //printf("%d\n", MDFND_GetTime() - t);
+
+ // End loop here.
+ //printf("%d\n", vce->GetScanlineNo());
+
+ if(IsHES)
+  HES_Update(espec, INPUT_HESHack());	//Draw(espec->skip ? NULL : espec->surface, espec->skip ? NULL : &espec->DisplayRect, espec->SoundBuf, espec->SoundBufSize, INPUT_HESHack());
+}
+
+static void StateAction(StateMem *sm, const unsigned load, const bool data_only)
+{
+ SFORMAT StateRegs[] =
+ {
+  SFPTR8(BaseRAM, IsSGX? 32768 : 8192),
+  SFVAR(PCE_TimestampBase),
+
+  SFEND
+ };
+
+#ifdef WANT_DEBUGGER
+ PCEDBG_MachineStateChanged();
+#endif
+
+ MDFNSS_StateAction(sm, load, data_only, StateRegs, "MAIN");
+
+ HuCPU.StateAction(sm, load, data_only);
+ vce->StateAction(sm, load, data_only);
+ psg->StateAction(sm, load, data_only);
+ INPUT_StateAction(sm, load, data_only);
+ HuC_StateAction(sm, load, data_only);
+
+ if(load)
+ {
+
+ }
+}
+
+void PCE_Power(void)
+{
+#ifdef WANT_DEBUGGER
+ PCEDBG_MachineStateChanged();
+#endif
+
+ memset(BaseRAM, 0x00, sizeof(BaseRAM));
+
+ HuCPU.Power();
+ PCE_TimestampBase = 0;	// FIXME, move to init.
+ const int32 timestamp = HuCPU.Timestamp();
+
+ vce->Reset(timestamp);
+ psg->Power(timestamp / 3);
+
+ if(IsHES)
+  HES_Reset();
+ else
+  HuC_Power();
+
+ PCEINPUT_Power(timestamp);
+
+ if(PCE_IsCD)
+ {
+  vce->SetCDEvent(PCECD_Power(timestamp));
+ }
+ //printf("%d\n", HuCPU.Timestamp());
+}
+
+static void SetMedia(uint32 drive_idx, uint32 state_idx, uint32 media_idx, uint32 orientation_idx)
+{
+ const RMD_Layout* rmd = EmulatedPCE.RMD;
+ const RMD_Drive* rd = &rmd->Drives[drive_idx];
+ const RMD_State* rs = &rd->PossibleStates[state_idx];
+
+ if(rs->MediaPresent && rs->MediaUsable)
+ {
+  SCSICD_SetDisc(false, (*cdifs)[media_idx]);
+ }
+ else
+ {
+  SCSICD_SetDisc(rs->MediaCanChange, NULL);
+ }
+}
+
+static void DoSimpleCommand(int cmd)
+{
+ switch(cmd)
+ {
+  case MDFN_MSC_RESET: PCE_Power(); break;
+  case MDFN_MSC_POWER: PCE_Power(); break;
+ }
+}
+
+static const MDFNSetting PCESettings[] = 
+{
+  { "pce.input.multitap", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Enable multitap(TurboTap) emulation."), NULL, MDFNST_BOOL, "1" },
+
+  { "pce.slstart", MDFNSF_NOFLAGS, gettext_noop("First rendered scanline."), NULL, MDFNST_UINT, "4", "0", "239" },
+  { "pce.slend", MDFNSF_NOFLAGS, gettext_noop("Last rendered scanline."), NULL, MDFNST_UINT, "235", "0", "239" },
+
+  { "pce.h_overscan", MDFNSF_NOFLAGS, gettext_noop("Show horizontal overscan area."), NULL, MDFNST_BOOL, "0" },
+
+  { "pce.mouse_sensitivity", MDFNSF_NOFLAGS, gettext_noop("Emulated mouse sensitivity."), NULL, MDFNST_FLOAT, "0.50", NULL, NULL, NULL, PCEINPUT_SettingChanged },
+  { "pce.disable_softreset", MDFNSF_NOFLAGS, gettext_noop("If set, when RUN+SEL are pressed simultaneously, disable both buttons temporarily."), NULL, MDFNST_BOOL, "0", NULL, NULL, NULL, PCEINPUT_SettingChanged },
+
+  { "pce.disable_bram_cd", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Disable BRAM(saved game memory) for CD games."), gettext_noop("It is intended for viewing CD games' error screens that may be different from simple BRAM full and uninitialized BRAM error screens, though it can cause the game to crash outright."), MDFNST_BOOL, "0" },
+  { "pce.disable_bram_hucard", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Disable BRAM(saved game memory) for HuCard games."), gettext_noop("It is intended for changing the behavior(passwords vs save games) of some HuCard games."), MDFNST_BOOL, "0" },
+
+  { "pce.forcesgx", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Force SuperGrafx emulation."), 
+		gettext_noop("Enabling this option is not necessary to run unrecognized PCE ROM images in SuperGrafx mode, and enabling it is discouraged; ROM images with a file extension of \".sgx\" will automatically enable SuperGrafx emulation."), MDFNST_BOOL, "0" },
+
+  { "pce.arcadecard", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Enable Arcade Card emulation."), 
+	gettext_noop("Leaving this option enabled is recommended, unless you want to see special warning screens on ACD games, or you prefer the non-enhanced modes of ACD-enhanced SCD games.  Additionally, you may want to disable it you you wish to use state rewinding with a SCD ACD-enhanced game on a slow CPU, as the extra 2MiB of RAM the Arcade Card offers is difficult to compress in real-time."), MDFNST_BOOL, "1" },
+
+  { "pce.nospritelimit", MDFNSF_NOFLAGS, gettext_noop("Remove 16-sprites-per-scanline hardware limit."), 
+					 gettext_noop("WARNING: Enabling this option may cause undesirable graphics glitching on some games(such as \"Bloody Wolf\")."), MDFNST_BOOL, "0" },
+
+  { "pce.cdbios", MDFNSF_EMU_STATE | MDFNSF_CAT_PATH, gettext_noop("Path to the CD BIOS"), NULL, MDFNST_STRING, "syscard3.pce" },
+  { "pce.gecdbios", MDFNSF_EMU_STATE | MDFNSF_CAT_PATH, gettext_noop("Path to the GE CD BIOS"), gettext_noop("Games Express CD Card BIOS (Unlicensed)"), MDFNST_STRING, "gecard.pce" },
+
+  { "pce.psgrevision", MDFNSF_NOFLAGS, gettext_noop("Select PSG revision."), gettext_noop("WARNING: HES playback will always use the \"huc6280a\" revision if this setting is set to \"match\", since HES playback is always done with SuperGrafx emulation enabled."), MDFNST_ENUM, "match", NULL, NULL, NULL, NULL, PSGRevisionList  },
+
+  { "pce.cdpsgvolume", MDFNSF_NOFLAGS, gettext_noop("PSG volume when playing a CD game."), gettext_noop("Setting this volume control too high may cause sample clipping."), MDFNST_UINT, "100", "0", "200", NULL, CDSettingChanged },
+  { "pce.cddavolume", MDFNSF_NOFLAGS, gettext_noop("CD-DA volume."), gettext_noop("Setting this volume control too high may cause sample clipping."), MDFNST_UINT, "100", "0", "200", NULL, CDSettingChanged },
+  { "pce.adpcmvolume", MDFNSF_NOFLAGS, gettext_noop("ADPCM volume."), gettext_noop("Setting this volume control too high may cause sample clipping."), MDFNST_UINT, "100", "0", "200", NULL, CDSettingChanged },
+  { "pce.adpcmextraprec", MDFNSF_NOFLAGS, gettext_noop("Output the full 12-bit ADPCM predictor."), gettext_noop("Enabling this option causes the MSM5205 ADPCM predictor to be outputted with full precision of 12-bits, rather than only outputting 10-bits of precision(as an actual MSM5205 does).  Enable this option to reduce whining noise during ADPCM playback."), MDFNST_BOOL, "0" },
+
+  { "pce.resamp_quality", MDFNSF_NOFLAGS, gettext_noop("Sound quality."), gettext_noop("Higher values correspond to better SNR and better preservation of higher frequencies(\"brightness\"), at the cost of increased computational complexity and a negligible increase in latency.\n\nHigher values will also slightly increase the probability of sample clipping(relevant if Mednafen's volume control settings are set too high), due to increased (time-domain) ringing."), MDFNST_INT, "3", "0", "5" },
+  { "pce.resamp_rate_error", MDFNSF_NOFLAGS, gettext_noop("Sound output rate tolerance."), gettext_noop("Lower values correspond to better matching of the output rate of the resampler to the actual desired output rate, at the expense of increased RAM usage and poorer CPU cache utilization."), MDFNST_FLOAT, "0.0000009", "0.0000001", "0.0000350" },
+
+  { "pce.vramsize", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE | MDFNSF_SUPPRESS_DOC, gettext_noop("Size of emulated VRAM per VDC in 16-bit words.  DO NOT CHANGE THIS UNLESS YOU KNOW WTF YOU ARE DOING."), NULL, MDFNST_UINT, "32768", "32768", "65536" },
+
+  { NULL }
+};
+
+static DECLFR(CheatReadFunc)
+{
+  std::vector<SUBCHEAT>::iterator chit;
+  uint8 retval = NonCheatPCERead[(A / 8192) & 0xFF](A);
+
+  for(chit = SubCheats[A & 0x7].begin(); chit != SubCheats[A & 0x7].end(); chit++)
+  {
+   if(A == chit->addr)
+   {
+    if(chit->compare == -1 || chit->compare == retval)
+    {
+     retval = chit->value;
+     break;
+    }
+   }
+  }
+ return(retval);
+}
+
+static uint8 MemRead(uint32 addr)
+{
+ return(NonCheatPCERead[(addr / 8192) & 0xFF](addr));
+}
+
+static void InstallReadPatch(uint32 address, uint8 value, int compare)
+{
+ HuCPU.SetFastRead(address >> 13, NULL);
+ HuCPU.SetReadHandler(address >> 13, CheatReadFunc);
+}
+
+static void RemoveReadPatches(void)
+{
+ for(int x = 0; x < 0x100; x++)
+  HuCPU.SetReadHandler(x, NonCheatPCERead[x]);
+}
+
+static void SetLayerEnableMask(uint64 mask)
+{
+ vce->SetLayerEnableMask(mask);
+}
+
+static const FileExtensionSpecStruct KnownExtensions[] =
+{
+ { ".pce",   0, gettext_noop("PC Engine ROM Image") },
+ { ".hes", -20, gettext_noop("PC Engine Music Rip") },
+ { ".sgx",   0, gettext_noop("SuperGrafx ROM Image") },
+ { NULL, 0, NULL }
+};
+
+static bool SetSoundRate(double rate)
+{
+ if(HRRes)
+ {
+  delete HRRes;
+  HRRes = NULL;
+ }
+
+ if(rate > 0)
+ {
+  HRRes = new OwlResampler(PCE_MASTER_CLOCK / 12, rate, MDFN_GetSettingF("pce.resamp_rate_error"), 20, MDFN_GetSettingUI("pce.resamp_quality"));
+  for(unsigned i = 0; i < 2; i++)
+   HRRes->ResetBufResampState(HRBufs[i]);
+ }
+
+ return(true);
+}
+
+//MDFN_printf(_("Palette is missing the full set of 512 greyscale entries.  Strip-colorburst entries will be calculated.\n"));
+static const CustomPalette_Spec CPInfo[] =
+{
+ { gettext_noop("PCE/TG16 9-bit GRB.  If only 512 triplets are present, the remaining 512 greyscale colors will be calculated automatically."), NULL, { 512, 1024, 0 } },
+
+ { NULL, NULL }
+};
+
+static const CheatInfoStruct CheatInfo =
+{
+ InstallReadPatch,
+ RemoveReadPatches,
+ MemRead,
+ NULL,
+
+ CheatFormatInfo_Empty
+};
+
+};
+
+using namespace MDFN_IEN_PCE;
+
+MDFNGI EmulatedPCE =
+{
+ "pce",
+ "PC Engine (CD)/TurboGrafx 16 (CD)/SuperGrafx",
+ KnownExtensions,
+ MODPRIO_INTERNAL_HIGH,
+ #ifdef WANT_DEBUGGER
+ &PCEDBGInfo,
+ #else
+ NULL,
+ #endif
+ PCEPortInfo,
+ NULL,
+ Load,
+ TestMagic,
+ LoadCD,
+ TestMagicCD,
+ CloseGame,
+
+ SetLayerEnableMask,
+ NULL,
+
+ NULL,
+ NULL,
+
+ CPInfo,
+ 0,
+
+ CheatInfo,
+
+ false,
+ StateAction,
+ Emulate,
+ PCEINPUT_TransformInput,
+ PCEINPUT_SetInput,
+ SetMedia,
+ DoSimpleCommand,
+ NULL,
+ PCESettings,
+ MDFN_MASTERCLOCK_FIXED(PCE_MASTER_CLOCK),
+ 0,
+ true,  // Multires possible?
+
+ 0,   // lcm_width
+ 0,   // lcm_height
+ NULL,  // Dummy
+
+ 320,	// Nominal width
+ 232,	// Nominal height
+ 1365,	// Framebuffer width
+ 270,	// Framebuffer height(TODO: decrease to 264(263 + spillover line))
+
+ 2,     // Number of output sound channels
+};
+
diff -Naur -r --no-dereference ./mednafen/src/pce/vce.cpp ./emu4crt/src/pce/vce.cpp
--- ./mednafen/src/pce/vce.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/pce/vce.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -35,6 +35,11 @@
 namespace MDFN_IEN_PCE
 {
 
+// SLK
+static int prev_dot_clock = 0; // SLK - 4 to force resolution initializing a start  
+static const int width_list[4] = {256,      320,      512,      512 }; // SLK
+// SLK end
+  
 static const int vce_ratios[4] = { 4, 3, 2, 2 };
 
 static MDFN_FASTCALL NO_INLINE int32 Sync(const int32 timestamp);
@@ -634,6 +639,18 @@
  dot_clock_ratio = vce_ratios[dot_clock];
 
  CR = V;
+ 
+ // SLK
+ if(dot_clock != prev_dot_clock)
+ {
+   printf("PCE - VCE - dot_clock change to: %d\n",dot_clock);
+   prev_dot_clock = dot_clock;
+   resolution_to_change_w = width_list[dot_clock];
+   resolution_to_change_h = 240;
+   resolution_to_change = true;
+ }
+ // SLK end
+ 
 }
 
 void VCE::SetPixelFormat(const MDFN_PixelFormat &format, const uint8* CustomColorMap, const uint32 CustomColorMapLen)
diff -Naur -r --no-dereference ./mednafen/src/psx/gpu.cpp ./emu4crt/src/psx/gpu.cpp
--- ./mednafen/src/psx/gpu.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/psx/gpu.cpp	2019-10-04 14:21:10.049110256 -0700
@@ -24,6 +24,7 @@
 #include "psx.h"
 #include "timer.h"
 
+#include <mednafen/mednafen.h>   // SLK
 /* FIXME: Respect horizontal timing register values in relation to hsync/hblank/hretrace/whatever signal sent to the timers */
 
 /*
@@ -74,6 +75,78 @@
 }
 using namespace PS_GPU_INTERNAL;
 
+// SLK
+uint32 PreviousDisplayMode;
+int prev_resolution_w;
+int prev_resolution_h;
+int res_change_count;
+
+void GPU_NewDisplayMode(int V)  // SLK - identify GPU new resolution, set global variables used in MAIN & VIDEO
+{
+  // GP1(08h) - Display mode
+  //   0-1   Horizontal Resolution 1     (0=256, 1=320, 2=512, 3=640) ;GPUSTAT.17-18
+  //   2     Vertical Resolution         (0=240, 1=480, when Bit5=1)  ;GPUSTAT.19
+  //   3     Video Mode                  (0=NTSC/60Hz, 1=PAL/50Hz)    ;GPUSTAT.20
+  //   4     Display Area Color Depth    (0=15bit, 1=24bit)           ;GPUSTAT.21
+  //   5     Vertical Interlace          (0=Off, 1=On)                ;GPUSTAT.22
+  //   6     Horizontal Resolution 2     (0=256/320/512/640, 1=368)   ;GPUSTAT.16
+  //   7     "Reverseflag"               (0=Normal, 1=Distorted)      ;GPUSTAT.14    
+  //   source: http://problemkaputt.de/psx-spx.txt
+
+  // Width
+  if((V & 0x40) == 0x40)
+  {
+    resolution_to_change_w = 368;
+  }
+  else
+  {
+    switch(V & 0x3)
+      {
+	case 0x00:
+	  resolution_to_change_w = 256;
+	  break;
+	case 0x01:	
+	  resolution_to_change_w = 320;
+	  break;
+	case 0x02:	
+	  resolution_to_change_w = 512;
+	  break;
+	case 0x03:	
+	  resolution_to_change_w = 640;
+	  break;
+      }
+  }
+  // Height
+  if ((V & 8) == 8)
+  { //PAL
+    if ((V & 32) == 32) {resolution_to_change_h = 576;} //5 
+    else {resolution_to_change_h = 288;}
+  }
+  else
+  { // NTSC
+    if ((V & 32) == 32){resolution_to_change_h = 480;} //5
+    else {resolution_to_change_h = 240;}
+  }
+  
+  if(prev_resolution_w != resolution_to_change_w || prev_resolution_h != resolution_to_change_h)
+  {
+      if(res_change_count < 2)
+      {
+	res_change_count += 1;
+	printf("PSX GPU - Startup resolution change bypass (%d).\n",res_change_count);
+	native_resolution_vcenter = false;  // No need Vertical centering for PSX module.
+      }
+      else{
+	prev_resolution_w = resolution_to_change_w; // will be used in VIDEO.cpp
+	prev_resolution_h = resolution_to_change_h;
+	printf("PSX - GPU register - resolution change to: %dx%d (V=%d)\n",resolution_to_change_w,resolution_to_change_h,V);
+	resolution_to_change = true;  // will be reset in VIDEO.cpp
+
+      }
+  }
+}
+// SLK end
+
 void GPU_Init(bool pal_clock_and_tv)
 {
  static const int8 dither_table[4][4] =
@@ -110,11 +183,25 @@
  {
   GPUClockRatio = 103896; // 65536 * 53693181.818 / (44100 * 768)
   hmc_to_visible = 520; 
+    
+  //SLK
+  resolution_to_change = true;
+  resolution_to_change_w = 640;
+  resolution_to_change_h = 480;
+  printf("PSX - GPU Init - NTSC mode - resolution set to: %dx%d\n",resolution_to_change_w,resolution_to_change_h);
+  
  }
  else	// PAL clock
  {
   GPUClockRatio = 102948; // 65536 * 53203425 / (44100 * 768)
   hmc_to_visible = 560; 
+  
+  //SLK
+  resolution_to_change = true;
+  resolution_to_change_w = 640;
+  resolution_to_change_h = 576;
+  printf("PSX - GPU Init - PAL mode - resolution set to: %dx%d\n",resolution_to_change_w,resolution_to_change_h);
+  
  }
 
  memcpy(&Commands[0x00], Commands_00_1F, sizeof(Commands_00_1F));
@@ -879,6 +966,11 @@
    case 0x08:
 	//printf("\n\nDISPLAYMODE SET: 0x%02x, %u *************************\n\n\n", V & 0xFF, scanline);
 	DisplayMode = V & 0xFF;
+	if(PreviousDisplayMode != DisplayMode) // SLK - Trap GPU resolution change
+	{
+	  PreviousDisplayMode = DisplayMode;
+	  GPU_NewDisplayMode(V);
+	}
 	break;
 
    case 0x09:
@@ -1093,8 +1185,13 @@
 {
  static const uint32 DotClockRatios[5] = { 10, 8, 5, 4, 7 };
  const uint32 dmc = (DisplayMode & 0x40) ? 4 : (DisplayMode & 0x3);
- const uint32 dmw = 2800 / DotClockRatios[dmc];	// Must be <= (768 - 32)
- const uint32 dmpa = (2800 - (hide_hoverscan ? 2640 : 2800)) / DotClockRatios[dmc] / 2;	// Must be <= 32
+ 
+ // Hotdog mod
+ // const uint32 dmw = 2800 / DotClockRatios[dmc];	// Must be <= (768 - 32)
+ // const uint32 dmpa = (2800 - (hide_hoverscan ? 2640 : 2800)) / DotClockRatios[dmc] / 2;	// Must be <= 32
+ const uint32 dmw = 2560 / DotClockRatios[dmc]; // Must be <= (768 - 32)
+ const uint32 dmpa = 0;
+ // Hotdog mod - end
  const uint32 drxbo = 32;
 
  int32 sys_clocks = sys_timestamp - lastts;
@@ -1342,6 +1439,16 @@
      int32 fb_x = DisplayFB_XStart * 2;
      int32 dx_start = HorizStart, dx_end = HorizEnd;
 
+     // Hotdog mod - 384
+     int32 actualGameBufferWidth = (HorizEnd - HorizStart) / DotClockRatios[dmc];
+     int32 ourBufferWidth = dmw;
+     
+     int32 leftOffset = (actualGameBufferWidth - ourBufferWidth) / 2;
+     //leftOffset *= DotClockRatios[dmc]; // Get back into PSX GPU co-ords.
+     leftOffset = std::max<int32>(leftOffset, 0); // Make sure not negative
+     dx_start += leftOffset; // Offset the PSX buffer to render relative to our frame.
+     //
+     
      dest_line = ((scanline - FirstVisibleLine) << espec->InterlaceOn) + espec->InterlaceField;
      dest = surface->pixels + (drxbo - dmpa) + dest_line * surface->pitch32;
 
@@ -1351,10 +1458,16 @@
      dx_start = dx_start / DotClockRatios[dmc];
      dx_end = dx_end / DotClockRatios[dmc];
 
-     dx_start -= hmc_to_visible / DotClockRatios[dmc];
-     dx_end -= hmc_to_visible / DotClockRatios[dmc];
-     dx_start += 7;
-     dx_end += 7;
+     // Hotdogmod
+     dx_end -= dx_start;
+     dx_start = -leftOffset;
+     
+     // dx_start -= hmc_to_visible / DotClockRatios[dmc];
+     // dx_end -= hmc_to_visible / DotClockRatios[dmc];
+     // dx_start += 7;
+     // dx_end += 7;
+     // Hotdod mod - end
+
 
      if(dx_start < 0)
      {
diff -Naur -r --no-dereference ./mednafen/src/snes/interface.cpp ./emu4crt/src/snes/interface.cpp
--- ./mednafen/src/snes/interface.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/snes/interface.cpp	2019-10-04 14:21:10.053110280 -0700
@@ -71,6 +71,11 @@
 
 static std::vector<uint32> ColorMap;	// [32768]
 
+// SLK
+int prev_resolution_w;
+int prev_resolution_h;
+// SLK - end
+
 static void BuildColorMap(MDFN_PixelFormat &format, uint8* CustomColorMap)
 {
  for(int x = 0; x < 32768; x++) 
@@ -546,6 +551,23 @@
  MDFNGameInfo->fps = PAL ? 838977920 : 1008307711;
  MDFNGameInfo->MasterClock = MDFN_MASTERCLOCK_FIXED(32040.5);
 
+ // SLK -  init. dynamic display video resolution - progressive by default
+ printf("SNES Interface - Regional mode: %s \n",(PAL ? "PAL" : "NTSC"));
+ if(PAL)
+ {
+  resolution_to_change_h = 288;
+ }
+ else
+ {
+  printf("  Video mode set to 256 x 240\n");
+  resolution_to_change_h = 240;
+ }
+ resolution_to_change_w = 256;
+ resolution_to_change = true;
+ prev_resolution_w = resolution_to_change_w;
+ prev_resolution_h = resolution_to_change_h;
+ // SLK - end
+ 
  if(!snsf_loader)
  {
   EnableHBlend = MDFN_GetSettingB("snes.h_blend");
@@ -890,6 +912,32 @@
  bSNES_v059::system.run_mednafen_custom();
  bSNES_v059::ppu.enable_renderer(true);
 
+ // SLK - guess SNES active resolution
+ //printf("SNES Interface - Emulate - %dx%d - %d,%d\n",tdr->w,tdr->h,tdr->x,tdr->y);
+ if(tdr->h > 10 && tdr->w > 10 && tdr->w != prev_resolution_w)
+ {
+   resolution_to_change = true;
+   resolution_to_change_w = tdr->w;
+ }
+ if(tdr->h > 10 && tdr->w > 10 && tdr->h != prev_resolution_h)
+ {
+   resolution_to_change = true;
+   if(tdr->h <= 400)
+   {
+    resolution_to_change_h = bSNES_v059::system.region() ? 288 : 240;
+   }
+   else
+   {
+     resolution_to_change_h = bSNES_v059::system.region() ? 576 : 480;
+   }
+ }
+ if(resolution_to_change)
+ {
+   //printf("SNES - Interface - Resolution change detected: %dx%d\n",resolution_to_change_w,resolution_to_change_h);
+   prev_resolution_w = resolution_to_change_w;
+   prev_resolution_h = tdr->h;
+ }
+ // SLK - end
 
  //
  // Blank out any missed lines(for e.g. display height change with PAL emulation)
diff -Naur -r --no-dereference ./mednafen/src/snes_faust/ppu.cpp ./emu4crt/src/snes_faust/ppu.cpp
--- ./mednafen/src/snes_faust/ppu.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/snes_faust/ppu.cpp	2019-10-07 12:20:28.357840984 -0700
@@ -37,6 +37,10 @@
 namespace MDFN_IEN_SNES_FAUST
 {
 
+// SLK
+int prev_resolution_w = 256;
+//
+
 uint32 scanline;
 
 static struct
@@ -2225,6 +2229,15 @@
  uint32* const out_target = es->surface->pixels + out_line * es->surface->pitchinpix;
  const uint32 w = ((BGMode & 0x7) == 0x5 || (BGMode & 0x7) == 0x6 || (ScreenMode & 0x08)) ? 512 : 256;
 
+// SLK 
+ if(w != prev_resolution_w)
+ {
+   resolution_to_change_w = w;
+   prev_resolution_w = w;
+   resolution_to_change = true;
+ }
+// SLK - end
+
  es->LineWidths[out_line] = w;
  //
  LineTarget++;
diff -Naur -r --no-dereference ./mednafen/src/snes_faust/snes.cpp ./emu4crt/src/snes_faust/snes.cpp
--- ./mednafen/src/snes_faust/snes.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/snes_faust/snes.cpp	2019-10-04 14:21:10.053110280 -0700
@@ -533,6 +533,21 @@
  const bool IsPAL = CART_Init(snsf_loader ? &snsf_loader->ROM_Data : gf->stream, EmulatedSNES_Faust.MD5, cx4_ocmultiplier, superfx_ocmultiplier);
  CART_LoadNV();
 
+// SLK -  init. dynamic display video resolution - progressive by default
+ printf("SNES FAUST snes - Regional mode: %s \n",(IsPAL ? "PAL" : "NTSC"));
+ if(IsPAL)
+ {
+  resolution_to_change_h = 288;
+ }
+ else
+ {
+  printf("  Video mode set to 256 x 240\n");
+  resolution_to_change_h = 240;
+ }
+ resolution_to_change_w = 256;
+ resolution_to_change = true;
+ // SLK - end
+
  DMA_Init();
  INPUT_Init();
  {
diff -Naur -r --no-dereference ./mednafen/src/snes_faust/snes.cpp.orig ./emu4crt/src/snes_faust/snes.cpp.orig
--- ./mednafen/src/snes_faust/snes.cpp.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/snes_faust/snes.cpp.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,1122 @@
+/******************************************************************************/
+/* Mednafen Fast SNES Emulation Module                                        */
+/******************************************************************************/
+/* snes.cpp:
+**  Copyright (C) 2015-2019 Mednafen Team
+**
+** This program is free software; you can redistribute it and/or
+** modify it under the terms of the GNU General Public License
+** as published by the Free Software Foundation; either version 2
+** of the License, or (at your option) any later version.
+**
+** This program is distributed in the hope that it will be useful,
+** but WITHOUT ANY WARRANTY; without even the implied warranty of
+** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+** GNU General Public License for more details.
+**
+** You should have received a copy of the GNU General Public License
+** along with this program; if not, write to the Free Software Foundation, Inc.,
+** 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+*/
+
+#include "snes.h"
+#include "input.h"
+#include "cart.h"
+#include "apu.h"
+#include "ppu.h"
+
+#include <mednafen/mednafen.h>
+#include <mednafen/mempatcher.h>
+#include <mednafen/SNSFLoader.h>
+#include <mednafen/player.h>
+#include <mednafen/hash/sha1.h>
+
+#include <bitset>
+
+extern MDFNGI EmulatedSNES_Faust;
+
+namespace MDFN_IEN_SNES_FAUST
+{
+static bool SpecEx, SpecExSoundToo;
+static MemoryStream* SpecExSS = NULL;
+static int32 SpecExAudioExpected;
+
+static void InitEvents(void) MDFN_COLD;
+
+
+template<bool b_bus>
+static void SetHandlers(uint32 A1, uint32 A2, readfunc read_handler, writefunc write_handler)
+{
+ unsigned index = 0;
+
+ assert(read_handler && write_handler);
+
+ while(index < 256 && CPUM.ReadFuncs[index] && CPUM.WriteFuncs[index] && (CPUM.ReadFuncs[index] != read_handler || CPUM.WriteFuncs[index] != write_handler))
+  index++;
+
+ assert(index < 256);
+
+ CPUM.ReadFuncs[index] = read_handler;
+ CPUM.WriteFuncs[index] = write_handler;
+ CPUM.ReadFuncsA[index] = b_bus ? OBRead_FAST : read_handler;
+ CPUM.WriteFuncsA[index] = b_bus ? OBWrite_FAST : write_handler;
+
+ if(b_bus)
+ {
+  assert(A1 < 256 && A2 < 256);
+
+  for(unsigned bank = 0x00; bank < 0x100; bank++)
+  {
+   if(bank <= 0x3F || (bank >= 0x80 && bank <= 0xBF))
+   {
+    for(uint32 baddr = A1; baddr <= A2; baddr++)
+    {
+     CPUM.DM_ReadFuncsB[baddr] = read_handler;
+     CPUM.DM_WriteFuncsB[baddr] = write_handler;
+
+     CPUM.RWIndex[(bank << 16) + 0x2100 + baddr] = index;
+    }
+   }
+  }
+ }
+ else
+ {
+  for(uint32 addr = A1; addr <= A2; addr++)
+  {
+   CPUM.RWIndex[addr] = index;
+  }
+ }
+
+ CPUM.RWIndex[256 * 65536] = CPUM.RWIndex[0];
+}
+
+void Set_A_Handlers(uint32 A1, uint32 A2, readfunc read_handler, writefunc write_handler)
+{
+ SetHandlers<false>(A1, A2, read_handler, write_handler);
+}
+
+void Set_B_Handlers(uint8 A1, uint8 A2, readfunc read_handler, writefunc write_handler)
+{
+ SetHandlers<true>(A1, A2, read_handler, write_handler);
+}
+
+bool MemSelect;
+
+template<signed cyc>
+static INLINE DEFREAD(OBRead)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return CPUM.mdr;
+ }
+
+ if(cyc >= 0)
+  CPUM.timestamp += cyc;
+ else
+  CPUM.timestamp += MemSelect ? MEMCYC_FAST : MEMCYC_SLOW;
+
+ SNES_DBG("[SNES] Unknown Read: $%02x:%04x\n", A >> 16, A & 0xFFFF);
+ return CPUM.mdr;
+}
+
+template<signed cyc>
+static INLINE DEFWRITE(OBWrite)
+{
+ if(cyc >= 0)
+  CPUM.timestamp += cyc;
+ else
+  CPUM.timestamp += MemSelect ? MEMCYC_FAST : MEMCYC_SLOW;
+
+ SNES_DBG("[SNES] Unknown Write: $%02x:%04x $%02x\n", A >> 16, A & 0xFFFF, V);
+}
+
+DEFREAD(OBRead_XSLOW) { return OBRead<MEMCYC_XSLOW>(A); }
+DEFREAD(OBRead_SLOW)  { return OBRead<MEMCYC_SLOW>(A); }
+DEFREAD(OBRead_FAST)  { return OBRead<MEMCYC_FAST>(A); }
+DEFREAD(OBRead_VAR)   { return OBRead<-1>(A); }
+
+DEFWRITE(OBWrite_XSLOW) { OBWrite<MEMCYC_XSLOW>(A, V); }
+DEFWRITE(OBWrite_SLOW) { OBWrite<MEMCYC_SLOW>(A, V); }
+DEFWRITE(OBWrite_FAST) { OBWrite<MEMCYC_FAST>(A, V); }
+DEFWRITE(OBWrite_VAR) { OBWrite<-1>(A, V); }
+
+
+static uint8 WRAM[0x20000];
+#ifdef SNES_DBG_ENABLE
+static std::bitset<0x20000> WRAMWritten;	// for debugging
+#endif
+
+template<uint32 mask>
+static DEFREAD(WRAMRead)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return WRAM[A & mask];
+ }
+
+ CPUM.timestamp += MEMCYC_SLOW;
+
+#ifdef SNES_DBG_ENABLE
+ //if(!WRAMWritten[A & mask])
+ // SNES_DBG("[SNES] Read from uninitialized WRAM at 0x%08x!\n", A & mask);
+#endif
+
+ return WRAM[A & mask];
+}
+
+template<uint32 mask>
+static DEFWRITE(WRAMWrite)
+{
+ CPUM.timestamp += MEMCYC_SLOW;
+
+ WRAM[A & mask] = V;
+
+#ifdef SNES_DBG_ENABLE
+ WRAMWritten[A & mask] = true;
+#endif
+}
+
+static uint8 Multiplicand;
+static uint16 MultProduct;	// Also division remainder.
+
+static uint16 Dividend;
+static uint16 DivQuotient;
+
+static uint32 WMAddress;
+
+#include "dma.inc"
+
+static void ICRegsReset(bool powering_up)
+{
+ if(powering_up)
+ {
+  Multiplicand = 0xFF;
+  MultProduct = 0xFFFF;
+
+  Dividend = 0xFFFF;
+  DivQuotient = 0xFFFF;
+ }
+
+ WMAddress = 0;
+
+ MemSelect = 0;
+}
+
+static DEFWRITE(ICRegsWrite)
+{
+ CPUM.timestamp += MEMCYC_FAST;
+
+ A &= 0xFFFF;
+
+ switch(A & 0xFFFF)
+ {
+  case 0x4202:	Multiplicand = V;
+		break;
+
+  case 0x4203:	MultProduct = Multiplicand * V;
+		break;
+
+  case 0x4204:	Dividend = (Dividend & 0xFF00) | (V << 0);
+		break;
+
+  case 0x4205:  Dividend = (Dividend & 0x00FF) | (V << 8);
+		break;
+
+  case 0x4206:	//printf("Divide: 0x%04x / 0x%02x\n", Dividend, V);
+
+		if(!V)
+		{
+		 DivQuotient = 0xFFFF;
+		 MultProduct = Dividend;
+		}
+		else
+		{
+		 DivQuotient = Dividend / V;
+		 MultProduct = Dividend % V;
+		}
+		break;
+
+  case 0x420D:  MemSelect = V & 1;
+		break;
+ }
+}
+
+
+static DEFREAD(Read_4214)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return DivQuotient >> 0;
+ }
+
+ CPUM.timestamp += MEMCYC_FAST;
+
+ return DivQuotient >> 0;
+}
+
+static DEFREAD(Read_4215)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return DivQuotient >> 8;
+ }
+
+ CPUM.timestamp += MEMCYC_FAST;
+
+ return DivQuotient >> 8;
+}
+
+static DEFREAD(Read_4216)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return MultProduct >> 0;
+ }
+
+ CPUM.timestamp += MEMCYC_FAST;
+
+ return MultProduct >> 0;
+}
+
+static DEFREAD(Read_4217)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return MultProduct >> 8;
+ }
+
+ CPUM.timestamp += MEMCYC_FAST;
+
+ return MultProduct >> 8;
+}
+
+//
+//
+//
+static DEFWRITE(Write_2180)
+{
+ CPUM.timestamp += MEMCYC_FAST;
+
+#ifdef SNES_DBG_ENABLE
+ WRAMWritten[WMAddress] = true;
+#endif
+
+ WRAM[WMAddress] = V;
+ WMAddress = (WMAddress + 1) & 0x1FFFF;
+}
+
+static DEFWRITE(Write_2181)
+{
+ CPUM.timestamp += MEMCYC_FAST;
+
+ WMAddress &= 0xFFFF00;
+ WMAddress |= V << 0;
+}
+
+static DEFWRITE(Write_2182)
+{
+ CPUM.timestamp += MEMCYC_FAST;
+
+ WMAddress &= 0xFF00FF;
+ WMAddress |= V << 8;
+}
+
+static DEFWRITE(Write_2183)
+{
+ CPUM.timestamp += MEMCYC_FAST;
+
+ WMAddress &= 0x00FFFF;
+ WMAddress |= (V & 1) << 16;
+}
+
+static DEFREAD(Read_2180)
+{
+ if(MDFN_UNLIKELY(DBG_InHLRead))
+ {
+  return WRAM[WMAddress];
+ }
+
+ uint8 ret;
+
+ CPUM.timestamp += MEMCYC_FAST;
+
+ ret = WRAM[WMAddress];
+ WMAddress = (WMAddress + 1) & 0x1FFFF;
+
+ return ret;
+}
+
+//
+//
+//
+static SNSFLoader* snsf_loader = NULL;
+static SPCReader* spc_reader = NULL;
+
+static MDFN_COLD void Reset(bool powering_up)
+{
+ if(spc_reader)
+ {
+  APU_Reset(powering_up);
+  APU_SetSPC(spc_reader);
+
+  return;
+ }
+
+ if(powering_up)
+ {
+  for(unsigned i = 0, p = 0xCAFEBEEF; i < sizeof(WRAM); i++, p = (p << 1) | (((p >> 31) ^ (p >> 21) ^ (p >> 1) ^ p) & 1))
+   WRAM[i] = ((p + i * 3) % 192) + 32;
+
+  //memset(WRAM, 0x02, sizeof(WRAM));
+  //WRAM[0x1D0FF] = 0x0;	// lufia 2...
+
+#ifdef SNES_DBG_ENABLE
+  WRAMWritten.reset();
+#endif
+ }
+
+ ICRegsReset(powering_up);
+ DMA_Reset(powering_up);
+ APU_Reset(powering_up);
+ PPU_Reset(powering_up);
+ CART_Reset(powering_up);
+ INPUT_Reset(powering_up);
+
+ //
+ CPU_Reset(powering_up);
+
+ InitEvents();
+ ForceEventUpdates(0);
+}
+
+//
+//
+//
+
+static MDFN_COLD bool TestMagic(GameFile* gf)
+{
+ if(gf->ext == "sfc" || gf->ext == "smc" || gf->ext == "swc" || gf->ext == "fig")
+  return true;
+
+ if(SNSFLoader::TestMagic(gf->stream))
+  return true;
+
+ if(SPCReader::TestMagic(gf->stream))
+  return true;
+
+ return false;
+}
+
+static MDFN_COLD void Cleanup(void)
+{
+ if(SpecExSS)
+ {
+  delete SpecExSS;
+  SpecExSS = NULL;
+ }
+
+ if(snsf_loader)
+ {
+  delete snsf_loader;
+  snsf_loader = NULL;
+ }
+
+ APU_Kill();
+
+ if(spc_reader)
+ {
+  delete spc_reader;
+  spc_reader = NULL;
+ }
+ else
+ {
+  PPU_Kill();
+  INPUT_Kill();
+  CART_Kill();
+ }
+}
+
+static MDFN_COLD void LoadReal(GameFile* gf)
+{
+ if(SPCReader::TestMagic(gf->stream))
+ {
+  spc_reader = new SPCReader(gf->stream);
+  Player_Init(1, spc_reader->GameName(), spc_reader->ArtistName(), "", std::vector<std::string>({ spc_reader->SongName() }));
+  EmulatedSNES_Faust.fps = (1U << 24) * 75;
+  EmulatedSNES_Faust.MasterClock = MDFN_MASTERCLOCK_FIXED(21477272.7);
+
+  APU_Init(false);
+  Reset(true);
+
+  return;
+ }
+
+ SpecEx = MDFN_GetSettingB("snes_faust.spex");
+ SpecExSoundToo = MDFN_GetSettingB("snes_faust.spex.sound");
+ SpecExAudioExpected = -1;
+
+ MDFNMP_Init(8192, (1U << 24) / 8192);
+ MDFNMP_RegSearchable(0x7E0000, 0x20000);
+
+ DBG_Init();
+
+ CPU_Init();
+
+ memset(CPUM.ReadFuncs, 0, sizeof(CPUM.ReadFuncs));
+ memset(CPUM.WriteFuncs, 0, sizeof(CPUM.WriteFuncs));
+
+ memset(CPUM.ReadFuncsA, 0, sizeof(CPUM.ReadFuncsA));
+ memset(CPUM.WriteFuncsA, 0, sizeof(CPUM.WriteFuncsA));
+
+ //
+ // Map in open bus.
+ //
+ for(unsigned bank = 0x00; bank < 0x100; bank++)
+ {
+  readfunc ob_cart_r = OBRead_SLOW;
+  writefunc ob_cart_w = OBWrite_SLOW;
+
+  if(bank >= 0x80)
+  {
+   ob_cart_r = OBRead_VAR;
+   ob_cart_w = OBWrite_VAR;
+  }
+
+  if(bank <= 0x3F || (bank >= 0x80 && bank <= 0xBF))
+  {
+   Set_A_Handlers((bank << 16) | 0x2000, (bank << 16) | 0x3FFF, OBRead_FAST, OBWrite_FAST);
+   Set_A_Handlers((bank << 16) | 0x4000, (bank << 16) | 0x41FF, OBRead_XSLOW, OBWrite_XSLOW);
+   Set_A_Handlers((bank << 16) | 0x4200, (bank << 16) | 0x5FFF, OBRead_FAST, OBWrite_FAST);
+   Set_A_Handlers((bank << 16) | 0x6000, (bank << 16) | 0x7FFF, OBRead_SLOW, OBWrite_SLOW);
+
+   Set_A_Handlers((bank << 16) | 0x8000, (bank << 16) | 0xFFFF, ob_cart_r, ob_cart_w);
+  }
+  else if(bank != 0x7E && bank != 0x7F)
+   Set_A_Handlers((bank << 16) | 0x0000, (bank << 16) | 0xFFFF, ob_cart_r, ob_cart_w);
+ }
+ Set_B_Handlers(0x00, 0xFF, OBRead_FAST, OBWrite_FAST);
+
+ //
+ // Map WRAM and CPU registers.
+ //
+ Set_A_Handlers(0x7E0000, 0x7FFFFF, WRAMRead<0x1FFFF>, WRAMWrite<0x1FFFF>);
+
+ Set_B_Handlers(0x80, Read_2180, Write_2180);
+ Set_B_Handlers(0x81, OBRead_FAST, Write_2181);
+ Set_B_Handlers(0x82, OBRead_FAST, Write_2182);
+ Set_B_Handlers(0x83, OBRead_FAST, Write_2183);
+
+ for(unsigned bank = 0x00; bank < 0x100; bank++)
+ {
+  if(bank <= 0x3F || (bank >= 0x80 && bank <= 0xBF))
+  {
+   Set_A_Handlers((bank << 16) | 0x0000, (bank << 16) | 0x1FFF, WRAMRead<0x1FFF>, WRAMWrite<0x1FFF>);
+
+   Set_A_Handlers((bank << 16) | 0x4202, (bank << 16) | 0x4206, OBRead_FAST, ICRegsWrite);
+   Set_A_Handlers((bank << 16) | 0x420D, OBRead_FAST, ICRegsWrite);
+
+   Set_A_Handlers((bank << 16) | 0x4214, Read_4214, OBWrite_FAST);
+   Set_A_Handlers((bank << 16) | 0x4215, Read_4215, OBWrite_FAST);
+   Set_A_Handlers((bank << 16) | 0x4216, Read_4216, OBWrite_FAST);
+   Set_A_Handlers((bank << 16) | 0x4217, Read_4217, OBWrite_FAST);
+  }
+ }
+
+ if(SNSFLoader::TestMagic(gf->stream))
+ {
+  snsf_loader = new SNSFLoader(gf->vfs, gf->dir, gf->stream);
+  Player_Init(1, snsf_loader->tags.GetTag("game"), snsf_loader->tags.GetTag("artist"), snsf_loader->tags.GetTag("copyright"), std::vector<std::string>({ snsf_loader->tags.GetTag("title") }));
+ }
+
+ const int32 cx4_ocmultiplier = ((MDFN_GetSettingUI("snes_faust.cx4.clock_rate") << 16) + 50) / 100;
+ const int32 superfx_ocmultiplier = 1U << 16; //((MDFN_GetSettingUI("snes_faust.superfx.clock_rate") << 16) + 50) / 100;
+ const bool IsPAL = CART_Init(snsf_loader ? &snsf_loader->ROM_Data : gf->stream, EmulatedSNES_Faust.MD5, cx4_ocmultiplier, superfx_ocmultiplier);
+ CART_LoadNV();
+
+ DMA_Init();
+ INPUT_Init();
+ {
+  const bool mte[2] = { MDFN_GetSettingB("snes_faust.input.sport1.multitap"), MDFN_GetSettingB("snes_faust.input.sport2.multitap") };
+  INPUT_SetMultitap(mte);
+ }
+
+ EmulatedSNES_Faust.MasterClock = IsPAL ? MDFN_MASTERCLOCK_FIXED(21281370.0) : MDFN_MASTERCLOCK_FIXED(21477272.7);
+
+ PPU_Init(IsPAL);
+ PPU_SetGetVideoParams(&EmulatedSNES_Faust, MDFN_GetSettingB("snes_faust.correct_aspect"), MDFN_GetSettingUI("snes_faust.h_filter"));
+
+ APU_Init(IsPAL);
+
+ Reset(true);
+}
+
+static MDFN_COLD void Load(GameFile* gf)
+{
+ try
+ {
+  LoadReal(gf);
+ }
+ catch(...)
+ {
+  Cleanup();
+
+  throw;
+ }
+}
+
+static MDFN_COLD void CloseGame(void)
+{
+ if(!snsf_loader && !spc_reader)
+ {
+  try
+  {
+   CART_SaveNV();
+  }
+  catch(std::exception &e)
+  {
+   MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+  }
+ }
+ Cleanup();
+}
+
+static MDFN_COLD uint8* CheatMemGetPointer(uint32 A)
+{
+ A &= (1U << 24) - 1;
+
+ const uint8 bank = A >> 16;
+ const uint16 offset = A & 0xFFFF;
+
+ if(bank == 0x7E || bank == 0x7F)
+  return &WRAM[A & 0x1FFFF];
+ else if(bank <= 0x3F || (bank >= 0x80 && bank <= 0xBF))
+ {
+  if(offset >= 0x0000 && offset <= 0x1FFF)
+   return &WRAM[A & 0x1FFF];
+ }
+
+ return nullptr;
+}
+
+static MDFN_COLD uint8 CheatMemRead(uint32 A)
+{
+ const uint8* p = CheatMemGetPointer(A);
+
+ if(p)
+  return *p;
+
+ return 0x00;
+}
+
+static MDFN_COLD void CheatMemWrite(uint32 A, uint8 V)
+{
+ uint8* p = CheatMemGetPointer(A);
+
+ if(p)
+  *p = V;
+}
+
+event_list_entry events[SNES_EVENT__COUNT];
+
+static MDFN_COLD void InitEvents(void)
+{
+ for(unsigned i = 0; i < SNES_EVENT__COUNT; i++)
+ {
+  if(i == SNES_EVENT__SYNFIRST)
+   events[i].event_time = 0;
+  else if(i == SNES_EVENT__SYNLAST)
+   events[i].event_time = 0xFFFFFFFF;
+  else
+   events[i].event_time = SNES_EVENT_MAXTS;
+
+  events[i].prev = (i > 0) ? &events[i - 1] : NULL;
+  events[i].next = (i < (SNES_EVENT__COUNT - 1)) ? &events[i + 1] : NULL;
+ }
+
+ events[SNES_EVENT_PPU].event_handler = PPU_Update;
+ events[SNES_EVENT_PPU_LINEIRQ].event_handler = PPU_UpdateLineIRQ;
+ events[SNES_EVENT_DMA_DUMMY].event_handler = DMA_Update;
+ events[SNES_EVENT_CART].event_handler = CART_GetEventHandler();
+}
+
+static void RebaseTS(const uint32 timestamp)
+{
+ for(unsigned i = SNES_EVENT__SYNFIRST + 1; i < SNES_EVENT__SYNLAST; i++)
+ {
+  assert(events[i].event_time > timestamp);
+  events[i].event_time -= timestamp;
+ }
+
+ CART_AdjustTS(-timestamp);
+
+ CPUM.next_event_ts = events[SNES_EVENT__SYNFIRST].next->event_time;
+}
+
+void SNES_SetEventNT(const int type, const uint32 next_timestamp)
+{
+#ifdef SNES_DBG_ENABLE
+ assert(type > SNES_EVENT__SYNFIRST && type < SNES_EVENT__SYNLAST);
+#endif
+ event_list_entry *e = &events[type];
+
+ if(next_timestamp < e->event_time)
+ {
+  event_list_entry *fe = e;
+
+  do
+  {
+   fe = fe->prev;
+  }
+  while(next_timestamp < fe->event_time);
+
+  // Remove this event from the list, temporarily of course.
+  e->prev->next = e->next;
+  e->next->prev = e->prev;
+
+  // Insert into the list, just after "fe".
+  e->prev = fe;
+  e->next = fe->next;
+  fe->next->prev = e;
+  fe->next = e;
+
+  e->event_time = next_timestamp;
+ }
+ else if(next_timestamp > e->event_time)
+ {
+  event_list_entry *fe = e;
+
+  do
+  {
+   fe = fe->next;
+  } while(next_timestamp > fe->event_time);
+
+  // Remove this event from the list, temporarily of course
+  e->prev->next = e->next;
+  e->next->prev = e->prev;
+
+  // Insert into the list, just BEFORE "fe".
+  e->prev = fe->prev;
+  e->next = fe;
+  fe->prev->next = e;
+  fe->prev = e;
+
+  e->event_time = next_timestamp;
+ }
+
+ CPUM.next_event_ts = events[SNES_EVENT__SYNFIRST].next->event_time & CPUM.running_mask;
+}
+
+// Called from debug.cpp too.
+void ForceEventUpdates(const uint32 timestamp)
+{
+ for(unsigned i = SNES_EVENT__SYNFIRST + 1; i < SNES_EVENT__SYNLAST; i++)
+ {
+  SNES_SetEventNT(i, events[i].event_handler(timestamp));
+ }
+ //
+ CPUM.next_event_ts = events[SNES_EVENT__SYNFIRST].next->event_time;
+}
+
+void CPU_Misc::EventHandler(void)
+{
+ event_list_entry *e = events[SNES_EVENT__SYNFIRST].next;
+
+ while(timestamp >= e->event_time)	// If Running = 0, SNES_EventHandler() may be called even if there isn't an event per-se, so while() instead of do { ... } while
+ {
+  event_list_entry *prev = e->prev;
+  uint32 nt;
+
+  nt = e->event_handler(e->event_time);
+//#if SNES_EVENT_SYSTEM_CHECKS
+  assert(nt > e->event_time);
+//#endif
+
+  SNES_SetEventNT(/*e->which*/e - events, nt);
+
+  // Order of events can change due to calling SNES_SetEventNT(), this prev business ensures we don't miss an event due to reordering.
+  e = prev->next;
+ }
+
+ //return(Running);
+}
+
+static void NO_INLINE EmulateReal(EmulateSpecStruct* espec)
+{
+ APU_StartFrame((double)EmulatedSNES_Faust.MasterClock / MDFN_MASTERCLOCK_FIXED(1), espec->SoundRate);
+
+ if(spc_reader)
+  CPUM.timestamp = 286364;
+ else
+ {
+  const bool skip_save = espec->skip;
+  espec->skip |= snsf_loader != NULL;
+
+  MDFNMP_ApplyPeriodicCheats();
+
+  // Call before PPU_StartFrame(), as PPU_StartFrame() may call INPUT_AutoRead().
+  INPUT_UpdatePhysicalState();
+
+  PPU_StartFrame(espec);
+
+#if 0
+ for(unsigned msi = 0; msi < 2; msi++)
+ {
+  for(uint32 A = 0; A < (1U << 24); A++)
+  {
+   CPUM.timestamp = 0;
+   const uint32 pts = CPUM.timestamp;
+
+   MemSelect = msi;
+   CPUM.ReadA(A);
+   //
+   const uint32 td = CPUM.timestamp - pts;
+   const uint8 bank = A >> 16;
+   const uint16 offs = (uint16)A;
+   uint32 reqtd = ~0U;
+
+   if(!(bank & 0x40))
+   {
+    if(offs < 0x2000)
+     reqtd = 8;
+    else if(offs < 0x4000)
+     reqtd = 6;
+    else if(offs < 0x4200)
+     reqtd = 12;
+    else if(offs < 0x6000)
+     reqtd = 6;
+    else if(offs < 0x8000)
+     reqtd = 8;
+    else
+     reqtd = ((bank & 0x80) && msi) ? 6 : 8;
+   }
+   else
+    reqtd = ((bank & 0x80) && msi) ? 6 : 8;
+
+   if(td != reqtd)
+   {
+    printf("0x%06x td=%d reqtd=%d\n", A, td, reqtd);
+    assert(td == reqtd);
+   }
+  }
+ }
+ printf("Done\n");
+ exit(0);
+#endif
+
+
+  CPU_Run();
+  uint32 prev = CPUM.timestamp;
+  ForceEventUpdates(CPUM.timestamp);
+  assert(CPUM.timestamp == prev);
+
+  espec->skip = skip_save;
+ }
+
+ espec->MasterCycles = CPUM.timestamp;
+
+ espec->SoundBufSize = APU_EndFrame(espec->SoundBuf);
+ if(!spc_reader)
+ {
+  PPU_ResetTS();
+  RebaseTS(CPUM.timestamp);
+ }
+ CPUM.timestamp = 0;
+}
+
+#ifdef SNES_DBG_ENABLE
+static sha1_digest doggy;
+#endif
+
+static void Emulate(EmulateSpecStruct* espec)
+{
+ if(!SpecEx || spc_reader || snsf_loader)
+  EmulateReal(espec);
+ else
+ {
+  EmulateSpecStruct tmp_espec = *espec;
+
+  if(espec->SoundFormatChanged || espec->NeedSoundReverse)
+   SpecExAudioExpected = -1;
+
+  tmp_espec.skip = true;
+  tmp_espec.NeedSoundReverse = false;
+  tmp_espec.VideoFormatChanged = false;
+  tmp_espec.SoundFormatChanged = false;
+
+  if(!SpecExSS)
+   SpecExSS = new MemoryStream(524288);
+
+  EmulateReal(&tmp_espec);
+
+  MDFNSS_SaveSM(SpecExSS, true);
+  SpecExSS->rewind();
+
+  if(!espec->SoundBuf)
+   EmulateReal(espec);
+  else if(!SpecExSoundToo)
+  {
+   espec->SoundBuf += tmp_espec.SoundBufSize * 2;
+   EmulateReal(espec);
+   espec->SoundBuf -= tmp_espec.SoundBufSize * 2;
+   espec->SoundBufSize = tmp_espec.SoundBufSize;
+  }
+  else
+  {
+   const int expected_delta = (SpecExAudioExpected >= 0) ? SpecExAudioExpected - tmp_espec.SoundBufSize : 0;
+   const int sbo = (expected_delta < 0) ? -expected_delta : 0;
+
+#ifdef SNES_DBG_ENABLE
+   if(!expected_delta && doggy != sha1(tmp_espec.SoundBuf, tmp_espec.SoundBufSize * 2 * sizeof(int16)))
+    fprintf(stderr, "Oops\n");
+
+   if(expected_delta)
+    fprintf(stderr, "%d\n", expected_delta);
+#endif
+
+   memmove(espec->SoundBuf, espec->SoundBuf + (tmp_espec.SoundBufSize - sbo) * 2, sbo * 2 * sizeof(int16));
+   espec->SoundBuf += sbo * 2;
+
+   EmulateReal(espec);
+#ifdef SNES_DBG_ENABLE
+   doggy = sha1(espec->SoundBuf, espec->SoundBufSize * 2 * sizeof(int16));
+#endif
+   SpecExAudioExpected = espec->SoundBufSize;
+
+   espec->SoundBuf -= sbo * 2;
+   espec->SoundBufSize += sbo;
+
+   if(expected_delta > 0 && espec->SoundBufSize >= expected_delta)
+   {
+    espec->SoundBufSize -= expected_delta;
+    memmove(espec->SoundBuf, espec->SoundBuf + expected_delta * 2, espec->SoundBufSize * 2 * sizeof(int16));
+   }
+  }
+
+  MDFNSS_LoadSM(SpecExSS, true);
+  SpecExSS->rewind();
+ } 
+
+ if(spc_reader || snsf_loader)
+ {
+  espec->LineWidths[0] = ~0;
+  Player_Draw(espec->surface, &espec->DisplayRect, 0, espec->SoundBuf, espec->SoundBufSize);
+ }
+}
+
+static void DoSimpleCommand(int cmd)
+{
+ switch(cmd)
+ {
+  case MDFN_MSC_POWER: Reset(true); break;
+  case MDFN_MSC_RESET: Reset(false); break;
+ }
+}
+
+static void StateAction(StateMem *sm, const unsigned load, const bool data_only)
+{
+ if(spc_reader)
+ {
+  APU_StateAction(sm, load, data_only);
+  return;
+ }
+
+ SFORMAT StateRegs[] =
+ {
+  SFVAR(MemSelect),
+  SFVAR(WRAM),
+
+  SFVAR(Multiplicand),
+  SFVAR(MultProduct),
+
+  SFVAR(Dividend),
+  SFVAR(DivQuotient),
+  SFVAR(WMAddress),
+
+  SFEND
+ };
+
+ MDFNSS_StateAction(sm, load, data_only, StateRegs, "SNES");
+
+ CPU_StateAction(sm, load, data_only, "CPU", "CPUCORE");
+ DMA_StateAction(sm, load, data_only);
+ APU_StateAction(sm, load, data_only);
+ PPU_StateAction(sm, load, data_only);
+ CART_StateAction(sm, load, data_only);
+ INPUT_StateAction(sm, load, data_only);
+
+
+ if(load)
+ {
+  ForceEventUpdates(CPUM.timestamp);
+ }
+}
+
+static void SetInput(unsigned port, const char *type, uint8* data)
+{
+ if(spc_reader)
+  return;
+
+ INPUT_Set(port, type, data);
+}
+
+
+uint32 SNES_GetRegister(const unsigned int id, char* special, const uint32 special_len)
+{
+ uint32 ret = 0xDEADBEEF;
+
+ switch(id)
+ {
+  case SNES_GSREG_MEMSEL:
+	ret = MemSelect;
+	break;
+
+  case SNES_GSREG_TS:
+	ret = CPUM.timestamp;
+	break;
+ }
+
+ return ret;
+}
+
+void SNES_SetRegister(const unsigned int id, uint32 value)
+{
+ switch(id)
+ {
+  case SNES_GSREG_MEMSEL:
+	MemSelect = value & 0x1;
+	break;
+ }
+}
+
+
+uint8 PeekWRAM(uint32 addr)
+{
+ return WRAM[addr & 0x1FFFF];
+}
+
+void PokeWRAM(uint32 addr, uint8 val)
+{
+ WRAM[addr & 0x1FFFF] = val;
+}
+
+static const FileExtensionSpecStruct KnownExtensions[] =
+{
+ { ".smc", 0, "Super Magicom ROM Image" },
+ { ".swc", 0, "Super Wildcard ROM Image" },
+ { ".sfc", 0, "SNES/SFC ROM Image" },
+ { ".fig", -10, "SNES/SFC ROM Image" },
+
+ { NULL, 0, NULL }
+};
+
+static const MDFNSetting_EnumList HFilter_List[] =
+{
+ { "none", PPU_HFILTER_NONE, gettext_noop("None") },
+ { "512", PPU_HFILTER_512, gettext_noop("Force 512."), gettext_noop("Double width of line if it's 256.") },
+ { "phr256blend", PPU_HFILTER_PHR256BLEND, gettext_noop("Pseudo-hires halve-blend."), gettext_noop("Blend line down to 256 pixels if it's pseudo-hires.") },
+ { "phr256blend_512", PPU_HFILTER_PHR256BLEND_512, gettext_noop("Pseudo-hires halve-blend and force 512."), gettext_noop("Blend line down to 256 pixels if it's pseudo-hires.  After, double width of line if it's 256.") },
+ { "512_blend", PPU_HFILTER_512_BLEND, gettext_noop("Force 512 and blend."), gettext_noop("Double width of line if it's 256.  After, blend line.") },
+
+ { NULL, 0 },
+};
+
+static const MDFNSetting Settings[] =
+{
+ { "snes_faust.resamp_quality", MDFNSF_NOFLAGS, gettext_noop("Sound quality."), gettext_noop("Higher values correspond to better SNR and better preservation of higher frequencies(\"brightness\"), at the cost of increased computational complexity and a negligible increase in latency.\n\nHigher values will also slightly increase the probability of sample clipping(relevant if Mednafen's volume control settings are set too high), due to increased (time-domain) ringing."), MDFNST_INT, "3", "0", "5" },
+ { "snes_faust.resamp_rate_error", MDFNSF_NOFLAGS, gettext_noop("Sound output rate tolerance."), gettext_noop("Lower values correspond to better matching of the output rate of the resampler to the actual desired output rate, at the expense of increased RAM usage and poorer CPU cache utilization."), MDFNST_FLOAT, "0.000035", "0.0000001", "0.0015" },
+
+ { "snes_faust.spex", MDFNSF_NOFLAGS, gettext_noop("Enable 1-frame speculative execution for video output."), gettext_noop("Hack to reduce input->output video latency by 1 frame.  Enabling will increase CPU usage, and may cause video glitches(such as \"jerkiness\") in some oddball games, but most commercially-released games should be fine."), MDFNST_BOOL, "0" },
+ { "snes_faust.spex.sound", MDFNSF_NOFLAGS, gettext_noop("Enable speculative execution for sound output too."), gettext_noop("Only has an effect when speculative-execution for video output is enabled.  Will cause minor sound glitches in some games."), MDFNST_BOOL, "1" },
+
+ { "snes_faust.input.sport1.multitap", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Enable multitap on SNES port 1."), NULL, MDFNST_BOOL, "0" },
+ { "snes_faust.input.sport2.multitap", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Enable multitap on SNES port 2."), NULL, MDFNST_BOOL, "0" },
+
+ { "snes_faust.correct_aspect", MDFNSF_NOFLAGS, gettext_noop("Correct aspect ratio."), NULL, MDFNST_BOOL, "1" },
+
+ { "snes_faust.h_filter", MDFNSF_NOFLAGS, gettext_noop("Horizontal blending/doubling filter."), NULL, MDFNST_ENUM, "none", NULL, NULL, NULL, NULL, HFilter_List },
+
+ { "snes_faust.cx4.clock_rate", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("CX4 clock rate, specified in percentage of normal."), gettext_noop("Overclocking the CX4 will cause or worsen attract mode desynchronization."), MDFNST_UINT, "100", "100", "500" },
+ // TODO: { "snes_faust.superfx.clock_rate", MDFNSF_EMU_STATE | MDFNSF_UNTRUSTED_SAFE, gettext_noop("Super FX clock rate, specified in percentage of normal."), gettext_noop("Overclocking the Super FX will cause or worsen attract mode desynchronization."), MDFNST_UINT, "100", "100", "500" },
+
+ { NULL }
+};
+
+static const CheatInfoStruct CheatInfo =
+{
+ NULL,
+ NULL,
+
+ CheatMemRead,
+ CheatMemWrite,
+
+ CheatFormatInfo_Empty,
+ false
+};
+
+}
+
+using namespace MDFN_IEN_SNES_FAUST;
+
+MDFNGI EmulatedSNES_Faust =
+{
+ "snes_faust",
+ "Super Nintendo Entertainment System/Super Famicom",
+ KnownExtensions,
+ MODPRIO_INTERNAL_LOW,
+ #ifdef SNES_DBG_ENABLE
+ &DBG_DBGInfo,
+ #else
+ NULL,
+ #endif
+ INPUT_PortInfo,
+ NULL,
+ Load,
+ TestMagic,
+ NULL,
+ NULL,
+ CloseGame,
+
+ NULL,	//ToggleLayer,
+ NULL,
+
+ NULL,
+ NULL,
+
+ NULL,
+ 0,
+
+ CheatInfo,
+
+ false,
+ StateAction,
+ Emulate,
+ NULL,
+ SetInput,
+ NULL,
+ DoSimpleCommand,
+ NULL,
+ Settings,
+ 0,
+ 0,
+
+ true, // Multires possible?
+
+ //
+ // Note: Following video settings may be overwritten during game load.
+ //
+ 0,	// lcm_width
+ 0,	// lcm_height
+ NULL,  // Dummy
+
+ 292,   // Nominal width
+ 224,   // Nominal height
+
+ 0,	// Framebuffer width
+ 0,	// Framebuffer height
+ //
+ //
+ //
+
+ 2,     // Number of output sound channels
+};
+
diff -Naur -r --no-dereference ./mednafen/src/snes_faust/snes.h ./emu4crt/src/snes_faust/snes.h
--- ./mednafen/src/snes_faust/snes.h	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/snes_faust/snes.h	2019-10-04 14:21:10.053110280 -0700
@@ -45,6 +45,7 @@
 
 namespace MDFN_IEN_SNES_FAUST
 {
+
 extern bool MemSelect;
 
 DEFREAD(OBRead_XSLOW);
diff -Naur -r --no-dereference ./mednafen/src/snes_faust/snes.h.orig ./emu4crt/src/snes_faust/snes.h.orig
--- ./mednafen/src/snes_faust/snes.h.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/snes_faust/snes.h.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,144 @@
+/******************************************************************************/
+/* Mednafen Fast SNES Emulation Module                                        */
+/******************************************************************************/
+/* snes.h:
+**  Copyright (C) 2015-2019 Mednafen Team
+**
+** This program is free software; you can redistribute it and/or
+** modify it under the terms of the GNU General Public License
+** as published by the Free Software Foundation; either version 2
+** of the License, or (at your option) any later version.
+**
+** This program is distributed in the hope that it will be useful,
+** but WITHOUT ANY WARRANTY; without even the implied warranty of
+** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+** GNU General Public License for more details.
+**
+** You should have received a copy of the GNU General Public License
+** along with this program; if not, write to the Free Software Foundation, Inc.,
+** 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+*/
+
+#ifndef __MDFN_SNES_FAUST_SNES_H
+#define __MDFN_SNES_FAUST_SNES_H
+
+#pragma GCC optimize ("unroll-loops")
+
+#include <mednafen/mednafen.h>
+
+#define DEFREAD(x) uint8 MDFN_FASTCALL MDFN_HOT x (uint32 A)
+#define DEFWRITE(x) void MDFN_FASTCALL MDFN_HOT x (uint32 A, uint8 V)
+
+#define MEMCYC_FAST   6
+#define MEMCYC_SLOW   8
+#define MEMCYC_XSLOW 12
+
+#if defined(WANT_DEBUGGER) && defined(MDFN_ENABLE_DEV_BUILD)
+ #define SNES_DBG_ENABLE 1
+ #define SNES_DBG(s, ...) printf(s, ## __VA_ARGS__)
+#else
+ static INLINE void SNES_DBG(const char* format, ...) { }
+#endif
+
+#include "cpu.h"
+#include "debug.h"
+
+namespace MDFN_IEN_SNES_FAUST
+{
+extern bool MemSelect;
+
+DEFREAD(OBRead_XSLOW);
+DEFREAD(OBRead_SLOW);
+DEFREAD(OBRead_FAST);
+DEFREAD(OBRead_VAR);
+
+DEFWRITE(OBWrite_XSLOW);
+DEFWRITE(OBWrite_SLOW);
+DEFWRITE(OBWrite_FAST);
+DEFWRITE(OBWrite_VAR);
+
+//
+// Caution: B bus read/write handlers should ignore the upper 24 bits of the passed-in address
+// variable.
+//
+void Set_B_Handlers(uint8 A1, uint8 A2, readfunc read_handler, writefunc write_handler) MDFN_COLD;
+static INLINE void Set_B_Handlers(uint8 A1, readfunc read_handler, writefunc write_handler)
+{
+ Set_B_Handlers(A1, A1, read_handler, write_handler);
+}
+
+void Set_A_Handlers(uint32 A1, uint32 A2, readfunc read_handler, writefunc write_handler) MDFN_COLD;
+static INLINE void Set_A_Handlers(uint32 A1, readfunc read_handler, writefunc write_handler)
+{
+ Set_A_Handlers(A1, A1, read_handler, write_handler);
+}
+
+void DMA_InitHDMA(void) MDFN_HOT;
+void DMA_RunHDMA(void) MDFN_HOT;
+
+typedef uint32 (*snes_event_handler)(const uint32 timestamp);
+
+struct event_list_entry
+{
+ uint32 event_time;
+ event_list_entry *prev;
+ event_list_entry *next;
+ snes_event_handler event_handler;
+};
+
+enum
+{
+ SNES_EVENT__SYNFIRST = 0,
+ SNES_EVENT_PPU,
+ SNES_EVENT_PPU_LINEIRQ,
+ SNES_EVENT_DMA_DUMMY,
+ SNES_EVENT_CART,
+ SNES_EVENT__SYNLAST,
+ SNES_EVENT__COUNT,
+};
+
+#define SNES_EVENT_MAXTS       		0x20000000
+
+extern event_list_entry events[SNES_EVENT__COUNT];
+
+void ForceEventUpdates(const uint32 timestamp);
+
+void SNES_SetEventNT(const int type, const uint32 next_timestamp) MDFN_HOT;
+//
+//
+//
+enum
+{
+ DMA_GSREG_DMAENABLE,
+ DMA_GSREG_HDMAENABLE,
+ DMA_GSREG_HDMAENABLEM,
+
+ DMA_GSREG_CHN_CONTROL,
+ DMA_GSREG_CHN_BBUSADDR,
+ DMA_GSREG_CHN_ABUSADDR,
+ DMA_GSREG_CHN_ABUSBANK,
+ DMA_GSREG_CHN_INDIRBANK,
+ DMA_GSREG_CHN_COUNT_INDIRADDR,
+ DMA_GSREG_CHN_TABLEADDR,
+ DMA_GSREG_CHN_LINECOUNTER,
+ DMA_GSREG_CHN_UNKNOWN,
+ DMA_GSREG_CHN_OFFSET,
+ DMA_GSREG_CHN_DOTRANSFER,
+};
+
+uint32 DMA_GetRegister(const unsigned id, char* const special, const uint32 special_len) MDFN_COLD;
+void DMA_SetRegister(const unsigned id, const uint32 value) MDFN_COLD;
+
+enum
+{
+ SNES_GSREG_MEMSEL,
+ SNES_GSREG_TS
+};
+uint32 SNES_GetRegister(const unsigned int id, char* special, const uint32 special_len) MDFN_COLD;
+void SNES_SetRegister(const unsigned int id, uint32 value) MDFN_COLD;
+
+uint8 PeekWRAM(uint32 addr) MDFN_COLD;
+void PokeWRAM(uint32 addr, uint8 val) MDFN_COLD;
+}
+
+#endif
diff -Naur -r --no-dereference ./mednafen/src/ss/vdp2_render.cpp ./emu4crt/src/ss/vdp2_render.cpp
--- ./mednafen/src/ss/vdp2_render.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/ss/vdp2_render.cpp	2019-10-04 14:21:10.053110280 -0700
@@ -145,6 +145,14 @@
 static uint8 LineColorCCRatio;
 static uint8 BackCCRatio;
 
+//SLK
+static uint8 prev_InterlaceMode = 0;
+static uint8 prev_HRes = 0;
+static uint8 prev_VRes = 0;
+static bool  prev_BorderMode = 0;
+// SLK end
+
+
 //
 static struct
 {
@@ -550,6 +558,39 @@
 	InterlaceMode = (V >> 6) & 0x3;
 	VRes = (V >> 4) & 0x3;
 	HRes = (V >> 0) & 0x7;
+	// SLK
+	if(InterlaceMode != prev_InterlaceMode || HRes != prev_HRes)
+	{
+	  printf("VDP2 Render - Television mode changed: %d\n",V);
+	  printf("     BorderMode: %d\n",BorderMode);
+	  printf("     PAL: %d\n",PAL);
+	  printf("     InterlaceMode: %d\n",InterlaceMode);
+	  printf("     VRes: %d\n",VRes);
+	  printf("     HRes: %d\n",HRes);
+	  prev_BorderMode = BorderMode;
+	  prev_InterlaceMode = InterlaceMode;
+	  prev_VRes = VRes;
+	  prev_HRes = HRes;
+	  // HRES
+	  switch(HRes){
+	    case 0:
+	      resolution_to_change_w = 320;
+	      break;
+	    case 1:
+	      resolution_to_change_w = 352;
+	      break;
+	    case 2:
+	      resolution_to_change_w = 640;
+	      break;
+	    case 3:
+	      resolution_to_change_w = 704;
+	      break;
+	  }
+	  if(InterlaceMode >= 2){resolution_to_change_h = PAL ? 576 : 480;} else {resolution_to_change_h = PAL ? 288 : 240;}
+	  printf("SS - VDP2 Render - TV mode set to %dx%d",resolution_to_change_w,resolution_to_change_h);
+	  resolution_to_change  = true; // Flag for video resolution change by VIDEO.cpp/MAIN.cpp
+	}
+	// SLK - end
 	break;
 
   case 0x02:
@@ -3296,12 +3337,20 @@
  {
   gi->nominal_width = (ShowHOverscan ? 365 : 354);
   gi->fb_height = 576;
+  resolution_to_change_h = 288; // SLK - init crt mode
  }
  else
  {
   gi->nominal_width = (ShowHOverscan ? 302 : 292);
   gi->fb_height = 480;
+  resolution_to_change_h = 240; // SLK - init crt mode
  }
+ // SLK
+ resolution_to_change_w = 320;
+ resolution_to_change = true; // SLK - init crt mode
+ // SLK - end
+ 
+ 
  gi->nominal_height = LineVisLast + 1 - LineVisFirst;
 
  gi->lcm_width = (ShowHOverscan? 10560 : 10240);
diff -Naur -r --no-dereference ./mednafen/src/ss/vdp2_render.cpp.orig ./emu4crt/src/ss/vdp2_render.cpp.orig
--- ./mednafen/src/ss/vdp2_render.cpp.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/ss/vdp2_render.cpp.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,3525 @@
+/******************************************************************************/
+/* Mednafen Sega Saturn Emulation Module                                      */
+/******************************************************************************/
+/* vdp2_render.cpp - VDP2 Rendering
+**  Copyright (C) 2016-2019 Mednafen Team
+**
+** This program is free software; you can redistribute it and/or
+** modify it under the terms of the GNU General Public License
+** as published by the Free Software Foundation; either version 2
+** of the License, or (at your option) any later version.
+**
+** This program is distributed in the hope that it will be useful,
+** but WITHOUT ANY WARRANTY; without even the implied warranty of
+** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+** GNU General Public License for more details.
+**
+** You should have received a copy of the GNU General Public License
+** along with this program; if not, write to the Free Software Foundation, Inc.,
+** 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+*/
+
+// TODO: 31KHz monitor mode.
+// When implementing GetRegister(), remember RPRCTL and window x start and end registers can
+//  change outside of direct register writes
+// Ignore T4-T7 in hires and 31KHz monitor mode.
+
+#include "ss.h"
+#include <mednafen/mednafen.h>
+#include <mednafen/Time.h>
+#include <mednafen/MThreading.h>
+#include "vdp2_common.h"
+#include "vdp2_render.h"
+
+#include <atomic>
+
+namespace MDFN_IEN_SS
+{
+
+//uint8 vdp2rend_prepad_bss
+
+static EmulateSpecStruct* espec = NULL;
+static bool PAL;
+static bool CorrectAspect;
+static bool ShowHOverscan;
+static bool DoHBlend;
+static int LineVisFirst, LineVisLast;
+static uint32 NextOutLine;
+static bool Clock28M;
+static unsigned VisibleLines;
+static VDP2Rend_LIB LIB[256];
+static uint16 VRAM[262144];
+static uint16 CRAM[2048];
+
+static uint8 HRes, VRes;
+static bool BorderMode;
+static uint8 InterlaceMode;
+enum { IM_NONE, IM_ILLEGAL, IM_SINGLE, IM_DOUBLE };
+
+static bool CRKTE;
+static uint8 CRAM_Mode;
+enum
+{
+ CRAM_MODE_RGB555_1024	= 0,
+ CRAM_MODE_RGB555_2048	= 1,
+ CRAM_MODE_RGB888_1024	= 2,
+ CRAM_MODE_ILLEGAL	= 3
+};
+static uint8 VRAM_Mode;
+static uint8 RDBS_Mode;
+
+static uint8 VCPRegs[4][8];
+static const uint16 DummyTileNT[8 * 8 * 4 / sizeof(uint16)] = { 0 };
+
+static uint32 UserLayerEnableMask;
+//
+//
+//
+static uint16 BGON;
+static uint16 MZCTL;
+static uint8 MosaicVCount;
+
+static uint8 SFSEL;
+static uint16 SFCODE;
+
+static uint16 CHCTLA;
+static uint16 CHCTLB;
+
+static uint16 BMPNA;
+static uint8 BMPNB;
+
+static uint16 PNCN[4];
+static uint16 PNCNR;
+
+static uint16 PLSZ;
+static uint16 MPOFN;
+static uint16 MPOFR;
+
+static uint8 MapRegs[4][4];
+static uint8 RotMapRegs[2][16];
+//
+static uint16 XScrollI[4], YScrollI[4];
+static uint8 XScrollF[2], YScrollF[2];
+
+static uint16 ZMCTL;
+static uint16 SCRCTL;
+static uint32 LineScrollAddr[2];
+static uint32 VCScrollAddr;
+static uint32 VCLast[2];
+
+static uint16 XCoordInc[2], YCoordInc[2];
+static uint32 YCoordAccum[2];
+static uint32 MosEff_YCoordAccum[2];
+
+static uint32 CurXScrollIF[2];
+static uint32 CurYScrollIF[2];
+static uint16 CurXCoordInc[2];
+static uint32 CurLSA[2];
+
+static uint16 NBG23_YCounter[2];
+static uint16 MosEff_NBG23_YCounter[2];
+//
+static uint8 RPMD;
+static uint8 KTCTL[2];
+static uint16 OVPNR[2];
+//
+static uint32 BKTA;
+static uint32 CurBackTabAddr;
+static uint16 CurBackColor;
+
+static uint32 LCTA;
+static uint32 CurLCTabAddr;
+static uint16 CurLCColor;
+
+static uint8 LineColorEn;
+
+static uint16 SFPRMD;
+static uint16 CCCTL;
+static uint16 SFCCMD;
+//
+static uint8 NBGPrioNum[4];
+static uint8 RBG0PrioNum;
+
+static uint8 NBGCCRatio[4];
+static uint8 RBG0CCRatio;
+static uint8 LineColorCCRatio;
+static uint8 BackCCRatio;
+
+//
+static struct
+{
+ uint16 XStart, XEnd;
+ uint32 LineWinAddr;
+ bool LineWinEn;
+ //
+ bool YMet;
+ uint16 CurXStart, CurXEnd;
+ uint32 CurLineWinAddr;
+} Window[2];
+
+static uint8 WinControl[8];
+enum
+{
+ WINLAYER_NBG0 = 0,
+ WINLAYER_NBG1 = 1,
+ WINLAYER_NBG2 = 2,
+ WINLAYER_NBG3 = 3,
+ WINLAYER_RBG0 = 4,
+ WINLAYER_SPRITE = 5,
+ WINLAYER_ROTPARAM = 6,
+ WINLAYER_CC = 7,
+};
+
+static std::array<unsigned, 5> WinPieces;
+//
+static uint8 SpriteCCCond;
+static uint8 SpriteCCNum;
+static uint8 SPCTL_Low;
+
+static uint16 SDCTL;
+
+static uint8 SpritePrioNum[8];
+static uint8 SpriteCCRatio[8];
+
+static uint8 SpriteCCLUT[8];	// Temp optimization data
+static uint8 SpriteCC3Mask; 	// Temp optimization data
+
+//
+static uint8 CRAMAddrOffs_NBG[4];
+static uint8 CRAMAddrOffs_RBG0;
+static uint8 CRAMAddrOffs_Sprite;
+//
+static uint8 ColorOffsEn;
+static uint8 ColorOffsSel;
+
+//enum
+//{
+// COLOFFS_ENSEL_NBG0 = 0,
+// COLOFFS_ENSEL_NBG1 = 0,
+//};
+
+static int32 ColorOffs[2][3];	// [A,B] [R << 0, G << 8, B << 16]
+
+template<bool IsRot>
+struct TileFetcher
+{
+ unsigned CRAOffs;
+
+ bool BMSCC;
+ bool BMSPR;
+ unsigned BMPalNo;
+ unsigned BMSize;
+
+ unsigned PlaneSize;
+ unsigned PlaneOver;
+ uint16 PlaneOverChar;
+ bool PNDSize;
+ bool CharSize;
+ bool AuxMode;
+ unsigned Supp;
+
+ //
+ //
+ //
+ unsigned BMOffset;
+ unsigned BMWShift;
+ unsigned BMWMask;
+ unsigned BMHMask;
+
+ uint32 adj_map_regs[IsRot ? 16 : 4];
+ uint32 doxm, doym;
+
+ bool nt_ok[4];
+ bool cg_ok[4];
+
+ // n=0...3, NBG0...3
+ // n=4, RBG0
+ // n=5, RBG1
+ INLINE void Start(const unsigned n, const bool bmen, const unsigned map_offset, const uint8* map_regs)
+ {
+  BMOffset = map_offset << 16;
+  BMWShift = ((BMSize & 2) ? 10 : 9);
+  BMWMask = (1U << BMWShift) - 8;
+  BMHMask = (BMSize & 1) ? 0x1FF : 0xFF;
+
+  const unsigned psshift = (13 - PNDSize - (CharSize << 1));
+
+  for(unsigned i = 0; i < (IsRot ? 16 : 4); i++)
+  {
+   adj_map_regs[i] = ((map_offset << 6) + (map_regs[i] &~ PlaneSize)) << psshift;
+  }
+
+  if(IsRot)
+  {
+   if(bmen)
+   {
+    doxm = ~(BMWMask + 7);
+    doym = ~BMHMask;
+   }
+   else
+   {
+    doxm = ~((1U << ((9 + (bool)(PlaneSize & 0x1)) + (IsRot ? 2 : 1))) - 1);
+    doym = ~((1U << ((9 + (bool)(PlaneSize & 0x2)) + (IsRot ? 2 : 1))) - 1);
+   }
+
+   if(PlaneOver == 0)
+    doxm = doym = 0;
+   else if(PlaneOver == 3)
+    doxm = doym = ~511;
+  }
+
+  // Kludgeyness:
+  for(unsigned bank = 0; bank < 4; bank++)
+  {
+   const unsigned esb = bank & (2 | ((VRAM_Mode >> (bank >> 1)) & 1));
+   const uint8 rdbs = (RDBS_Mode >> (esb << 1)) & 0x3;
+
+   if(IsRot)
+   {
+    if(!(BGON & 0x20) || n == 4)
+    {
+     nt_ok[bank] = (rdbs == RDBS_NAME) && (bank < 2 || !(BGON & 0x20));
+     cg_ok[bank] = (rdbs == RDBS_CHAR) && (bank < 2 || !(BGON & 0x20));
+    }
+    else
+    {
+     nt_ok[bank] = (bank == 3);
+     cg_ok[bank] = (bank == 2);
+    }
+   }
+   else
+   {
+    nt_ok[bank] = false;
+    cg_ok[bank] = false;
+
+    if(!(BGON & 0x30) || rdbs == RDBS_UNUSED)
+    {
+     for(unsigned ac = 0; ac < ((HRes & 0x6) ? 4 : 8); ac++)
+     {
+      if(VCPRegs[esb][ac] == (VCP_NBG0_CG + n))
+       cg_ok[bank] = true;
+
+      if(VCPRegs[esb][ac] == (VCP_NBG0_NT + n))
+       nt_ok[bank] = true;
+     }
+    }
+   }
+  }
+
+  #if 1
+  pcco = 0;
+  spr = false;
+  scc = false;
+  tile_vrb = nullptr;
+  cellx_xor = 0;
+  #endif
+ }
+
+ //
+ //
+ //
+ uint32 pcco;
+ bool spr;
+ bool scc;
+ const uint16* tile_vrb;
+ uint32 cellx_xor;
+
+ template<unsigned TA_bpp>
+ INLINE bool Fetch(const bool bmen, const uint32 ix, const uint32 iy)
+ {
+  size_t cg_addr;
+  uint32 palno;
+  bool is_outside = false;
+
+  if(IsRot)
+   is_outside = (ix & doxm) | (iy & doym);
+
+  if(bmen)
+  {
+   palno = BMPalNo;
+   spr = BMSPR;
+   scc = BMSCC;
+   cellx_xor = (ix &~ 0x7);
+   cg_addr = (BMOffset + ((((ix & BMWMask) + ((iy & BMHMask) << BMWShift)) * TA_bpp) >> 4)) & 0x3FFFF;
+  }
+  else
+  {
+   bool vflip, hflip;
+   uint16 charno;
+   uint32 mapidx, planeidx, planeoffs, pageoffs;
+   const uint16* pnd;
+   uint32 celly;
+   size_t nt_addr;
+
+   if(IsRot)
+    mapidx = ((ix >> (9 + (bool)(PlaneSize & 0x1))) & 0x3) | ((iy >> (9 + (bool)(PlaneSize & 0x2) - 2)) & 0xC);
+   else
+    mapidx = ((ix >> (9 + (bool)(PlaneSize & 0x1))) & 0x1) | ((iy >> (9 + (bool)(PlaneSize & 0x2) - 1)) & 0x2);
+
+   planeidx = ((ix >> 9) & PlaneSize & 0x1) | ((iy >> (9 - 1)) & PlaneSize & 0x2);
+   planeoffs = planeidx << (13 - PNDSize - (CharSize << 1));
+   pageoffs = ((((ix >> 3) & 0x3F) >> CharSize) + ((((iy >> 3) & 0x3F) >> CharSize) << (6 - CharSize))) << (1 - PNDSize);
+   nt_addr = (adj_map_regs[mapidx] + planeoffs + pageoffs) & 0x3FFFF;
+
+   pnd = &VRAM[nt_addr];
+   if(!nt_ok[nt_addr >> 16])
+    pnd = DummyTileNT;
+
+   if(IsRot && is_outside && PlaneOver == 1)
+   {
+    pnd = &PlaneOverChar;
+    goto OverCharCase;
+   }
+
+   if(!PNDSize)
+   {
+    uint16 tmp = pnd[0];
+
+    palno = tmp & 0x7F;
+    vflip = (bool)(tmp & 0x8000);
+    hflip = (bool)(tmp & 0x4000);
+    spr = (bool)(tmp & 0x2000);
+    scc = (bool)(tmp & 0x1000);
+    charno = pnd[1] & 0x7FFF;
+   }
+   else
+   {
+    OverCharCase:;
+    uint16 tmp = pnd[0];
+
+    if(TA_bpp >= 8)
+     palno = ((tmp >> 12) & 0x7) << 4;
+    else
+     palno = ((tmp >> 12) & 0xF) | (((Supp >> 5) & 0x7) << 4);
+    spr = (bool)(Supp & 0x200);
+    scc = (bool)(Supp & 0x100);
+
+    if(!AuxMode)
+    {
+     vflip = (bool)(tmp & 0x800);
+     hflip = (bool)(tmp & 0x400);
+
+     if(CharSize)
+      charno = ((tmp & 0x3FF) << 2) + ((Supp & 0x1C) << 10) + (Supp & 0x3);
+     else
+      charno = (tmp & 0x3FF) + ((Supp & 0x1F) << 10);
+    }
+    else
+    {
+     hflip = vflip = false;
+
+     if(CharSize)
+      charno = ((tmp & 0xFFF) << 2) + ((Supp & 0x10) << 10) + (Supp & 0x3);
+     else
+      charno = (tmp & 0xFFF) + ((Supp & 0x1C) << 10);
+    }
+   }
+
+   if(CharSize)
+   {
+    uint32 cidx = (((ix >> 3) ^ hflip) & 0x1) + (((iy >> 2) ^ (vflip << 1)) & 0x2);
+    charno = (charno + cidx * (TA_bpp >> 2)) & 0x7FFF;
+   }
+
+   cellx_xor = (ix &~ 0x7) | (hflip ? 0x7 : 0x0);
+   celly = (iy & 0x7) ^ (vflip ? 0x7 : 0);
+   cg_addr = ((charno << 4) + ((celly * TA_bpp) >> 1)) & 0x3FFFF;
+  }
+  tile_vrb = &VRAM[cg_addr];
+
+  if(!cg_ok[cg_addr >> 16])
+  {
+   //printf("Goop: %08zx, %d %02x, %016llx %016llx %016llx %016llx\n", cg_addr, TA_bpp, VRAM_Mode, MDFN_de64lsb(VCPRegs[0]), MDFN_de64lsb(VCPRegs[1]), MDFN_de64lsb(VCPRegs[2]), MDFN_de64lsb(VCPRegs[3]));
+   tile_vrb = DummyTileNT;
+  }
+
+  //
+  //
+  //
+  pcco = ((palno << 4) &~ ((1U << (TA_bpp & 0x1F)) - 1)) + CRAOffs;
+
+  return IsRot && is_outside && (PlaneOver & 2);
+ }
+};
+
+struct RotVars
+{
+ int32 Xsp, Ysp;// .10
+ int32 Xp, Yp;	// .10
+ int32 dX, dY;	// .10
+
+ int32 kx, ky;	// .16
+
+ bool use_coeff;
+ uint32 base_coeff;
+
+ TileFetcher<true> tf;
+};
+
+static struct
+{
+ uint64 spr[704];
+ uint64 rbg0[704];
+ union
+ {
+  uint64 nbg[4][8 + 704 + 8];
+  struct
+  {
+   uint8 dummy[sizeof(nbg) / 2];
+   uint16 vcscr[2][88 + 1 + 1];	// + 1 for fine x scroll != 0, + 1 for pointer shenanigans in FetchVCScroll
+  };
+  struct
+  {
+   uint8 rotdummy[sizeof(nbg) / 4];
+   uint8 rotabsel[352];	// Also used as a scratch buffer in T_DrawRBG() to handle mosaic-related junk.
+   RotVars rotv[2];
+   uint32 rotcoeff[352];
+  };
+ };
+ alignas(16) uint8 lc[704];
+} LB;
+
+// ColorOffsEn, etc. ?...hmm, discrepancy with ColorCalcEn and LineColorEn...
+enum
+{
+ LAYER_NBG0 = 0,
+ //LAYER_RBG1 = 0,
+ LAYER_NBG1 = 1,
+ //LAYER_EXBG = 1,
+ LAYER_NBG2 = 2,
+ LAYER_NBG3 = 3,
+
+ LAYER_RBG0 = 4,
+ LAYER_BACK = 5, // Line color?
+ LAYER_SPRITE = 6,
+};
+
+//
+//
+//
+static uint32 ColorCache[2048];
+static void CacheCRE(const unsigned cri)
+{
+ if(CRAM_Mode & CRAM_MODE_RGB888_1024)
+ {
+  (ColorCache + 0x000)[cri >> 1] = (ColorCache + 0x400)[cri >> 1] = (((CRAM + 0x000)[(cri >> 1) & 0x3FF] & 0x80FF) << 16) | ((CRAM + 0x400)[(cri >> 1) & 0x3FF] << 0);
+ }
+ else
+ {
+  const uint16 t = CRAM[cri & ((CRAM_Mode == CRAM_MODE_RGB555_1024) ? 0x3FF : 0x7FF)];
+  const uint32 col = ((t << 3) & 0xF8) | ((t << 6) & 0xF800) | ((t << 9) & 0xF80000) | ((t << 16) & 0x80000000);
+
+  if(CRAM_Mode == CRAM_MODE_RGB555_1024)
+   (ColorCache + 0x000)[cri & 0x3FF] = (ColorCache + 0x400)[cri & 0x3FF] = col;
+  else
+   ColorCache[cri] = col;
+ }
+}
+
+static void RecalcColorCache(void)
+{
+ if(CRAM_Mode & CRAM_MODE_RGB888_1024)
+ {
+  for(unsigned i = 0; i < 2048; i += 2)
+   CacheCRE(i);
+ }
+ else
+ {
+  const unsigned count = (CRAM_Mode == CRAM_MODE_RGB555_2048) ? 2048 : 1024;
+
+  for(unsigned i = 0; i < count; i++)
+   CacheCRE(i);
+ }
+}
+
+//
+// Register writes seem to always be 16-bit
+//
+static INLINE void RegsWrite(uint32 A, uint16 V)
+{
+ A &= 0x1FE;
+
+ switch(A)
+ {
+  default:
+	break;
+
+  case 0x00:
+	//DisplayOn = (V >> 15) & 0x1;
+	BorderMode = (V >> 8) & 0x1;
+	InterlaceMode = (V >> 6) & 0x3;
+	VRes = (V >> 4) & 0x3;
+	HRes = (V >> 0) & 0x7;
+	break;
+
+  case 0x02:
+	//ExLatchEnable = (V >> 9) & 0x1;
+	//ExSyncEnable = (V >> 8) & 0x1;
+
+	//DispAreaSelect = (V >> 1) & 0x1;
+	//ExBGEnable = (V >> 0) & 0x1;
+	break;
+
+  case 0x0E:
+	{
+	 const unsigned old_CRAM_Mode = CRAM_Mode;
+
+	 CRKTE = (V >> 15) & 0x1;
+	 CRAM_Mode = (V >> 12) & 0x3;;
+	 VRAM_Mode = (V >> 8) & 0x3;
+	 RDBS_Mode = V & 0xFF;
+
+	 if(old_CRAM_Mode != CRAM_Mode)
+	  RecalcColorCache();
+	}
+	break;
+  //
+  case 0x10:
+  case 0x12:
+  case 0x14:
+  case 0x16:
+  case 0x18:
+  case 0x1A:
+  case 0x1C:
+  case 0x1E:
+	{
+	 uint8* const b = &VCPRegs[(A >> 2) & 3][(A & 0x2) << 1];
+	 b[0] = (V >> 12) & 0xF;
+	 b[1] = (V >>  8) & 0xF;
+	 b[2] = (V >>  4) & 0xF;
+	 b[3] = (V >>  0) & 0xF;
+	}
+	break;
+  //
+  case 0x20:
+	BGON = V & 0x1F3F;
+	break;
+
+  case 0x22:
+	MZCTL = V & 0xFF1F;
+	break;
+
+  case 0x24:
+	SFSEL = V & 0x1F;
+	break;
+
+  case 0x26:
+	SFCODE = V;
+	break;
+
+  case 0x28:
+	CHCTLA = V & 0x3F7F;
+	break;
+
+  case 0x2A:
+	CHCTLB = V & 0x7733;
+	break;
+
+  case 0x2C:
+	BMPNA = V & 0x3737;
+	break;
+
+  case 0x2E:
+	BMPNB = V & 0x37;
+	break;
+
+  //
+  case 0x30:
+  case 0x32:
+  case 0x34:
+  case 0x36:
+	PNCN[(A & 0x6) >> 1] = V & 0xC3FF;
+	break;
+
+  case 0x38:
+	PNCNR = V & 0xC3FF;
+	break;
+
+  //
+  case 0x3A:
+	PLSZ = V;	// Plane size
+	break;
+
+  case 0x3C:
+	MPOFN = V & 0x7777;	// Map offset NBG
+	break;
+
+  case 0x3E:
+	MPOFR = V & 0x0077;	// Map offset RBG
+	break;
+  //
+  case 0x40:
+  case 0x42:
+  case 0x44:
+  case 0x46:
+  case 0x48:
+  case 0x4A:
+  case 0x4C:
+  case 0x4E:
+	MapRegs[(A & 0xC) >> 2][(A & 0x2) + 0] = (V >> 0) & 0x3F;
+	MapRegs[(A & 0xC) >> 2][(A & 0x2) + 1] = (V >> 8) & 0x3F;
+	break;
+
+  case 0x50: case 0x52: case 0x54: case 0x56: case 0x58: case 0x5A: case 0x5C: case 0x5E:
+  case 0x60: case 0x62: case 0x64: case 0x66: case 0x68: case 0x6A: case 0x6C: case 0x6E:
+	RotMapRegs[(bool)(A & 0x20)][(A & 0xE) + 0] = (V >> 0) & 0x3F;
+	RotMapRegs[(bool)(A & 0x20)][(A & 0xE) + 1] = (V >> 8) & 0x3F;
+	break;
+  //
+  case 0x70:
+  case 0x80:
+	XScrollI[A >> 7] = V & 0x7FF;
+	break;
+
+  case 0x72:
+  case 0x82:
+	XScrollF[A >> 7] = (V >> 8) & 0xFF;
+	break;
+
+  case 0x74:
+  case 0x84:
+	YScrollI[A >> 7] = V & 0x7FF;
+	break;
+
+  case 0x76:
+  case 0x86:
+	YScrollF[A >> 7] = (V >> 8) & 0xFF;
+	break;
+
+  case 0x78:
+  case 0x88:
+	XCoordInc[A >> 7] = (XCoordInc[A >> 7] & 0xFF) | ((V & 0x7) << 8);
+	break;
+
+  case 0x7A:
+  case 0x8A:
+	XCoordInc[A >> 7] = (XCoordInc[A >> 7] & 0x700) | ((V >> 8) & 0xFF);
+	break;
+
+  case 0x7C:
+  case 0x8C:
+	YCoordInc[A >> 7] = (YCoordInc[A >> 7] & 0xFF) | ((V & 0x7) << 8);
+	break;
+
+  case 0x7E:
+  case 0x8E:
+	YCoordInc[A >> 7] = (YCoordInc[A >> 7] & 0x700) | ((V >> 8) & 0xFF);
+	break;
+
+  case 0x90:
+  case 0x94:
+	XScrollI[2 + (bool)(A & 0x4)] = V & 0x7FF;
+	break;
+
+  case 0x92:
+  case 0x96:
+	{
+	 const unsigned which = (bool)(A & 0x4);
+
+	 NBG23_YCounter[which] = YScrollI[2 + which] = V & 0x7FF;
+	}
+	break;
+
+  case 0x98:
+	ZMCTL = V & 0x0303;
+	break;
+
+  case 0x9A:
+	SCRCTL = V & 0x3F3F;
+	break;
+
+  case 0x9C:
+	VCScrollAddr = (VCScrollAddr & 0xFFFF) | ((V & 0x7) << 16);
+	break;
+
+  case 0x9E:
+	VCScrollAddr = (VCScrollAddr & 0x70000) | (V & 0xFFFE);
+	break;
+
+  case 0xA0:
+	LineScrollAddr[0] = (LineScrollAddr[0] & 0xFFFF) | ((V & 0x7) << 16);
+	break;
+
+  case 0xA2:
+	LineScrollAddr[0] = (LineScrollAddr[0] & 0x70000) | (V & 0xFFFE);
+	break;
+
+  case 0xA4:
+	LineScrollAddr[1] = (LineScrollAddr[1] & 0xFFFF) | ((V & 0x7) << 16);
+	break;
+
+  case 0xA6:
+	LineScrollAddr[1] = (LineScrollAddr[1] & 0x70000) | (V & 0xFFFE);
+	break;
+
+  //
+  case 0xA8:
+	LCTA = (LCTA & 0xFFFF) | ((V & 0x8007) << 16);
+	break;
+
+  case 0xAA:
+	LCTA = (LCTA & ~0xFFFF) | V;
+	break;
+
+  case 0xAC:
+	BKTA = (BKTA & 0xFFFF) | ((V & 0x8007) << 16);
+	break;
+
+  case 0xAE:
+	BKTA = (BKTA & ~0xFFFF) | V;
+	break;
+  //
+  case 0xB0:
+	RPMD = V & 0x3;
+	break;
+
+  case 0xB4:
+	KTCTL[0] = (V >> 0) & 0x1F;
+	KTCTL[1] = (V >> 8) & 0x1F;
+	break;
+
+  case 0xB8:
+	OVPNR[0] = V;
+	break;
+
+  case 0xBA:
+	OVPNR[1] = V;
+	break;
+
+  //
+  case 0xC0: Window[0].XStart = V & 0x3FF; break;
+  case 0xC4: Window[0].XEnd = V & 0x3FF; break;
+
+  case 0xC8: Window[1].XStart = V & 0x3FF; break;
+  case 0xCC: Window[1].XEnd = V & 0x3FF; break;
+
+  case 0xD0:
+  case 0xD2:
+  case 0xD4:
+	WinControl[(A & 0x6) + 0] = (V >> 0) & 0xBF;
+	WinControl[(A & 0x6) + 1] = (V >> 8) & 0xBF;
+	break;
+
+  case 0xD6:
+	WinControl[(A & 0x6) + 0] = (V >> 0) & 0x8F;	// Rot
+	WinControl[(A & 0x6) + 1] = (V >> 8) & 0xBF;	// CC
+	break;
+
+  case 0xD8:
+  case 0xDC:
+	{
+	 const unsigned w = (A & 0x4) >> 2;
+
+	 Window[w].LineWinEn = (bool)(V & 0x8000);
+	 Window[w].LineWinAddr = (Window[w].LineWinAddr & 0xFFFF) | ((V & 0x7) << 16);
+	}
+	break;
+
+  case 0xDA:
+  case 0xDE:
+	{
+	 const unsigned w = (A & 0x4) >> 2;
+
+	 Window[w].LineWinAddr = (Window[w].LineWinAddr & 0x70000) | (V & 0xFFFE);
+	}
+	break;
+
+  //
+  case 0xE0:
+	SpriteCCCond = (V >> 12) & 0x3;
+	SpriteCCNum = (V >> 8) & 0x7;
+	SPCTL_Low = V & 0x3F;
+	break;	
+
+  case 0xE2:
+	SDCTL = V & 0x13F;
+	break;
+
+  case 0xE4:
+	CRAMAddrOffs_NBG[0] = (V >>  0) & 0x7;
+	CRAMAddrOffs_NBG[1] = (V >>  4) & 0x7;
+	CRAMAddrOffs_NBG[2] = (V >>  8) & 0x7;
+	CRAMAddrOffs_NBG[3] = (V >> 12) & 0x7;
+	break;
+
+  case 0xE6:
+	CRAMAddrOffs_RBG0 = (V >> 0) & 0x7;
+	CRAMAddrOffs_Sprite = (V >> 4) & 0x7;
+	break;
+
+  case 0xE8:
+	LineColorEn = V & 0x3F;
+	break;
+
+  case 0xEA:
+	SFPRMD = V & 0x3FF;
+	break;
+
+  case 0xEC:
+	CCCTL = V & 0xF77F;
+	break;
+
+  case 0xEE:
+	SFCCMD = V & 0x3FF;
+	break;
+
+  case 0xF0:
+  case 0xF2:
+  case 0xF4:
+  case 0xF6:
+	SpritePrioNum[(A & 0x6) + 0] = ((V >> 0) & 0x7);
+	SpritePrioNum[(A & 0x6) + 1] = ((V >> 8) & 0x7);
+	break;
+
+  case 0xF8:
+	NBGPrioNum[0] = (V >> 0) & 0x7;
+	NBGPrioNum[1] = (V >> 8) & 0x7;
+	break;
+
+  case 0xFA:
+	NBGPrioNum[2] = (V >> 0) & 0x7;
+	NBGPrioNum[3] = (V >> 8) & 0x7;
+	break;
+
+  case 0xFC:
+	RBG0PrioNum = (V >> 0) & 0x7;
+	break;
+
+  case 0x100:
+  case 0x102:
+  case 0x104:
+  case 0x106:
+	SpriteCCRatio[(A & 0x6) + 0] = (V >> 0) & 0x1F;
+	SpriteCCRatio[(A & 0x6) + 1] = (V >> 8) & 0x1F;
+	break;
+
+  case 0x108:
+  case 0x10A:
+	NBGCCRatio[(A & 0x2) + 0] = (V >> 0) & 0x1F;
+	NBGCCRatio[(A & 0x2) + 1] = (V >> 8) & 0x1F;
+	break;
+
+  case 0x10C:
+	RBG0CCRatio = V & 0x1F;
+	break;
+
+  case 0x10E:
+	LineColorCCRatio = (V >> 0) & 0x1F;
+	BackCCRatio = (V >> 8) & 0x1F;
+	break;
+
+  case 0x110:
+	ColorOffsEn = V & 0x7F;
+	break;
+
+  case 0x112:
+	ColorOffsSel = V & 0x7F;
+	break;
+
+  case 0x114: // A Red
+  case 0x116: // A Green
+  case 0x118: // A Blue
+  case 0x11A: // B Red
+  case 0x11C: // B Green
+  case 0x11E: // B Blue
+	{
+	 const unsigned ab = (A >= 0x11A);
+	 const unsigned wcc = ((A - 0x114) >> 1) % 3;
+
+	 ColorOffs[ab][wcc] = (uint32)sign_x_to_s32(9, V) << (wcc << 3);
+	}
+	break;
+ }
+}
+
+template<typename T>
+static INLINE void MemW(uint32 A, const uint16 DB)
+{
+ A &= 0x1FFFFF;
+
+ //
+ // VRAM
+ //
+ if(A < 0x100000)
+ {
+  const size_t vri = (A & 0x7FFFF) >> 1;
+  const unsigned mask = (sizeof(T) == 2) ? 0xFFFF : (0xFF00 >> ((A & 1) << 3));
+
+  VRAM[vri] = (VRAM[vri] &~ mask) | (DB & mask);
+
+  return;
+ }
+
+ //
+ // CRAM
+ //
+ if(A < 0x180000)
+ {
+  const unsigned cri = (A & 0xFFF) >> 1;
+
+  switch(CRAM_Mode)
+  {
+    case CRAM_MODE_RGB555_1024:
+	(CRAM + 0x000)[cri & 0x3FF] = DB;
+	(CRAM + 0x400)[cri & 0x3FF] = DB;
+	CacheCRE(cri);
+	break;
+
+    case CRAM_MODE_RGB555_2048:
+	CRAM[cri] = DB;
+	CacheCRE(cri);
+	break;
+
+    case CRAM_MODE_RGB888_1024:
+    case CRAM_MODE_ILLEGAL:
+    default:
+	CRAM[((cri >> 1) & 0x3FF) | ((cri & 1) << 10)] = DB;
+	CacheCRE(cri);
+	break;
+  }
+
+  return;
+ }
+
+ //
+ // Registers
+ //
+ if(A < 0x1C0000)
+ {
+  RegsWrite(A, DB);
+
+  return;
+ }
+}
+
+
+static void Reset(bool powering_up)
+{
+ if(powering_up)
+ {
+  memset(VRAM, 0, sizeof(VRAM));
+  memset(CRAM, 0, sizeof(CRAM));
+ }
+ //
+ //
+ CRKTE = false;
+ CRAM_Mode = 0;
+ VRAM_Mode = 0;
+ RDBS_Mode = 0;
+ HRes = 0;
+ VRes = 0;
+ BorderMode = false;
+ InterlaceMode = 0;
+ //
+ memset(VCPRegs, 0, sizeof(VCPRegs));
+ //
+ BGON = 0;
+ MZCTL = 0;
+ MosaicVCount = 0;
+
+ SFSEL = 0;
+ SFCODE = 0;
+
+ CHCTLA = 0;
+ CHCTLB = 0;
+
+ BMPNA = 0;
+ BMPNB = 0;
+
+ for(unsigned n = 0; n < 4; n++)
+  PNCN[n] = 0;
+
+ PNCNR = 0;
+
+ PLSZ = 0;
+ MPOFN = 0;
+ MPOFR = 0;
+
+ for(unsigned n = 0; n < 4; n++)
+ {
+  for(unsigned i = 0; i < 4; i++)
+   MapRegs[n][i] = 0;
+ }
+
+ for(unsigned rn = 0; rn < 2; rn++)
+ {
+  for(unsigned i = 0; i < 16; i++)
+   RotMapRegs[rn][i] = 0;
+ }
+
+ //
+ for(unsigned n = 0; n < 4; n++)
+ {
+  XScrollI[n] = 0;
+  YScrollI[n] = 0;
+
+  if(n < 2)
+  {
+   XScrollF[n] = 0;
+   YScrollF[n] = 0;
+
+   XCoordInc[n] = 0;
+   YCoordInc[n] = 0;
+   YCoordAccum[n] = 0;
+   MosEff_YCoordAccum[n] = 0;
+  }
+  else
+  {
+   NBG23_YCounter[n & 1] = 0;
+   MosEff_NBG23_YCounter[n & 1] = 0;
+  }
+ }
+
+ ZMCTL = 0;
+ SCRCTL = 0;
+ LineScrollAddr[0] = 0;
+ LineScrollAddr[1] = 0;
+ VCScrollAddr = 0;
+ VCLast[0] = VCLast[1] = 0;
+
+ for(unsigned n = 0; n < 2; n++)
+ {
+  CurXScrollIF[n] = 0;
+  CurYScrollIF[n] = 0;
+  CurLSA[n] = 0;
+  CurXCoordInc[n] = 0;
+ }
+
+ for(unsigned n = 0; n < 4; n++)
+  NBGPrioNum[n] = 0;
+
+ RBG0PrioNum = 0;
+
+ for(unsigned n = 0; n < 4; n++)
+  NBGCCRatio[n] = 0;
+
+ RBG0CCRatio = 0;
+ LineColorCCRatio = 0;
+ BackCCRatio = 0;
+
+ for(unsigned w = 0; w < 2; w++)
+ {
+  Window[w].XStart = 0;
+  Window[w].XEnd = 0;
+  Window[w].LineWinAddr = 0;
+  Window[w].LineWinEn = false;
+
+  Window[w].YMet = false;
+  Window[w].CurXStart = 0;
+  Window[w].CurXEnd = 0;
+  Window[w].CurLineWinAddr = 0;
+ }
+
+ for(unsigned i = 0; i < 8; i++)
+  WinControl[i] = 0;
+
+ //
+ RPMD = 0;
+ for(unsigned i = 0; i < 2; i++)
+ {
+  KTCTL[i] = 0;
+  OVPNR[i] = 0;
+ }
+ //
+ BKTA = 0;
+ CurBackTabAddr = 0;
+ CurBackColor = 0;
+
+ LCTA = 0;
+ CurLCTabAddr = 0;
+ CurLCColor = 0;
+
+ LineColorEn = 0;
+
+ SFPRMD = 0;
+ SFCCMD = 0;
+
+ CCCTL = 0;
+ //
+ SpriteCCCond = 0;
+ SpriteCCNum = 0;
+ SPCTL_Low = 0;
+
+ SDCTL = 0;
+ //
+ for(auto& spn : SpritePrioNum)
+  spn = 0;
+ //
+ for(auto& scr : SpriteCCRatio)
+  scr = 0;
+ //
+ for(auto& ao : CRAMAddrOffs_NBG)
+  ao = 0;
+
+ CRAMAddrOffs_RBG0 = 0;
+
+ CRAMAddrOffs_Sprite = 0;
+ //
+ ColorOffsEn = 0;
+ ColorOffsSel = 0;
+
+ for(auto& co : ColorOffs)
+  for(auto& coe : co)
+   coe = 0;
+}
+
+// Prio(3 bits), color calc(1 bit), layer num(3 bits), 1 bit for palette/rgb format, 1 bit for line color enable, 1 bit for color offs enable, 1 bit for color offs select
+//    1 bit for line color screen enable?, 1 bit allow sprite shadow, 1 bit do sprite shadow
+// Prio, color calc, layer num
+
+enum
+{
+ PIX_ISRGB_SHIFT = 0,	// original format, 0 = paletted, 1 = RGB
+ PIX_LCE_SHIFT = 1,	// Line color enable
+ PIX_COE_SHIFT = 2,	// Color offs enable
+ PIX_COSEL_SHIFT = 3,	// Color offset select(which color offset registers to use)
+ PIX_CCE_SHIFT = 4,	// Color calc enable
+
+ //
+ // Sprite shadow nonsense
+ // Keep these in this order at these bit positions
+ PIX_SHADEN_SHIFT = 5,	//
+ PIX_DOSHAD_SHIFT = 6,
+ PIX_SELFSHAD_SHIFT = 7,
+ PIX_SHADHALVTEST8_VAL = 0x60,
+ //
+ //
+ //
+ //
+
+ // 8 ... 15
+ PIX_PRIO_TEST_SHIFT = 8,
+ PIX_PRIO_SHIFT = PIX_PRIO_TEST_SHIFT + 3,
+
+ //
+ PIX_GRAD_SHIFT = 16,
+ PIX_LAYER_CCE_SHIFT = 17,	// For extended color calculation
+
+ // 24...31
+ PIX_CCRATIO_SHIFT = 24,
+
+ // 32 ... 55
+ PIX_RGB_SHIFT = 32,
+
+ //
+ PIX_SWBIT_SHIFT = 56,
+
+ // Reminder that highest bit can be == 1 when RGB data is pulled from ColorCache
+ //SPECIAL_CCALC_SHIFT = 63
+};
+
+static INLINE void GetCWV(const uint8 ctrl, const bool* const xmet, bool* cwv)
+{
+ const bool logic = (ctrl >> 7) & 1;	// 0 = OR, 1 = AND
+ const bool w_enable[2] = { (bool)(ctrl & 0x02), (bool)(ctrl & 0x08) };
+ const bool w_area[2] = { (bool)(ctrl & 0x01), (bool)(ctrl & 0x04) };
+ const bool sw_enable = ctrl & 0x20;
+ const bool sw_area = ctrl & 0x10;
+
+ for(unsigned swinput = 0; swinput < 2; swinput++)
+ {
+  bool wval[2];
+  bool swval;
+
+  wval[0] = (w_enable[0] ? ((xmet[0] & Window[0].YMet) ^ w_area[0]) : logic);
+  wval[1] = (w_enable[1] ? ((xmet[1] & Window[1].YMet) ^ w_area[1]) : logic);
+
+  swval = sw_enable ? (swinput ^ sw_area) : logic;
+
+  if(logic)
+   cwv[swinput] = wval[0] & wval[1] & swval;
+  else
+   cwv[swinput] = wval[0] | wval[1] | swval;
+ }
+}
+
+static void GetWinRotAB(void)
+{
+ unsigned x = 0;
+
+ for(unsigned piece = 0; piece < WinPieces.size(); piece++)
+ {
+  bool xmet[2];
+
+  xmet[0] = ((x >= Window[0].CurXStart) & (x <= Window[0].CurXEnd));
+  xmet[1] = ((x >= Window[1].CurXStart) & (x <= Window[1].CurXEnd));
+  //
+  //
+  //
+  bool cwv[2];
+
+  GetCWV(WinControl[WINLAYER_ROTPARAM], xmet, cwv);
+
+  if(HRes & 0x2)
+  {
+   for(; MDFN_LIKELY(x < WinPieces[piece]); x += 2)
+    LB.rotabsel[x >> 1] = cwv[(LB.spr[x] >> PIX_SWBIT_SHIFT) & 1];
+  }
+  else
+  {
+   for(; MDFN_LIKELY(x < WinPieces[piece]); x++)
+    LB.rotabsel[x] = cwv[(LB.spr[x] >> PIX_SWBIT_SHIFT) & 1];
+  }
+ }
+}
+
+static void ApplyWin(const unsigned wlayer, uint64* buf)
+{
+ unsigned x = 0;
+
+ //printf("%d %d %d %d %d --- %d %d\n", WinPieces[0], WinPieces[1], WinPieces[2], WinPieces[3], WinPieces[4], Window[0].CurXStart, Window[0].CurXEnd);
+
+ for(unsigned piece = 0; piece < WinPieces.size(); piece++)
+ {
+  bool xmet[2];
+
+  xmet[0] = ((x >= Window[0].CurXStart) & (x <= Window[0].CurXEnd));
+  xmet[1] = ((x >= Window[1].CurXStart) & (x <= Window[1].CurXEnd));
+
+  //
+  //
+  //
+  bool cwv[2];
+  bool cc_cwv[2];
+
+  GetCWV(WinControl[wlayer], xmet, cwv);
+  GetCWV(WinControl[WINLAYER_CC], xmet, cc_cwv);
+
+  if(!((cwv[0] ^ cwv[1]) | (cc_cwv[0] ^ cc_cwv[1])))	// Fast path(no sprite window, or sprite window wouldn't have an effect in this piece).
+  {
+   if(cwv[0])
+   {
+    for(; MDFN_LIKELY(x < WinPieces[piece]); x++)
+     buf[x] &= ~(uint64)0xFFFFFFFF;
+   }
+   else if(cc_cwv[0])
+   {
+    for(; MDFN_LIKELY(x < WinPieces[piece]); x++)
+     buf[x] &= ~(uint64)(1U << PIX_CCE_SHIFT);
+   }
+   x = WinPieces[piece];
+  }
+  else
+  {
+   uint64 masks[2];
+
+   for(unsigned i = 0; i < 2; i++)
+   {
+    uint64 m = ~(uint64)0;
+
+    if(cwv[i])
+     m = ~(uint64)0xFFFFFFFF;
+
+    if(cc_cwv[i])
+     m &= ~(uint64)(1U << PIX_CCE_SHIFT);
+
+    masks[i] = m;
+   }
+
+   for(; MDFN_LIKELY(x < WinPieces[piece]); x++)
+   {
+    buf[x] &= masks[(LB.spr[x] >> PIX_SWBIT_SHIFT) & 1];
+   }
+  }
+ }
+}
+
+#pragma GCC push_options
+#pragma GCC optimize("no-unroll-loops,no-peel-loops,no-crossjumping")
+static NO_INLINE void ApplyHMosaic(const unsigned layer, uint64* buf, const unsigned w)
+{
+ if(!(MZCTL & (1U << layer)))
+  return;
+
+ const unsigned moz_horiz_param = ((MZCTL >> 8) & 0xF);
+ const unsigned moz_wmax = w - moz_horiz_param;
+ unsigned x = 0;
+
+ switch(moz_horiz_param)
+ {
+  case 0x0: x = moz_wmax; break;
+  case 0x1: for(; x < moz_wmax; x += 0x2) { auto b = buf[x]; buf[x + 1] = b; } break;
+  case 0x2: for(; x < moz_wmax; x += 0x3) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; } break;
+  case 0x3: for(; x < moz_wmax; x += 0x4) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; } break;
+  case 0x4: for(; x < moz_wmax; x += 0x5) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; } break;
+  case 0x5: for(; x < moz_wmax; x += 0x6) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; } break;
+  case 0x6: for(; x < moz_wmax; x += 0x7) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; } break;
+  case 0x7: for(; x < moz_wmax; x += 0x8) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; } break;
+  case 0x8: for(; x < moz_wmax; x += 0x9) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; } break;
+  case 0x9: for(; x < moz_wmax; x += 0xA) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; } break;
+  case 0xA: for(; x < moz_wmax; x += 0xB) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; buf[x + 10] = b; } break;
+  case 0xB: for(; x < moz_wmax; x += 0xC) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; buf[x + 10] = b; buf[x + 11] = b; } break;
+  case 0xC: for(; x < moz_wmax; x += 0xD) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; buf[x + 10] = b; buf[x + 11] = b; buf[x + 12] = b; } break;
+  case 0xD: for(; x < moz_wmax; x += 0xE) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; buf[x + 10] = b; buf[x + 11] = b; buf[x + 12] = b; buf[x + 13] = b; } break;
+  case 0xE: for(; x < moz_wmax; x += 0xF) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; buf[x + 10] = b; buf[x + 11] = b; buf[x + 12] = b; buf[x + 13] = b; buf[x + 14] = b; } break;
+  case 0xF: for(; x < moz_wmax; x += 0x10) { auto b = buf[x]; buf[x + 1] = b; buf[x + 2] = b; buf[x + 3] = b; buf[x + 4] = b; buf[x + 5] = b; buf[x + 6] = b; buf[x + 7] = b; buf[x + 8] = b; buf[x + 9] = b; buf[x + 10] = b; buf[x + 11] = b; buf[x + 12] = b; buf[x + 13] = b; buf[x + 14] = b; buf[x + 15] = b;} break;
+ }
+ assert(x <= w);
+
+ for(auto b = buf[x]; x < w; x++)
+  buf[x] = b;
+}
+#pragma GCC pop_options
+
+//
+// NBG0(HRES=0x1):
+//   Cycle 0: OK
+//   Cycle 1: OK
+//
+//   Cycle 2:
+//	[Entry 0] [Entry 0] [Entry 1] [Entry 2]
+//   Cycle 3 ... 7:
+//	[Entry 44] [Entry 44] [Entry 0] [Entry 1]
+//
+
+static void FetchVCScroll(const unsigned w)
+{
+ const bool vcon[2] = { (bool)(SCRCTL & BGON & !(MZCTL & 0x1)), (bool)((SCRCTL >> 8) & (BGON >> 1) & !(MZCTL & 0x2) & 0x1) };
+ const unsigned max_cyc = (HRes & 0x6) ? 4 : 8;
+ const unsigned tc = (w >> 3) + 1;
+ uint32 tmp[2] = { VCLast[0], VCLast[1] };
+ uint32 vcaddr = VCScrollAddr & 0x3FFFE;
+ uint32 base[2];
+ unsigned inc[8];
+ uint8 VRMVCPCache[4][8];
+
+ for(unsigned bank = 0; bank < 4; bank++)
+ {
+  //unsigned brm[4];
+  //brm[bank] = bank & (2 | ((VRAM_Mode >> (bank >> 1)) & 1));
+  const unsigned esb = bank & (2 | ((VRAM_Mode >> (bank >> 1)) & 1));
+  memcpy(VRMVCPCache[bank], VCPRegs[esb], 8);
+ }
+
+ for(unsigned n = 0; n < 2; n++)
+  base[n] = CurYScrollIF[n] + YCoordAccum[n];
+
+ for(unsigned cyc = 0; cyc < max_cyc; cyc++)
+ {
+  unsigned do_inc = 0;
+
+  for(unsigned bank = 0; bank < 4; bank++)
+  {
+   const unsigned act = VRMVCPCache[bank][cyc];
+
+   do_inc |= vcon[0] & (act == VCP_NBG0_VCS);
+   do_inc |= vcon[1] & (act == VCP_NBG1_VCS);
+  }
+
+  inc[cyc] = do_inc << 1;
+ }
+
+ for(unsigned tile = 0; MDFN_LIKELY(tile < tc); tile++)
+ {
+  for(unsigned cyc = 0; cyc < max_cyc; cyc++)
+  {
+   const unsigned act = VRMVCPCache[vcaddr >> 16][cyc];
+
+   // NBG0
+   if(vcon[0])
+   {
+    if(cyc == 3)
+     LB.vcscr[0][tile] = ((base[0] + tmp[0]) >> 8);
+
+    if(cyc == 3)
+     tmp[0] = VCLast[0];
+
+    if(act == VCP_NBG0_VCS)
+    {
+     VCLast[0] = (VRAM[vcaddr + 0] << 8) | (VRAM[vcaddr + 1] >> 8);
+     if(cyc <= (1 + !tile))
+      tmp[0] = VCLast[0];
+    }
+   }
+
+   // NBG1
+   if(vcon[1])
+   {
+    if(cyc == 4)
+     LB.vcscr[1][tile] = ((base[1] + tmp[1]) >> 8);
+
+    if(cyc == 4)
+     tmp[1] = VCLast[1];
+
+    if(act == VCP_NBG1_VCS)
+    {
+     VCLast[1] = (VRAM[vcaddr + 0] << 8) | (VRAM[vcaddr + 1] >> 8);
+     if(cyc <= 2) //(2 + !tile)) // TODO: Check
+      tmp[1] = VCLast[1];
+    }
+   }
+
+   vcaddr = (vcaddr + inc[cyc]) & 0x3FFFE;
+  }
+ }
+}
+
+template<unsigned TA_PrioMode, unsigned TA_CCMode>
+static INLINE void MakeSFCodeLUT(const unsigned layer, int16* const sfcode_lut)
+{
+ const uint8 code = SFCODE >> (((SFSEL >> layer) & 1) << 3);
+
+ for(unsigned i = 0; i < 8; i++)
+ {
+  uint16 tmp = 0xFFFF;
+
+  if(!((code >> i) & 1))
+  {
+   if(TA_PrioMode & 2)
+    tmp &= ~(1U << PIX_PRIO_SHIFT);
+
+   if(TA_CCMode == 2)
+    tmp &= ~(1U << PIX_CCE_SHIFT);
+  }
+
+  sfcode_lut[i] = tmp;
+ }
+}
+
+static INLINE uint32 rgb15_to_rgb24(uint16 src)
+{
+ return ((((src << 3) & 0xF8) | ((src << 6) & 0xF800) | ((src << 9) & 0xF80000) | ((src << 16) & 0x80000000)));;
+}
+
+template<bool TA_bmen, unsigned TA_bpp, bool TA_isrgb, bool TA_igntp, unsigned TA_PrioMode, unsigned TA_CCMode, typename T>
+static INLINE uint64 MakeNBGRBGPix(T& tf, const uint32 pix_base_or, const int16* sfcode_lut, const uint32 ix, const uint32 iy)
+{
+ uint32 cellx = (ix ^ tf.cellx_xor);
+ const uint16* vrb = &tf.tile_vrb[((cellx * TA_bpp) >> 4)];
+ //
+ //
+ //
+ uint32 pbor = pix_base_or;
+ uint32 rgb24;
+ bool opaque;
+
+ if(TA_CCMode == 1 || (TA_CCMode == 2 && !TA_isrgb))
+  pbor |= (tf.scc << PIX_CCE_SHIFT);
+
+ if(TA_PrioMode == 1 || (TA_PrioMode == 2 && !TA_isrgb))
+  pbor |= (tf.spr << PIX_PRIO_SHIFT);
+
+ if(TA_isrgb)
+ {
+  if(TA_bpp == 32)
+  {
+   uint32 tmp = (vrb[0] << 16) | vrb[1];
+
+   rgb24 = tmp & 0xFFFFFF;
+   opaque = (bool)(tmp & 0x80000000);
+  }
+  else
+  {
+   uint32 tmp = vrb[0];
+
+   rgb24 = rgb15_to_rgb24(tmp & 0x7FFF);
+   opaque = (bool)(tmp & 0x8000);
+  }
+
+  if(TA_CCMode == 3)
+   pbor |= (1 << PIX_CCE_SHIFT);
+ }
+ else
+ {
+  uint32 dcc;
+  uint32 tmp = vrb[0]; //charno ^ (charno << 8); //vrb[0];
+
+  if(TA_bpp == 16)
+   dcc = tmp & 0x7FF;
+  else if(TA_bpp == 8)
+   dcc = (tmp >> (((cellx & 1) ^ 1) << 3)) & 0xFF;
+  else
+   dcc = (tmp >> (((cellx & 3) ^ 3) << 2)) & 0x0F;
+
+  opaque = (bool)dcc;
+
+  rgb24 = ColorCache[(tf.pcco + dcc) & 2047];
+
+  if(TA_CCMode == 3)
+   pbor |= ((int32)rgb24 >> 31) & (1 << PIX_CCE_SHIFT);
+  //
+  if(TA_PrioMode == 2 || TA_CCMode == 2)
+   pbor &= *(const int16*)((const uint8*)sfcode_lut + (dcc & 0xE));
+ }
+
+ if(!TA_igntp && !opaque)
+  pbor = 0;
+
+ return pbor | ((uint64)rgb24 << PIX_RGB_SHIFT);
+}
+
+template<bool TA_bmen, unsigned TA_bpp, bool TA_isrgb, bool TA_igntp, unsigned TA_PrioMode, unsigned TA_CCMode>
+static void T_DrawNBG(const unsigned n, uint64* bgbuf, const unsigned w, const uint32 pix_base_or)
+{
+ assert(n < 2);
+ //
+ //
+ const bool VCSEn = ((SCRCTL >> (n << 3)) & 0x1) && !(MZCTL & (1U << n));
+ //
+ TileFetcher<false> tf;
+ uint32 xcinc;
+ uint32 xc;
+ uint32 iy;
+ int16 sfcode_lut[8];
+
+ tf.CRAOffs = CRAMAddrOffs_NBG[n] << 8;
+ //
+ tf.BMSCC = ((BMPNA >> (4 + (n << 3))) & 1);
+ tf.BMSPR = ((BMPNA >> (5 + (n << 3))) & 1);
+ tf.BMPalNo = ((BMPNA >> (0 + (n << 3))) & 0x7) << 4;
+ tf.BMSize = ((CHCTLA >> (2 + (n << 3))) & 0x3);
+ //
+ tf.PlaneSize = (PLSZ >> (n << 1)) & 0x3;
+ tf.PNDSize = (PNCN[n] >> 15) & 1;	// 0 = 2 words, 1 = 1 word
+ tf.CharSize = ((CHCTLA >> (0 + (n << 3))) & 1);
+ tf.AuxMode = (PNCN[n] >> 14) & 1;
+ tf.Supp = (PNCN[n] & 0x3FF); // Supplement bits when PNDSize == 1
+ //
+ tf.Start(n, TA_bmen, (MPOFN >> (n << 2)) & 0x7, MapRegs[n]);
+
+ MakeSFCodeLUT<TA_PrioMode, TA_CCMode>(n, sfcode_lut);
+
+ xc = CurXScrollIF[n];
+ iy = (CurYScrollIF[n] + MosEff_YCoordAccum[n]) >> 8;
+ xcinc = CurXCoordInc[n];
+
+ //if(line == 64)
+ // printf("Mega %d: planesize=0x%1x charsize=%d pndsize=%d(auxmode=%d,supp=0x%04x) bpp=%d/%d ccmode=0x%04x SFSEL=0x%04x SFCODE=0x%04x SFCCMD=0x%04x\n", n, PlaneSize, CharSize, PNDSize, AuxMode, Supp, TA_bpp, TA_isrgb, TA_CCMode, SFSEL, SFCODE, SFCCMD);
+
+ //printf("Mega %d %02x %d --- %04x %04x -- %04x --- lsa=0x%06x vcsa=0x%06x --- imode=0x%01x\n", TA_bpp, BMSize, w, xcinc, ycinc, SCRCTL, LineScrollAddr[n], VCScrollAddr, InterlaceMode);
+
+ // Map: 2x2 planes
+ // Plane: 1x1, 2x1, or 2x2 pages
+ // Page: 64x64 cells
+ // Character: 1x1, 2x2 cells
+ // Cell: 8x8 dots
+ uint32 prev_ix = ~0U;
+
+ if(((ZMCTL >> (n << 3)) & 0x3) && VCSEn)
+ {
+  for(unsigned i = 0; MDFN_LIKELY(i < w); i++)
+  {
+   const uint32 ix = xc >> 8;
+   iy = LB.vcscr[n][i >> 3];
+   tf.Fetch<TA_bpp>(TA_bmen, ix, iy);
+   //
+   //
+   //
+   bgbuf[i] = MakeNBGRBGPix<TA_bmen, TA_bpp, TA_isrgb, TA_igntp, TA_PrioMode, TA_CCMode>(tf, pix_base_or, sfcode_lut, ix, iy);
+   xc += xcinc;
+  }
+ }
+ else
+ {
+  for(unsigned i = 0; MDFN_LIKELY(i < w); i++)
+  {
+   const uint32 ix = xc >> 8;
+
+   if((ix >> 3) != prev_ix)
+   {
+    prev_ix = ix >> 3;
+    //
+    if(VCSEn)
+     iy = LB.vcscr[n][(i + 7) >> 3];
+
+    tf.Fetch<TA_bpp>(TA_bmen, ix, iy);
+   }
+   //
+   //
+   //
+   bgbuf[i] = MakeNBGRBGPix<TA_bmen, TA_bpp, TA_isrgb, TA_igntp, TA_PrioMode, TA_CCMode>(tf, pix_base_or, sfcode_lut, ix, iy);
+   xc += xcinc;
+  }
+ }
+}
+
+static void (*DrawNBG[2 /*bitmap enable*/][5/*col mode*/][2/*igntp*/][3/*priomode*/][4/*ccmode*/])(const unsigned n, uint64* bgbuf, const unsigned w, const uint32 pix_base_or) =
+{
+ {
+  {  {  { T_DrawNBG<0, 4, 0, 0, 0, 0>, T_DrawNBG<0, 4, 0, 0, 0, 1>, T_DrawNBG<0, 4, 0, 0, 0, 2>, T_DrawNBG<0, 4, 0, 0, 0, 3>,  },  { T_DrawNBG<0, 4, 0, 0, 1, 0>, T_DrawNBG<0, 4, 0, 0, 1, 1>, T_DrawNBG<0, 4, 0, 0, 1, 2>, T_DrawNBG<0, 4, 0, 0, 1, 3>,  },  { T_DrawNBG<0, 4, 0, 0, 2, 0>, T_DrawNBG<0, 4, 0, 0, 2, 1>, T_DrawNBG<0, 4, 0, 0, 2, 2>, T_DrawNBG<0, 4, 0, 0, 2, 3>,  },  },  {  { T_DrawNBG<0, 4, 0, 1, 0, 0>, T_DrawNBG<0, 4, 0, 1, 0, 1>, T_DrawNBG<0, 4, 0, 1, 0, 2>, T_DrawNBG<0, 4, 0, 1, 0, 3>,  },  { T_DrawNBG<0, 4, 0, 1, 1, 0>, T_DrawNBG<0, 4, 0, 1, 1, 1>, T_DrawNBG<0, 4, 0, 1, 1, 2>, T_DrawNBG<0, 4, 0, 1, 1, 3>,  },  { T_DrawNBG<0, 4, 0, 1, 2, 0>, T_DrawNBG<0, 4, 0, 1, 2, 1>, T_DrawNBG<0, 4, 0, 1, 2, 2>, T_DrawNBG<0, 4, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<0, 8, 0, 0, 0, 0>, T_DrawNBG<0, 8, 0, 0, 0, 1>, T_DrawNBG<0, 8, 0, 0, 0, 2>, T_DrawNBG<0, 8, 0, 0, 0, 3>,  },  { T_DrawNBG<0, 8, 0, 0, 1, 0>, T_DrawNBG<0, 8, 0, 0, 1, 1>, T_DrawNBG<0, 8, 0, 0, 1, 2>, T_DrawNBG<0, 8, 0, 0, 1, 3>,  },  { T_DrawNBG<0, 8, 0, 0, 2, 0>, T_DrawNBG<0, 8, 0, 0, 2, 1>, T_DrawNBG<0, 8, 0, 0, 2, 2>, T_DrawNBG<0, 8, 0, 0, 2, 3>,  },  },  {  { T_DrawNBG<0, 8, 0, 1, 0, 0>, T_DrawNBG<0, 8, 0, 1, 0, 1>, T_DrawNBG<0, 8, 0, 1, 0, 2>, T_DrawNBG<0, 8, 0, 1, 0, 3>,  },  { T_DrawNBG<0, 8, 0, 1, 1, 0>, T_DrawNBG<0, 8, 0, 1, 1, 1>, T_DrawNBG<0, 8, 0, 1, 1, 2>, T_DrawNBG<0, 8, 0, 1, 1, 3>,  },  { T_DrawNBG<0, 8, 0, 1, 2, 0>, T_DrawNBG<0, 8, 0, 1, 2, 1>, T_DrawNBG<0, 8, 0, 1, 2, 2>, T_DrawNBG<0, 8, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<0, 16, 0, 0, 0, 0>, T_DrawNBG<0, 16, 0, 0, 0, 1>, T_DrawNBG<0, 16, 0, 0, 0, 2>, T_DrawNBG<0, 16, 0, 0, 0, 3>,  },  { T_DrawNBG<0, 16, 0, 0, 1, 0>, T_DrawNBG<0, 16, 0, 0, 1, 1>, T_DrawNBG<0, 16, 0, 0, 1, 2>, T_DrawNBG<0, 16, 0, 0, 1, 3>,  },  { T_DrawNBG<0, 16, 0, 0, 2, 0>, T_DrawNBG<0, 16, 0, 0, 2, 1>, T_DrawNBG<0, 16, 0, 0, 2, 2>, T_DrawNBG<0, 16, 0, 0, 2, 3>,  },  },  {  { T_DrawNBG<0, 16, 0, 1, 0, 0>, T_DrawNBG<0, 16, 0, 1, 0, 1>, T_DrawNBG<0, 16, 0, 1, 0, 2>, T_DrawNBG<0, 16, 0, 1, 0, 3>,  },  { T_DrawNBG<0, 16, 0, 1, 1, 0>, T_DrawNBG<0, 16, 0, 1, 1, 1>, T_DrawNBG<0, 16, 0, 1, 1, 2>, T_DrawNBG<0, 16, 0, 1, 1, 3>,  },  { T_DrawNBG<0, 16, 0, 1, 2, 0>, T_DrawNBG<0, 16, 0, 1, 2, 1>, T_DrawNBG<0, 16, 0, 1, 2, 2>, T_DrawNBG<0, 16, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<0, 16, 1, 0, 0, 0>, T_DrawNBG<0, 16, 1, 0, 0, 1>, T_DrawNBG<0, 16, 1, 0, 0, 2>, T_DrawNBG<0, 16, 1, 0, 0, 3>,  },  { T_DrawNBG<0, 16, 1, 0, 1, 0>, T_DrawNBG<0, 16, 1, 0, 1, 1>, T_DrawNBG<0, 16, 1, 0, 1, 2>, T_DrawNBG<0, 16, 1, 0, 1, 3>,  },  { T_DrawNBG<0, 16, 1, 0, 2, 0>, T_DrawNBG<0, 16, 1, 0, 2, 1>, T_DrawNBG<0, 16, 1, 0, 2, 2>, T_DrawNBG<0, 16, 1, 0, 2, 3>,  },  },  {  { T_DrawNBG<0, 16, 1, 1, 0, 0>, T_DrawNBG<0, 16, 1, 1, 0, 1>, T_DrawNBG<0, 16, 1, 1, 0, 2>, T_DrawNBG<0, 16, 1, 1, 0, 3>,  },  { T_DrawNBG<0, 16, 1, 1, 1, 0>, T_DrawNBG<0, 16, 1, 1, 1, 1>, T_DrawNBG<0, 16, 1, 1, 1, 2>, T_DrawNBG<0, 16, 1, 1, 1, 3>,  },  { T_DrawNBG<0, 16, 1, 1, 2, 0>, T_DrawNBG<0, 16, 1, 1, 2, 1>, T_DrawNBG<0, 16, 1, 1, 2, 2>, T_DrawNBG<0, 16, 1, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<0, 32, 1, 0, 0, 0>, T_DrawNBG<0, 32, 1, 0, 0, 1>, T_DrawNBG<0, 32, 1, 0, 0, 2>, T_DrawNBG<0, 32, 1, 0, 0, 3>,  },  { T_DrawNBG<0, 32, 1, 0, 1, 0>, T_DrawNBG<0, 32, 1, 0, 1, 1>, T_DrawNBG<0, 32, 1, 0, 1, 2>, T_DrawNBG<0, 32, 1, 0, 1, 3>,  },  { T_DrawNBG<0, 32, 1, 0, 2, 0>, T_DrawNBG<0, 32, 1, 0, 2, 1>, T_DrawNBG<0, 32, 1, 0, 2, 2>, T_DrawNBG<0, 32, 1, 0, 2, 3>,  },  },  {  { T_DrawNBG<0, 32, 1, 1, 0, 0>, T_DrawNBG<0, 32, 1, 1, 0, 1>, T_DrawNBG<0, 32, 1, 1, 0, 2>, T_DrawNBG<0, 32, 1, 1, 0, 3>,  },  { T_DrawNBG<0, 32, 1, 1, 1, 0>, T_DrawNBG<0, 32, 1, 1, 1, 1>, T_DrawNBG<0, 32, 1, 1, 1, 2>, T_DrawNBG<0, 32, 1, 1, 1, 3>,  },  { T_DrawNBG<0, 32, 1, 1, 2, 0>, T_DrawNBG<0, 32, 1, 1, 2, 1>, T_DrawNBG<0, 32, 1, 1, 2, 2>, T_DrawNBG<0, 32, 1, 1, 2, 3>,  },  },  },
+ },
+ {
+  {  {  { T_DrawNBG<1, 4, 0, 0, 0, 0>, T_DrawNBG<1, 4, 0, 0, 0, 1>, T_DrawNBG<1, 4, 0, 0, 0, 2>, T_DrawNBG<1, 4, 0, 0, 0, 3>,  },  { T_DrawNBG<1, 4, 0, 0, 1, 0>, T_DrawNBG<1, 4, 0, 0, 1, 1>, T_DrawNBG<1, 4, 0, 0, 1, 2>, T_DrawNBG<1, 4, 0, 0, 1, 3>,  },  { T_DrawNBG<1, 4, 0, 0, 2, 0>, T_DrawNBG<1, 4, 0, 0, 2, 1>, T_DrawNBG<1, 4, 0, 0, 2, 2>, T_DrawNBG<1, 4, 0, 0, 2, 3>,  },  },  {  { T_DrawNBG<1, 4, 0, 1, 0, 0>, T_DrawNBG<1, 4, 0, 1, 0, 1>, T_DrawNBG<1, 4, 0, 1, 0, 2>, T_DrawNBG<1, 4, 0, 1, 0, 3>,  },  { T_DrawNBG<1, 4, 0, 1, 1, 0>, T_DrawNBG<1, 4, 0, 1, 1, 1>, T_DrawNBG<1, 4, 0, 1, 1, 2>, T_DrawNBG<1, 4, 0, 1, 1, 3>,  },  { T_DrawNBG<1, 4, 0, 1, 2, 0>, T_DrawNBG<1, 4, 0, 1, 2, 1>, T_DrawNBG<1, 4, 0, 1, 2, 2>, T_DrawNBG<1, 4, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<1, 8, 0, 0, 0, 0>, T_DrawNBG<1, 8, 0, 0, 0, 1>, T_DrawNBG<1, 8, 0, 0, 0, 2>, T_DrawNBG<1, 8, 0, 0, 0, 3>,  },  { T_DrawNBG<1, 8, 0, 0, 1, 0>, T_DrawNBG<1, 8, 0, 0, 1, 1>, T_DrawNBG<1, 8, 0, 0, 1, 2>, T_DrawNBG<1, 8, 0, 0, 1, 3>,  },  { T_DrawNBG<1, 8, 0, 0, 2, 0>, T_DrawNBG<1, 8, 0, 0, 2, 1>, T_DrawNBG<1, 8, 0, 0, 2, 2>, T_DrawNBG<1, 8, 0, 0, 2, 3>,  },  },  {  { T_DrawNBG<1, 8, 0, 1, 0, 0>, T_DrawNBG<1, 8, 0, 1, 0, 1>, T_DrawNBG<1, 8, 0, 1, 0, 2>, T_DrawNBG<1, 8, 0, 1, 0, 3>,  },  { T_DrawNBG<1, 8, 0, 1, 1, 0>, T_DrawNBG<1, 8, 0, 1, 1, 1>, T_DrawNBG<1, 8, 0, 1, 1, 2>, T_DrawNBG<1, 8, 0, 1, 1, 3>,  },  { T_DrawNBG<1, 8, 0, 1, 2, 0>, T_DrawNBG<1, 8, 0, 1, 2, 1>, T_DrawNBG<1, 8, 0, 1, 2, 2>, T_DrawNBG<1, 8, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<1, 16, 0, 0, 0, 0>, T_DrawNBG<1, 16, 0, 0, 0, 1>, T_DrawNBG<1, 16, 0, 0, 0, 2>, T_DrawNBG<1, 16, 0, 0, 0, 3>,  },  { T_DrawNBG<1, 16, 0, 0, 1, 0>, T_DrawNBG<1, 16, 0, 0, 1, 1>, T_DrawNBG<1, 16, 0, 0, 1, 2>, T_DrawNBG<1, 16, 0, 0, 1, 3>,  },  { T_DrawNBG<1, 16, 0, 0, 2, 0>, T_DrawNBG<1, 16, 0, 0, 2, 1>, T_DrawNBG<1, 16, 0, 0, 2, 2>, T_DrawNBG<1, 16, 0, 0, 2, 3>,  },  },  {  { T_DrawNBG<1, 16, 0, 1, 0, 0>, T_DrawNBG<1, 16, 0, 1, 0, 1>, T_DrawNBG<1, 16, 0, 1, 0, 2>, T_DrawNBG<1, 16, 0, 1, 0, 3>,  },  { T_DrawNBG<1, 16, 0, 1, 1, 0>, T_DrawNBG<1, 16, 0, 1, 1, 1>, T_DrawNBG<1, 16, 0, 1, 1, 2>, T_DrawNBG<1, 16, 0, 1, 1, 3>,  },  { T_DrawNBG<1, 16, 0, 1, 2, 0>, T_DrawNBG<1, 16, 0, 1, 2, 1>, T_DrawNBG<1, 16, 0, 1, 2, 2>, T_DrawNBG<1, 16, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<1, 16, 1, 0, 0, 0>, T_DrawNBG<1, 16, 1, 0, 0, 1>, T_DrawNBG<1, 16, 1, 0, 0, 2>, T_DrawNBG<1, 16, 1, 0, 0, 3>,  },  { T_DrawNBG<1, 16, 1, 0, 1, 0>, T_DrawNBG<1, 16, 1, 0, 1, 1>, T_DrawNBG<1, 16, 1, 0, 1, 2>, T_DrawNBG<1, 16, 1, 0, 1, 3>,  },  { T_DrawNBG<1, 16, 1, 0, 2, 0>, T_DrawNBG<1, 16, 1, 0, 2, 1>, T_DrawNBG<1, 16, 1, 0, 2, 2>, T_DrawNBG<1, 16, 1, 0, 2, 3>,  },  },  {  { T_DrawNBG<1, 16, 1, 1, 0, 0>, T_DrawNBG<1, 16, 1, 1, 0, 1>, T_DrawNBG<1, 16, 1, 1, 0, 2>, T_DrawNBG<1, 16, 1, 1, 0, 3>,  },  { T_DrawNBG<1, 16, 1, 1, 1, 0>, T_DrawNBG<1, 16, 1, 1, 1, 1>, T_DrawNBG<1, 16, 1, 1, 1, 2>, T_DrawNBG<1, 16, 1, 1, 1, 3>,  },  { T_DrawNBG<1, 16, 1, 1, 2, 0>, T_DrawNBG<1, 16, 1, 1, 2, 1>, T_DrawNBG<1, 16, 1, 1, 2, 2>, T_DrawNBG<1, 16, 1, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawNBG<1, 32, 1, 0, 0, 0>, T_DrawNBG<1, 32, 1, 0, 0, 1>, T_DrawNBG<1, 32, 1, 0, 0, 2>, T_DrawNBG<1, 32, 1, 0, 0, 3>,  },  { T_DrawNBG<1, 32, 1, 0, 1, 0>, T_DrawNBG<1, 32, 1, 0, 1, 1>, T_DrawNBG<1, 32, 1, 0, 1, 2>, T_DrawNBG<1, 32, 1, 0, 1, 3>,  },  { T_DrawNBG<1, 32, 1, 0, 2, 0>, T_DrawNBG<1, 32, 1, 0, 2, 1>, T_DrawNBG<1, 32, 1, 0, 2, 2>, T_DrawNBG<1, 32, 1, 0, 2, 3>,  },  },  {  { T_DrawNBG<1, 32, 1, 1, 0, 0>, T_DrawNBG<1, 32, 1, 1, 0, 1>, T_DrawNBG<1, 32, 1, 1, 0, 2>, T_DrawNBG<1, 32, 1, 1, 0, 3>,  },  { T_DrawNBG<1, 32, 1, 1, 1, 0>, T_DrawNBG<1, 32, 1, 1, 1, 1>, T_DrawNBG<1, 32, 1, 1, 1, 2>, T_DrawNBG<1, 32, 1, 1, 1, 3>,  },  { T_DrawNBG<1, 32, 1, 1, 2, 0>, T_DrawNBG<1, 32, 1, 1, 2, 1>, T_DrawNBG<1, 32, 1, 1, 2, 2>, T_DrawNBG<1, 32, 1, 1, 2, 3>,  },  },  },
+ }
+};
+
+template<bool TA_igntp, unsigned TA_PrioMode, unsigned TA_CCMode>
+static INLINE uint64 MakeNBG23Pix(uint32 dcc, uint32 pbor, const int16* sfcode_lut, uint32 colcacheoffs)
+{
+ uint32 rgb24;
+
+ rgb24 = ColorCache[(colcacheoffs + dcc) & 2047];
+
+ if(TA_CCMode == 3)
+  pbor |= ((int32)rgb24 >> 31) & (1 << PIX_CCE_SHIFT);
+
+ if(TA_PrioMode == 2 || TA_CCMode == 2)
+  pbor &= *(const int16*)((const uint8*)sfcode_lut + (dcc & 0xE));
+
+ if(!TA_igntp && !dcc)
+  pbor = 0;
+
+ return pbor + ((uint64)rgb24 << PIX_RGB_SHIFT);
+}
+
+//
+// CCMode will be forced to 0 in the effective instantiation if corresponding NBG CCE bit in CCCTL is 0.
+//
+template<unsigned TA_bpp, bool TA_igntp, unsigned TA_PrioMode, unsigned TA_CCMode>
+static void T_DrawNBG23(const unsigned n, uint64* bgbuf, const unsigned w, const uint32 pix_base_or)
+{
+ assert(n >= 2);
+ TileFetcher<false> tf;
+ int16 sfcode_lut[8];
+ unsigned tc = 1 + (w >> 3);
+ const unsigned xscr = XScrollI[n];
+ const unsigned yscr = MosEff_NBG23_YCounter[n & 1];
+ unsigned tx;
+
+ tf.CRAOffs = CRAMAddrOffs_NBG[n] << 8;
+ //
+ tf.PlaneSize = (PLSZ >> (n << 1)) & 0x3;
+ tf.PNDSize = (PNCN[n] >> 15) & 1;	// 0 = 2 words, 1 = 1 word
+ tf.CharSize = ((CHCTLB >> (0 + ((n & 1) << 2))) & 1);
+ tf.AuxMode = (PNCN[n] >> 14) & 1;
+ tf.Supp = (PNCN[n] & 0x3FF); // Supplement bits when PNDSize == 1
+ //
+ tf.Start(n, false, (MPOFN >> (n << 2)) & 0x7, MapRegs[n]);
+
+ MakeSFCodeLUT<TA_PrioMode, TA_CCMode>(n, sfcode_lut);
+
+ bgbuf -= xscr & 0x7;
+ tx = xscr >> 3;
+
+ //
+ // Layer offset kludges
+ //
+ // Note: When/If adding new kludges, check that the NT and CG fetches for the layer each occur only in one bank, to safely handle other cases may require something more complex.
+ // printf("(TA_bpp == %d && n == %d && VRAM_Mode == 0x%01x && (HRes & 0x6) == 0x%01x && MDFN_de64lsb(VCPRegs[0]) == 0x%016llxULL && MDFN_de64lsb(VCPRegs[1]) == 0x%016llxULL && MDFN_de64lsb(VCPRegs[2]) == 0x%016llxULL && MDFN_de64lsb(VCPRegs[3]) == 0x%016llxULL) || \n", TA_bpp, n, VRAM_Mode, HRes & 0x6, (unsigned long long)MDFN_de64lsb(VCPRegs[0]), (unsigned long long)MDFN_de64lsb(VCPRegs[1]), (unsigned long long)MDFN_de64lsb(VCPRegs[2]), (unsigned long long)MDFN_de64lsb(VCPRegs[3]));
+ if(MDFN_UNLIKELY(
+  /* Akumajou Dracula X */ (TA_bpp == 4 && n == 3 && VRAM_Mode == 0x2 && (HRes & 0x6) == 0x0 && MDFN_de64lsb(VCPRegs[0]) == 0x0f0f070406060505ULL && MDFN_de64lsb(VCPRegs[1]) == 0x0f0f0f0f0f0f0f0fULL && MDFN_de64lsb(VCPRegs[2]) == 0x0f0f03000f0f0201ULL && MDFN_de64lsb(VCPRegs[3]) == 0x0f0f0f0f0f0f0f0fULL) ||
+  /* Alien Trilogy      */ (TA_bpp == 4 && n == 3 && VRAM_Mode == 0x2 && (HRes & 0x6) == 0x0 && MDFN_de64lsb(VCPRegs[0]) == 0x07050f0f0f0f0606ULL && MDFN_de64lsb(VCPRegs[1]) == 0x0f0f0f0f0f0f0f0fULL && MDFN_de64lsb(VCPRegs[2]) == 0x0f0f0f0f0f0f0f0fULL && MDFN_de64lsb(VCPRegs[3]) == 0x0f0103020f0f0f0fULL) ||
+  /* Daytona USA CCE    */ (TA_bpp == 4 && n == 2 && VRAM_Mode == 0x3 && (HRes & 0x6) == 0x0 && MDFN_de64lsb(VCPRegs[0]) == 0x0f0f0f0f00000404ULL && MDFN_de64lsb(VCPRegs[1]) == 0x0f0f0f060f0f0f0fULL && MDFN_de64lsb(VCPRegs[2]) == 0x0f0f0f0f0505070fULL && MDFN_de64lsb(VCPRegs[3]) == 0x0f0f03020f010f00ULL) ||
+  0))
+ {
+  for(unsigned i = 0; i < 8; i++)
+   *bgbuf++ = 0;
+  tc--;
+ }
+
+ while(MDFN_LIKELY(tc--))
+ {
+  uint32 pbor = pix_base_or;
+
+  tf.Fetch<TA_bpp>(false, tx << 3, yscr);
+
+  if(TA_CCMode == 1 || TA_CCMode == 2)
+   pbor |= (tf.scc << PIX_CCE_SHIFT);
+
+  if(TA_PrioMode == 1 || TA_PrioMode == 2)
+   pbor |= (tf.spr << PIX_PRIO_SHIFT);
+  //
+  //
+  auto* const mbp = MakeNBG23Pix<TA_igntp, TA_PrioMode, TA_CCMode>;
+
+  if(TA_bpp == 8)
+  {
+   if(tf.cellx_xor & 0x7)
+   {
+    bgbuf[7] = mbp((uint8)(tf.tile_vrb[0] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[6] = mbp((uint8)(tf.tile_vrb[0] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[5] = mbp((uint8)(tf.tile_vrb[1] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[4] = mbp((uint8)(tf.tile_vrb[1] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[3] = mbp((uint8)(tf.tile_vrb[2] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[2] = mbp((uint8)(tf.tile_vrb[2] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[1] = mbp((uint8)(tf.tile_vrb[3] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[0] = mbp((uint8)(tf.tile_vrb[3] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+   }
+   else
+   {
+    bgbuf[0] = mbp((uint8)(tf.tile_vrb[0] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[1] = mbp((uint8)(tf.tile_vrb[0] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[2] = mbp((uint8)(tf.tile_vrb[1] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[3] = mbp((uint8)(tf.tile_vrb[1] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[4] = mbp((uint8)(tf.tile_vrb[2] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[5] = mbp((uint8)(tf.tile_vrb[2] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[6] = mbp((uint8)(tf.tile_vrb[3] >>  8), /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[7] = mbp((uint8)(tf.tile_vrb[3] >>  0), /**/pbor, sfcode_lut, tf.pcco);
+   }
+  }
+  else
+  {
+   if(tf.cellx_xor & 0x7)
+   {
+    bgbuf[7] = mbp((tf.tile_vrb[0] >>  12),       /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[6] = mbp((tf.tile_vrb[0] >>   8) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[5] = mbp((tf.tile_vrb[0] >>   4) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[4] = mbp((tf.tile_vrb[0] >>   0) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[3] = mbp((tf.tile_vrb[1] >>  12),       /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[2] = mbp((tf.tile_vrb[1] >>   8) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[1] = mbp((tf.tile_vrb[1] >>   4) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[0] = mbp((tf.tile_vrb[1] >>   0) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+   }
+   else
+   {
+    bgbuf[0] = mbp((tf.tile_vrb[0] >>  12),       /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[1] = mbp((tf.tile_vrb[0] >>   8) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[2] = mbp((tf.tile_vrb[0] >>   4) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[3] = mbp((tf.tile_vrb[0] >>   0) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[4] = mbp((tf.tile_vrb[1] >>  12),       /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[5] = mbp((tf.tile_vrb[1] >>   8) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[6] = mbp((tf.tile_vrb[1] >>   4) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+    bgbuf[7] = mbp((tf.tile_vrb[1] >>   0) & 0xF, /**/pbor, sfcode_lut, tf.pcco);
+   }
+  }
+
+  //
+  //
+  //
+  tx++;
+  bgbuf += 8;
+ }
+}
+
+static void (*DrawNBG23[2/*col mode*/][2/*igntp*/][3/*priomode*/][4/*ccmode*/])(const unsigned n, uint64* bgbuf, const unsigned w, const uint32 pix_base_or) =
+{
+ {
+  {    { T_DrawNBG23<4, 0, 0, 0>, T_DrawNBG23<4, 0, 0, 1>, T_DrawNBG23<4, 0, 0, 2>, T_DrawNBG23<4, 0, 0, 3>, },    { T_DrawNBG23<4, 0, 1, 0>, T_DrawNBG23<4, 0, 1, 1>, T_DrawNBG23<4, 0, 1, 2>, T_DrawNBG23<4, 0, 1, 3>, },    { T_DrawNBG23<4, 0, 2, 0>, T_DrawNBG23<4, 0, 2, 1>, T_DrawNBG23<4, 0, 2, 2>, T_DrawNBG23<4, 0, 2, 3>, }, },
+  {    { T_DrawNBG23<4, 1, 0, 0>, T_DrawNBG23<4, 1, 0, 1>, T_DrawNBG23<4, 1, 0, 2>, T_DrawNBG23<4, 1, 0, 3>, },    { T_DrawNBG23<4, 1, 1, 0>, T_DrawNBG23<4, 1, 1, 1>, T_DrawNBG23<4, 1, 1, 2>, T_DrawNBG23<4, 1, 1, 3>, },    { T_DrawNBG23<4, 1, 2, 0>, T_DrawNBG23<4, 1, 2, 1>, T_DrawNBG23<4, 1, 2, 2>, T_DrawNBG23<4, 1, 2, 3>, }, },
+ },
+ {
+  {    { T_DrawNBG23<8, 0, 0, 0>, T_DrawNBG23<8, 0, 0, 1>, T_DrawNBG23<8, 0, 0, 2>, T_DrawNBG23<8, 0, 0, 3>, },    { T_DrawNBG23<8, 0, 1, 0>, T_DrawNBG23<8, 0, 1, 1>, T_DrawNBG23<8, 0, 1, 2>, T_DrawNBG23<8, 0, 1, 3>, },    { T_DrawNBG23<8, 0, 2, 0>, T_DrawNBG23<8, 0, 2, 1>, T_DrawNBG23<8, 0, 2, 2>, T_DrawNBG23<8, 0, 2, 3>, }, },
+  {    { T_DrawNBG23<8, 1, 0, 0>, T_DrawNBG23<8, 1, 0, 1>, T_DrawNBG23<8, 1, 0, 2>, T_DrawNBG23<8, 1, 0, 3>, },    { T_DrawNBG23<8, 1, 1, 0>, T_DrawNBG23<8, 1, 1, 1>, T_DrawNBG23<8, 1, 1, 2>, T_DrawNBG23<8, 1, 1, 3>, },    { T_DrawNBG23<8, 1, 2, 0>, T_DrawNBG23<8, 1, 2, 1>, T_DrawNBG23<8, 1, 2, 2>, T_DrawNBG23<8, 1, 2, 3>, }, },
+ },
+};
+
+static INLINE uint32 GetCoeffAddr(const unsigned i, uint32 offset)
+{
+ const uint32 src_mask = (CRKTE ? 0x3FF : 0x3FFFF);
+
+ offset >>= 10;
+ offset <<= !(KTCTL[i] & 0x2);
+ offset &= src_mask;
+
+ return offset;
+}
+
+static INLINE uint32 ReadCoeff(const unsigned i, const uint32 addr)
+{
+ const uint16* src = (CRKTE ? &CRAM[0x400] : VRAM);
+ uint32 coeff;
+
+ if(KTCTL[i] & 0x2)
+ {
+  const uint16 tmp = src[addr];
+  coeff = (sign_x_to_s32(21, tmp << 6) & 0x00FFFFFF) | ((tmp & 0x8000) << 16);
+  //printf("%d Coeff %08x, %04x -- %08x\n", i, offset, tmp, coeff);
+ }
+ else
+ {
+  const uint16* ea = &src[addr];
+  coeff = (ea[0] << 16) | ea[1];
+ }
+
+ return coeff;
+}
+
+// Coefficient table reading can (temporarily) override kx, ky, and/or Xp
+//
+// When RBG1 is enabled, line color screen uses rotation parameter A coefficient table
+//
+// RBG1 always uses MSB of coefficient data as transparent bit.
+//
+// RBG1 requires RPMD == 0, or else bad things happen?
+
+template<typename T>
+static void SetupRotVars(const T* rs, const unsigned rbg_w)
+{
+ const uint8 EffRPMD = ((BGON & 0x20) ? 0 : RPMD);
+
+ if(EffRPMD < 2)
+ {
+  for(unsigned x = 0; MDFN_LIKELY(x < rbg_w); x++)
+   LB.rotabsel[x] = RPMD;
+ }
+ else if(EffRPMD == 3)
+  GetWinRotAB();
+
+ //
+ //
+ //
+
+ for(unsigned i = 0; i < 2; i++)
+ {
+  auto& r = LB.rotv[i];
+
+  r.Xsp = rs[i].Xsp;
+  r.Ysp = rs[i].Ysp;
+  r.Xp = rs[i].Xp;
+  r.Yp = rs[i].Yp;
+  r.dX = rs[i].dX;
+  r.dY = rs[i].dY;
+  r.kx = rs[i].kx;
+  r.ky = rs[i].ky;
+
+  LB.rotv[i].tf.BMSCC = ((BMPNB >> 4) & 1);
+  LB.rotv[i].tf.BMSPR = ((BMPNB >> 5) & 1);
+  LB.rotv[i].tf.BMPalNo = ((BMPNB >> 0) & 0x7) << 4;
+  LB.rotv[i].tf.BMSize = ((CHCTLB >> 10) & 0x1);
+
+  //
+  //
+  //
+  //
+  //
+  //
+  if((BGON & 0x20) && i)
+  {
+   LB.rotv[1].tf.CRAOffs = CRAMAddrOffs_NBG[0] << 8;
+   LB.rotv[1].tf.PNDSize = (PNCN[0] >> 15) & 1;
+   LB.rotv[1].tf.CharSize = ((CHCTLA >> 0) & 1);
+   LB.rotv[1].tf.AuxMode = (PNCN[0] >> 14) & 1;
+   LB.rotv[1].tf.Supp = (PNCN[0] & 0x3FF);
+  }
+  else
+  {
+   LB.rotv[i].tf.CRAOffs = CRAMAddrOffs_RBG0 << 8;
+   LB.rotv[i].tf.PNDSize = (PNCNR >> 15) & 1;
+   LB.rotv[i].tf.CharSize = ((CHCTLB >> 8) & 1);
+   LB.rotv[i].tf.AuxMode = (PNCNR >> 14) & 1;
+   LB.rotv[i].tf.Supp = (PNCNR & 0x3FF);
+  }
+  LB.rotv[i].tf.PlaneSize = (PLSZ >> ( 8 + (i << 2))) & 0x3;
+  LB.rotv[i].tf.PlaneOver = (PLSZ >> (10 + (i << 2))) & 0x3;
+  LB.rotv[i].tf.PlaneOverChar = OVPNR[i];
+  LB.rotv[i].tf.Start(4 + i, !i && ((CHCTLB >> 9) & 1), (MPOFR >> (i << 2)) & 0x7, RotMapRegs[i]);
+ }
+
+ //
+ //
+ //
+ {
+  bool bank_tab[4];
+
+  for(unsigned i = 0; i < 4; i++)
+   bank_tab[i] = ((RDBS_Mode >> (i << 1)) & 0x3) == RDBS_COEFF;
+  //
+  if(!(VRAM_Mode & 0x1))
+   bank_tab[1] = bank_tab[0];
+
+  if(!(VRAM_Mode & 0x2))
+   bank_tab[3] = bank_tab[2];
+
+  if(BGON & 0x20)
+   bank_tab[2] = bank_tab[3] = false;
+  //
+  if(CRKTE)
+   bank_tab[0] = bank_tab[1] = bank_tab[2] = bank_tab[3] = true;
+  //
+  //
+  LB.rotv[0].use_coeff = (bool)(KTCTL[0] & 0x1);
+  LB.rotv[1].use_coeff = (bool)(KTCTL[1] & 0x1);
+
+  uint32 coeff[2];
+
+  for(unsigned i = 0; i < 2; i++)
+   LB.rotv[i].base_coeff = coeff[i] = ReadCoeff(i, GetCoeffAddr(i, rs[i].KAstAccum));
+
+  //if(grumpus == 120)
+  // printf("BankTab: %d %d %d %d, UC: %d %d, Coeff: @0x%05x=0x%08x @0x%05x=0x%08x, DKAx: %f %f\n", bank_tab[0], bank_tab[1], bank_tab[2], bank_tab[3], LB.rotv[0].use_coeff, LB.rotv[1].use_coeff, GetCoeffAddr(0, rs[0].KAstAccum), coeff[0], GetCoeffAddr(1, rs[1].KAstAccum), coeff[1], rs[0].DKAx / 1024.0, rs[1].DKAx / 1024.0);
+
+  for(unsigned x = 0; MDFN_LIKELY(x < rbg_w); x++)
+  {
+   const unsigned i = ((EffRPMD == 2) ? 0 : LB.rotabsel[x]);
+   const uint32 addr = GetCoeffAddr(i, rs[i].KAstAccum + (x * rs[i].DKAx));
+
+   if(bank_tab[addr >> 16])
+    coeff[i] = ReadCoeff(i, addr);
+
+   if(KTCTL[i] & 0x10)
+    LB.lc[x] = (coeff[i] >> 24) & 0x7F;
+
+   if(EffRPMD == 2)
+   {
+    uint32 tmp = coeff[0];
+
+    LB.rotabsel[x] = tmp >> 31;
+
+    if((int32)tmp < 0)
+     tmp = coeff[1];
+
+    LB.rotcoeff[x] = tmp;
+   }
+   else
+    LB.rotcoeff[x] = coeff[i];
+  }
+ }
+}
+
+// const bool TA_bmen = ((rn == 1) ? false : ((CHCTLB >> 9) & 1));
+template<bool TA_bmen, unsigned TA_bpp, bool TA_isrgb, bool TA_igntp, unsigned TA_PrioMode, unsigned TA_CCMode>
+static void T_DrawRBG(const bool rn, uint64* bgbuf, const unsigned w, const uint32 pix_base_or)
+{
+ // Full color format selection for both RBG0 and RBG1
+ // Bitmap only allowed for RBG0
+ // RBG0 can use rot param A and B, RBG1 is fixed to rot param B
+ // RBG1 shares setting bitfields with NBG0
+ // 16 planes instead of 4 like with NBG*
+ // Mosaic only has effect in the horizontal direction?
+ //
+ int16 sfcode_lut[8];
+
+ MakeSFCodeLUT<TA_PrioMode, TA_CCMode>((rn ? 0 : 4), sfcode_lut);
+
+ for(unsigned i = 0; MDFN_LIKELY(i < w); i++)
+ {
+  const unsigned ab = LB.rotabsel[i];
+  auto& r = LB.rotv[ab];
+  auto& tf = r.tf;
+  uint32 Xp = r.Xp;
+  int32 kx = r.kx;
+  int32 ky = r.ky;
+  bool rot_tp = false;
+
+  if(r.use_coeff)
+  {
+   const uint32 coeff = (rn ? r.base_coeff : LB.rotcoeff[i]);
+
+   rot_tp = ((int32)coeff < 0);
+
+   const uint32 sext = sign_x_to_s32(24, coeff);
+ 
+   switch((KTCTL[ab] >> 2) & 0x3)
+   {
+    case 0: kx = ky = sext; break;
+    case 1: kx = sext; break;
+    case 2: ky = sext; break;
+    case 3: Xp = sext << 2; break;
+   }
+  }
+
+  const uint32 ix = (  Xp + (uint32)(((int64)kx * (int32)(r.Xsp + (r.dX * i))) >> 16)) >> 10;
+  const uint32 iy = (r.Yp + (uint32)(((int64)ky * (int32)(r.Ysp + (r.dY * i))) >> 16)) >> 10;
+
+  rot_tp |= tf.Fetch<TA_bpp>(TA_bmen, ix, iy);
+
+  LB.rotabsel[i] = rot_tp;
+  //
+  //
+  //
+  bgbuf[i] = MakeNBGRBGPix<TA_bmen, TA_bpp, TA_isrgb, TA_igntp, TA_PrioMode, TA_CCMode>(tf, pix_base_or, sfcode_lut, ix, iy);
+ }
+}
+
+//template<unsigned TA_bpp, bool TA_isrgb, bool TA_igntp, unsigned TA_PrioMode, unsigned TA_CCMode>
+static void (*DrawRBG[2 /*bitmap enable*/][5/*col mode*/][2/*igntp*/][3/*priomode*/][4/*ccmode*/])(const bool rn, uint64* bgbuf, const unsigned w, const uint32 pix_base_or) =
+{
+ {
+  {  {  { T_DrawRBG<0, 4, 0, 0, 0, 0>, T_DrawRBG<0, 4, 0, 0, 0, 1>, T_DrawRBG<0, 4, 0, 0, 0, 2>, T_DrawRBG<0, 4, 0, 0, 0, 3>,  },  { T_DrawRBG<0, 4, 0, 0, 1, 0>, T_DrawRBG<0, 4, 0, 0, 1, 1>, T_DrawRBG<0, 4, 0, 0, 1, 2>, T_DrawRBG<0, 4, 0, 0, 1, 3>,  },  { T_DrawRBG<0, 4, 0, 0, 2, 0>, T_DrawRBG<0, 4, 0, 0, 2, 1>, T_DrawRBG<0, 4, 0, 0, 2, 2>, T_DrawRBG<0, 4, 0, 0, 2, 3>,  },  },  {  { T_DrawRBG<0, 4, 0, 1, 0, 0>, T_DrawRBG<0, 4, 0, 1, 0, 1>, T_DrawRBG<0, 4, 0, 1, 0, 2>, T_DrawRBG<0, 4, 0, 1, 0, 3>,  },  { T_DrawRBG<0, 4, 0, 1, 1, 0>, T_DrawRBG<0, 4, 0, 1, 1, 1>, T_DrawRBG<0, 4, 0, 1, 1, 2>, T_DrawRBG<0, 4, 0, 1, 1, 3>,  },  { T_DrawRBG<0, 4, 0, 1, 2, 0>, T_DrawRBG<0, 4, 0, 1, 2, 1>, T_DrawRBG<0, 4, 0, 1, 2, 2>, T_DrawRBG<0, 4, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<0, 8, 0, 0, 0, 0>, T_DrawRBG<0, 8, 0, 0, 0, 1>, T_DrawRBG<0, 8, 0, 0, 0, 2>, T_DrawRBG<0, 8, 0, 0, 0, 3>,  },  { T_DrawRBG<0, 8, 0, 0, 1, 0>, T_DrawRBG<0, 8, 0, 0, 1, 1>, T_DrawRBG<0, 8, 0, 0, 1, 2>, T_DrawRBG<0, 8, 0, 0, 1, 3>,  },  { T_DrawRBG<0, 8, 0, 0, 2, 0>, T_DrawRBG<0, 8, 0, 0, 2, 1>, T_DrawRBG<0, 8, 0, 0, 2, 2>, T_DrawRBG<0, 8, 0, 0, 2, 3>,  },  },  {  { T_DrawRBG<0, 8, 0, 1, 0, 0>, T_DrawRBG<0, 8, 0, 1, 0, 1>, T_DrawRBG<0, 8, 0, 1, 0, 2>, T_DrawRBG<0, 8, 0, 1, 0, 3>,  },  { T_DrawRBG<0, 8, 0, 1, 1, 0>, T_DrawRBG<0, 8, 0, 1, 1, 1>, T_DrawRBG<0, 8, 0, 1, 1, 2>, T_DrawRBG<0, 8, 0, 1, 1, 3>,  },  { T_DrawRBG<0, 8, 0, 1, 2, 0>, T_DrawRBG<0, 8, 0, 1, 2, 1>, T_DrawRBG<0, 8, 0, 1, 2, 2>, T_DrawRBG<0, 8, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<0, 16, 0, 0, 0, 0>, T_DrawRBG<0, 16, 0, 0, 0, 1>, T_DrawRBG<0, 16, 0, 0, 0, 2>, T_DrawRBG<0, 16, 0, 0, 0, 3>,  },  { T_DrawRBG<0, 16, 0, 0, 1, 0>, T_DrawRBG<0, 16, 0, 0, 1, 1>, T_DrawRBG<0, 16, 0, 0, 1, 2>, T_DrawRBG<0, 16, 0, 0, 1, 3>,  },  { T_DrawRBG<0, 16, 0, 0, 2, 0>, T_DrawRBG<0, 16, 0, 0, 2, 1>, T_DrawRBG<0, 16, 0, 0, 2, 2>, T_DrawRBG<0, 16, 0, 0, 2, 3>,  },  },  {  { T_DrawRBG<0, 16, 0, 1, 0, 0>, T_DrawRBG<0, 16, 0, 1, 0, 1>, T_DrawRBG<0, 16, 0, 1, 0, 2>, T_DrawRBG<0, 16, 0, 1, 0, 3>,  },  { T_DrawRBG<0, 16, 0, 1, 1, 0>, T_DrawRBG<0, 16, 0, 1, 1, 1>, T_DrawRBG<0, 16, 0, 1, 1, 2>, T_DrawRBG<0, 16, 0, 1, 1, 3>,  },  { T_DrawRBG<0, 16, 0, 1, 2, 0>, T_DrawRBG<0, 16, 0, 1, 2, 1>, T_DrawRBG<0, 16, 0, 1, 2, 2>, T_DrawRBG<0, 16, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<0, 16, 1, 0, 0, 0>, T_DrawRBG<0, 16, 1, 0, 0, 1>, T_DrawRBG<0, 16, 1, 0, 0, 2>, T_DrawRBG<0, 16, 1, 0, 0, 3>,  },  { T_DrawRBG<0, 16, 1, 0, 1, 0>, T_DrawRBG<0, 16, 1, 0, 1, 1>, T_DrawRBG<0, 16, 1, 0, 1, 2>, T_DrawRBG<0, 16, 1, 0, 1, 3>,  },  { T_DrawRBG<0, 16, 1, 0, 2, 0>, T_DrawRBG<0, 16, 1, 0, 2, 1>, T_DrawRBG<0, 16, 1, 0, 2, 2>, T_DrawRBG<0, 16, 1, 0, 2, 3>,  },  },  {  { T_DrawRBG<0, 16, 1, 1, 0, 0>, T_DrawRBG<0, 16, 1, 1, 0, 1>, T_DrawRBG<0, 16, 1, 1, 0, 2>, T_DrawRBG<0, 16, 1, 1, 0, 3>,  },  { T_DrawRBG<0, 16, 1, 1, 1, 0>, T_DrawRBG<0, 16, 1, 1, 1, 1>, T_DrawRBG<0, 16, 1, 1, 1, 2>, T_DrawRBG<0, 16, 1, 1, 1, 3>,  },  { T_DrawRBG<0, 16, 1, 1, 2, 0>, T_DrawRBG<0, 16, 1, 1, 2, 1>, T_DrawRBG<0, 16, 1, 1, 2, 2>, T_DrawRBG<0, 16, 1, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<0, 32, 1, 0, 0, 0>, T_DrawRBG<0, 32, 1, 0, 0, 1>, T_DrawRBG<0, 32, 1, 0, 0, 2>, T_DrawRBG<0, 32, 1, 0, 0, 3>,  },  { T_DrawRBG<0, 32, 1, 0, 1, 0>, T_DrawRBG<0, 32, 1, 0, 1, 1>, T_DrawRBG<0, 32, 1, 0, 1, 2>, T_DrawRBG<0, 32, 1, 0, 1, 3>,  },  { T_DrawRBG<0, 32, 1, 0, 2, 0>, T_DrawRBG<0, 32, 1, 0, 2, 1>, T_DrawRBG<0, 32, 1, 0, 2, 2>, T_DrawRBG<0, 32, 1, 0, 2, 3>,  },  },  {  { T_DrawRBG<0, 32, 1, 1, 0, 0>, T_DrawRBG<0, 32, 1, 1, 0, 1>, T_DrawRBG<0, 32, 1, 1, 0, 2>, T_DrawRBG<0, 32, 1, 1, 0, 3>,  },  { T_DrawRBG<0, 32, 1, 1, 1, 0>, T_DrawRBG<0, 32, 1, 1, 1, 1>, T_DrawRBG<0, 32, 1, 1, 1, 2>, T_DrawRBG<0, 32, 1, 1, 1, 3>,  },  { T_DrawRBG<0, 32, 1, 1, 2, 0>, T_DrawRBG<0, 32, 1, 1, 2, 1>, T_DrawRBG<0, 32, 1, 1, 2, 2>, T_DrawRBG<0, 32, 1, 1, 2, 3>,  },  },  },
+ },
+ {
+  {  {  { T_DrawRBG<1, 4, 0, 0, 0, 0>, T_DrawRBG<1, 4, 0, 0, 0, 1>, T_DrawRBG<1, 4, 0, 0, 0, 2>, T_DrawRBG<1, 4, 0, 0, 0, 3>,  },  { T_DrawRBG<1, 4, 0, 0, 1, 0>, T_DrawRBG<1, 4, 0, 0, 1, 1>, T_DrawRBG<1, 4, 0, 0, 1, 2>, T_DrawRBG<1, 4, 0, 0, 1, 3>,  },  { T_DrawRBG<1, 4, 0, 0, 2, 0>, T_DrawRBG<1, 4, 0, 0, 2, 1>, T_DrawRBG<1, 4, 0, 0, 2, 2>, T_DrawRBG<1, 4, 0, 0, 2, 3>,  },  },  {  { T_DrawRBG<1, 4, 0, 1, 0, 0>, T_DrawRBG<1, 4, 0, 1, 0, 1>, T_DrawRBG<1, 4, 0, 1, 0, 2>, T_DrawRBG<1, 4, 0, 1, 0, 3>,  },  { T_DrawRBG<1, 4, 0, 1, 1, 0>, T_DrawRBG<1, 4, 0, 1, 1, 1>, T_DrawRBG<1, 4, 0, 1, 1, 2>, T_DrawRBG<1, 4, 0, 1, 1, 3>,  },  { T_DrawRBG<1, 4, 0, 1, 2, 0>, T_DrawRBG<1, 4, 0, 1, 2, 1>, T_DrawRBG<1, 4, 0, 1, 2, 2>, T_DrawRBG<1, 4, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<1, 8, 0, 0, 0, 0>, T_DrawRBG<1, 8, 0, 0, 0, 1>, T_DrawRBG<1, 8, 0, 0, 0, 2>, T_DrawRBG<1, 8, 0, 0, 0, 3>,  },  { T_DrawRBG<1, 8, 0, 0, 1, 0>, T_DrawRBG<1, 8, 0, 0, 1, 1>, T_DrawRBG<1, 8, 0, 0, 1, 2>, T_DrawRBG<1, 8, 0, 0, 1, 3>,  },  { T_DrawRBG<1, 8, 0, 0, 2, 0>, T_DrawRBG<1, 8, 0, 0, 2, 1>, T_DrawRBG<1, 8, 0, 0, 2, 2>, T_DrawRBG<1, 8, 0, 0, 2, 3>,  },  },  {  { T_DrawRBG<1, 8, 0, 1, 0, 0>, T_DrawRBG<1, 8, 0, 1, 0, 1>, T_DrawRBG<1, 8, 0, 1, 0, 2>, T_DrawRBG<1, 8, 0, 1, 0, 3>,  },  { T_DrawRBG<1, 8, 0, 1, 1, 0>, T_DrawRBG<1, 8, 0, 1, 1, 1>, T_DrawRBG<1, 8, 0, 1, 1, 2>, T_DrawRBG<1, 8, 0, 1, 1, 3>,  },  { T_DrawRBG<1, 8, 0, 1, 2, 0>, T_DrawRBG<1, 8, 0, 1, 2, 1>, T_DrawRBG<1, 8, 0, 1, 2, 2>, T_DrawRBG<1, 8, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<1, 16, 0, 0, 0, 0>, T_DrawRBG<1, 16, 0, 0, 0, 1>, T_DrawRBG<1, 16, 0, 0, 0, 2>, T_DrawRBG<1, 16, 0, 0, 0, 3>,  },  { T_DrawRBG<1, 16, 0, 0, 1, 0>, T_DrawRBG<1, 16, 0, 0, 1, 1>, T_DrawRBG<1, 16, 0, 0, 1, 2>, T_DrawRBG<1, 16, 0, 0, 1, 3>,  },  { T_DrawRBG<1, 16, 0, 0, 2, 0>, T_DrawRBG<1, 16, 0, 0, 2, 1>, T_DrawRBG<1, 16, 0, 0, 2, 2>, T_DrawRBG<1, 16, 0, 0, 2, 3>,  },  },  {  { T_DrawRBG<1, 16, 0, 1, 0, 0>, T_DrawRBG<1, 16, 0, 1, 0, 1>, T_DrawRBG<1, 16, 0, 1, 0, 2>, T_DrawRBG<1, 16, 0, 1, 0, 3>,  },  { T_DrawRBG<1, 16, 0, 1, 1, 0>, T_DrawRBG<1, 16, 0, 1, 1, 1>, T_DrawRBG<1, 16, 0, 1, 1, 2>, T_DrawRBG<1, 16, 0, 1, 1, 3>,  },  { T_DrawRBG<1, 16, 0, 1, 2, 0>, T_DrawRBG<1, 16, 0, 1, 2, 1>, T_DrawRBG<1, 16, 0, 1, 2, 2>, T_DrawRBG<1, 16, 0, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<1, 16, 1, 0, 0, 0>, T_DrawRBG<1, 16, 1, 0, 0, 1>, T_DrawRBG<1, 16, 1, 0, 0, 2>, T_DrawRBG<1, 16, 1, 0, 0, 3>,  },  { T_DrawRBG<1, 16, 1, 0, 1, 0>, T_DrawRBG<1, 16, 1, 0, 1, 1>, T_DrawRBG<1, 16, 1, 0, 1, 2>, T_DrawRBG<1, 16, 1, 0, 1, 3>,  },  { T_DrawRBG<1, 16, 1, 0, 2, 0>, T_DrawRBG<1, 16, 1, 0, 2, 1>, T_DrawRBG<1, 16, 1, 0, 2, 2>, T_DrawRBG<1, 16, 1, 0, 2, 3>,  },  },  {  { T_DrawRBG<1, 16, 1, 1, 0, 0>, T_DrawRBG<1, 16, 1, 1, 0, 1>, T_DrawRBG<1, 16, 1, 1, 0, 2>, T_DrawRBG<1, 16, 1, 1, 0, 3>,  },  { T_DrawRBG<1, 16, 1, 1, 1, 0>, T_DrawRBG<1, 16, 1, 1, 1, 1>, T_DrawRBG<1, 16, 1, 1, 1, 2>, T_DrawRBG<1, 16, 1, 1, 1, 3>,  },  { T_DrawRBG<1, 16, 1, 1, 2, 0>, T_DrawRBG<1, 16, 1, 1, 2, 1>, T_DrawRBG<1, 16, 1, 1, 2, 2>, T_DrawRBG<1, 16, 1, 1, 2, 3>,  },  },  },
+  {  {  { T_DrawRBG<1, 32, 1, 0, 0, 0>, T_DrawRBG<1, 32, 1, 0, 0, 1>, T_DrawRBG<1, 32, 1, 0, 0, 2>, T_DrawRBG<1, 32, 1, 0, 0, 3>,  },  { T_DrawRBG<1, 32, 1, 0, 1, 0>, T_DrawRBG<1, 32, 1, 0, 1, 1>, T_DrawRBG<1, 32, 1, 0, 1, 2>, T_DrawRBG<1, 32, 1, 0, 1, 3>,  },  { T_DrawRBG<1, 32, 1, 0, 2, 0>, T_DrawRBG<1, 32, 1, 0, 2, 1>, T_DrawRBG<1, 32, 1, 0, 2, 2>, T_DrawRBG<1, 32, 1, 0, 2, 3>,  },  },  {  { T_DrawRBG<1, 32, 1, 1, 0, 0>, T_DrawRBG<1, 32, 1, 1, 0, 1>, T_DrawRBG<1, 32, 1, 1, 0, 2>, T_DrawRBG<1, 32, 1, 1, 0, 3>,  },  { T_DrawRBG<1, 32, 1, 1, 1, 0>, T_DrawRBG<1, 32, 1, 1, 1, 1>, T_DrawRBG<1, 32, 1, 1, 1, 2>, T_DrawRBG<1, 32, 1, 1, 1, 3>,  },  { T_DrawRBG<1, 32, 1, 1, 2, 0>, T_DrawRBG<1, 32, 1, 1, 2, 1>, T_DrawRBG<1, 32, 1, 1, 2, 2>, T_DrawRBG<1, 32, 1, 1, 2, 3>,  },  },  },
+ }
+};
+
+template<typename T>
+static INLINE void Doubleize(T* ptr, const int orig_len)
+{
+ for(int i = orig_len - 1; MDFN_LIKELY(i >= 0); i--)
+ {
+  auto tmp = *(ptr + i);
+
+  *(ptr + (i << 1) + 0) = tmp;
+  *(ptr + (i << 1) + 1) = tmp;
+ }
+}
+
+static void RBGPP(const unsigned layer, uint64* buf, const unsigned rbg_w)
+{
+ ApplyHMosaic(layer, buf, rbg_w);
+
+ for(unsigned i = 0; i < rbg_w; i++)
+ {
+  uint64 tmp = buf[i];
+
+  if(LB.rotabsel[i])
+   tmp &= ~(uint64)0xFFFFFFFF;
+
+  buf[i] = tmp;
+ }
+
+ if(HRes & 0x2)
+  Doubleize(buf, rbg_w);
+
+ ApplyWin(layer, buf);
+}
+
+// Call before DrawSpriteData()
+static INLINE void MakeSpriteCCLUT(void)
+{
+ const bool cce = ((CCCTL >> 6) & 1);
+
+ for(unsigned pr = 0; pr < 8; pr++)
+ {
+  bool mask = false;
+
+  switch(SpriteCCCond)
+  {
+   case 0: mask = (SpritePrioNum[pr] <= SpriteCCNum); break;
+   case 1: mask = (SpritePrioNum[pr] == SpriteCCNum); break;
+   case 2: mask = (SpritePrioNum[pr] >= SpriteCCNum); break;
+  }
+  SpriteCCLUT[pr] = (cce & mask) << PIX_CCE_SHIFT;
+ }
+
+ SpriteCC3Mask = 0;
+ if(SpriteCCCond == 3 && cce)
+  SpriteCC3Mask = 1U << PIX_CCE_SHIFT;
+}
+
+template<bool TA_HiRes, bool TA_TPShadSel, unsigned TA_SPCTL_Low>
+static void T_DrawSpriteData(const uint16* vdp1sb, const bool vdp1_hires8, unsigned w)
+{
+ const unsigned SpriteType = (TA_SPCTL_Low & 0xF);
+ const bool SpriteWinEn = (TA_SPCTL_Low & 0x10);
+ const bool SpriteColorMode = (TA_SPCTL_Low & 0x20);
+ //
+ const size_t cao = CRAMAddrOffs_Sprite << 8;
+ uint32 spix_base_or = 0;
+
+ spix_base_or |= ((ColorOffsEn >> 6) & 1) << PIX_COE_SHIFT;
+ spix_base_or |= ((ColorOffsSel >> 6) & 1) << PIX_COSEL_SHIFT;
+ spix_base_or |= ((LineColorEn >> 5/*5 here, not 6*/) & 1) << PIX_LCE_SHIFT;
+ spix_base_or |= (((CCCTL >> 12) & 0x7) == 0x0) << PIX_GRAD_SHIFT;
+ spix_base_or |= ((CCCTL >> 6) & 1) << PIX_LAYER_CCE_SHIFT;
+
+ for(unsigned i = 0; MDFN_LIKELY(i < w); i++)
+ {
+  unsigned src;
+  unsigned pr = 0, cc = 0;
+  bool tp = false;
+  uint64 spix;
+
+  src = vdp1sb[i >> TA_HiRes];
+
+  if(vdp1_hires8)
+  {
+   if(TA_HiRes)
+    src = 0xFF00 | (src >> (((i & 1) ^ 1) << 3));
+   else
+    src = 0xFF00 | (src >> 8);
+  }
+
+  if(SpriteColorMode && (src & 0x8000))
+  {
+   spix = (uint64)rgb15_to_rgb24(src) << PIX_RGB_SHIFT;
+   spix |= 1U << PIX_ISRGB_SHIFT;
+   spix |= SpriteCC3Mask;
+
+   if(SpriteType & 0x8)
+    tp = !(src & 0xFF);
+   else if(SpriteWinEn)
+   {
+    if(SpriteType >= 0x2 && SpriteType <= 0x7)
+     tp = !(src & 0x7FFF);
+   }
+  }
+  else
+  {
+   bool nshad = false;
+   bool sd = false;
+   unsigned dc;
+
+   if(SpriteType & 0x8)
+    src &= 0xFF;
+
+   tp = !src;
+
+   switch(SpriteType)
+   {
+     case 0x0:
+	pr = (src >> 14) & 0x3;
+	cc = (src >> 11) & 0x7;
+	dc = src & 0x7FF;
+	nshad = (dc == 0x7FE);
+	break;
+
+     case 0x1:
+	pr = (src >> 13) & 0x7;
+	cc = (src >> 11) & 0x3;
+	dc = src & 0x7FF;
+	nshad = (dc == 0x7FE);
+	break;
+
+     case 0x2:
+	sd = (src >> 15) & 0x1;
+	pr = (src >> 14) & 0x1;
+	cc = (src >> 11) & 0x7;
+	dc = src & 0x7FF;
+	nshad = (dc == 0x7FE);
+	break;
+
+     case 0x3:
+	sd = (src >> 15) & 0x1;
+	pr = (src >> 13) & 0x3;
+	cc = (src >> 11) & 0x3;
+	dc = src & 0x7FF;
+	nshad = (dc == 0x7FE);
+	break;
+
+     case 0x4:
+	sd = (src >> 15) & 0x1;
+	pr = (src >> 13) & 0x3;
+	cc = (src >> 10) & 0x7;
+	dc = src & 0x3FF;
+	nshad = (dc == 0x3FE);
+	break;
+
+     case 0x5:
+	sd = (src >> 15) & 0x1;
+	pr = (src >> 12) & 0x7;
+	cc = (src >> 11) & 0x1;
+	dc = src & 0x7FF;
+	nshad = (dc == 0x7FE);
+	break;
+
+     case 0x6:
+	sd = (src >> 15) & 0x1;
+	pr = (src >> 12) & 0x7;
+	cc = (src >> 10) & 0x3;
+	dc = src & 0x3FF;
+	nshad = (dc == 0x3FE);
+	break;
+
+     case 0x7:
+	sd = (src >> 15) & 0x1;
+	pr = (src >> 12) & 0x7;
+	cc = (src >>  9) & 0x7;
+	dc = src & 0x1FF;
+	nshad = (dc == 0x1FE);
+	break;
+     //
+     //
+     //
+     case 0x8:
+	pr = (src >> 7) & 0x1;
+	dc = src & 0x7F;
+	nshad = (dc == 0x7E);
+	break;
+
+     case 0x9:
+	pr = (src >> 7) & 0x1;
+	cc = (src >> 6) & 0x1;
+	dc = src & 0x3F;
+	nshad = (dc == 0x3E);
+	break;
+
+     case 0xA:
+	pr = (src >> 6) & 0x3;
+	dc = src & 0x3F;
+	nshad = (dc == 0x3E);
+	break;
+
+     case 0xB:
+	cc = (src >> 6) & 0x3;
+	dc = src & 0x3F;
+	nshad = (dc == 0x3E);
+	break;
+     //
+     case 0xC:
+	pr = (src >> 7) & 0x1;
+	dc = src & 0xFF;
+	nshad = (dc == 0xFE);
+	break;
+
+     case 0xD:
+	pr = (src >> 7) & 0x1;
+	cc = (src >> 6) & 0x1;
+	dc = src & 0xFF;
+	nshad = (dc == 0xFE);
+	break;
+
+     case 0xE:
+	pr = (src >> 6) & 0x3;
+	dc = src & 0xFF;
+	nshad = (dc == 0xFE);
+	break;
+
+     case 0xF:
+	cc = (src >> 6) & 0x3;
+	dc = src & 0xFF;
+	nshad = (dc == 0xFE);
+	break;
+   }
+   //
+   //
+   //
+   uint32 rgb24 = ColorCache[(cao + dc) & 0x7FF];
+
+   spix = (uint64)rgb24 << PIX_RGB_SHIFT;
+
+   spix |= ((int32)rgb24 >> 31) & SpriteCC3Mask;
+
+   if(SpriteWinEn)	// Sprite window enable
+    spix |= ((uint64)sd << PIX_SWBIT_SHIFT);
+
+   if(nshad)
+    spix |= 1 << PIX_DOSHAD_SHIFT;
+   else
+   {
+    if(SpriteWinEn)
+    {
+     if(SpriteType >= 0x2 && SpriteType <= 0x7)
+      tp = !(src & 0x7FFF);
+    }
+    else if(sd)
+    {
+     if(src & 0x7FFF)
+      spix |= 1 << PIX_SELFSHAD_SHIFT;
+     else if(TA_TPShadSel)
+      spix |= 1 << PIX_DOSHAD_SHIFT;
+     else
+      tp = true;
+    }
+   }
+  }
+
+  spix |= spix_base_or;
+  spix |= (tp ? 0 : SpritePrioNum[pr]) << PIX_PRIO_SHIFT;
+  spix |= SpriteCCRatio[cc] << PIX_CCRATIO_SHIFT;
+  spix |= SpriteCCLUT[pr];
+
+  LB.spr[i] = spix;
+ }
+}
+
+static void (*DrawSpriteData[2][2][0x40])(const uint16* vdp1sb, const bool vdp1_hires8, unsigned w) =
+{
+ {
+  { T_DrawSpriteData<0, 0, 0x00>, T_DrawSpriteData<0, 0, 0x01>, T_DrawSpriteData<0, 0, 0x02>, T_DrawSpriteData<0, 0, 0x03>, T_DrawSpriteData<0, 0, 0x04>, T_DrawSpriteData<0, 0, 0x05>, T_DrawSpriteData<0, 0, 0x06>, T_DrawSpriteData<0, 0, 0x07>, T_DrawSpriteData<0, 0, 0x08>, T_DrawSpriteData<0, 0, 0x09>, T_DrawSpriteData<0, 0, 0x0a>, T_DrawSpriteData<0, 0, 0x0b>, T_DrawSpriteData<0, 0, 0x0c>, T_DrawSpriteData<0, 0, 0x0d>, T_DrawSpriteData<0, 0, 0x0e>, T_DrawSpriteData<0, 0, 0x0f>, T_DrawSpriteData<0, 0, 0x10>, T_DrawSpriteData<0, 0, 0x11>, T_DrawSpriteData<0, 0, 0x12>, T_DrawSpriteData<0, 0, 0x13>, T_DrawSpriteData<0, 0, 0x14>, T_DrawSpriteData<0, 0, 0x15>, T_DrawSpriteData<0, 0, 0x16>, T_DrawSpriteData<0, 0, 0x17>, T_DrawSpriteData<0, 0, 0x18>, T_DrawSpriteData<0, 0, 0x19>, T_DrawSpriteData<0, 0, 0x1a>, T_DrawSpriteData<0, 0, 0x1b>, T_DrawSpriteData<0, 0, 0x1c>, T_DrawSpriteData<0, 0, 0x1d>, T_DrawSpriteData<0, 0, 0x1e>, T_DrawSpriteData<0, 0, 0x1f>, T_DrawSpriteData<0, 0, 0x20>, T_DrawSpriteData<0, 0, 0x21>, T_DrawSpriteData<0, 0, 0x22>, T_DrawSpriteData<0, 0, 0x23>, T_DrawSpriteData<0, 0, 0x24>, T_DrawSpriteData<0, 0, 0x25>, T_DrawSpriteData<0, 0, 0x26>, T_DrawSpriteData<0, 0, 0x27>, T_DrawSpriteData<0, 0, 0x28>, T_DrawSpriteData<0, 0, 0x29>, T_DrawSpriteData<0, 0, 0x2a>, T_DrawSpriteData<0, 0, 0x2b>, T_DrawSpriteData<0, 0, 0x2c>, T_DrawSpriteData<0, 0, 0x2d>, T_DrawSpriteData<0, 0, 0x2e>, T_DrawSpriteData<0, 0, 0x2f>, T_DrawSpriteData<0, 0, 0x30>, T_DrawSpriteData<0, 0, 0x31>, T_DrawSpriteData<0, 0, 0x32>, T_DrawSpriteData<0, 0, 0x33>, T_DrawSpriteData<0, 0, 0x34>, T_DrawSpriteData<0, 0, 0x35>, T_DrawSpriteData<0, 0, 0x36>, T_DrawSpriteData<0, 0, 0x37>, T_DrawSpriteData<0, 0, 0x38>, T_DrawSpriteData<0, 0, 0x39>, T_DrawSpriteData<0, 0, 0x3a>, T_DrawSpriteData<0, 0, 0x3b>, T_DrawSpriteData<0, 0, 0x3c>, T_DrawSpriteData<0, 0, 0x3d>, T_DrawSpriteData<0, 0, 0x3e>, T_DrawSpriteData<0, 0, 0x3f> },
+  { T_DrawSpriteData<0, 1, 0x00>, T_DrawSpriteData<0, 1, 0x01>, T_DrawSpriteData<0, 1, 0x02>, T_DrawSpriteData<0, 1, 0x03>, T_DrawSpriteData<0, 1, 0x04>, T_DrawSpriteData<0, 1, 0x05>, T_DrawSpriteData<0, 1, 0x06>, T_DrawSpriteData<0, 1, 0x07>, T_DrawSpriteData<0, 1, 0x08>, T_DrawSpriteData<0, 1, 0x09>, T_DrawSpriteData<0, 1, 0x0a>, T_DrawSpriteData<0, 1, 0x0b>, T_DrawSpriteData<0, 1, 0x0c>, T_DrawSpriteData<0, 1, 0x0d>, T_DrawSpriteData<0, 1, 0x0e>, T_DrawSpriteData<0, 1, 0x0f>, T_DrawSpriteData<0, 1, 0x10>, T_DrawSpriteData<0, 1, 0x11>, T_DrawSpriteData<0, 1, 0x12>, T_DrawSpriteData<0, 1, 0x13>, T_DrawSpriteData<0, 1, 0x14>, T_DrawSpriteData<0, 1, 0x15>, T_DrawSpriteData<0, 1, 0x16>, T_DrawSpriteData<0, 1, 0x17>, T_DrawSpriteData<0, 1, 0x18>, T_DrawSpriteData<0, 1, 0x19>, T_DrawSpriteData<0, 1, 0x1a>, T_DrawSpriteData<0, 1, 0x1b>, T_DrawSpriteData<0, 1, 0x1c>, T_DrawSpriteData<0, 1, 0x1d>, T_DrawSpriteData<0, 1, 0x1e>, T_DrawSpriteData<0, 1, 0x1f>, T_DrawSpriteData<0, 1, 0x20>, T_DrawSpriteData<0, 1, 0x21>, T_DrawSpriteData<0, 1, 0x22>, T_DrawSpriteData<0, 1, 0x23>, T_DrawSpriteData<0, 1, 0x24>, T_DrawSpriteData<0, 1, 0x25>, T_DrawSpriteData<0, 1, 0x26>, T_DrawSpriteData<0, 1, 0x27>, T_DrawSpriteData<0, 1, 0x28>, T_DrawSpriteData<0, 1, 0x29>, T_DrawSpriteData<0, 1, 0x2a>, T_DrawSpriteData<0, 1, 0x2b>, T_DrawSpriteData<0, 1, 0x2c>, T_DrawSpriteData<0, 1, 0x2d>, T_DrawSpriteData<0, 1, 0x2e>, T_DrawSpriteData<0, 1, 0x2f>, T_DrawSpriteData<0, 1, 0x30>, T_DrawSpriteData<0, 1, 0x31>, T_DrawSpriteData<0, 1, 0x32>, T_DrawSpriteData<0, 1, 0x33>, T_DrawSpriteData<0, 1, 0x34>, T_DrawSpriteData<0, 1, 0x35>, T_DrawSpriteData<0, 1, 0x36>, T_DrawSpriteData<0, 1, 0x37>, T_DrawSpriteData<0, 1, 0x38>, T_DrawSpriteData<0, 1, 0x39>, T_DrawSpriteData<0, 1, 0x3a>, T_DrawSpriteData<0, 1, 0x3b>, T_DrawSpriteData<0, 1, 0x3c>, T_DrawSpriteData<0, 1, 0x3d>, T_DrawSpriteData<0, 1, 0x3e>, T_DrawSpriteData<0, 1, 0x3f> },
+ },
+ {
+  { T_DrawSpriteData<1, 0, 0x00>, T_DrawSpriteData<1, 0, 0x01>, T_DrawSpriteData<1, 0, 0x02>, T_DrawSpriteData<1, 0, 0x03>, T_DrawSpriteData<1, 0, 0x04>, T_DrawSpriteData<1, 0, 0x05>, T_DrawSpriteData<1, 0, 0x06>, T_DrawSpriteData<1, 0, 0x07>, T_DrawSpriteData<1, 0, 0x08>, T_DrawSpriteData<1, 0, 0x09>, T_DrawSpriteData<1, 0, 0x0a>, T_DrawSpriteData<1, 0, 0x0b>, T_DrawSpriteData<1, 0, 0x0c>, T_DrawSpriteData<1, 0, 0x0d>, T_DrawSpriteData<1, 0, 0x0e>, T_DrawSpriteData<1, 0, 0x0f>, T_DrawSpriteData<1, 0, 0x10>, T_DrawSpriteData<1, 0, 0x11>, T_DrawSpriteData<1, 0, 0x12>, T_DrawSpriteData<1, 0, 0x13>, T_DrawSpriteData<1, 0, 0x14>, T_DrawSpriteData<1, 0, 0x15>, T_DrawSpriteData<1, 0, 0x16>, T_DrawSpriteData<1, 0, 0x17>, T_DrawSpriteData<1, 0, 0x18>, T_DrawSpriteData<1, 0, 0x19>, T_DrawSpriteData<1, 0, 0x1a>, T_DrawSpriteData<1, 0, 0x1b>, T_DrawSpriteData<1, 0, 0x1c>, T_DrawSpriteData<1, 0, 0x1d>, T_DrawSpriteData<1, 0, 0x1e>, T_DrawSpriteData<1, 0, 0x1f>, T_DrawSpriteData<1, 0, 0x20>, T_DrawSpriteData<1, 0, 0x21>, T_DrawSpriteData<1, 0, 0x22>, T_DrawSpriteData<1, 0, 0x23>, T_DrawSpriteData<1, 0, 0x24>, T_DrawSpriteData<1, 0, 0x25>, T_DrawSpriteData<1, 0, 0x26>, T_DrawSpriteData<1, 0, 0x27>, T_DrawSpriteData<1, 0, 0x28>, T_DrawSpriteData<1, 0, 0x29>, T_DrawSpriteData<1, 0, 0x2a>, T_DrawSpriteData<1, 0, 0x2b>, T_DrawSpriteData<1, 0, 0x2c>, T_DrawSpriteData<1, 0, 0x2d>, T_DrawSpriteData<1, 0, 0x2e>, T_DrawSpriteData<1, 0, 0x2f>, T_DrawSpriteData<1, 0, 0x30>, T_DrawSpriteData<1, 0, 0x31>, T_DrawSpriteData<1, 0, 0x32>, T_DrawSpriteData<1, 0, 0x33>, T_DrawSpriteData<1, 0, 0x34>, T_DrawSpriteData<1, 0, 0x35>, T_DrawSpriteData<1, 0, 0x36>, T_DrawSpriteData<1, 0, 0x37>, T_DrawSpriteData<1, 0, 0x38>, T_DrawSpriteData<1, 0, 0x39>, T_DrawSpriteData<1, 0, 0x3a>, T_DrawSpriteData<1, 0, 0x3b>, T_DrawSpriteData<1, 0, 0x3c>, T_DrawSpriteData<1, 0, 0x3d>, T_DrawSpriteData<1, 0, 0x3e>, T_DrawSpriteData<1, 0, 0x3f> },
+  { T_DrawSpriteData<1, 1, 0x00>, T_DrawSpriteData<1, 1, 0x01>, T_DrawSpriteData<1, 1, 0x02>, T_DrawSpriteData<1, 1, 0x03>, T_DrawSpriteData<1, 1, 0x04>, T_DrawSpriteData<1, 1, 0x05>, T_DrawSpriteData<1, 1, 0x06>, T_DrawSpriteData<1, 1, 0x07>, T_DrawSpriteData<1, 1, 0x08>, T_DrawSpriteData<1, 1, 0x09>, T_DrawSpriteData<1, 1, 0x0a>, T_DrawSpriteData<1, 1, 0x0b>, T_DrawSpriteData<1, 1, 0x0c>, T_DrawSpriteData<1, 1, 0x0d>, T_DrawSpriteData<1, 1, 0x0e>, T_DrawSpriteData<1, 1, 0x0f>, T_DrawSpriteData<1, 1, 0x10>, T_DrawSpriteData<1, 1, 0x11>, T_DrawSpriteData<1, 1, 0x12>, T_DrawSpriteData<1, 1, 0x13>, T_DrawSpriteData<1, 1, 0x14>, T_DrawSpriteData<1, 1, 0x15>, T_DrawSpriteData<1, 1, 0x16>, T_DrawSpriteData<1, 1, 0x17>, T_DrawSpriteData<1, 1, 0x18>, T_DrawSpriteData<1, 1, 0x19>, T_DrawSpriteData<1, 1, 0x1a>, T_DrawSpriteData<1, 1, 0x1b>, T_DrawSpriteData<1, 1, 0x1c>, T_DrawSpriteData<1, 1, 0x1d>, T_DrawSpriteData<1, 1, 0x1e>, T_DrawSpriteData<1, 1, 0x1f>, T_DrawSpriteData<1, 1, 0x20>, T_DrawSpriteData<1, 1, 0x21>, T_DrawSpriteData<1, 1, 0x22>, T_DrawSpriteData<1, 1, 0x23>, T_DrawSpriteData<1, 1, 0x24>, T_DrawSpriteData<1, 1, 0x25>, T_DrawSpriteData<1, 1, 0x26>, T_DrawSpriteData<1, 1, 0x27>, T_DrawSpriteData<1, 1, 0x28>, T_DrawSpriteData<1, 1, 0x29>, T_DrawSpriteData<1, 1, 0x2a>, T_DrawSpriteData<1, 1, 0x2b>, T_DrawSpriteData<1, 1, 0x2c>, T_DrawSpriteData<1, 1, 0x2d>, T_DrawSpriteData<1, 1, 0x2e>, T_DrawSpriteData<1, 1, 0x2f>, T_DrawSpriteData<1, 1, 0x30>, T_DrawSpriteData<1, 1, 0x31>, T_DrawSpriteData<1, 1, 0x32>, T_DrawSpriteData<1, 1, 0x33>, T_DrawSpriteData<1, 1, 0x34>, T_DrawSpriteData<1, 1, 0x35>, T_DrawSpriteData<1, 1, 0x36>, T_DrawSpriteData<1, 1, 0x37>, T_DrawSpriteData<1, 1, 0x38>, T_DrawSpriteData<1, 1, 0x39>, T_DrawSpriteData<1, 1, 0x3a>, T_DrawSpriteData<1, 1, 0x3b>, T_DrawSpriteData<1, 1, 0x3c>, T_DrawSpriteData<1, 1, 0x3d>, T_DrawSpriteData<1, 1, 0x3e>, T_DrawSpriteData<1, 1, 0x3f> },
+ }
+};
+
+// Don't change these constants without also updating the template variable
+// setup for the call into MixIt(and the contents of MixIt itself...).
+enum
+{
+ MIXIT_SPECIAL_NONE = 0x0,
+ MIXIT_SPECIAL_GRAD = 0x1,
+ MIXIT_SPECIAL_EXCC_CRAM0 = 0x2,
+ MIXIT_SPECIAL_EXCC_CRAM12 = 0x3,
+ MIXIT_SPECIAL_EXCC_LINE_CRAM0 = 0x4,
+ MIXIT_SPECIAL_EXCC_LINE_CRAM12 = 0x5
+};
+
+template<bool TA_rbg1en, unsigned TA_Special, bool TA_CCRTMD, bool TA_CCMD>
+static void T_MixIt(uint32* target, const unsigned vdp2_line, const unsigned w, const uint32 back_rgb24, const uint64* blursrc)
+{
+ //printf("MixIt: %d, %d, %d, %d\n", TA_rbg1en, TA_Special, TA_CCRTMD, TA_CCMD);
+ const uint32* lclut = &ColorCache[CurLCColor &~ 0x7F];
+ uint32 blurprev[2];
+
+ if(TA_Special == MIXIT_SPECIAL_GRAD)
+  blurprev[0] = blurprev[1] = *blursrc >> PIX_RGB_SHIFT;
+
+ uint32 line_pix_l;
+ {
+  line_pix_l = 0U << PIX_ISRGB_SHIFT;
+  line_pix_l |= LineColorCCRatio << PIX_CCRATIO_SHIFT;
+  line_pix_l |= ((CCCTL >> 5) & 1) << PIX_CCE_SHIFT;
+  line_pix_l |= ((CCCTL >> 5) & 1) << PIX_LAYER_CCE_SHIFT;
+ }
+
+ //
+ //
+ uint64 back_pix;
+ {
+  back_pix = (uint64)back_rgb24 << PIX_RGB_SHIFT;
+  back_pix |= 1U << PIX_ISRGB_SHIFT;
+  back_pix |= ((ColorOffsEn >> 5) & 1) << PIX_COE_SHIFT;
+  back_pix |= ((ColorOffsSel >> 5) & 1) << PIX_COSEL_SHIFT;
+  back_pix |= ((SDCTL >> 5) & 1) << PIX_SHADEN_SHIFT;
+  back_pix |= BackCCRatio << PIX_CCRATIO_SHIFT;
+ }
+
+ for(uint32 i = 0; MDFN_LIKELY(i < w); i++)
+ {
+  uint64 pix = back_pix;
+  uint32 blurcake;
+
+  //
+  // Listed from lowest priority to greatest priority when prio levels are equal(back pixel has prio level of 0,
+  // and should display on "top" of any other layers).
+  //
+  uint64 tmp_pix[8] =
+  {
+   (TA_rbg1en ? 0 : (LB.nbg[3] + 8)[i]),
+   (TA_rbg1en ? 0 : (LB.nbg[2] + 8)[i]),
+   (TA_rbg1en ? 0 : (LB.nbg[1] + 8)[i]),
+   (LB.nbg[0] + 8)[i],
+   LB.rbg0[i],
+   LB.spr[i],
+   0/*null pixel*/,
+   back_pix
+  };
+  uint64 pt;
+  unsigned st;
+
+  pt  = 0x01ULL << (uint8)(tmp_pix[0] >> PIX_PRIO_TEST_SHIFT);
+  pt |= 0x02ULL << (uint8)(tmp_pix[1] >> PIX_PRIO_TEST_SHIFT);
+  pt |= 0x04ULL << (uint8)(tmp_pix[2] >> PIX_PRIO_TEST_SHIFT);
+  pt |= 0x08ULL << (uint8)(tmp_pix[3] >> PIX_PRIO_TEST_SHIFT);
+  pt |= 0x10ULL << (uint8)(tmp_pix[4] >> PIX_PRIO_TEST_SHIFT);
+  pt |= 0x20ULL << (uint8)(tmp_pix[5] >> PIX_PRIO_TEST_SHIFT);
+  pt |= 0xC0ULL; // Back pixel(0x80) and null pixel(0x40)
+
+  st = 63 ^ MDFN_lzcount64_0UD(pt);
+  pt ^= 1ULL << st;
+  pt |= 0x40;	// Restore the null!
+  pix = tmp_pix[st & 0x7];
+
+  if(pix & (1U << PIX_DOSHAD_SHIFT))
+  {
+   st = 63 ^ MDFN_lzcount64_0UD(pt);
+   pt ^= 1ULL << st;
+   pt |= 0x40;	// Restore the null!
+   pix = tmp_pix[st & 0x7];
+   pix |= (1U << PIX_DOSHAD_SHIFT);
+  }
+
+  if(TA_Special == MIXIT_SPECIAL_GRAD)
+  {
+   const uint32 blurpie = blursrc[i] >> PIX_RGB_SHIFT;
+
+   blurcake = ((blurprev[0] + blurprev[1]) - ((blurprev[0] ^ blurprev[1]) & 0x01010101)) >> 1;
+   blurcake = ((blurcake + blurpie) - ((blurcake ^ blurpie) & 0x01010101)) >> 1;
+   blurprev[0] = blurprev[1];
+   blurprev[1] = blurpie;
+  }
+
+  //
+  // Color calculation
+  //
+  if(pix & (1U << PIX_CCE_SHIFT))
+  {
+   uint64 pix2, pix3;
+
+   st = 63 ^ MDFN_lzcount64_0UD(pt);
+   pt ^= 1ULL << st;
+   pt |= 0x40;	// Restore the null!
+   pix2 = tmp_pix[st & 0x7];
+
+   st = 63 ^ MDFN_lzcount64_0UD(pt);
+   pt ^= 1ULL << st;
+   pt |= 0x40;	// Restore the null!
+   pix3 = tmp_pix[st & 0x7];
+
+   if(TA_Special == MIXIT_SPECIAL_GRAD)
+   {
+    if((pix | pix2) & (1U << PIX_GRAD_SHIFT))
+     pix2 = (uint32)pix2 | ((uint64)blurcake << PIX_RGB_SHIFT);	// Be sure to preserve the color calc ratio, at least.
+   }
+   else if(pix & (1U << PIX_LCE_SHIFT))
+   {
+    //
+    // Line color
+    //
+    const uint64 pix4 = pix3;
+    const uint32 line_pix_rgb = lclut[LB.lc[i]];
+    pix3 = pix2;
+    pix2 = line_pix_l | ((uint64)line_pix_rgb << PIX_RGB_SHIFT);
+
+    if(TA_Special == MIXIT_SPECIAL_EXCC_LINE_CRAM0)
+    {
+     uint32 sec_rgb = line_pix_rgb;
+     uint32 third_rgb = (pix3 >> PIX_RGB_SHIFT);
+
+     if(pix3 & (1U << PIX_LAYER_CCE_SHIFT))
+      third_rgb = (third_rgb >> 1) & 0x7F7F7F;
+
+     sec_rgb = ((sec_rgb + third_rgb) - ((sec_rgb ^ third_rgb) & 0x01010101)) >> 1;
+     pix2 = (uint32)pix2 | ((uint64)sec_rgb << PIX_RGB_SHIFT);
+    }
+    else if(TA_Special == MIXIT_SPECIAL_EXCC_LINE_CRAM12)
+    {
+     uint32 sec_rgb = line_pix_rgb;
+     uint32 third_rgb = (pix3 >> PIX_RGB_SHIFT);
+
+     if(pix3 & (1U << PIX_ISRGB_SHIFT))
+     {
+      if((pix3 & (1U << PIX_LAYER_CCE_SHIFT)) && (pix4 & (1U << PIX_ISRGB_SHIFT)))
+      {
+       const uint32 fourth_rgb = (pix4 >> PIX_RGB_SHIFT);
+       third_rgb = ((third_rgb + fourth_rgb) - ((third_rgb ^ fourth_rgb) & 0x01010101)) >> 1;
+      }
+
+      sec_rgb = ((sec_rgb + third_rgb) - ((sec_rgb ^ third_rgb) & 0x01010101)) >> 1;
+      pix2 = (uint32)pix2 | ((uint64)sec_rgb << PIX_RGB_SHIFT);
+     }
+    }
+   }
+   else
+   {
+    if(TA_Special == MIXIT_SPECIAL_EXCC_CRAM0 || TA_Special == MIXIT_SPECIAL_EXCC_CRAM12 || TA_Special == MIXIT_SPECIAL_EXCC_LINE_CRAM0 || TA_Special == MIXIT_SPECIAL_EXCC_LINE_CRAM12)
+    {
+     if(pix2 & (1U << PIX_LAYER_CCE_SHIFT))
+     {
+      if(TA_Special == MIXIT_SPECIAL_EXCC_CRAM0 || TA_Special == MIXIT_SPECIAL_EXCC_LINE_CRAM0 || (pix3 & (1U << PIX_ISRGB_SHIFT)))
+      {
+       uint32 sec_rgb = pix2 >> PIX_RGB_SHIFT;
+       const uint32 third_rgb = (pix3 >> PIX_RGB_SHIFT);
+
+       sec_rgb = ((sec_rgb + third_rgb) - ((sec_rgb ^ third_rgb) & 0x01010101)) >> 1;
+       pix2 = (uint32)pix2 | ((uint64)sec_rgb << PIX_RGB_SHIFT);
+      }
+     }
+    }
+   }
+
+   uint32 fore_rgb = pix >> PIX_RGB_SHIFT;
+   uint32 sec_rgb = pix2 >> PIX_RGB_SHIFT;
+   uint32 new_rgb;
+
+   if(TA_CCMD)	// Ignore ratio, add as-is.
+   {
+    new_rgb =  std::min<unsigned>(0x0000FF, (fore_rgb & 0x0000FF) + (sec_rgb & 0x0000FF));
+    new_rgb |= std::min<unsigned>(0x00FF00, (fore_rgb & 0x00FF00) + (sec_rgb & 0x00FF00));
+    new_rgb |= std::min<unsigned>(0xFF0000, (fore_rgb & 0xFF0000) + (sec_rgb & 0xFF0000));
+   }
+   else
+   {
+    unsigned fore_ratio = ((uint32)(TA_CCRTMD ? pix2 : pix) >> PIX_CCRATIO_SHIFT) ^ 0x1F;
+    unsigned sec_ratio = 0x20 - fore_ratio;
+
+    new_rgb =  ((((fore_rgb & 0x0000FF) * fore_ratio) + ((sec_rgb & 0x0000FF) * sec_ratio)) >> 5);
+    new_rgb |= ((((fore_rgb & 0x00FF00) * fore_ratio) + ((sec_rgb & 0x00FF00) * sec_ratio)) >> 5) & 0x00FF00;
+    new_rgb |= ((((fore_rgb & 0xFF0000) * fore_ratio) + ((sec_rgb & 0xFF0000) * sec_ratio)) >> 5) & 0xFF0000;
+   }
+   pix = ((uint64)new_rgb << 32) | (uint32)pix;
+  }
+
+  //
+  // Color offset
+  //
+  if(pix & (1U << PIX_COE_SHIFT))
+  {
+   const unsigned sel = (pix >> PIX_COSEL_SHIFT) & 1;
+   const uint32 rgb_tmp = pix >> PIX_RGB_SHIFT;
+   int32 rt, gt, bt;
+
+   rt = ColorOffs[sel][0] + (rgb_tmp & 0x000000FF);
+   if(rt < 0) rt = 0;
+   if(rt & 0x00000100) rt = 0x000000FF;
+
+   gt = ColorOffs[sel][1] + (rgb_tmp & 0x0000FF00);
+   if(gt < 0) gt = 0;
+   if(gt & 0x00010000) gt = 0x0000FF00;
+
+   bt = ColorOffs[sel][2] + (rgb_tmp & 0x00FF0000);
+   if(bt < 0) bt = 0;
+   if(bt & 0x01000000) bt = 0x00FF0000;
+
+   pix = (uint32)pix | ((uint64)(uint32)(rt | gt | bt) << PIX_RGB_SHIFT);
+  }
+
+  //
+  // Sprite shadow
+  //
+  if((uint8)pix >= PIX_SHADHALVTEST8_VAL)
+   pix = (uint32)pix | ((pix >> 1) & 0x7F7F7F00000000ULL);
+
+  target[i] = pix >> PIX_RGB_SHIFT;
+ }
+}
+
+//template<bool TA_rbg1en, unsigned TA_Special, bool TA_CCRTMD, bool TA_CCMD>
+static void (*MixIt[2][6][2][2])(uint32* target, const unsigned vdp2_line, const unsigned w, const uint32 back_rgb24, const uint64* blursrc) =
+{
+ {  {  { T_MixIt<0, 0, 0, 0>, T_MixIt<0, 0, 0, 1>,  },  { T_MixIt<0, 0, 1, 0>, T_MixIt<0, 0, 1, 1>,  },  },  {  { T_MixIt<0, 1, 0, 0>, T_MixIt<0, 1, 0, 1>,  },  { T_MixIt<0, 1, 1, 0>, T_MixIt<0, 1, 1, 1>,  },  },  {  { T_MixIt<0, 2, 0, 0>, T_MixIt<0, 2, 0, 1>,  },  { T_MixIt<0, 2, 1, 0>, T_MixIt<0, 2, 1, 1>,  },  },  {  { T_MixIt<0, 3, 0, 0>, T_MixIt<0, 3, 0, 1>,  },  { T_MixIt<0, 3, 1, 0>, T_MixIt<0, 3, 1, 1>,  },  },  {  { T_MixIt<0, 4, 0, 0>, T_MixIt<0, 4, 0, 1>,  },  { T_MixIt<0, 4, 1, 0>, T_MixIt<0, 4, 1, 1>,  },  },  {  { T_MixIt<0, 5, 0, 0>, T_MixIt<0, 5, 0, 1>,  },  { T_MixIt<0, 5, 1, 0>, T_MixIt<0, 5, 1, 1>,  },  },  },
+ {  {  { T_MixIt<1, 0, 0, 0>, T_MixIt<1, 0, 0, 1>,  },  { T_MixIt<1, 0, 1, 0>, T_MixIt<1, 0, 1, 1>,  },  },  {  { T_MixIt<1, 1, 0, 0>, T_MixIt<1, 1, 0, 1>,  },  { T_MixIt<1, 1, 1, 0>, T_MixIt<1, 1, 1, 1>,  },  },  {  { T_MixIt<1, 2, 0, 0>, T_MixIt<1, 2, 0, 1>,  },  { T_MixIt<1, 2, 1, 0>, T_MixIt<1, 2, 1, 1>,  },  },  {  { T_MixIt<1, 3, 0, 0>, T_MixIt<1, 3, 0, 1>,  },  { T_MixIt<1, 3, 1, 0>, T_MixIt<1, 3, 1, 1>,  },  },  {  { T_MixIt<1, 4, 0, 0>, T_MixIt<1, 4, 0, 1>,  },  { T_MixIt<1, 4, 1, 0>, T_MixIt<1, 4, 1, 1>,  },  },  {  { T_MixIt<1, 5, 0, 0>, T_MixIt<1, 5, 0, 1>,  },  { T_MixIt<1, 5, 1, 0>, T_MixIt<1, 5, 1, 1>,  },  },  },
+};
+
+static int32 ApplyHBlend(uint32* const target, int32 w)
+{
+ #define BHALF(m, n) ((((uint64)(m) + (n)) - (((m) ^ (n)) & 0x01010101)) >> 1)
+
+ assert(w >= 4);
+
+#if 1
+ if(!(HRes & 0x2))
+ {
+  target[(w - 1) * 2 + 1] = target[w - 1];
+  target[(w - 1) * 2 + 0] = BHALF(BHALF(target[w - 2], target[w - 1]), target[w - 1]);
+
+  for(int32 x = w - 2; x > 0; x--)
+  {
+   uint32 ptxm1 = target[x - 1];
+   uint32 ptx = target[x];
+   uint32 ptxp1 = target[x + 1];
+   uint32 ptxm1_ptx = BHALF(ptxm1, ptx);
+   uint32 ptx_ptxp1 = BHALF(ptx, ptxp1);
+
+   target[x * 2 + 0] = BHALF(ptxm1_ptx, ptx);
+   target[x * 2 + 1] = BHALF(ptx_ptxp1, ptx);
+  }
+
+  target[1] = BHALF(BHALF(target[0], target[1]), target[0]);
+  target[0] = target[0];
+
+  return w << 1;
+ }
+ else
+#else
+ if(!(HRes & 0x2))
+ {
+  for(int32 x = w - 1; x >= 0; x--)
+   target[x * 2 + 0] = target[x * 2 + 1] = target[x];
+
+  w <<= 1;
+ }
+#endif
+ {
+  uint32 a = target[0];
+  for(int32 x = 0; x < w - 1; x++)
+  {
+   uint32 b = target[x];
+   uint32 c = target[x + 1];
+   uint32 ac = BHALF(a, c);
+   uint32 bac = BHALF(b, ac);
+
+   target[x] = bac;
+   a = b;
+  }
+  return w;
+ }
+ #undef BHALF
+}
+
+static void ReorderRGB(uint32* target, const unsigned w, const unsigned Rshift, const unsigned Gshift, const unsigned Bshift)
+{
+ assert(!(w & 1));
+ uint32* const bound = target + w;
+
+ while(MDFN_LIKELY(target != bound))
+ {
+  const uint32 tmp0 = target[0];
+  const uint32 tmp1 = target[1];
+
+  target[0] = ((uint8)(tmp0 >>  0) << Rshift) |
+	      ((uint8)(tmp0 >>  8) << Gshift) |
+	      ((uint8)(tmp0 >> 16) << Bshift);
+
+  target[1] = ((uint8)(tmp1 >>  0) << Rshift) |
+	      ((uint8)(tmp1 >>  8) << Gshift) |
+	      ((uint8)(tmp1 >> 16) << Bshift);
+
+  target += 2;
+ }
+}
+
+static NO_INLINE void DrawLine(const uint16 out_line, const uint16 vdp2_line, const bool field)
+{
+ uint32* target;
+ const int32 tvdw = ((!CorrectAspect || Clock28M) ? 352 : 330) << ((HRes & 0x2) >> 1);
+ const unsigned rbg_w = ((HRes & 0x1) ? 352 : 320);
+ const unsigned w = ((HRes & 0x1) ? 352 : 320) << ((HRes & 0x2) >> 1);
+ const int32 tvxo = std::max<int32>(0, (int32)(tvdw - w) >> 1);
+ uint32 back_rgb24;
+ uint32 border_ncf;
+
+ target = espec->surface->pixels + out_line * espec->surface->pitchinpix;
+ espec->LineWidths[out_line] = tvdw;
+
+ if(!ShowHOverscan)
+ {
+  const int32 ntdw = tvdw * 1024 / 1056;
+  const int32 tadj = std::max<int32>(0, espec->DisplayRect.x - ((tvdw - ntdw) >> 1));
+
+  //if(out_line == 100)
+  // printf("tvdw=%d, ntdw=%d, tadj=%d --- tvdw+tadj=%d\n", tvdw, ntdw, tadj, tvdw + tadj);
+
+  assert((tvdw + tadj) <= 704);
+
+  target += tadj;
+  espec->LineWidths[out_line] = ntdw;
+ }
+
+ //
+ // FIXME: Timing
+ //
+ if(vdp2_line == 0)
+ {
+  CurBackTabAddr = (BKTA & 0x7FFFF) + ((BKTA & 0x80000000) && InterlaceMode == IM_DOUBLE && field);
+  CurLCTabAddr = (LCTA & 0x7FFFF) + ((LCTA & 0x80000000) && InterlaceMode == IM_DOUBLE && field);
+
+  for(unsigned n = 0; n < 2; n++)
+  {
+   YCoordAccum[n] = (InterlaceMode == IM_DOUBLE && field) ? YCoordInc[n] : 0;
+
+   CurLSA[n] = LineScrollAddr[n];
+
+   if(InterlaceMode == IM_DOUBLE && field)
+   {
+    const uint8 sc = (SCRCTL >> (n << 3));
+    const uint8 lss = ((sc >> 4) & 0x3);
+
+    if(!lss)
+     CurLSA[n] += ((bool)(sc & 0x2) + (bool)(sc & 0x4) + (bool)(sc & 0x8)) << 1;
+   }
+   //
+   //
+   NBG23_YCounter[n & 1] = YScrollI[2 + n];
+  }
+
+  for(unsigned d = 0; d < 2; d++)
+  {
+   Window[d].CurLineWinAddr = Window[d].LineWinAddr;
+
+   if(InterlaceMode == IM_DOUBLE && field)
+    Window[d].CurLineWinAddr += 2;
+  }
+
+  MosaicVCount = 0;
+ }
+
+ if(vdp2_line != 0xFFFF)
+ {
+  CurBackColor = VRAM[CurBackTabAddr & 0x3FFFF] & 0x7FFF;
+
+  if(BKTA & 0x80000000)
+   CurBackTabAddr += 1 << (InterlaceMode == IM_DOUBLE);
+  //
+  CurLCColor = VRAM[CurLCTabAddr & 0x3FFFF] & 0x07FF;
+  if(LCTA & 0x80000000)
+   CurLCTabAddr += 1 << (InterlaceMode == IM_DOUBLE);
+ }
+
+ back_rgb24 = rgb15_to_rgb24(CurBackColor);
+
+ if(BorderMode)
+  border_ncf = espec->surface->MakeColor((uint8)(back_rgb24 >> 0), (uint8)(back_rgb24 >> 8), (uint8)(back_rgb24 >> 16));
+ else
+  border_ncf = espec->surface->MakeColor(0, 0, 0);
+
+ if(vdp2_line == 0xFFFF)
+ {
+  for(int32 i = 0; i < tvdw; i++)
+   target[i] = border_ncf;
+ }
+ else
+ {
+  //
+  // Line scroll
+  //
+  const unsigned ls_comp_line = vdp2_line << (InterlaceMode == IM_DOUBLE);
+
+  for(unsigned n = 0; n < 2; n++)
+  {
+   const uint8 sc = (SCRCTL >> (n << 3));
+   const uint8 lss = ((sc >> 4) & 0x3);
+
+   if((ls_comp_line & ((1 << lss) - 1)) == 0)
+   {
+    if(sc & 0x2)	// X
+    {
+     CurXScrollIF[n] = (VRAM[CurLSA[n] & 0x3FFFF] & 0x7FF) << 8;
+     CurLSA[n]++;
+     CurXScrollIF[n] |= VRAM[CurLSA[n] & 0x3FFFF] >> 8;
+     CurLSA[n]++;
+
+     CurXScrollIF[n] += (XScrollI[n] << 8) + XScrollF[n];
+    }
+
+    if(sc & 0x4) // Y
+    {
+     YCoordAccum[n] = 0;	// Don't (InterlaceMode == IM_DOUBLE && field)
+     //
+     CurYScrollIF[n] = (VRAM[CurLSA[n] & 0x3FFFF] & 0x7FF) << 8;
+     CurLSA[n]++;
+     CurYScrollIF[n] |= VRAM[CurLSA[n] & 0x3FFFF] >> 8;
+     CurLSA[n]++;
+
+     CurYScrollIF[n] += (YScrollI[n] << 8) + YScrollF[n];
+     //printf("%d %d %08x: %08x \n", vdp2_line, n, CurLSA[n], CurYScrollIF[n]);
+    }
+ 
+    if(sc & 0x8) // X zoom
+    {
+     CurXCoordInc[n] = (VRAM[CurLSA[n] & 0x3FFFF] & 0x7) << 8;
+     CurLSA[n]++;
+     CurXCoordInc[n] |= VRAM[CurLSA[n] & 0x3FFFF] >> 8;
+     CurLSA[n]++;
+    }
+
+    if(InterlaceMode == IM_DOUBLE && !lss)
+     CurLSA[n] += ((bool)(sc & 0x2) + (bool)(sc & 0x4) + (bool)(sc & 0x8)) << 1;
+   }
+
+   if(!(sc & 0x2))
+    CurXScrollIF[n] = (XScrollI[n] << 8) + XScrollF[n];
+
+   if(!(sc & 0x4))
+    CurYScrollIF[n] = (YScrollI[n] << 8) + YScrollF[n];
+
+   if(!(sc & 0x8))
+    CurXCoordInc[n] = XCoordInc[n];
+  }
+
+  //
+  // Line Window
+  //
+  {
+   for(unsigned d = 0; d < 2; d++)
+   {
+    if(Window[d].LineWinEn)
+    {
+     const uint16* vrt = &VRAM[Window[d].CurLineWinAddr & 0x3FFFE];
+
+     Window[d].XStart = vrt[0] & 0x3FF;
+     Window[d].XEnd = vrt[1] & 0x3FF;
+
+     //printf("LWin %d, %d(%08x): %04x %04x\n", vdp2_line, d, Window[d].CurLineWinAddr & 0x3FFFE, vrt[0], vrt[1]);
+    }
+    //
+    //
+    //
+    int32 xs = Window[d].XStart, xe = Window[d].XEnd;
+
+    // FIXME: Kludge, until we can figure out what's going on.
+    if(xs >= 0x380)
+     xs = 0;
+
+    // FIXME: Kludge, until we can figure out what's going on.
+    if(xe >= 0x380)
+    {
+     xs = 2;
+     xe = 0;
+    }
+
+    if(!(HRes & 0x2))
+    {
+     xs >>= 1;
+     xe >>= 1;
+    }
+    Window[d].CurXStart = xs;
+    Window[d].CurXEnd = xe;
+
+    Window[d].CurLineWinAddr += 2 << (InterlaceMode == IM_DOUBLE);
+
+    Window[d].YMet = LIB[vdp2_line].win_ymet[d];
+    //
+    //
+    //
+   }
+
+   //
+   //
+   //
+   WinPieces[0] = Window[0].CurXStart;
+   WinPieces[1] = Window[0].CurXEnd + 1;
+   WinPieces[2] = Window[1].CurXStart;
+   WinPieces[3] = Window[1].CurXEnd + 1;
+   WinPieces[4] = w;
+
+   for(unsigned piece = 0; piece < WinPieces.size(); piece++)
+    WinPieces[piece] = std::min<unsigned>(w, WinPieces[piece]);	// Almost forgot to do this...
+
+   std::sort(WinPieces.begin(), WinPieces.end());
+  }
+
+  //
+  //
+  //
+  if(vdp2_line == 64)
+  {
+   //printf("%d:%d, %d:%d (%d) --- %d:%d, %d:%d (%d)\n", Window[0].XStart, Window[0].YStart, Window[0].XEnd, Window[0].YEnd, Window[0].LineWinEn, Window[1].XStart, Window[1].YStart, Window[1].XEnd, Window[1].YEnd, Window[1].LineWinEn);
+   //printf("SPCTL_Low: %02x, SDCTL: %03x, SpriteCCCond: %01x, CCNum: %01x -- %01x %01x %01x %01x %01x %01x %01x %01x \n", SPCTL_Low, SDCTL, SpriteCCCond, SpriteCCNum, SpriteCCRatio[0], SpriteCCRatio[1], SpriteCCRatio[2], SpriteCCRatio[3], SpriteCCRatio[4], SpriteCCRatio[5], SpriteCCRatio[6], SpriteCCRatio[7]);
+   //printf("WinControl[WINLAYER_CC]=%02x\n", WinControl[WINLAYER_CC]);
+  }
+
+  //
+  // Process sprite data before NBG0-3 and RBG0-1, but defer applying the window until after NBG and RBG are handled(so the sprite window
+  // bit in the sprite linebuffer data isn't trashed prematurely).
+  //
+  if(MDFN_LIKELY(UserLayerEnableMask & (1U << 6)))
+  {
+   MakeSpriteCCLUT();
+   DrawSpriteData[(HRes & 0x2) >> 0x1][(SDCTL >> 8) & 0x1][SPCTL_Low](LIB[vdp2_line].vdp1_line, LIB[vdp2_line].vdp1_hires8, w);
+  }
+  else
+   MDFN_FastArraySet(LB.spr, 0, w);
+  //
+  //
+  //
+  //
+  //
+  //
+  //
+  if(BGON & 0x30)
+  {
+   MDFN_FastArraySet(LB.lc, CurLCColor & 0x7F, rbg_w);
+   SetupRotVars(LIB[vdp2_line].rv, rbg_w);
+   if(HRes & 0x2)
+    Doubleize(LB.lc, rbg_w);
+
+   // RBG0
+   if(MDFN_LIKELY(UserLayerEnableMask & 0x10))
+   {
+    const bool igntp = (BGON >> 12) & 1;
+    const bool bmen = (CHCTLB >> 9) & 1;
+    const unsigned colornum = std::min<unsigned>(4, (CHCTLB >> 12) & 0x7);	// TODO: Test 5 ... 7
+    const unsigned priomode = (SFPRMD >> 8) & 0x3;
+    const unsigned ccmode = (CCCTL & 0x10) ? ((SFCCMD >> 8) & 0x3) : 0;
+    const uint32 prio = RBG0PrioNum;
+    uint32 pix_base_or;
+
+    pix_base_or = ((colornum >= 3) << PIX_ISRGB_SHIFT);
+    pix_base_or |= ((ColorOffsEn >> 4) & 1) << PIX_COE_SHIFT;
+    pix_base_or |= ((ColorOffsSel >> 4) & 1) << PIX_COSEL_SHIFT;
+    pix_base_or |= ((LineColorEn >> 4) & 1) << PIX_LCE_SHIFT;
+    pix_base_or |= RBG0CCRatio << PIX_CCRATIO_SHIFT;
+    pix_base_or |= (((CCCTL >> 12) & 0x7) == 0x1) << PIX_GRAD_SHIFT;
+    pix_base_or |= ((CCCTL >> 4) & 1) << PIX_LAYER_CCE_SHIFT;
+    pix_base_or |= ((SDCTL >> 4) & 1) << PIX_SHADEN_SHIFT;
+
+    if(ccmode == 0)
+     pix_base_or |= ((CCCTL >> 4) & 1) << PIX_CCE_SHIFT;
+
+    if(priomode >= 1)
+     pix_base_or |= ((prio &~ 1) << PIX_PRIO_SHIFT);
+    else
+     pix_base_or |= (prio << PIX_PRIO_SHIFT);
+
+    DrawRBG[bmen][colornum][igntp][priomode % 3][ccmode](0, LB.rbg0, rbg_w, pix_base_or);
+    RBGPP(4, LB.rbg0, rbg_w);
+   }
+   else
+    MDFN_FastArraySet(LB.rbg0, 0, w);
+
+   // RBG1
+   if(BGON & UserLayerEnableMask & 0x20)
+   {
+    const bool igntp = (BGON >> 8) & 1;
+    const unsigned colornum = std::min<unsigned>(4, (CHCTLA >> 4) & 0x7);	// TODO: Test 5 ... 7
+    const unsigned priomode = (SFPRMD >> 0) & 0x3;
+    const unsigned ccmode = (CCCTL & 0x01) ? ((SFCCMD >> 0) & 0x3) : 0;
+    const uint32 prio = NBGPrioNum[0];
+    uint32 pix_base_or;
+
+    pix_base_or = (false << PIX_ISRGB_SHIFT);
+    pix_base_or |= ((ColorOffsEn >> 0) & 1) << PIX_COE_SHIFT;
+    pix_base_or |= ((ColorOffsSel >> 0) & 1) << PIX_COSEL_SHIFT;
+    pix_base_or |= ((LineColorEn >> 0) & 1) << PIX_LCE_SHIFT;
+    pix_base_or |= NBGCCRatio[0] << PIX_CCRATIO_SHIFT;
+    pix_base_or |= (((CCCTL >> 12) & 0x7) == 0x2) << PIX_GRAD_SHIFT;
+    pix_base_or |= ((CCCTL >> 0) & 1) << PIX_LAYER_CCE_SHIFT;
+    pix_base_or |= ((SDCTL >> 0) & 1) << PIX_SHADEN_SHIFT;
+
+    if(ccmode == 0)
+     pix_base_or |= ((CCCTL >> 0) & 1) << PIX_CCE_SHIFT;
+
+    if(priomode >= 1)
+     pix_base_or |= ((prio &~ 1) << PIX_PRIO_SHIFT);
+    else
+     pix_base_or |= (prio << PIX_PRIO_SHIFT);
+
+    MDFN_FastArraySet(LB.rotabsel, 1, rbg_w);
+    DrawRBG[false][colornum][igntp][priomode % 3][ccmode](1, LB.nbg[0] + 8, rbg_w, pix_base_or);
+    RBGPP(0, LB.nbg[0] + 8, rbg_w);
+   }
+   else if(BGON & 0x20)
+    MDFN_FastArraySet(LB.nbg[0] + 8, 0, w);
+  }
+  else
+  {
+   MDFN_FastArraySet(LB.lc, CurLCColor & 0x7F, w);
+   MDFN_FastArraySet(LB.rbg0, 0, w);
+  }
+  //
+  //
+  //
+  for(unsigned n = 0; n < 4; n++)
+  {
+   if(!MosaicVCount || !(MZCTL & (1U << n)))
+   {
+    if(n < 2)
+    {
+     MosEff_YCoordAccum[n] = YCoordAccum[n];	// Don't + (InterlaceMode == IM_DOUBLE && field)
+    }
+    else
+    {
+     MosEff_NBG23_YCounter[n & 1] = NBG23_YCounter[n & 1] + (InterlaceMode == IM_DOUBLE && field);
+    }
+   }
+  }
+
+  if(SCRCTL & 0x0101)
+   FetchVCScroll(w);	// Call after handling line scroll, and before DrawNBG() stuff
+
+  if(!(BGON & 0x20))
+  {
+   for(unsigned n = 0; n < 4; n++)
+   {
+    if(((BGON >> n) & 1) && MDFN_LIKELY((UserLayerEnableMask >> n) & 1))
+    {
+     const bool igntp = (BGON >> (n + 8)) & 1;
+     bool bmen = false;
+     unsigned colornum;
+     unsigned priomode;
+     unsigned ccmode;
+
+     if(n < 2)
+     {
+      const unsigned nshift = (n & 1) << 3;
+
+      bmen = (CHCTLA >> (1 + nshift)) & 1;
+      colornum = (CHCTLA >> (4 + nshift)) & (n ? 0x3 : 0x7);
+     }
+     else	// n >= 2
+     {
+      const unsigned nshift = (n & 1) << 2;
+
+      colornum = (CHCTLB >> (1 + nshift)) & 1;
+     }
+
+     if(colornum > 4) // TODO: test 5 ... 7
+      colornum = 4;
+
+     priomode = (SFPRMD >> (n << 1)) & 0x3;
+     ccmode = (SFCCMD >> (n << 1)) & 0x3;
+     if(!((CCCTL >> n) & 1))
+      ccmode = 0;
+     //
+     //
+     const uint32 prio = NBGPrioNum[n];
+     uint32 pix_base_or;
+
+     pix_base_or = ((colornum >= 3) << PIX_ISRGB_SHIFT);
+     pix_base_or |= ((ColorOffsEn >> n) & 1) << PIX_COE_SHIFT;
+     pix_base_or |= ((ColorOffsSel >> n) & 1) << PIX_COSEL_SHIFT;
+     pix_base_or |= ((LineColorEn >> n) & 1) << PIX_LCE_SHIFT;
+     pix_base_or |= NBGCCRatio[n] << PIX_CCRATIO_SHIFT;
+     pix_base_or |= (((CCCTL >> 12) & 0x7) == (3 + n - !n)) << PIX_GRAD_SHIFT;
+     pix_base_or |= ((CCCTL >> n) & 1) << PIX_LAYER_CCE_SHIFT;
+     pix_base_or |= ((SDCTL >> n) & 1) << PIX_SHADEN_SHIFT;
+
+     if(ccmode == 0)
+      pix_base_or |= ((CCCTL >> n) & 1) << PIX_CCE_SHIFT;
+
+     if(priomode >= 1)
+      pix_base_or |= ((prio &~ 1) << PIX_PRIO_SHIFT);
+     else
+      pix_base_or |= (prio << PIX_PRIO_SHIFT);
+
+     if(n < 2)
+      DrawNBG[bmen][colornum][igntp][priomode % 3][ccmode](n, LB.nbg[n] + 8, w, pix_base_or);
+     else
+      DrawNBG23[colornum][igntp][priomode % 3][ccmode](n, LB.nbg[n] + 8, w, pix_base_or);
+
+     ApplyHMosaic(n, LB.nbg[n] + 8, w);
+     ApplyWin(n, LB.nbg[n] + 8);
+    }
+    else
+     MDFN_FastArraySet(LB.nbg[n] + 8, 0, w);
+   }
+  }
+
+  //
+  //
+  //
+  //
+  //
+  // Apply window to sprite linebuffer after BG layers have windows applied.
+  ApplyWin(WINLAYER_SPRITE, LB.spr);
+
+  //
+  for(int32 i = 0; i < tvxo; i++)
+   target[i] = border_ncf;
+
+  for(int32 i = tvxo + w; i < tvdw; i++)
+   target[i] = border_ncf;
+
+  {
+   const bool rbg1en = (bool)(BGON & 0x20);
+   unsigned special = MIXIT_SPECIAL_NONE;
+   const bool CCRTMD = (bool)(CCCTL & 0x0200);
+   const bool CCMD = (bool)(CCCTL & 0x0100);
+   static const uint64* blurremap[8] = { LB.spr, LB.rbg0, LB.nbg[0] + 8, /*Dummy:*/LB.spr,
+					 LB.nbg[1] + 8, LB.nbg[2] + 8, LB.nbg[3] + 8, /*Dummy:*/LB.spr
+				       };
+   const uint64* blursrc = blurremap[(CCCTL >> 12) & 0x7];
+
+   if(!(HRes & 0x6))
+   {
+    if(CCCTL & 0x8000)
+    {
+     if(CRAM_Mode == 0)
+      special = MIXIT_SPECIAL_GRAD;
+    }
+    else if(CCCTL & 0x0400)
+    {
+     special = 0x2;
+     special += (bool)CRAM_Mode;
+     special += (CCCTL >> 4) & 0x2;
+    }
+   }
+   MixIt[rbg1en][special][CCRTMD][CCMD](target + tvxo, vdp2_line, w, back_rgb24, blursrc);
+   ReorderRGB(target + tvxo, w, espec->surface->format.Rshift, espec->surface->format.Gshift, espec->surface->format.Bshift);
+  }
+
+  //
+  //
+  //
+  // FIXME: Timing
+  //
+  for(unsigned n = 0; n < 2; n++)
+  {
+   YCoordAccum[n] += YCoordInc[n] << (InterlaceMode == IM_DOUBLE);
+   NBG23_YCounter[n & 1] += 1 << (InterlaceMode == IM_DOUBLE);
+  }
+
+  if(MosaicVCount >= ((MZCTL >> 12) & 0xF))
+   MosaicVCount = 0;
+  else
+   MosaicVCount++;
+ }
+
+ //
+ //
+ //
+ if(DoHBlend)
+ {
+  espec->LineWidths[out_line] = ApplyHBlend(espec->surface->pixels + out_line * espec->surface->pitchinpix + espec->DisplayRect.x, espec->LineWidths[out_line]);
+
+  // Kind of late, but meh. ;p
+  assert((espec->DisplayRect.x + espec->LineWidths[out_line]) <= 704);
+ }
+}
+
+//
+//
+//
+static MThreading::Thread* RThread = NULL;
+
+enum
+{
+ COMMAND_WRITE8 = 0,
+ COMMAND_WRITE16,
+
+ COMMAND_DRAW_LINE,
+
+ COMMAND_SET_LEM,
+
+ COMMAND_SET_BUSYWAIT,
+
+ COMMAND_RESET,
+ COMMAND_EXIT
+};
+
+struct WQ_Entry
+{
+ uint16 Command;
+ uint16 Arg16;
+ uint32 Arg32;
+};
+
+static std::array<WQ_Entry, 0x80000> WQ;
+static size_t WQ_ReadPos, WQ_WritePos;
+static std::atomic_int_least32_t WQ_InCount;
+static std::atomic_int_least32_t DrawCounter;
+static bool DoBusyWait;
+static MThreading::Sem* WakeupSem;
+static bool DoWakeupIfNecessary;
+
+static INLINE void WWQ(uint16 command, uint32 arg32 = 0, uint16 arg16 = 0)
+{
+ while(MDFN_UNLIKELY(WQ_InCount.load(std::memory_order_acquire) == WQ.size()))
+  Time::SleepMS(1);
+
+ WQ_Entry* wqe = &WQ[WQ_WritePos];
+
+ wqe->Command = command;
+ wqe->Arg16 = arg16;
+ wqe->Arg32 = arg32;
+
+ WQ_WritePos = (WQ_WritePos + 1) % WQ.size();
+ WQ_InCount.fetch_add(1, std::memory_order_release);
+}
+
+static int RThreadEntry(void* data)
+{
+ bool Running = true;
+
+ while(MDFN_LIKELY(Running))
+ {
+  while(MDFN_UNLIKELY(WQ_InCount.load(std::memory_order_acquire) == 0))
+  {
+   if(!DoBusyWait)
+    MThreading::WaitSemTimeout(WakeupSem, 1);
+   else
+   {
+#ifdef MDFN_SS_BUSYWAIT_PAUSE
+    asm volatile("pause\n\tpause\n\tpause\n\tpause\n\tpause\n\tpause\n\tpause\n\t");
+#else
+    for(int i = 1000; i; i--)
+    {
+     #ifdef _MSC_VER
+     __nop();
+     #else
+     asm volatile("nop\n\t");
+     #endif
+    }
+#endif
+   }
+  }
+  //
+  //
+  //
+  WQ_Entry* wqe = &WQ[WQ_ReadPos];
+
+  switch(wqe->Command)
+  {
+   case COMMAND_WRITE8:
+	MemW<uint8>(wqe->Arg32, wqe->Arg16);
+	break;
+
+   case COMMAND_WRITE16:
+	MemW<uint16>(wqe->Arg32, wqe->Arg16);
+	break;
+
+   case COMMAND_DRAW_LINE:
+	//for(unsigned i = 0; i < 2; i++)
+	DrawLine((uint16)wqe->Arg32, wqe->Arg32 >> 16, wqe->Arg16);
+	//
+	DrawCounter.fetch_sub(1, std::memory_order_release);
+	break;
+
+   case COMMAND_RESET:
+	Reset(wqe->Arg32);
+	break;
+
+   case COMMAND_SET_LEM:
+	UserLayerEnableMask = wqe->Arg32;
+	break;
+
+   case COMMAND_SET_BUSYWAIT:
+	DoBusyWait = wqe->Arg32;
+	break;
+
+   case COMMAND_EXIT:
+	Running = false;
+	break;
+  }
+  //
+  //
+  //
+  WQ_ReadPos = (WQ_ReadPos + 1) % WQ.size();
+  WQ_InCount.fetch_sub(1, std::memory_order_release);
+ }
+
+ return 0;
+}
+
+
+//
+//
+//
+//
+//
+void VDP2REND_Init(const bool IsPAL)
+{
+ PAL = IsPAL;
+ VisibleLines = PAL ? 288 : 240;
+ //
+ UserLayerEnableMask = ~0U;
+ Clock28M = false;
+ //
+ WQ_ReadPos = 0;
+ WQ_WritePos = 0;
+ WQ_InCount.store(0, std::memory_order_release); 
+ DrawCounter.store(0, std::memory_order_release);
+
+ WakeupSem = MThreading::CreateSem();
+ RThread = MThreading::CreateThread(RThreadEntry, NULL, "MDFN VDP2 Render");
+ #ifdef MDFN_SS_VDP2_THREAD_AFFINITY
+ MThreading::SetAffinity(RThread, MDFN_SS_VDP2_THREAD_AFFINITY);
+ #endif
+}
+
+// Needed for ss.correct_aspect == 0
+void VDP2REND_GetGunXTranslation(const bool clock28m, float* scale, float* offs)
+{
+ *scale = 1.0;
+ *offs = 0.0;
+
+ if(!CorrectAspect && !clock28m)
+ {
+  *scale = 65.0 / 61.0;
+  *offs = -(21472 - (21472.0 / 65 * 61)) * 0.5;
+ }
+}
+
+void VDP2REND_SetGetVideoParams(MDFNGI* gi, const bool caspect, const int sls, const int sle, const bool show_h_overscan, const bool dohblend)
+{
+ CorrectAspect = caspect;
+ ShowHOverscan = show_h_overscan;
+ DoHBlend = dohblend;
+ LineVisFirst = sls;
+ LineVisLast = sle;
+ //
+ //
+ //
+ gi->fb_width = 704;
+
+ if(PAL)
+ {
+  gi->nominal_width = (ShowHOverscan ? 365 : 354);
+  gi->fb_height = 576;
+ }
+ else
+ {
+  gi->nominal_width = (ShowHOverscan ? 302 : 292);
+  gi->fb_height = 480;
+ }
+ gi->nominal_height = LineVisLast + 1 - LineVisFirst;
+
+ gi->lcm_width = (ShowHOverscan? 10560 : 10240);
+ gi->lcm_height = (LineVisLast + 1 - LineVisFirst) * 2;
+
+ gi->mouse_scale_x = (float)(ShowHOverscan? 21472 : 20821);
+ gi->mouse_offs_x = (float)(ShowHOverscan? 0 : 651) / 2;
+ gi->mouse_scale_y = gi->nominal_height;
+ gi->mouse_offs_y = LineVisFirst;
+ //
+ //
+ //
+ if(!CorrectAspect)
+ {
+  gi->nominal_width = (ShowHOverscan ? 352 : 341);
+  gi->lcm_width = gi->nominal_width * 2;
+
+  gi->mouse_scale_x = (float)(ShowHOverscan? 21472 : 20821);
+  gi->mouse_offs_x = (float)(ShowHOverscan? 0 : 651) / 2;
+ }
+}
+
+void VDP2REND_Kill(void)
+{
+ if(RThread != NULL)
+ {
+  WWQ(COMMAND_EXIT);
+  MThreading::WaitThread(RThread, NULL);
+ }
+
+ if(WakeupSem != NULL)
+ {
+  MThreading::DestroySem(WakeupSem);
+  WakeupSem = NULL;
+ }
+}
+
+void VDP2REND_StartFrame(EmulateSpecStruct* espec_arg, const bool clock28m, const int SurfInterlaceField)
+{
+ NextOutLine = 0;
+ Clock28M = clock28m;
+
+ espec = espec_arg;
+
+ if(SurfInterlaceField >= 0)
+ {
+  espec->LineWidths[0] = 0;
+  espec->InterlaceOn = true;
+  espec->InterlaceField = SurfInterlaceField;
+ }
+ else
+  espec->InterlaceOn = false;
+
+ espec->DisplayRect.x = (ShowHOverscan ? 0 : 10);
+ espec->DisplayRect.y = LineVisFirst << espec->InterlaceOn;
+ espec->DisplayRect.w = 0;
+ espec->DisplayRect.h = (LineVisLast + 1 - LineVisFirst) << espec->InterlaceOn;
+}
+
+void VDP2REND_EndFrame(void)
+{
+ while(MDFN_UNLIKELY(DrawCounter.load(std::memory_order_acquire) != 0))
+ {
+  //fprintf(stderr, "SLEEEEP\n");
+  //Time::SleepMS(1);
+ }
+
+ WWQ(COMMAND_SET_BUSYWAIT, false);
+
+ if(NextOutLine < VisibleLines)
+ {
+  //printf("OutLineCounter(%d) < VisibleLines(%d)\n", OutLineCounter, VisibleLines);
+  do
+  {
+   uint16 out_line = NextOutLine;
+   uint32* target;
+
+   if(espec->InterlaceOn)
+    out_line = (out_line << 1) | espec->InterlaceField;
+
+   target = espec->surface->pixels + out_line * espec->surface->pitchinpix;
+   target[0] = target[1] = target[2] = target[3] = espec->surface->MakeColor(0, 0, 0);
+   espec->LineWidths[out_line] = 4;
+  } while(++NextOutLine < VisibleLines);
+ }
+
+ espec = NULL;
+}
+
+VDP2Rend_LIB* VDP2REND_GetLIB(unsigned line)
+{
+ assert(line < (PAL ? 256 : 240)); // NO: VisibleLines);
+
+ return &LIB[line];
+}
+
+void VDP2REND_DrawLine(const int vdp2_line, const uint32 crt_line, const bool field)
+{
+ const unsigned bwthresh = VisibleLines - 48;
+
+ if(MDFN_LIKELY(crt_line < VisibleLines))
+ {
+  uint16 out_line = crt_line;
+
+  if(espec->InterlaceOn)
+   out_line = (out_line << 1) | espec->InterlaceField;
+
+  auto wdcq = DrawCounter.fetch_add(1, std::memory_order_release);
+  WWQ(COMMAND_DRAW_LINE, ((uint16)vdp2_line << 16) | out_line, field);
+  //
+  //
+  if(crt_line == bwthresh)
+  {
+   WWQ(COMMAND_SET_BUSYWAIT, true);
+   MThreading::PostSem(WakeupSem);
+  }
+  else if(crt_line < bwthresh)
+  {
+   if(wdcq == 0)
+    DoWakeupIfNecessary = true;
+   else if((wdcq + 1) >= 64 && DoWakeupIfNecessary)
+   {
+    //printf("Post Wakeup: %3d --- crt_line=%3d\n", wdcq + 1, crt_line);
+    MThreading::PostSem(WakeupSem);
+    DoWakeupIfNecessary = false;
+   }
+  }
+
+  NextOutLine = crt_line + 1;
+ }
+}
+
+void VDP2REND_Reset(bool powering_up)
+{
+ WWQ(COMMAND_RESET, powering_up);
+}
+
+void VDP2REND_SetLayerEnableMask(uint64 mask)
+{
+ WWQ(COMMAND_SET_LEM, mask);
+}
+
+void VDP2REND_Write8_DB(uint32 A, uint16 DB)
+{
+ //if(DrawCounter.load(std::memory_order_acquire) != 0)
+  WWQ(COMMAND_WRITE8, A, DB);
+ //else
+ // MemW<uint8>(A, DB);
+}
+
+void VDP2REND_Write16_DB(uint32 A, uint16 DB)
+{
+ //if(DrawCounter.load(std::memory_order_acquire) != 0)
+  WWQ(COMMAND_WRITE16, A, DB);
+ //else
+ // MemW<uint16>(A, DB);
+}
+
+void VDP2REND_StateAction(StateMem* sm, const unsigned load, const bool data_only, uint16 (&rr)[0x100], uint16 (&cr)[2048], uint16 (&vr)[262144])
+{
+ while(MDFN_UNLIKELY(WQ_InCount.load(std::memory_order_acquire) != 0))
+  Time::SleepMS(1);
+ //
+ //
+ //
+ SFORMAT StateRegs[] =
+ {
+  SFVAR(Clock28M),	// DUBIOUS
+
+  SFVAR(MosaicVCount),
+
+  SFVAR(VCLast),
+
+  SFVAR(YCoordAccum),
+  SFVAR(MosEff_YCoordAccum),
+
+  SFVAR(CurXScrollIF),
+  SFVAR(CurYScrollIF),
+  SFVAR(CurXCoordInc),
+  SFVAR(CurLSA),
+
+  SFVAR(NBG23_YCounter),
+  SFVAR(MosEff_NBG23_YCounter),
+
+  SFVAR(CurBackTabAddr),
+  SFVAR(CurBackColor),
+
+  SFVAR(CurLCTabAddr),
+  SFVAR(CurLCColor),
+
+  // XStart and XEnd can be modified by line window processing.
+  SFVAR(Window->XStart, 2, sizeof(*Window), Window),
+  SFVAR(Window->XEnd, 2, sizeof(*Window), Window),
+  SFVAR(Window->CurXStart, 2, sizeof(*Window), Window),
+  SFVAR(Window->CurXEnd, 2, sizeof(*Window), Window),
+  SFVAR(Window->CurLineWinAddr, 2, sizeof(*Window), Window),
+
+  SFEND
+ };
+
+ // Calls to RegsWrite() should go before MDFNSS_StateAction(), and before memcpy() to VRAM and CRAM.
+ if(load)
+ {
+  for(unsigned i = 0; i < 0x100; i++)
+  {
+   RegsWrite(i << 1, rr[i]);
+  }
+ }
+
+ MDFNSS_StateAction(sm, load, data_only, StateRegs, "VDP2REND");
+
+ if(load)
+ {
+  memcpy(VRAM, vr, sizeof(VRAM));
+  memcpy(CRAM, cr, sizeof(CRAM));
+
+  RecalcColorCache();
+ }
+}
+
+}
diff -Naur -r --no-dereference ./mednafen/src/state.cpp ./emu4crt/src/state.cpp
--- ./mednafen/src/state.cpp	2019-09-03 08:16:47.000000000 -0700
+++ ./emu4crt/src/state.cpp	2019-10-04 14:21:10.053110280 -0700
@@ -470,6 +470,14 @@
 	  neowidth = MDFNGameInfo->nominal_width;
 	  neoheight = MDFNGameInfo->nominal_height;
 
+	  // SLK - Approximation to prevent SaveState snapshot corruption
+	  if(use_super_resolution)
+	  {
+	    neowidth = resolution_to_change_w;
+	    neoheight = DisplayRect->h;
+	  }
+	  // SLK - end
+	  
 	  if(LineWidths[0] != ~0)
  	  {
 	   int32 first_w = LineWidths[DisplayRect->y];
@@ -857,7 +865,9 @@
   MDFN_Error* me = dynamic_cast<MDFN_Error*>(&e);
 
   if(!fname && !suffix)
-   MDFN_Notify(MDFN_NOTICE_ERROR, _("State %d load error: %s"), CurrentState, e.what());
+   // SLK
+   // MDFN_Notify(MDFN_NOTICE_ERROR, _("State %d load error: %s"), CurrentState, e.what());
+   MDFN_Notify(MDFN_NOTICE_ERROR, _("State %d not found."), CurrentState); // SLK - shorten message to fit low-res rendering    
   else
   {
    // FIXME: Autosave kludgery, refactor interfaces in the future to make cleaner.
diff -Naur -r --no-dereference ./mednafen/src/state.cpp.orig ./emu4crt/src/state.cpp.orig
--- ./mednafen/src/state.cpp.orig	1969-12-31 16:00:00.000000000 -0800
+++ ./emu4crt/src/state.cpp.orig	2019-09-03 08:16:47.000000000 -0700
@@ -0,0 +1,879 @@
+/* Mednafen - Multi-system Emulator
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#include "mednafen.h"
+
+#include <map>
+
+#include <mednafen/Time.h>
+
+#include "driver.h"
+#include "general.h"
+#include "state.h"
+#include "movie.h"
+#include "netplay.h"
+#include "video.h"
+#include "video/resize.h"
+
+#include "MemoryStream.h"
+#include "compress/GZFileStream.h"
+
+namespace Mednafen
+{
+
+struct StateSectionMapEntry
+{
+ uint64 pos;
+ uint32 size;
+ bool used;
+};
+
+struct StateMem
+{
+ StateMem(Stream*s, bool svbe_ = false, bool fuzz_ = false) : st(s), svbe(svbe_), fuzz(fuzz_) { };
+ ~StateMem();
+
+ Stream* st = nullptr;
+ bool svbe = false;	// State variable data is stored big-endian(for normal-path state loading only).
+ bool fuzz = false;
+
+ std::map<std::string, StateSectionMapEntry> secmap; // For loads
+
+ std::exception_ptr deferred_error;
+ void ThrowDeferred(void);
+};
+
+static void MakeSectionMap(StateMem* sm, const uint64 sss_bound)
+{
+ Stream* const st = sm->st;
+ char sname_tmp[32 + 1];
+
+ while(st->tell() < sss_bound)
+ {
+  StateSectionMapEntry sme;
+
+  st->read(sname_tmp, 32);
+  sname_tmp[32] = 0;
+
+  sme.size = st->get_LE<uint32>();
+  sme.pos = st->tell();
+  sme.used = false;
+  st->seek(sme.size, SEEK_CUR);
+  //
+  std::string name_ss = sname_tmp;
+
+  if(sm->secmap.count(name_ss))
+   throw MDFN_Error(0, _("Duplicate section \"%s\" in save state!"), name_ss.c_str());
+  else
+   sm->secmap[name_ss] = sme;
+ }
+}
+
+
+static void SubWrite(Stream *st, const SFORMAT *sf)
+{
+ while(sf->size || sf->name)	// Size can sometimes be zero, so also check for the text name.  These two should both be zero only at the end of a struct.
+ {
+  if(!sf->size || !sf->data)
+  {
+   sf++;
+   continue;
+  }
+
+  if(sf->size == ~0U)		/* Link to another struct.	*/
+  {
+   SubWrite(st, (const SFORMAT *)sf->data);
+
+   sf++;
+   continue;
+  }
+
+  int32 bytesize = sf->size;
+  uintptr_t p = (uintptr_t)sf->data;
+  uint32 repcount = sf->repcount;
+  const size_t repstride = sf->repstride; 
+  char nameo[1 + 255];
+  const int slen = strlen(sf->name);
+
+  if(slen > 255)
+   throw MDFN_Error(0, _("State variable name \"%s\" is too long."), sf->name);
+
+  memcpy(&nameo[1], sf->name, slen);
+  nameo[0] = slen;
+
+  st->write(nameo, 1 + nameo[0]);
+  st->put_LE<uint32>(bytesize * (repcount + 1));
+
+  do
+  {
+   // Special case for the evil bool type, to convert bool to 1-byte elements.
+   if(!sf->type)
+   {
+    for(int32 bool_monster = 0; bool_monster < bytesize; bool_monster++)
+    {
+     uint8 tmp_bool = ((bool *)p)[bool_monster];
+     //printf("Bool write: %.31s\n", sf->name);
+     st->write(&tmp_bool, 1);
+    }
+   }
+   else
+   {
+    st->write((void*)p, bytesize);
+   }
+  } while(p += repstride, repcount--);
+
+  sf++; 
+ }
+}
+
+struct compare_cstr
+{
+ bool operator()(const char *s1, const char *s2) const
+ {
+  return(strcmp(s1, s2) < 0);
+ }
+};
+
+typedef std::map<const char *, const SFORMAT *, compare_cstr> SFMap_t;
+
+static void MakeSFMap(const SFORMAT *sf, SFMap_t &sfmap)
+{
+ while(sf->size || sf->name) // Size can sometimes be zero, so also check for the text name.  These two should both be zero only at the end of a struct.
+ {
+  if(!sf->size || !sf->data)
+  {
+   sf++;
+   continue;
+  }
+
+  if(sf->size == ~0U)            /* Link to another SFORMAT structure. */
+   MakeSFMap((const SFORMAT *)sf->data, sfmap);
+  else
+  {
+   assert(sf->name);
+
+   if(sfmap.find(sf->name) != sfmap.end())
+    printf("Duplicate save state variable in internal emulator structures(CLUB THE PROGRAMMERS WITH BREADSTICKS): %s\n", sf->name);
+
+   sfmap[sf->name] = sf;
+  }
+
+  sf++;
+ }
+}
+
+static void ReadStateChunk(Stream *st, const SFORMAT *sf, const char* sname, uint32 size, const bool svbe, const bool fuzz)
+{
+ SFMap_t sfmap;
+ SFMap_t sfmap_found;	// Used for identifying variables that are missing in the save state.
+
+ MakeSFMap(sf, sfmap);
+
+ uint64 temp = st->tell();
+ while(st->tell() < (temp + size))
+ {
+  uint32 recorded_size;	// In bytes
+  uint8 toa[1 + 256];	// Don't change to char unless cast toa[0] to unsigned to smem_read() and other places.
+
+  st->read(toa, 1);
+  st->read(toa + 1, toa[0]);
+
+  toa[1 + toa[0]] = 0;
+
+  recorded_size = st->get_LE<uint32>();
+
+  SFMap_t::iterator sfmit;
+
+  sfmit = sfmap.find((char *)toa + 1);
+
+  if(sfmit != sfmap.end())
+  {
+   const SFORMAT *tmp = sfmit->second;
+
+   if(recorded_size != tmp->size * (1 + tmp->repcount))
+   {
+    // Don't error out(throw), but still printf-log it.
+    printf("Variable in save state wrong size: %s.  Need: %u, got: %u\n", toa + 1, tmp->size * (1 + tmp->repcount), recorded_size);
+    st->seek(recorded_size, SEEK_CUR);
+   }
+   else
+   {
+    const auto type = tmp->type;
+    const uint32 expected_size = tmp->size;	// In bytes
+    uintptr_t p = (uintptr_t)tmp->data;
+    uint32 repcount = tmp->repcount;
+    const size_t repstride = tmp->repstride; 
+
+    sfmap_found[tmp->name] = tmp;
+
+    do
+    {
+     st->read((void*)p, expected_size);
+
+     if(MDFN_UNLIKELY(fuzz))
+     {
+      static uint64 lcg[2] = { 0xDEADBEEFCAFEBABEULL, 0x0123456789ABCDEFULL };
+
+      for(unsigned i = 0; i < expected_size; i++)
+      {
+       ((uint8*)p)[i] = (lcg[0] ^ lcg[1]) >> 28;
+       lcg[0] = (19073486328125ULL * lcg[0]) + 1;
+       lcg[1] = (6364136223846793005ULL * lcg[1]) + 1442695040888963407ULL;
+      }
+     }
+
+     if(!type)
+     {
+      // Converting downwards is necessary for the case of sizeof(bool) > 1
+      for(int32 bool_monster = expected_size - 1; bool_monster >= 0; bool_monster--)
+      {
+       ((bool *)p)[bool_monster] = ((uint8 *)p)[bool_monster] & 1;
+      }
+     }
+     else if(svbe != MDFN_IS_BIGENDIAN)
+     {
+      switch(type)
+      {
+       case 2: Endian_A16_Swap((void*)p, expected_size / sizeof(uint16)); break;
+       case 4: Endian_A32_Swap((void*)p, expected_size / sizeof(uint32)); break;
+       case 8: Endian_A64_Swap((void*)p, expected_size / sizeof(uint64)); break;
+      }
+     }
+    } while(p += repstride, repcount--);
+   }
+  }
+  else
+  {
+   printf("Unknown variable in save state section \"%s\": %s\n", sname, toa + 1);
+   st->seek(recorded_size, SEEK_CUR);
+  }
+ } // while(...)
+
+ for(SFMap_t::const_iterator it = sfmap.begin(); it != sfmap.end(); it++)
+ {
+  if(sfmap_found.find(it->second->name) == sfmap_found.end())
+  {
+   printf("Variable of bytesize %u missing from save state section \"%s\": %s\n", it->second->size * (1 + it->second->repcount), sname, it->second->name);
+  }
+ }
+}
+
+//
+// Fast raw chunk reader/writer.
+//
+template<bool load>
+static void FastRWChunk(Stream *st, const SFORMAT *sf)
+{
+ while(sf->size || sf->name)	// Size can sometimes be zero, so also check for the text name.  These two should both be zero only at the end of a struct.
+ {
+  if(!sf->size || !sf->data)
+  {
+   sf++;
+   continue;
+  }
+
+  if(sf->size == ~0U)		/* Link to another struct.	*/
+  {
+   FastRWChunk<load>(st, (const SFORMAT *)sf->data);
+
+   sf++;
+   continue;
+  }
+
+  int32 bytesize = sf->size;
+  uintptr_t p = (uintptr_t)sf->data;
+  uint32 repcount = sf->repcount;
+  const size_t repstride = sf->repstride; 
+
+  // If we're only saving the raw data, and we come across a bool type, we save it as it is in memory, rather than converting it to
+  // 1-byte.  In the SFORMAT structure, the size member for bool entries is the number of bool elements, not the total in-memory size,
+  // so we adjust it here.
+  if(!sf->type)
+   bytesize *= sizeof(bool);
+  
+  //
+  // Align large variables(e.g. RAM) to a 16-byte boundary for potentially faster memory copying, before we read/write it.
+  //
+  if(bytesize >= 65536)
+   st->seek((st->tell() + 15) &~ 15, SEEK_SET);
+
+  do
+  {
+   if(load)
+    st->read((void*)p, bytesize);
+   else
+    st->write((void*)p, bytesize);
+  } while(p += repstride, repcount--);
+  sf++; 
+ }
+}
+
+//
+// When updating this function make sure to adhere to the guarantees in state.h.
+//
+bool MDFNSS_StateAction(StateMem *sm, const unsigned load, const bool data_only, const SFORMAT *sf, const char *sname, const bool optional) noexcept
+{
+ //printf("Section: %s %zu\n", sname, strlen(sname));
+
+ if(MDFN_UNLIKELY(sm->deferred_error))
+ {
+  return(load ? false : true);
+ }
+
+ try
+ {
+  Stream* st = sm->st;
+
+  if(MDFN_LIKELY(data_only))	// Not particularly likely, but it's more important to optimize for this code path...
+  {
+   static const uint8 SSFastCanary[8] = { 0x42, 0xA3, 0x10, 0x87, 0xBC, 0x6D, 0xF2, 0x79 };
+   char sname_canary[32 + 8];
+
+   if(load)
+   {
+    st->read(sname_canary, 32 + 8);
+
+    if(strncmp(sname_canary, sname, 32))
+     throw MDFN_Error(0, _("Section name mismatch in state loading fast path."));
+
+    if(memcmp(sname_canary + 32, SSFastCanary, 8))
+     throw MDFN_Error(0, _("Section canary is a zombie AAAAAAAAAAGH!"));
+
+    FastRWChunk<true>(st, sf);
+   }
+   else
+   {
+    memset(sname_canary, 0, sizeof(sname_canary));
+    strncpy(sname_canary, sname, 32);
+    memcpy(sname_canary + 32, SSFastCanary, 8);
+    st->write(sname_canary, 32 + 8);
+
+    FastRWChunk<false>(st, sf);
+   }
+  }
+  else
+  {
+   if(load)
+   {
+    auto msme = sm->secmap.find(sname);
+
+    if(msme == sm->secmap.end())
+    {
+     if(optional)
+     {
+      printf("Missing optional section: %.32s\n", sname);
+
+      return false;
+     }
+     else
+      throw MDFN_Error(0, _("Section missing: %.32s"), sname);
+    }
+    else
+    {
+     msme->second.used = true;
+     st->seek(msme->second.pos, SEEK_SET);
+     ReadStateChunk(st, sf, sname, msme->second.size, sm->svbe, sm->fuzz);
+    }
+   }
+   else
+   {
+    int64 data_start_pos;
+    int64 end_pos;
+    uint8 sname_tmp[32];
+
+    memset(sname_tmp, 0, sizeof(sname_tmp));
+    strncpy((char *)sname_tmp, sname, 32);
+
+    if(strlen(sname) > 32)
+     printf("Warning: section name is too long: %s\n", sname);
+
+    st->write(sname_tmp, 32);
+
+    st->put_LE<uint32>(0);                // We'll come back and write this later.
+
+    data_start_pos = st->tell();
+    SubWrite(st, sf);
+    end_pos = st->tell();
+
+    st->seek(data_start_pos - 4, SEEK_SET);
+    st->put_LE<uint32>(end_pos - data_start_pos);
+    st->seek(end_pos, SEEK_SET);
+   }
+  }
+ }
+ catch(...)
+ {
+  sm->deferred_error = std::current_exception();
+  return(load ? false : true);
+ }
+ return(true);
+}
+
+StateMem::~StateMem(void)
+{
+
+}
+
+void StateMem::ThrowDeferred(void)
+{
+ if(deferred_error)
+ {
+  std::exception_ptr te = deferred_error;
+  deferred_error = nullptr;
+  std::rethrow_exception(te);
+ }
+}
+
+void MDFNSS_SaveSM(Stream *st, bool data_only, const MDFN_Surface *surface, const MDFN_Rect *DisplayRect, const int32 *LineWidths)
+{
+	if(!MDFNGameInfo->StateAction)
+	{
+	 throw MDFN_Error(0, _("Module \"%s\" doesn't support save states."), MDFNGameInfo->shortname);
+	}
+
+	StateMem sm(st);
+
+	if(data_only)
+	{
+	 MDFN_StateAction(&sm, 0, true);
+	 sm.ThrowDeferred();
+	}
+	else
+	{
+	 static const char *header_magic = "MDFNSVST";
+	 int64 start_pos;
+         uint8 header[32];
+	 int neowidth = 0, neoheight = 0;
+
+	 memset(header, 0, sizeof(header));
+
+	 if(surface && DisplayRect && LineWidths)
+	 {
+	  bool is_multires = false;
+
+	  // We'll want to use the nominal width if the source rectangle is > 25% off on either axis, or the source image has
+	  // multiple horizontal resolutions.
+	  neowidth = MDFNGameInfo->nominal_width;
+	  neoheight = MDFNGameInfo->nominal_height;
+
+	  if(LineWidths[0] != ~0)
+ 	  {
+	   int32 first_w = LineWidths[DisplayRect->y];
+
+	   for(int y = 0; y < DisplayRect->h; y++)
+	   {
+	    if(LineWidths[DisplayRect->y + y] != first_w)
+	    {
+	     //puts("Multires!");
+	     is_multires = true;
+	    }
+	   }
+	  }
+
+	  if(!is_multires)
+	  {
+	   if(((double)DisplayRect->w / MDFNGameInfo->nominal_width) > 0.75  && ((double)DisplayRect->w / MDFNGameInfo->nominal_width) < 1.25)
+	    neowidth = DisplayRect->w;
+
+           if(((double)DisplayRect->h / MDFNGameInfo->nominal_height) > 0.75  && ((double)DisplayRect->h / MDFNGameInfo->nominal_height) < 1.25)
+	    neoheight = DisplayRect->h;
+	  }
+	 }
+
+	 memcpy(header, header_magic, 8);
+
+	 MDFN_en64lsb(header + 8, Time::EpochTime());
+
+	 MDFN_en32lsb(header + 16, MEDNAFEN_VERSION_NUMERIC);
+	 MDFN_en32lsb(header + 24, neowidth);
+	 MDFN_en32lsb(header + 28, neoheight);
+
+	 start_pos = st->tell();
+	 st->write(header, 32);
+
+	 if(surface && DisplayRect && LineWidths)
+	 {
+	  //
+	  // TODO: Make work with 8bpp and 16bpp.
+	  //
+	  MDFN_Surface dest_surface(NULL, neowidth, neoheight, neowidth, surface->format);
+	  MDFN_Rect dest_rect;
+
+	  dest_rect.x = 0;
+	  dest_rect.y = 0;
+	  dest_rect.w = neowidth;
+	  dest_rect.h = neoheight;
+
+	  MDFN_ResizeSurface(surface, DisplayRect, LineWidths, &dest_surface, &dest_rect);
+
+	  {
+	   uint32* previewbuffer = dest_surface.pixels;
+	   uint8* previewbuffer8 = (uint8*)previewbuffer;
+
+	   for(int32 a = 0; a < neowidth * neoheight; a++)
+	   {
+	    int nr, ng, nb;
+
+	    surface->DecodeColor(previewbuffer[a], nr, ng, nb);
+
+	    previewbuffer8[0] = nr;
+	    previewbuffer8[1] = ng;
+	    previewbuffer8[2] = nb;
+
+	    previewbuffer8 += 3;
+	   }
+	  }
+
+          st->write((uint8*)dest_surface.pixels, 3 * neowidth * neoheight);
+	 }
+
+	 MDFN_StateAction(&sm, 0, data_only);
+	 sm.ThrowDeferred();
+
+	 {
+	  int64 end_pos = st->tell();
+	  uint32 pv = (end_pos - start_pos) & 0x7FFFFFFF;
+
+	  #ifdef MSB_FIRST
+	  pv |= 0x80000000;
+	  #endif
+
+	  st->seek(start_pos + 16 + 4, SEEK_SET);
+	  st->put_LE<uint32>(pv);
+	  st->seek(end_pos, SEEK_SET);		// Seek to just beyond end of save state before returning.
+	 }
+	}
+}
+
+void MDFNSS_LoadSM(Stream *st, bool data_only, bool fuzz)
+{
+	if(!MDFNGameInfo->StateAction)
+	{
+	 throw MDFN_Error(0, _("Module \"%s\" doesn't support save states."), MDFNGameInfo->shortname);
+	}
+
+	if(MDFN_LIKELY(data_only))
+	{
+	 StateMem sm(st);
+	 MDFN_StateAction(&sm, MEDNAFEN_VERSION_NUMERIC, true);
+	 sm.ThrowDeferred();
+	}
+	else
+	{
+         uint8 header[32];
+	 uint32 width, height, preview_len;
+  	 uint32 stateversion;
+	 uint32 total_len;
+	 int64 start_pos;
+	 bool svbe;
+
+	 start_pos = st->tell();
+         st->read(header, 32);
+
+         if(memcmp(header, "MEDNAFENSVESTATE", 16) && memcmp(header, "MDFNSVST", 8))
+	  throw MDFN_Error(0, _("Missing/Wrong save state header ID."));
+
+	 stateversion = MDFN_de32lsb(header + 16);
+	 total_len = MDFN_de32lsb(header + 20) & 0x7FFFFFFF;
+         svbe = MDFN_de32lsb(header + 20) & 0x80000000;
+         width = MDFN_de32lsb(header + 24);
+         height = MDFN_de32lsb(header + 28);
+	 preview_len = width * height * 3;
+
+	 if((int)stateversion < 0x900)	// Ensuring that (int)stateversion is > 0 is the most important part.
+	  throw MDFN_Error(0, _("Invalid/Unsupported version in save state header."));
+
+	 st->seek(preview_len, SEEK_CUR);				// Skip preview
+
+	 {
+	  StateMem sm(st, svbe, fuzz);
+
+	  MakeSectionMap(&sm, start_pos + total_len);
+
+	  MDFN_StateAction(&sm, stateversion, false);			// Load state data.
+
+	  for(auto msme : sm.secmap)
+	  {
+	   if(!msme.second.used)
+	    printf("Warning: Unused section \"%s\".\n", msme.first.c_str());
+	  }
+
+	  sm.ThrowDeferred();
+	 }
+	 st->seek(start_pos + total_len, SEEK_SET);			// Seek to just beyond end of save state before returning.
+	}
+}
+
+//
+//
+//
+static int SaveStateStatus[10];
+static int CurrentState = 0;
+static int RecentlySavedState = -1;
+
+void MDFNSS_CheckStates(void)
+{
+	int64 last_time = 0;
+
+        if(!MDFNGameInfo->StateAction) 
+         return;
+
+	for(int ssel = 0; ssel < 10; ssel++)
+        {
+	 SaveStateStatus[ssel] = false;
+
+	 try
+	 {
+	  VirtualFS::FileInfo finfo;
+
+	  //printf("%s\n", MDFN_MakeFName(MDFNMKF_STATE, ssel, 0).c_str());
+	  NVFS.finfo(MDFN_MakeFName(MDFNMKF_STATE, ssel, 0), &finfo);
+	  //
+	  SaveStateStatus[ssel] = true;
+	  if(finfo.mtime_us > last_time)
+	  {
+	   RecentlySavedState = ssel;
+	   last_time = finfo.mtime_us;
+ 	  }
+	 }
+	 catch(...)
+	 {
+
+	 }
+        }
+
+	CurrentState = 0;
+	MDFND_SetStateStatus(NULL);
+}
+
+void MDFNSS_GetStateInfo(const std::string& path, StateStatusStruct* status)
+{
+ uint32 StateShowPBWidth;
+ uint32 StateShowPBHeight;
+ uint8 *previewbuffer = NULL;
+
+ try
+ {
+  GZFileStream fp(path, GZFileStream::MODE::READ);
+  uint8 header[32];
+
+  fp.read(header, 32);
+
+  uint32 width = MDFN_de32lsb(header + 24);
+  uint32 height = MDFN_de32lsb(header + 28);
+
+  if(width > 1024)
+   width = 1024;
+
+  if(height > 1024)
+   height = 1024;
+
+  previewbuffer = new uint8[3 * width * height];
+  fp.read(previewbuffer, 3 * width * height);
+
+  StateShowPBWidth = width;
+  StateShowPBHeight = height;
+ }
+ catch(std::exception &e)
+ {
+  if(previewbuffer != NULL)
+  {
+   delete[] previewbuffer;
+   previewbuffer = NULL;
+  }
+
+  StateShowPBWidth = MDFNGameInfo->nominal_width;
+  StateShowPBHeight = MDFNGameInfo->nominal_height;
+ }
+
+ status->gfx = previewbuffer;
+ status->w = StateShowPBWidth;
+ status->h = StateShowPBHeight;
+}
+
+void MDFNI_SelectState(int w) noexcept
+{
+ if(!MDFNGameInfo->StateAction) 
+  return;
+
+ if(w == -1) 
+ {  
+  MDFND_SetStateStatus(NULL);
+  return; 
+ }
+
+ MDFNI_SelectMovie(-1);
+
+ try
+ {
+  if(w == 666 + 1)
+   CurrentState = (CurrentState + 1) % 10;
+  else if(w == 666 - 1)
+  {
+   CurrentState--;
+
+   if(CurrentState < 0 || CurrentState > 9)
+    CurrentState = 9;
+  }
+  else
+   CurrentState = w;
+
+  std::unique_ptr<StateStatusStruct> status(new StateStatusStruct());
+
+  memset(status.get(), 0, sizeof(StateStatusStruct));
+ 
+  memcpy(status->status, SaveStateStatus, 10 * sizeof(int));
+
+  status->current = CurrentState;
+  status->recently_saved = RecentlySavedState;
+
+  MDFNSS_GetStateInfo(MDFN_MakeFName(MDFNMKF_STATE, CurrentState, NULL), status.get());
+  MDFND_SetStateStatus(status.release());
+ }
+ catch(std::exception& e)
+ {
+  MDFN_Notify(MDFN_NOTICE_WARNING, "%s", e.what());
+  MDFND_SetStateStatus(NULL);
+ }
+}  
+
+bool MDFNI_SaveState(const char *fname, const char *suffix, const MDFN_Surface *surface, const MDFN_Rect *DisplayRect, const int32 *LineWidths) noexcept
+{
+ bool ret = true;
+
+ try
+ {
+  if(MDFNnetplay && (MDFNGameInfo->SaveStateAltersState == true))
+  {
+   throw MDFN_Error(0, _("Module %s is not compatible with manual state saving during netplay."), MDFNGameInfo->shortname);
+  }
+
+  //
+  //
+  {
+   MemoryStream st(65536);
+
+   MDFNSS_SaveSM(&st, false, surface, DisplayRect, LineWidths);
+
+   //
+   //
+   //
+   GZFileStream gp(fname ? std::string(fname) : MDFN_MakeFName(MDFNMKF_STATE,CurrentState,suffix),
+			GZFileStream::MODE::WRITE, MDFN_GetSettingI("filesys.state_comp_level"));
+
+   gp.write(st.map(), st.size());
+   gp.close();
+  }
+
+  MDFND_SetStateStatus(NULL);
+
+  if(!fname && !suffix)
+  {
+   SaveStateStatus[CurrentState] = true;
+   RecentlySavedState = CurrentState;
+   MDFN_Notify(MDFN_NOTICE_STATUS, _("State %d saved."), CurrentState);
+  }
+ }
+ catch(std::exception &e)
+ {
+  if(!fname && !suffix)
+   MDFN_Notify(MDFN_NOTICE_ERROR, _("State %d save error: %s"), CurrentState, e.what());
+  else
+   MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+
+  if(MDFNnetplay)
+   MDFND_NetplayText(e.what(), false);
+
+  ret = false;
+ }
+
+ return(ret);
+}
+
+bool MDFNI_LoadState(const char *fname, const char *suffix) noexcept
+{
+ bool ret = true;
+
+ try
+ {
+  /* For network play and movies, be load the state locally, and then save the state to a temporary buffer,
+     and send or record that.  This ensures that if an older state is loaded that is missing some
+     information expected in newer save states, desynchronization won't occur(at least not
+     from this ;)).
+  */
+
+  {
+   GZFileStream st(fname ? std::string(fname) : MDFN_MakeFName(MDFNMKF_STATE,CurrentState,suffix), GZFileStream::MODE::READ);
+   uint8 header[32];
+   uint32 st_len;
+
+   st.read(header, 32);
+
+   st_len = MDFN_de32lsb(header + 16 + 4) & 0x7FFFFFFF;
+
+   if(st_len < 32)
+    throw MDFN_Error(0, _("Save state header length field is bad."));
+
+   MemoryStream sm(st_len, -1);
+
+   memcpy(sm.map(), header, 32);
+   st.read(sm.map() + 32, st_len - 32);
+
+   MDFNSS_LoadSM(&sm, false);
+  }
+
+  if(MDFNnetplay)
+  {
+   NetplaySendState();
+  }
+
+  if(MDFNMOV_IsRecording())
+   MDFNMOV_RecordState();
+
+  MDFND_SetStateStatus(NULL);
+
+  if(!fname && !suffix)
+  {
+   SaveStateStatus[CurrentState] = true;
+   MDFN_Notify(MDFN_NOTICE_STATUS, _("State %d loaded."), CurrentState);
+  }
+ }
+ catch(std::exception &e)
+ {
+  MDFN_Error* me = dynamic_cast<MDFN_Error*>(&e);
+
+  if(!fname && !suffix)
+   MDFN_Notify(MDFN_NOTICE_ERROR, _("State %d load error: %s"), CurrentState, e.what());
+  else
+  {
+   // FIXME: Autosave kludgery, refactor interfaces in the future to make cleaner.
+   if(suffix && me && me->GetErrno() == ENOENT)
+    return true;
+
+   MDFND_OutputNotice(MDFN_NOTICE_ERROR, e.what());
+  }
+
+  if(MDFNnetplay)
+   MDFND_NetplayText(e.what(), false);
+
+  ret = false;
+ }
+
+ return(ret);
+}
+
+}
